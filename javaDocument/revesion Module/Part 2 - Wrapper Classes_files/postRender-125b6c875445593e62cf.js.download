"use strict";(self.webpackChunknotion_next=self.webpackChunknotion_next||[]).push([[8586],{80567:(e,t,i)=>{i.d(t,{a:()=>s});var n=i(19234),o=i(54642);async function s(e,t){const i=(0,n.gq)(t);if("skip"===i)return{valid:!0};if("insufficient_data"===i)return{valid:!1};const s=await(0,o.resolveAddress)(e,{address:{line1:t.addressLine1,city:t.city,zip:t.zipCode,state:t.state,country:t.country}});return"failed"===s.type?{valid:!1}:s.data}},87461:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Rr});var n=i(77094),o=i.n(n),s=i(67294),a=i.n(s),r=i(83355),l=i(23537),d=i(28350),c=i(88108),u=i(88266),m=i(77907),p=i(49085);class g extends p.Z{getInitialState(){return{open:!1}}}const h=new g,f={position:"fixed",right:"calc(50% - ".concat(160,"px)"),bottom:0,width:"".concat(320,"px"),color:"white",background:"rgba(0, 0, 0, 0.75)",padding:"".concat(8,"px")},v={fontWeight:600,fontSize:"14px"};function y(e){const t=(0,d.Kw)(h).open;return o()(u.Z,{open:t,render:()=>o()("div",{style:f},void 0,o()("div",{style:v},void 0,"MessageStore metrics"),o()(m.LazyMessageStoreDebugChart,{width:304,height:64}))})}(0,c.exposeDebugValue)("toggleMessageStoreDebugPanel",(()=>{h.setState({open:!h.state.open})}));var S=i(27832),b=i(19671),M=i(13023),w=i(41464),C=i(77422),k=i.n(C),T=(i(33948),i(54564)),I=i(10663),Z=i(45094),P=i(24229),_=i(21202),x=i(5366),F=i(78089),A=i(60709),B=i(65598),E=i(34859),R=i(19895),D=i(97543),L=i(36488),O=i(72897),N=i(3386),U=i(78140),W=i(40721),V=i(37064),z=i(66957);const q=[P.u.Open,P.u.Resolved];class H extends r.Z{constructor(){super(...arguments),k()(this,"deepDiscussionsStores",this.createComputedStore((()=>{const{discussionIds:e}=this.props,{blockStore:t,recursivelyLoadAllDiscussions:i}=this.props;return B.al(t,{recursivelyLoadAllDiscussions:i}).filter((t=>!e||e.includes(t.id)||(0,F.De)(t)))}))),k()(this,"handleChangeTab",(e=>{const t=P.Z.state;t.open&&P.Z.setState({...t,tab:q[e]})})),k()(this,"handleBackspace",(e=>{null==e||e.preventDefault(),T.LZ()}))}renderComponent(){if((0,Z.Sx)(this.environment))return null;const{device:e}=this.environment;let t;return t=e.isMobile?{menuType:A.o.Modal,title:o()(x.FormattedMessage,{defaultMessage:"Comments",id:"blockDiscussionMenu.mobileMenu.title"}),header:this.renderMenuHeader(),right:o()(W.DoneMenuText,{}),onClickRight:T.LZ,whiteBackground:!0}:{menuType:A.o.Popup,header:this.renderMenuHeader(),width:480,maxHeight:"50vh",onClickOutside:T.LZ},o()(O.Z,{capture:!0,preventType:E.Z.All},void 0,o()(L.Z,{capture:!0,allowMobileAutoScroll:!0,render:()=>o()(N.Z,{capture:!0,onEsc:T.LZ,onBackspace:this.handleBackspace,onDelete:this.handleBackspace},void 0,o()(V.Z,{store:this.props.blockStore,droppable:!0,render:()=>a().createElement(U.Z,t,this.renderMenuContent())},this.props.blockStore.id))}))}renderMenuHeader(){const{device:e}=this.environment,{resolved:t,unresolved:i}=B.bB(this.deepDiscussionsStores.state),n=i.length,s=t.length;return 0===s||0===n?null:o()(z.Z,{tabs:[o()(x.FormattedMessage,{defaultMessage:"Open ({numberOfOpenDiscussions})",id:"blockDiscussionMenu.openDiscussionsTab.title",values:{numberOfOpenDiscussions:n}}),o()(x.FormattedMessage,{defaultMessage:"Resolved ({numberOfResolvedDiscussions})",id:"blockDiscussionMenu.resolvedDiscussionsTab.title",values:{numberOfResolvedDiscussions:s}})],selectedIndex:q.indexOf(this.props.tab),onChange:this.handleChangeTab,style:{...e.isAndroid&&{borderBottom:"none"}}})}renderMenuContent(){const{device:e}=this.environment,{resolved:t,unresolved:i}=B.bB(this.deepDiscussionsStores.state);if(this.props.tab===P.u.Open){if(i.length){const t=i.map(((e,t,i)=>o()(D.Z,{store:e,format:F.O2.Menu,isFirst:0===t,isOnly:1===i.length,discussionLocation:"block_menu",showResolveButtonByDefaultIfPossible:!0,blockStore:this.props.blockStore,onDismiss:T.LZ},e.id))),n=this.props.blockStore.getType(),a=n&&_.p2[n];if(e.isMobile&&a){const e=R.h(this.props.blockStore);return e?o()(s.Fragment,{},void 0,o()("div",{style:{padding:"12px 16px",boxShadow:"0 1px 0 ".concat(this.theme.regularDividerColor),marginBottom:1}},void 0,o()(e,{store:this.props.blockStore,disabled:!0,hideContent:!0,style:{fontSize:14,pointerEvents:"none"},isQuickFind:!0})),t):t}return t}return this.renderEmptyState(o()(x.FormattedMessage,{defaultMessage:"No comments to show.",id:"blockDiscussionMenu.emptyState.noCommentsMessage"}))}return t.length?t.map(((e,t,i)=>o()(D.Z,{store:e,format:F.O2.Menu,isFirst:0===t,isOnly:1===i.length,discussionLocation:"block_menu",showResolveButtonByDefaultIfPossible:!0,blockStore:this.props.blockStore,onDismiss:T.LZ},e.id))):this.renderEmptyState(o()(x.FormattedMessage,{defaultMessage:"No resolved comments.",id:"blockDiscussionMenu.emptyState.noResolvedCommentsMessage"}))}renderEmptyState(e){const{device:t}=this.environment;return o()("div",{style:{textAlign:"center",padding:t.isMobile?"64px 18px":"32px 18px 36px",fontSize:14,color:this.theme.mediumTextColor}},void 0,e)}}const G=H;var K=i(44532);class j extends r.Z{constructor(){super(...arguments),k()(this,"renderDiscussionMenu",(()=>{if(P.Z.state.open&&!(0,Z.Sx)(this.environment))return o()(G,{rect:P.Z.state.rect,tab:P.Z.state.tab,blockStore:P.Z.state.blockStore,discussionIds:P.Z.state.discussionIds,recursivelyLoadAllDiscussions:P.Z.state.recursivelyLoadAllDiscussions})}))}renderComponent(){const{device:e}=this.environment,{rect:t}=P.Z.state,i=!(0,Z.Sx)(this.environment)&&P.Z.state.open&&!(0,I.az)(this.environment,P.Z.state.blockStore);return o()(K.ZP,{popupType:e.isMobile?K.ZP.PopupType.SlideUp:K.ZP.PopupType.Popup,open:i,originRect:t,placementToOrigin:K.ZP.Placement.Bottom,alignmentToOrigin:K.ZP.Alignment.Center,disableMouseCapture:!0,originGap:4,render:this.renderDiscussionMenu,preventScaleTransition:!0,preventOpacityTransition:!0,onDismiss:T.LZ})}}const Y=j;var Q=i(96486),X=i.n(Q),J=i(29369),$=i(50906),ee=i(6404),te=i(33665),ie=i(35328),ne=i(8949),oe=i(20431),se=i(27724),ae=i(13713),re=i(80209),le=i(48019),de=i(68894),ce=i(72495),ue=i(83182);class me extends r.Z{constructor(){super(...arguments),k()(this,"renderOverlay",(()=>{const{device:e}=this.environment,t=ne.Z.state;if(!t.isActive)return;const{originBlockRect:i,actions:n,inputValue:s,publicEditMode:r}=t,l={environment:this.environment,blocks:t.stores,originRect:i,publicEditMode:r},d=t.showInput&&this.renderInputSection(),c=t.stores[0];let u;return u=e.isPhone?{menuType:A.o.Modal,title:o()(x.FormattedMessage,{defaultMessage:"Actions",id:"blockMenu.actionButton.label"}),right:o()(W.DoneMenuText,{}),onClickRight:this.handleOverlayBgClick,header:d}:{menuType:A.o.Popup,width:265,header:d},o()(N.Z,{capture:!0,onBackspace:X().identity},void 0,a().createElement(U.Z,u,o()(le.Z,{filter:s,context:l,sections:n,onAccept:this.handleAccept,initialFocus:s?0:void 0}),!s&&this.renderBlockAuthorInfo(),!s&&o()(re.Z,{store:c}),!s&&c.isCollectionView()&&this.renderCollectionHelpButton()))})),k()(this,"handleOverlayBgClick",(()=>{ee.xv()})),k()(this,"handleAccept",(e=>{const t=ne.Z.state;if(!t.isActive)return;const{stores:i}=se.default.state,{analyticsFrom:n}=t,o=i[0];if(o){const t=o.getParentTable(),i=o.getType();if(i&&t){let s;if(t===J.e0){const e=o.getParentId(),{currentSpaceStore:t}=S.default.getState();t&&void 0!==e&&(s=oe.Z.createChildStore(t,{table:J.e0,id:e}))}$.trackBlockAction(this.environment,{analyticsName:e.analyticsName,from:n,block_id:o.id,block_type:i,parentTeamStore:s,is_toggleable:(0,ie._A)(i,o.getFormat())})}}e.closeParentMenu&&ee.xv()})),k()(this,"handleInputChange",(e=>{ne.Z.state.isActive&&ne.Z.setState({...ne.Z.state,inputValue:e.target.value})}))}renderComponent(){const{device:e}=this.environment,t=ne.Z.state;return o()(K.ZP,{popupType:e.isPhone?K.ZP.PopupType.SlideUp:K.ZP.PopupType.Popup,open:t.isActive,originRect:t.isActive?t.originBlockRect:void 0,onDismiss:this.handleOverlayBgClick,placementToOrigin:K.ZP.Placement.Bottom,alignmentToOrigin:K.ZP.Alignment.Start,originGap:0,preventScaleTransition:!0,render:this.renderOverlay,preventBlockRenderQueueOnEnter:e.isMobile})}renderBlockAuthorInfo(){const e=ne.Z.state;if(e.isActive&&!(e.stores.length>1))return o()(ae.Z,{store:e.stores[0],isPageMoreButton:!1})}renderInputSection(){const{device:e}=this.environment,{intl:t}=this.props,i=ne.Z.state;if(!i.isActive||e.isPhone)return;const{inputValue:n}=i;return o()(ce.Z,{isInput:!0},void 0,o()(de.ZP,{value:n,onChange:this.handleInputChange,focus:!0,focusAfterAnimation:!0,placeholder:t.formatMessage({defaultMessage:"Search actions…",id:"blockMenu.filterForActions.placeholder"}),preventCaptureDeleteWhenEmpty:!0}))}renderCollectionHelpButton(){return o()(ce.Z,{topBorder:!0},void 0,o()(ue.Z,{title:o()(x.FormattedMessage,{defaultMessage:"Learn about databases",id:"blocks.blockMenu.collectionHelpButton"}),href:(0,te.UY)("guides.database"),analyticsFrom:"block_menu"}))}}const pe=(0,x.injectIntl)(me);var ge=i(97464),he=i.n(ge),fe=i(62965),ve=i(79554),ye=i(43250),Se=i(33929),be=i(61207),Me=i(52275),we=i(58189);const Ce=(0,x.defineMessages)({createTransclusion:{defaultMessage:"Paste and sync",id:"blockPasteMenu.actions.createTransclusion.title"},linkToPage:{defaultMessage:"Link to page",id:"blockPasteMenu.actions.linkToPage.title"},dismissItem:{defaultMessage:"Dismiss",id:"blockPasteMenu.actions.dismiss.title"}});class ke extends r.Z{constructor(){super(...arguments),k()(this,"renderMenu",(()=>{const{device:e}=this.environment,t=be.Z.state;if(!t.open)return;const i=this.getSections(t);let n;return n=e.isMobile?{menuType:A.o.ActionSheet}:{menuType:A.o.Popup,width:320,maxHeight:"40vh"},a().createElement(U.Z,he()({},n,{className:ye.sr}),o()(we.Z,{type:we.i.Vertical,sections:i,initialFocus:0}))})),k()(this,"handleDismiss",(()=>{ve.xv()}))}willMountOrUpdate(){const e=be.Z.state;if(e.open){const{stores:t,phase:i}=se.default.state;(0,fe.Z)(t,e.blocks)&&i===se.SelectionPhase.Selected||ve.xv()}}renderComponent(){const{device:e}=this.environment,t=be.Z.state;return o()(K.ZP,{popupType:e.isMobileNative&&!e.isTablet?K.ZP.PopupType.SlideUp:K.ZP.PopupType.Popup,open:t.open,originRect:t.open?t.rect:void 0,placementToOrigin:K.ZP.Placement.Bottom,alignmentToOrigin:K.ZP.Alignment.End,originGap:4,disableMouseCapture:!0,disableContentScroll:!0,disableDarkOverlayBackground:e.isMobile,keepFocus:e.isMobile,render:this.renderMenu,onDismiss:this.handleDismiss})}getSections(e){const{blocks:t}=e,i=[];if("blocks"===e.type){const{copiedStores:n,pageSource:o}=e;ve.H8({blocks:t,copiedStores:n})&&i.push({name:Se.default.formatMessage(Ce.createTransclusion),action:async()=>{await ve.ry({environment:this.environment,blocks:t,copiedBlockIds:n.map((e=>e.id))})}}),ve.wK({blocks:t})&&i.push({name:Se.default.formatMessage(Ce.linkToPage),action:async()=>ve.Dq({environment:this.environment,blocks:t,source:{type:"blocks",copiedStores:n,pageSource:o}})})}"links"===e.type&&i.push({name:Se.default.formatMessage(Ce.linkToPage),action:async()=>ve.Dq({environment:this.environment,blocks:t,source:{type:"links",copiedLinks:e.copiedLinks}})});return[{key:"embed section",render:e=>a().createElement(ce.Z,e),items:[{key:"dismiss",render:e=>a().createElement(Me.Z,he()({},e,{title:Se.default.formatMessage(Ce.dismissItem)})),action:this.handleDismiss},...i.map((e=>{let{name:t,action:i}=e;return{key:"embed ".concat(t),render:e=>a().createElement(Me.Z,he()({},e,{title:t})),action:i}}))]}]}}const Te=ke;var Ie=i(98308),Ze=i(87143),Pe=i(74194),_e=i(64369);class xe extends r.Z{constructor(){super(...arguments),k()(this,"handleOverlayBgClick",(e=>{Ze.Z.setState({...Ze.Z.state,active:!1,stringValue:""})}))}renderComponent(){const{device:e}=this.environment,{active:t,stringValue:i}=Ze.Z.state,n=window.innerWidth/2-150,s=window.innerHeight/2;return o()(K.ZP,{popupType:e.isMobileNative?K.ZP.PopupType.SlideUp:K.ZP.PopupType.Popup,open:t,originRect:{top:s,left:n},onDismiss:this.handleOverlayBgClick,placementToOrigin:K.ZP.Placement.Bottom,alignmentToOrigin:K.ZP.Alignment.Start,originGap:0,render:()=>o()(N.Z,{capture:!0,onEnter:X().identity,onCommandEnter:X().identity,onCommandShiftEnter:X().identity,onCommandSlash:X().identity,onDelete:X().identity,onBackspace:X().identity,onEsc:X().identity,onLeft:X().identity,onRight:X().identity,onUntab:X().identity,onTab:X().identity,onSelectAll:X().identity,onRedo:X().identity,onUndo:X().identity,onToggleBold:X().identity,onToggleItalics:X().identity,onToggleStrike:X().identity,onToggleCode:X().identity,onCut:X().identity,onCopy:X().identity,onPaste:X().identity,onKeypress:X().identity},void 0,o()("div",{style:{padding:8,width:300}},void 0,o()(Pe.Z,{style:{width:"100%",fontSize:12},value:i,focus:!0,textarea:!0,selectAll:!0,readOnly:!0}),o()(_e.Z,{isSmall:!0,style:{marginTop:6,pointerEvents:"none"}},void 0,o()(x.FormattedMessage,{defaultMessage:"Right click and copy the link above",id:"clipboardInputRenderer.copyLink.message"}))))})}}const Fe=xe;var Ae=i(480),Be=i(24405),Ee=i(7476),Re=i(13884),De=i(73935),Le=i.n(De),Oe=i(29566);class Ne extends Oe.Z{}const Ue=new Ne;class We extends p.Z{getInitialState(){return{}}}const Ve=We;class ze extends r.Z{constructor(){super(...arguments),k()(this,"storeTypes",{store:Ve}),k()(this,"rootNode",void 0),k()(this,"observer",void 0),k()(this,"handleMutation",(()=>{if(this.rootNode){const e=this.rootNode.getBoundingClientRect();this.stores.store.setState({rect:e})}}))}get registries(){return[Ue]}didMount(){this.props.capture&&this.startListeners()}willUpdate(e){e.capture&&!this.props.capture?this.startListeners():!e.capture&&this.props.capture&&this.stopListeners()}willUnmount(){this.stopListeners()}startListeners(){const e=Le().findDOMNode(this);e&&(this.rootNode=e,this.observer=new MutationObserver(this.handleMutation),this.observer.observe(this.rootNode,{attributes:!0,subtree:!0}))}stopListeners(){this.observer&&(this.observer.disconnect(),this.rootNode=void 0,this.observer=void 0)}renderComponent(){return a().Children.only(this.props.children)}}const qe=ze;var He=i(56952);const Ge=function(){const e=(0,Ae.O7)(),{device:t,WindowSizeStore:i}=e,n=(0,d.VK)((()=>Re.Z.state.rect),[]),s=(0,d.VK)((()=>{if(Re.Z.state.open){const{blockStore:t,discussionInputStore:i}=Re.Z.state;return{blockStore:t,discussionInputStore:i,canMarginCommentsRender:(0,I.az)(e,t)}}return null}),[e]),a=(0,d.VK)((()=>({paddingLeft:t.isMobileNative?i.getSafePaddingLeftCSS(10):10,paddingRight:t.isMobileNative?i.getSafePaddingRightCSS(10):10})),[i,t.isMobileNative]),r=(0,Be.y)((()=>({inputWrapper:{width:t.isMobileNative?"100%":470,maxWidth:t.isMobileBrowser?"90vw":"100%",paddingTop:8,paddingBottom:t.isAndroid?12:8,paddingLeft:a.paddingLeft,paddingRight:a.paddingRight}})),[t,a]),l=()=>{Ee.ZL(e)},c=()=>{s&&Ee.uK(s.discussionInputStore,e)};return null!=s&&s.canMarginCommentsRender?null:o()(K.ZP,{popupType:t.isMobileNative?K.ZP.PopupType.SlideUp:K.ZP.PopupType.Popup,keepFocus:!0,open:null!==s,originRect:n,placementToOrigin:K.ZP.Placement.Bottom,alignmentToOrigin:K.ZP.Alignment.Center,originGap:4,onDismiss:c,render:()=>{if(s){const{blockStore:e,discussionInputStore:t}=s;return o()(qe,{capture:!0},void 0,o()(L.Z,{capture:!0,allowOpenLinkMenu:!0,render:()=>o()(V.Z,{store:e,droppable:!0,render:()=>o()("div",{style:r.inputWrapper},void 0,o()(He.Z,{showAvatar:!0,parentStore:e,onCancel:c,onSubmit:l,discussionInputStore:t,isMobileSlideUpMenu:!0,shouldSaveUnsentComments:!1,discussionFormat:F.O2.Page,blockStore:e,canDrop:!0}))},e.id)}))}}})};i(15306),i(73210);var Ke=i(51454),je=i(86080),Ye=i(47307),Qe=i(81700),Xe=i(22346),Je=i(63296);class $e extends r.Z{constructor(){super(...arguments),k()(this,"lastOpenState",void 0),k()(this,"renderModal",(()=>{if(!this.lastOpenState)return;const{acceptLabel:e,requiredInputValue:t}=this.lastOpenState,i=[{key:"accept",render:t=>a().createElement(Je.Z,he()({isRed:!0,isLarge:!0,style:$e.buttonStyle,hovered:t.focused},t),e),action:this.handleAccept},{key:"cancel",render:e=>a().createElement(Je.Z,he()({isLarge:!0,style:$e.buttonStyle,hovered:e.focused},e),o()(x.FormattedMessage,{id:"confirmationInputDialog.cancelButton.label",defaultMessage:"Cancel"})),action:this.handleCancel}];return o()(O.Z,{capture:!0,preventType:E.Z.All},void 0,o()("div",{},void 0,o()("div",{style:{minHeight:64,display:"flex",alignItems:"center",justifyContent:"center",marginBottom:16}},void 0,this.lastOpenState.message),o()(N.Z,{capture:!0,onLeft:X().identity,onRight:X().identity,onSelectAll:X().identity,onRedo:X().identity,onUndo:X().identity,onToggleBold:X().identity,onToggleItalics:X().identity,onToggleCode:X().identity,onCut:X().identity,onCopy:X().identity,onPaste:X().identity,onKeypress:X().identity,onDelete:X().identity,onBackspace:X().identity},void 0,o()(Pe.Z,{value:this.lastOpenState.inputValue,onChange:this.handleInputChange,style:{height:38,marginBottom:2},placeholder:t})),o()(we.Z,{type:we.i.Vertical,initialFocus:void 0,sections:[{key:"dialog",render:e=>a().createElement(ce.Z,e),items:i}]})))})),k()(this,"handleAccept",(()=>{const e=Qe.Z.state;e.open&&(this.cleanAcceptInput(e.inputValue)===this.cleanAcceptInput(e.requiredInputValue)?je.x({didConfirm:!0}):Ye.showErrorMessage(o()(x.FormattedMessage,{id:"confirmDialogInput.incorrectInputError.message",defaultMessage:'Please type "{requiredInputValue}" to continue',values:{requiredInputValue:e.requiredInputValue}})))})),k()(this,"cleanAcceptInput",(e=>e.trim().toLowerCase().replace(/’/g,"'"))),k()(this,"handleCancel",(()=>{je.x({didConfirm:!1})})),k()(this,"handleInputChange",(e=>{const t=Qe.Z.state;t.open&&Qe.Z.setState({...t,inputValue:e.target.value})}))}renderComponent(){const e=Qe.Z.state;return e.open&&(this.lastOpenState={...e}),o()(Xe.Z,{open:e.open,keepFocus:!0,overlayZIndex:Ke.Wd,onDismiss:this.handleCancel,preventHideChildrenWhileOpening:!0,innerStyle:{borderRadius:3,paddingTop:24,paddingBottom:16,paddingLeft:32,paddingRight:32,width:this.lastOpenState&&this.lastOpenState.width||336,fontSize:16,boxShadow:this.theme.largeBoxShadow,background:this.theme.modalBackground,maxHeight:"90vh",overflowY:"scroll",marginLeft:24,marginRight:24},render:this.renderModal})}}k()($e,"buttonStyle",{width:"100%",marginTop:16});const et=$e;var tt=i(55367),it=i(8958);class nt extends r.Z{constructor(){super(...arguments),k()(this,"renderGhost",(()=>{const e=tt.ZP.state;if(!e.isDragging)return;const t=e.draggedStores.map(((t,i)=>o()(it.Z,{store:t,ghostElement:e.ghostElements[i]},"".concat(i))));return o()("div",{style:this.getGhostStyle()},void 0,t)})),k()(this,"isDragging",this.createComputedStore((()=>tt.ZP.state.isDragging)))}renderComponent(){return o()(u.Z,{open:this.isDragging.state,render:this.renderGhost})}getGhostStyle(){const e=tt.ZP.state;if(!e.isDragging)return;const{startX:t,startY:i,currentX:n,currentY:o}=e,s=o-i;return{position:"absolute",top:0,left:0,transform:"translate3d(".concat(n-t,"px, ").concat(s,"px, 0)")}}}const ot=nt;var st=i(45080),at=i(12768);class rt extends r.Z{constructor(){super(...arguments),k()(this,"handleContextMenu",(e=>{const{device:t}=this.environment;t.isAndroid||at.default.isOnboarding||(0,st.ZP)({event:e,context:st.Af.EditorContextMenu,callback:()=>{t.isElectron||this.environment.currentUser.isLoggedIn()&&e.preventDefault()}})})),k()(this,"handleDragStart",(e=>{e.preventDefault()}))}didMount(){window.addEventListener("contextmenu",this.handleContextMenu),window.addEventListener("dragstart",this.handleDragStart)}willUnmount(){window.removeEventListener("contextmenu",this.handleContextMenu),window.removeEventListener("dragstart",this.handleDragStart)}}const lt=rt;var dt=i(70203),ct=i(67133),ut=i(9953),mt=i(80456),pt=i(28020),gt=i(28748);class ht extends r.Z{constructor(){super(...arguments),k()(this,"handleChangeValue",(e=>{if(!e)return void this.removeDateAnnotation();const t=this.getEverythingIWant();if(!t)return;const{date_format:i,time_format:n}=t;this.setDateAnnotationData({date_format:i,time_format:n,...e})})),k()(this,"handleChangeDateFormat",(e=>{const t=this.getEverythingIWant();if(!t)return;const{dateValue:i,time_format:n}=t;this.setDateAnnotationData({date_format:e,time_format:n,...i})})),k()(this,"handleChangeTimeFormat",(e=>{const t=this.getEverythingIWant();if(!t)return;const{dateValue:i,date_format:n}=t;this.setDateAnnotationData({date_format:n,time_format:e,...i})})),k()(this,"setDateAnnotationData",(e=>{const t=this.getEverythingIWant();if(!t)return;const{textStore:i,textValue:n,tokenIndex:o,annotations:s}=t,a=n.map(((t,i)=>{if(i===o){const i=s.map((t=>dt.fp(t)?["d",e]:t));return dt.V3(t[0],i)}return t}));mt.createAndCommit({userAction:"DateMentionMenu.setDateAnnotationData",environment:this.environment,perform:e=>{ut.sO({store:i,value:a,transaction:e})}})})),k()(this,"removeDateAnnotation",(()=>{const e=this.getEverythingIWant();if(!e)return;const{textStore:t,textValue:i,tokenIndex:n}=e,o=i.filter(((e,t)=>t!==n));mt.createAndCommit({userAction:"DateMentionMenu.removeDateAnnotation",environment:this.environment,perform:e=>{ut.sO({store:t,value:o,transaction:e})}})}))}renderComponent(){const{device:e}=this.environment,t=gt.Z.state;return o()(K.ZP,{popupType:e.isMobile?K.ZP.PopupType.SlideUp:K.ZP.PopupType.Popup,open:t.open,originRect:t.originRect,onDismiss:ct.x,render:()=>{const e=this.getEverythingIWant();if(!e)return null;const{date_format:i,time_format:n,dateValue:s}=e;return o()(m.DependencyConsumer,{dependency:m.deps.menus},void 0,(e=>{let{DatePropertyMenu:a}=e;return o()(a,{firstDayOfWeek:pt.AK.state,value:s,canConfigureCollection:!0,onChangeValue:this.handleChangeValue,dateFormat:i,onChangeDateFormat:this.handleChangeDateFormat,timeFormat:n,onChangeTimeFormat:this.handleChangeTimeFormat,onDismiss:ct.x,disabled:!1,shouldShowReminder:!!t.open&&t.allowReminders,allowTabUntab:!1})}))}})}getEverythingIWant(){const e=gt.Z.state;if(e.open){const{textStore:t,tokenIndex:i}=e,n=t.getValue();if(n){const e=n[i];if(e){const o=dt.hD(e),s=dt.K9(o);if(s){const{date_format:a,time_format:r,...l}=dt.Ot(s);return{textStore:t,textValue:n,tokenIndex:i,token:e,annotations:o,date_format:a,time_format:r,dateValue:l}}}}}}}const ft=ht;var vt=i(1302),yt=i(84908),St=i(98104),bt=i(68056),Mt=i(80935),wt=i(81212);class Ct extends p.Z{getInitialState(){return{open:!1}}}const kt=new Ct;var Tt=i(24666),It=i(93405),Zt=i(1743);class Pt extends r.Z{constructor(){super(...arguments),k()(this,"handleContextMenu",((e,t)=>{if(e.preventDefault(),t.misspelledWord){const e=Tt.default.state,i="editing"===e.mode&&(0,bt.QY)(e.multiSelection);if(i&&i.selection.startIndex===i.selection.endIndex){const e=dt.Oq(i.store.getValue()||[],t.misspelledWord),n=i.selection.startIndex,o=dt.PE(e,n);o&&St.Z5({store:i.store,selection:o})}}kt.setState({open:!0,menuInfo:t})})),k()(this,"handleDismiss",(()=>{kt.setState({...kt.state,open:!1})}))}willMount(){yt.electronApi&&yt.electronApi.contextMenu&&yt.electronApi.contextMenu.addListener(this.handleContextMenu)}willUnmount(){yt.electronApi&&yt.electronApi.contextMenu&&yt.electronApi.contextMenu.removeListener(this.handleContextMenu)}renderComponent(){const{menuInfo:e,open:t}=kt.state,{device:i}=this.environment,{x:n,y:s}=this.getClickPosition(e),a=new DOMRect(n,s,0,0),r=e?this.getMenuSections(e):[],l=document.activeElement,d=Mt.get();let c=null,u=null;(l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement)&&(c=l.selectionStart,u=l.selectionEnd);for(const o of r)for(const e of o.items){const t=e.action;e.action=e=>{l.focus(),l instanceof HTMLInputElement||l instanceof HTMLTextAreaElement?(l.selectionStart=c,l.selectionEnd=u):d&&Mt.set(d,i),vt.default.afterNextFlush((()=>{t(e)}))}}return o()(K.ZP,{open:t&&r.length>0,popupType:K.ZP.PopupType.Popup,originRect:a,render:()=>o()(Zt.Z,{capture:!0,allowEsc:!0},void 0,o()(U.Z,{menuType:A.o.Popup},void 0,o()(we.Z,{type:we.i.Vertical,sections:r,initialFocus:void 0,onAccept:this.handleDismiss}))),onDismiss:this.handleDismiss,overlayContainerStore:wt.Z})}getClickPosition(e){const t=(0,yt.getCurrentZoom)();return{x:e?e.x/t:0,y:e?e.y/t:0}}getMenuSections(e){const t=[],i=this.getSpellingCorrectionItems(e);if(i.length>0){const e=t.length>0;t.push({key:"spellingCorrectionItems",items:i,render:t=>a().createElement(ce.Z,he()({},t,{topBorder:e}))})}const n=this.getDisableSpellCheckItems(e);if(n.length>0){const e=t.length>0;t.push({key:"disableSpellCheckItems",items:n,render:t=>a().createElement(ce.Z,he()({},t,{topBorder:e}))})}const o=this.getSearchItems(e);if(o.length>0){const e=t.length>0;t.push({key:"searchItems",items:o,render:t=>a().createElement(ce.Z,he()({},t,{topBorder:e}))})}const s=this.getLinkMenuItems(e);if(s.length>0){const e=t.length>0;t.push({key:"linkMenuItems",items:s,render:t=>a().createElement(ce.Z,he()({},t,{topBorder:e}))})}const r=this.getImageMenuItems(e);if(r.length>0){const e=t.length>0;t.push({key:"imageMenuItems",items:r,render:t=>a().createElement(ce.Z,he()({},t,{topBorder:e}))})}const l=this.getTextEditingItems(e);if(l.length>0){const e=t.length>0;t.push({key:"textEditingItems",items:l,render:t=>a().createElement(ce.Z,he()({},t,{topBorder:e}))})}const d=this.getEnableSpellCheckItem(e);if(d.length>0){const e=t.length>0;t.push({key:"enableSpellCheckItems",items:d,render:t=>a().createElement(ce.Z,he()({},t,{topBorder:e}))})}return t}getLinkMenuItems(e){const t=[];return e.linkURL&&e.linkURL.length>0&&(e.linkURL.startsWith("mailto:")?t.push({key:"copy-email",action:()=>{yt.electronApi&&yt.electronApi.copyText&&yt.electronApi&&yt.electronApi.copyText(e.linkText)},render:e=>a().createElement(Me.Z,he()({},e,{title:o()(x.FormattedMessage,{defaultMessage:"Copy email address",id:"desktop.rightClickMenu.copyEmailAddress"})}))}):t.push({key:"copy-link",action:()=>{yt.electronApi&&yt.electronApi.copyText&&yt.electronApi&&yt.electronApi.copyText(e.linkURL)},render:e=>a().createElement(Me.Z,he()({},e,{title:o()(x.FormattedMessage,{defaultMessage:"Copy link",id:"desktop.rightClickMenu.copyLink"})}))}),t.push({key:"open-link",action:()=>{yt.electronApi&&yt.electronApi.openExternalUrl(e.linkURL)},render:e=>a().createElement(Me.Z,he()({},e,{title:o()(x.FormattedMessage,{defaultMessage:"Open link",id:"desktop.rightClickMenu.openLink"})}))})),t}getImageMenuItems(e){const t=[];return e.hasImageContents&&e.srcURL&&e.srcURL.length>0&&(t.push({key:"copy-image",action:()=>{yt.electronApi&&yt.electronApi.copyImage&&yt.electronApi.copyImage(e.srcURL)},render:e=>a().createElement(Me.Z,he()({},e,{title:o()(x.FormattedMessage,{defaultMessage:"Copy image",id:"desktop.rightClickMenu.copyImage"})}))}),t.push({key:"copy-image-address",action:()=>{yt.electronApi&&yt.electronApi.copyText&&yt.electronApi.copyText(e.srcURL)},render:e=>a().createElement(Me.Z,he()({},e,{title:o()(x.FormattedMessage,{defaultMessage:"Copy image address",id:"desktop.rightClickMenu.copyImageAddress"})}))})),t}isEditing(e){return e.isEditable||e.inputFieldType&&"none"!==e.inputFieldType}hasMisspelling(e){return this.isEditing(e)&&e.misspelledWord&&e.misspelledWord.length>0}getSpellingCorrectionItems(e){const t="SpellCheckStore"in this.environment&&this.environment.SpellCheckStore,i=[];if(this.hasMisspelling(e)&&t&&t.isEnabled()){const n=t.getCorrections(e);for(const e of n)i.push({key:e,action:()=>{yt.electronApi&&yt.electronApi.replaceMisspelling&&yt.electronApi.replaceMisspelling(e)},render:t=>a().createElement(Me.Z,he()({},t,{title:e}))})}return i}getDisableSpellCheckItems(e){const t="SpellCheckStore"in this.environment&&this.environment.SpellCheckStore,i=[];return this.hasMisspelling(e)&&t&&t.isEnabled()&&i.push({key:"disable",action:()=>{t.setEnabled(!1)},render:e=>a().createElement(Me.Z,he()({},e,{title:o()(x.FormattedMessage,{defaultMessage:"Disable spell check",id:"desktop.spellcheckMenuItem.disableSpellcheck.title"})}))}),i}getEnableSpellCheckItem(e){const t="SpellCheckStore"in this.environment&&this.environment.SpellCheckStore,i=[];return this.isEditing(e)&&t&&!t.isEnabled()&&i.push({key:"enable",action:()=>{t.setEnabled(!0)},render:e=>a().createElement(Me.Z,he()({},e,{title:o()(x.FormattedMessage,{defaultMessage:"Enable spell check",id:"desktop.spellcheckMenuItem.enableSpellcheck.title"})}))}),i}getSearchItems(e){const t=[];return e.selectionText&&e.selectionText.length>0&&t.push({key:"google",action:()=>{if(yt.electronApi){const t="https://www.google.com/search?q=".concat(encodeURIComponent(e.selectionText.trim()));yt.electronApi.openExternalUrl(t)}},render:e=>a().createElement(Me.Z,he()({},e,{title:o()(x.FormattedMessage,{defaultMessage:"Search with Google",id:"desktop.searchMenuItem.searchWithGoogle.title"})}))}),t}getTextEditingItems(e){const t=[];return this.isEditing(e)&&(e.editFlags.canCut&&t.push({key:"cut",action:()=>{yt.electronApi&&yt.electronApi.cut&&yt.electronApi.cut()},render:e=>a().createElement(It.Z,he()({},e,{title:o()(x.FormattedMessage,{defaultMessage:"Cut",id:"desktop.textEditingMenuItem.cutAction.title"}),shortcuts:["cut"]}))}),e.editFlags.canCopy&&t.push({key:"copy",action:()=>{yt.electronApi&&yt.electronApi.copy&&yt.electronApi.copy()},render:e=>a().createElement(It.Z,he()({},e,{title:o()(x.FormattedMessage,{defaultMessage:"Copy",id:"desktop.textEditingMenuItem.copyAction.title"}),shortcuts:["copy"]}))}),e.editFlags.canPaste&&t.push({key:"paste",action:()=>{yt.electronApi&&yt.electronApi.paste&&yt.electronApi.paste()},render:e=>a().createElement(It.Z,he()({},e,{title:o()(x.FormattedMessage,{defaultMessage:"Paste",id:"desktop.textEditingMenuItem.pasteAction.title"}),shortcuts:["paste"]}))})),t}}const _t=Pt;var xt=i(41432),Ft=i(95538),At=i(74335),Bt=i(63143),Et=i(89951),Rt=i(95477),Dt=i(64233),Lt=i(80270);const Ot=(0,x.defineMessages)({image:{defaultMessage:"Embed image",id:"embedMenu.action.image"},video:{defaultMessage:"Embed video",id:"embedMenu.action.video"},tweet:{defaultMessage:"Embed Tweet",id:"embedMenu.action.tweet"},drive:{defaultMessage:"Embed Google Drive",id:"embedMenu.action.drive"},gist:{defaultMessage:"Embed GitHub Gist",id:"embedMenu.action.gist"},figma:{defaultMessage:"Embed Figma",id:"embedMenu.action.figma"},invision:{defaultMessage:"Embed Invision project",id:"embedMenu.action.invision"},abstract:{defaultMessage:"Embed Abstract project",id:"embedMenu.action.abstract"},framer:{defaultMessage:"Embed Framer prototype",id:"embedMenu.action.framer"},whimsical:{defaultMessage:"Embed Whimsical board",id:"embedMenu.action.whimsical"},sketch:{defaultMessage:"Embed Sketch document",id:"embedMenu.action.sketch"},excalidraw:{defaultMessage:"Embed excalidraw",id:"embedMenu.action.excalidraw"},replit:{defaultMessage:"Embed a repl",id:"embedMenu.action.replit"},miro:{defaultMessage:"Embed Miro board",id:"embedMenu.action.miro"},audio:{defaultMessage:"Embed audio",id:"embedMenu.action.audio"},maps:{defaultMessage:"Embed Google Map",id:"embedMenu.action.maps"},loom:{defaultMessage:"Embed Loom",id:"embedMenu.action.loom"},typeform:{defaultMessage:"Embed Typeform",id:"embedMenu.action.typeform"},codepen:{defaultMessage:"Embed CodePen",id:"embedMenu.action.codepen"},pdf:{defaultMessage:"Embed PDF",id:"embedMenu.action.pdf"},embed:{defaultMessage:"Create embed",id:"embedMenu.action.createEmbed"},hex:{defaultMessage:"Embed Hex",id:"embedMenu.action.hex"},deepnote:{defaultMessage:"Embed Deepnote",id:"embedMenu.action.deepnote"}}),Nt=(0,x.defineMessages)({linkToPage:{defaultMessage:"Link to page",id:"embedMenu.actions.linkToPage.title"},mentionPage:{defaultMessage:"Mention page",id:"embedMenu.actions.mentionPage.title"},mentionBlock:{defaultMessage:"Mention block",id:"embedMenu.actions.mentionBlock.title",description:"Mention a non-page block"},createLinkedDatabase:{defaultMessage:"Create linked database",id:"embedMenu.actions.createLinkedDatabase.title"},createLinkedViewOfDatabase:{defaultMessage:"Create linked view of database",id:"embedMenu.actions.createLinkedViewOfDatabase.title"},bookmarkMenuItem:{defaultMessage:"Create bookmark",id:"embedMenu.actions.createBookmark.title"},createTransclusionItem:{defaultMessage:"Paste and sync",id:"embedMenu.actions.createTransclusion.title"},dismissItem:{defaultMessage:"Dismiss",id:"embedMenu.actions.dismiss.title"}}),Ut={image:Se.default.formatMessage(Ot.image),video:Se.default.formatMessage(Ot.video),tweet:Se.default.formatMessage(Ot.tweet),drive:Se.default.formatMessage(Ot.drive),gist:Se.default.formatMessage(Ot.gist),figma:Se.default.formatMessage(Ot.figma),invision:Se.default.formatMessage(Ot.invision),abstract:Se.default.formatMessage(Ot.abstract),framer:Se.default.formatMessage(Ot.framer),whimsical:Se.default.formatMessage(Ot.whimsical),miro:Se.default.formatMessage(Ot.miro),sketch:Se.default.formatMessage(Ot.sketch),excalidraw:Se.default.formatMessage(Ot.excalidraw),replit:Se.default.formatMessage(Ot.replit),audio:Se.default.formatMessage(Ot.audio),maps:Se.default.formatMessage(Ot.maps),loom:Se.default.formatMessage(Ot.loom),typeform:Se.default.formatMessage(Ot.typeform),codepen:Se.default.formatMessage(Ot.codepen),pdf:Se.default.formatMessage(Ot.pdf),embed:Se.default.formatMessage(Ot.embed),hex:Se.default.formatMessage(Ot.hex),deepnote:Se.default.formatMessage(Ot.deepnote)};class Wt extends r.Z{constructor(){super(...arguments),k()(this,"renderMenu",(()=>{const{device:e}=this.environment,t=Dt.Z.state;if(!t.open)return;const i=this.getSections(t);let n;return n=e.isMobile?{menuType:A.o.ActionSheet}:{menuType:A.o.Popup,width:320,maxHeight:"40vh"},a().createElement(U.Z,he()({},n,{className:ye.sr}),o()(we.Z,{type:we.i.Vertical,sections:i,initialFocus:0}))})),k()(this,"handleDismiss",(()=>{const e=Dt.Z.state,{url:t}=e;$.trackEmbedMenuSelection(this.environment,{url:t,type:"close"}),Et.xv()})),k()(this,"handleAccept",(e=>{const t=Dt.Z.state,{url:i}=t;Et.RL({environment:this.environment,type:e}),$.trackEmbedMenuSelection(this.environment,{url:i,type:e})}))}willMountOrUpdate(){const e=Dt.Z.state;if(e.open){const t=Tt.default.state;if("editing"===t.mode){const{multiSelection:i}=t;(0,bt.qS)(i)&&i.start.store.id===e.textStore.id&&i.end.index===e.urlSelection.endIndex||Et.xv()}}}renderComponent(){const{device:e}=this.environment,t=Dt.Z.state;return o()(K.ZP,{popupType:e.isMobileNative&&!e.isTablet?K.ZP.PopupType.SlideUp:K.ZP.PopupType.Popup,open:t.open,originRect:t.open?t.selectionRect:void 0,placementToOrigin:K.ZP.Placement.Bottom,alignmentToOrigin:K.ZP.Alignment.Start,originGap:4,disableMouseCapture:!0,disableContentScroll:!0,disableDarkOverlayBackground:e.isMobile,keepFocus:e.isMobile,render:this.renderMenu,onDismiss:this.handleDismiss})}isInCollection(e){const t=e.getRecordStoreAtRootPath();return(0,B.NZ)(t)&&void 0!==Lt.Z.fromRecordStore(t).getParentCollectionStore()}getSections(e){const{device:t}=this.environment,{url:i,textStore:n}=e,o=[],s=(0,At.Wj)({url:i,baseUrl:Rt.Z.domainBaseUrl,publicDomainName:Rt.Z.publicDomainName,isMobile:t.isMobile,protocol:Rt.Z.protocol,currentUrl:window.location.href});if("page"===s.name){const e=Lt.Z.createChildStore(n,{table:_.iU,id:s.blockId}),t=s.scrollToBlockId?Lt.Z.createChildStore(n,{table:_.iU,id:s.scrollToBlockId}):void 0;o.push({name:Se.default.formatMessage(Nt.createLinkedViewOfDatabase),validator:()=>!t&&e.isCollectionView()&&!this.isInCollection(n),type:xt.ZP.collectionView}),o.push({name:Se.default.formatMessage(Nt.createTransclusionItem),validator:()=>Boolean(t&&!t.isNavigableBlock()&&!this.isInCollection(n)),type:"create-transclusion"}),o.push({name:Se.default.formatMessage(void 0===t?Nt.mentionPage:Nt.mentionBlock),validator:()=>!0,type:"mention-page"}),o.push({name:Se.default.formatMessage(Nt.linkToPage),validator:()=>!t&&!e.isCollectionView()&&!this.isInCollection(n),type:xt.ZP.page})}const r=Bt.XP(Ut);for(const a of r)"embed"!==a&&o.push({name:Ut[a],validator:Ft.Wb[a],type:a});o.push({name:Se.default.formatMessage(Nt.bookmarkMenuItem),validator:Ft.Cm,type:xt.ZP.bookmark}),o.push({name:Ut.embed,validator:Ft.Wb.embed,type:"embed"});return[{key:"embed section",render:e=>a().createElement(ce.Z,e),items:[{key:"dismiss",render:e=>a().createElement(Me.Z,he()({},e,{title:Se.default.formatMessage(Nt.dismissItem)})),action:this.handleDismiss},...X().compact(o.map((e=>{let{name:t,validator:n,type:o}=e;if(n({url:i,baseUrl:Rt.Z.domainBaseUrl,publicDomainName:Rt.Z.publicDomainName})){return{key:"embed ".concat(t),render:e=>a().createElement(Me.Z,he()({},e,{title:t})),action:()=>this.handleAccept(o)}}})))]}]}}const Vt=Wt;var zt=i(4727),qt=i(31352),Ht=i(88833),Gt=i(38797);class Kt extends r.Z{constructor(){super(...arguments),k()(this,"renderMenu",(()=>{const{device:e}=this.environment,t=Ht.Z.state,i=a().createRef();if(!t.open)return;let n;return n=e.isMobileNative&&!e.isTablet?{menuType:A.o.ActionSheet}:{menuType:A.o.Popup,width:Gt.ZP.desktopEmojiPickerOnlyPopupWidth,maxHeight:Gt.ZP.desktopEmojiPickerOnlyPopupHeight,onClickOutside:zt.xv},a().createElement(U.Z,he()({innerRef:i},n),o()(Gt.ZP,{filter:this.getFilter(t)||"",onSubmit:this.handleSubmit,onNoResults:this.handleNoResults,isCallout:!1,menuRef:i}))})),k()(this,"handleNoResults",(()=>{const e=Ht.Z.state;if(!e.open)return;const t=this.getFilter(e),i=X().last(t);i&&/\s/g.test(i)&&zt.xv()})),k()(this,"handleSubmit",(e=>{mt.createAndCommit({userAction:"EmojiMenu.handleSubmit",environment:this.environment,perform:t=>{zt.RL({environment:this.environment,emoji:e,transaction:t})}})})),k()(this,"handleCancel",(()=>{zt.xv()}))}willMountOrUpdate(){const e=Ht.Z.state;if(e.open){var t;const i=Tt.default.state,n=this.getFilter(e);("editing"!==i.mode||(null===(t=(0,bt.QY)(i.multiSelection))||void 0===t?void 0:t.store)!==e.textStore||void 0===n||":"===n||n.startsWith("\n")||n.startsWith(" "))&&zt.xv()}}renderComponent(){const{device:e}=this.environment,t=Ht.Z.state;let i=!1;if(t.open){const e=this.getFilter(t);e&&e.length>0&&(i=!0),t.showPopupWithEmptyFilter&&(i=!0)}return o()(K.ZP,{popupType:e.isMobileNative&&!e.isTablet?K.ZP.PopupType.SlideUp:K.ZP.PopupType.Popup,open:i,originRect:t.open?t.selectionRect:void 0,placementToOrigin:K.ZP.Placement.Bottom,alignmentToOrigin:K.ZP.Alignment.Start,originGap:4,disableMouseCapture:!0,disableContentScroll:!0,onDismiss:this.handleCancel,render:this.renderMenu,keepFocus:!0})}getFilter(e){return qt.zK(e.textStore,e.oldTextValue,!0)}}const jt=Kt;var Yt=i(8848),Qt=i(43593),Xt=i(53397),Jt=i(54604),$t=i(42858),ei=i(24677),ti=i(39500),ii=i(17504),ni=i(58202),oi=i(38302),si=i(12318),ai=i(65381),ri=i(68785),li=i(91941),di=i(58032),ci=i(56813);class ui extends r.Z{constructor(){var e;super(...arguments),e=this,k()(this,"zoomFocusPercentageX",0),k()(this,"zoomFocusPercentageY",0),k()(this,"isListeningToWheel",!1),k()(this,"hideControlsTimeout",void 0),k()(this,"isMovingToPrevOrNextTimeout",void 0),k()(this,"isEditingZoom",new si.default(!1)),k()(this,"contentDimensions",new si.default(void 0)),k()(this,"showControls",new si.default(!1)),k()(this,"responsiveSettings",this.createComputedStore((()=>{const e=this.environment.WindowSizeStore.state.width;return{edgePadding:Jt.zp(e),backgroundOpacity:.8}}))),k()(this,"renderOverlay",(()=>{const{isOpen:e,renderFullScreenNode:t,fullScreenNodeRect:i,contentAspectRatio:n,zoomScale:s,panOffset:r,skipAnimations:l}=oi.Z.state;if(!i)return;e&&!this.isListeningToWheel?(window.addEventListener("wheel",this.handleWheel,{passive:!1}),this.isListeningToWheel=!0):!e&&this.isListeningToWheel&&(window.removeEventListener("wheel",this.handleWheel),this.isListeningToWheel=!1);const{edgePadding:d,backgroundOpacity:c}=this.responsiveSettings.state,u=window.innerWidth,m=window.innerHeight-2*d;let p=u-2*d;const g=n||i.height/i.width;let h=p*g;if(h>m){const e=h/m;h/=e,p/=e}const f={opacity:0},v={scale:s,opacity:1,translateX:r.x,translateY:r.y};let y,S;return t&&(y=t()),S=this.showControls.get()?s>=1.5?"zoom-out":"zoom-in":"none",(0,ii.Z)((t=>o()(N.Z,{capture:e,onEsc:()=>{this.handleClose(!0)},onEnter:X().identity,onSpace:()=>this.handleClose(!0),onCommandEnter:()=>this.handleClose(!0),onCommandShiftEnter:X().identity,onCommandSlash:X().identity,onUp:X().identity,onDown:X().identity,onDelete:X().identity,onBackspace:X().identity,onLeft:()=>this.handlePrevious(!0),onRight:()=>this.handleNext(!0),onUntab:X().identity,onTab:X().identity,onSelectAll:X().identity,onRedo:X().identity,onUndo:X().identity,onToggleBold:X().identity,onToggleItalics:X().identity,onToggleStrike:X().identity,onToggleCode:X().identity,onCut:X().identity,onCopy:X().identity,onPaste:X().identity,onKeypress:this.handleKeypress},void 0,o()(O.Z,{capture:e,preventType:E.Z.All},void 0,a().createElement("div",he()({style:this.getStyle({isOpen:e})},t,{onClick:this.handleBackgroundClick,onMouseMove:this.resetHideControlsTimeout}),o()(ai.Z,{isVisible:e,enterAnimationStyle:{opacity:0},exitAnimationStyle:{opacity:0},animationStyle:{opacity:c},render:()=>o()("div",{style:this.getBackgroundStyle()}),onAnimationEnd:this.handleBackgroundAnimationEnd}),o()(ai.Z,{isVisible:e,enterAnimationStyle:f,exitAnimationStyle:f,animationStyle:v,skipAnimation:l,springConfig:{scale:this.getSpringConfig(),translateX:this.getSpringConfig(),translateY:this.getSpringConfig()},render:()=>a().createElement("div",{style:{display:"flex",cursor:S,maxWidth:p,maxHeight:h,justifyContent:"center"},ref:e=>{e&&this.contentDimensions.set({width:e.clientWidth,height:e.clientHeight})},onClick:this.handleContentClick,onMouseDown:this.handleMouseDown,onMouseUp:this.handleMouseUp,onMouseLeave:this.handleMouseUp,onMouseMove:this.handleMouseMove},y),onAnimationEnd:this.handleFullscreenNodeAnimationEnd}),this.renderBottomBar())))))})),k()(this,"clearHideControlsTimeout",(()=>{this.hideControlsTimeout&&clearTimeout(this.hideControlsTimeout)})),k()(this,"resetHideControlsTimeout",(()=>{const{isSaving:e}=oi.Z.state;this.showControls.set(!0),this.clearHideControlsTimeout(),this.isEditingZoom.get()||e||(this.hideControlsTimeout=setTimeout((()=>this.showControls.set(!1)),2e3))})),k()(this,"enableZoomEditing",(()=>{this.isEditingZoom.set(!0),this.clearHideControlsTimeout()})),k()(this,"disableZoomEditing",(()=>{this.isEditingZoom.set(!1),this.resetHideControlsTimeout()})),k()(this,"handleBackgroundClick",(e=>{(0,ti.uG)(e)||this.handleClose()})),k()(this,"handleContentClick",(e=>{const{zoomScale:t,panOffset:i}=oi.Z.state;if(e.stopPropagation(),(0,ti.uG)(e))return;let n,o;var s;(n=t<1?1:t<1.5?1.5:1,n<=1)?o={x:0,y:0}:o=null!==(s=this.clampPanOffset({x:(window.innerWidth/2-e.clientX)/(n/(n-1)),y:(window.innerHeight/2-e.clientY)/(n/(n-1))}))&&void 0!==s?s:i;oi.Z.setState({...oi.Z.state,zoomScale:n,panOffset:o}),this.resetHideControlsTimeout(),this.disableZoomEditing()})),k()(this,"handleClose",(function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];Jt.xv(),e.resetControls(),$.trackFullScreenAction(e.environment,{type:"close",triggered_by:t?"keypress":"click"}),ei.ZH(e.environment)})),k()(this,"handleResize",(()=>{const{isOpen:e}=oi.Z.state;e&&this.enqueueForceUpdate()})),k()(this,"handleBackgroundAnimationEnd",(()=>{const{isOpen:e}=oi.Z.state;e||oi.Z.setState({...oi.Z.state,backgroundAnimationComplete:!0})})),k()(this,"handleFullscreenNodeAnimationEnd",(()=>{const{isOpen:e}=oi.Z.state;e||oi.Z.setState({...oi.Z.state,fullscreenNodeAnimationComplete:!0})})),k()(this,"cancelBackgroundClick",(e=>{e.stopPropagation()})),k()(this,"handlePrevious",(function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e.moveToImageOffset(-1,t)})),k()(this,"handleNext",(function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];e.moveToImageOffset(1,t)})),k()(this,"handleZoomInputSubmit",(e=>{const t=e.target,i=parseInt(t.value);if(!isNaN(i)){const e=i/100;$.trackFullScreenAction(this.environment,{type:"set_zoom",new_zoom:e}),this.setZoomScale(e)}this.disableZoomEditing()})),k()(this,"handleZoomOut",(function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{zoomScale:i}=oi.Z.state;let n=Math.ceil((i-ui.ZOOM_STEP)*ui.INVERSE_ZOOM_STEP)/ui.INVERSE_ZOOM_STEP;i-n<ui.ZOOM_THRESHOLD&&(n-=ui.ZOOM_STEP),$.trackFullScreenAction(e.environment,{type:"zoom_out",new_zoom:n,triggered_by:t?"keypress":"click"}),e.setZoomScale(n)})),k()(this,"handleZoomIn",(function(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];const{zoomScale:i}=oi.Z.state;let n=Math.floor((i+ui.ZOOM_STEP)*ui.INVERSE_ZOOM_STEP)/ui.INVERSE_ZOOM_STEP;n-i<ui.ZOOM_THRESHOLD&&(n+=ui.ZOOM_STEP),$.trackFullScreenAction(e.environment,{type:"zoom_in",new_zoom:n,triggered_by:t?"keypress":"click"}),e.setZoomScale(n)})),k()(this,"addDeltaToZoomScale",(e=>{const{zoomScale:t}=oi.Z.state;this.setZoomScale(t+e)})),k()(this,"setZoomScale",(e=>{const{panOffset:t}=oi.Z.state;this.resetHideControlsTimeout();const i=Math.max(Math.min(e,ui.MAX_ZOOM),ui.MIN_ZOOM),n=i<=1?{x:0,y:0}:t;oi.Z.setState({...oi.Z.state,zoomScale:i,panOffset:n})})),k()(this,"handleWheel",(e=>{const{isOpen:t,panOffset:i}=oi.Z.state;t&&(e.preventDefault(),e.ctrlKey?e.deltaY?this.addDeltaToZoomScale(e.deltaY*ui.TRACK_PAD_SCALE):e.deltaX&&this.addDeltaToZoomScale(e.deltaX*ui.TRACK_PAD_SCALE):e.metaKey?e.deltaY?this.addDeltaToZoomScale(e.deltaY*ui.MOUSE_WHEEL_SCALE):e.deltaX&&this.addDeltaToZoomScale(e.deltaX*ui.MOUSE_WHEEL_SCALE):this.canPan()&&this.setPanOffset({x:i.x-e.deltaX,y:i.y-e.deltaY}))})),k()(this,"handleMouseDown",(e=>{const{panOffset:t,zoomScale:i}=oi.Z.state;oi.Z.setState({...oi.Z.state,panStartPosition:{x:e.clientX/i-t.x,y:e.clientY/i-t.y},skipAnimations:!0})})),k()(this,"handleMouseUp",(()=>{oi.Z.setState({...oi.Z.state,skipAnimations:!1})})),k()(this,"handleMouseMove",(e=>{const{panStartPosition:t,zoomScale:i}=oi.Z.state;this.contentDimensions.get()&&1===e.buttons&&this.canPan()&&this.setPanOffset({x:e.clientX/i-t.x,y:e.clientY/i-t.y})})),k()(this,"handleDownload",(e=>{const{block:t,imageUrl:i}=oi.Z.state;if(!t||!this.environment.currentUser.id||!this.canDownload())return;oi.Z.setState({...oi.Z.state,isSaving:!0}),this.clearHideControlsTimeout();const n=null==t?void 0:t.getProperties();let o;if(o=i||dt.Q(null==n?void 0:n.source),!o)return;const s=dt.Q(null==n?void 0:n.caption);(0,Qt.GN)(o,null==t?void 0:t.pointer,Rt.Z.domainBaseUrl,this.environment.currentUser.id,s).then((()=>{oi.Z.setState({...oi.Z.state,isSaving:!1}),$.trackFullScreenAction(this.environment,{type:"download",triggered_by:"click"}),this.resetHideControlsTimeout()}))})),k()(this,"handleKeypress",(e=>{switch(e.key){case"+":case"=":this.handleZoomIn(!0);break;case"-":case"_":this.handleZoomOut(!0)}}))}didMount(){super.didMount(),window.addEventListener("resize",this.handleResize)}willUnmount(){super.willUnmount(),window.removeEventListener("resize",this.handleResize),window.removeEventListener("wheel",this.handleWheel),this.isListeningToWheel=!1}renderComponent(){const{isOpen:e,fullscreenNodeAnimationComplete:t,backgroundAnimationComplete:i}=oi.Z.state;return o()(u.Z,{open:e||!t||!i,render:this.renderOverlay})}getAllImageBlocksOnPage(){const e=se.default.getCurrentRootStore();return ni.R.getMembersByDOMOrder().filter((e=>e instanceof ci.Z)).filter((t=>Boolean(t.props.store.findRecordStoreUIAncestor((t=>Boolean(e&&t===e))).ancestor))).map((e=>e.props.store)).filter((e=>Boolean(e.getProperties().source)))}renderBottomBar(){const{isOpen:e}=oi.Z.state;if(!this.environment.device.isMobile)return o()(ai.Z,{isVisible:this.showControls.get(),enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},animationStyle:{opacity:1},render:()=>o()("div",{style:this.getBottomContainerStyle(e),onClick:e=>{this.cancelBackgroundClick(e),this.resetHideControlsTimeout(),this.disableZoomEditing()}},void 0,o()("div",{style:{...ui.controlBarStyle,marginRight:10}},void 0,this.renderPrevNextButtons()),o()("div",{style:ui.controlBarStyle},void 0,this.renderZoomControls(),this.renderVerticalLine(),this.canDownload()?a().createElement(a().Fragment,null,this.renderDownloadButton(),this.renderVerticalLine()):void 0,this.renderCloseButton()))})}renderZoomControls(){const{zoomScale:e}=oi.Z.state,t=(100*e).toFixed(0);return o()("div",{style:{alignItems:"center",display:"flex",height:"100%",justifySelf:"flex-start"}},void 0,o()(di.Z,{renderTooltip:()=>this.renderTooltip({primaryText:o()(x.FormattedMessage,{id:"fullScreenRenderer.zoomOut",defaultMessage:"Zoom out",description:"Label for a button to zoom out an image"}),secondaryText:"-"}),disableTooltip:e<=ui.MIN_ZOOM,render:t=>a().createElement(li.Z,he()({},t,{disabled:e<=ui.MIN_ZOOM,style:{...this.getButtonStyle(e<=ui.MIN_ZOOM),...ui.firstButtonPadding},onClick:()=>this.handleZoomOut(),icon:e=>Xt.Z.minus({...e,fill:this.getBottomBarPrimaryColor(),height:16,margin:0,width:16})}))}),this.isEditingZoom.get()?o()(mi,{initialValue:t,onSubmit:this.handleZoomInputSubmit,onCancel:this.disableZoomEditing,primaryColor:this.getBottomBarPrimaryColor(),secondaryColor:this.getBottomBarSecondaryColor()}):o()(li.Z,{onClick:e=>{e.stopPropagation(),this.enableZoomEditing()},style:{color:this.getBottomBarSecondaryColor(),margin:0,width:46,padding:0,justifyContent:"center"}},void 0,"".concat(t,"%")),o()(di.Z,{renderTooltip:()=>this.renderTooltip({primaryText:o()(x.FormattedMessage,{id:"fullScreenRenderer.zoomIn",defaultMessage:"Zoom in",description:"Label for a button to zoom in an image"}),secondaryText:"+"}),disableTooltip:e>=ui.MAX_ZOOM,render:t=>a().createElement(li.Z,he()({},t,{disabled:e>=ui.MAX_ZOOM,style:this.getButtonStyle(e>=ui.MAX_ZOOM),onClick:()=>this.handleZoomIn(),icon:e=>Xt.Z.plus({...e,fill:this.getBottomBarPrimaryColor(),height:16,margin:0,width:16})}))}))}renderPrevNextButtons(){var e,t;const{block:i}=oi.Z.state,n=this.getAllImageBlocksOnPage(),s=null!==(e=null==n?void 0:n.length)&&void 0!==e?e:0,r=null!==(t=null==n?void 0:n.findIndex((e=>e===i)))&&void 0!==t?t:-1;return s<=1||r<0?o()("div",{}):a().createElement(a().Fragment,null,o()(di.Z,{renderTooltip:()=>this.renderTooltip({primaryText:o()(x.FormattedMessage,{id:"fullScreenRenderer.previous",defaultMessage:"Back",description:"Label for a button in a slideshow of images to go back to the previous image"}),secondaryText:this.renderPrevNextSecondaryText(r-1,s)}),disableTooltip:0===r,render:e=>a().createElement(li.Z,he()({},e,{disabled:r<=0,style:{...this.getButtonStyle(r<=0),...ui.firstButtonPadding},hoveredStyle:ui.hoveredButtonStyle,onClick:()=>this.handlePrevious(),icon:e=>Xt.Z.arrowLeft({...e,fill:this.getBottomBarPrimaryColor(),height:16,margin:0,width:16})}))}),o()(di.Z,{renderTooltip:()=>this.renderTooltip({primaryText:o()(x.FormattedMessage,{id:"fullScreenRenderer.next",defaultMessage:"Next",description:"Label for a button in a slideshow of images to go to the next image"}),secondaryText:this.renderPrevNextSecondaryText(r+1,s)}),disableTooltip:r+1===s,render:e=>a().createElement(li.Z,he()({},e,{disabled:r>=s-1,style:{...this.getButtonStyle(r>=s-1),...ui.lastButtonPadding},hoveredStyle:ui.hoveredButtonStyle,onClick:()=>this.handleNext(),icon:e=>Xt.Z.arrowRight({...e,fill:this.getBottomBarPrimaryColor(),height:16,margin:0,width:16})}))}))}renderDownloadButton(){const{isSaving:e}=oi.Z.state;return o()(di.Z,{renderTooltip:()=>this.renderTooltip({primaryText:o()(x.FormattedMessage,{id:"fullScreenRenderer.download",defaultMessage:"Download",description:"Label for a button to download an image"})}),render:t=>a().createElement(li.Z,he()({},t,{disabled:e,onClick:this.handleDownload,style:this.getButtonStyle(!1),hoveredStyle:ui.hoveredButtonStyle}),e?o()(ri.Z,{style:{width:16}}):Xt.Z.download({fill:this.getBottomBarPrimaryColor(),width:16}))})}renderCloseButton(){return o()(di.Z,{renderTooltip:()=>this.renderTooltip({primaryText:o()(x.FormattedMessage,{defaultMessage:"Close",id:"fullscreenRenderer.closeButton.label",description:"Shown in the top right corner when viewing an asset (image, file, etc.) in full screen mode, to close out of full screen mode."}),secondaryText:"esc"}),render:e=>a().createElement(li.Z,he()({},e,{onClick:()=>this.handleClose(),style:{...this.getButtonStyle(!1),...ui.lastButtonPadding},hoveredStyle:ui.hoveredButtonStyle,icon:e=>Xt.Z.collapse({...e,fill:this.getBottomBarPrimaryColor(),height:16,margin:0,width:16})}))})}renderPrevNextSecondaryText(e,t){return o()(x.FormattedMessage,{values:{currentIndex:e+1,totalCount:t},defaultMessage:"{currentIndex} of {totalCount}",id:"fullscreenRenderer.imageCount.label",description:"Description stating what image number this is in a list of images. For example, 3 of 14"})}renderTooltip(e){const{primaryText:t,secondaryText:i}=e;return a().createElement(a().Fragment,null,o()("span",{style:{marginRight:i?4:void 0}},void 0,t),i?o()("span",{style:{color:this.getBottomBarSecondaryColor()}},void 0,i):void 0)}renderVerticalLine(){return o()("span",{style:{borderLeft:"1px solid ".concat(Yt.ZP.whiteWithAlpha(.25)),height:"100%"}})}scrollToZoomFocus(e){const t=window.innerWidth/2,i=window.innerHeight/2,n=e.scrollWidth*this.zoomFocusPercentageX,o=e.scrollHeight*this.zoomFocusPercentageY;e.scrollLeft=n-t,e.scrollTop=o-i}resetControls(){this.isEditingZoom.set(!1),oi.Z.setState({...oi.Z.state,zoomScale:1,panStartPosition:{x:0,y:0},panOffset:{x:0,y:0}})}canPan(){const{zoomScale:e}=oi.Z.state;return e>1}clampPanOffset(e){const t=this.contentDimensions.get();if(!t)return;let i,n;i=t.width*ui.MAX_ZOOM>window.innerWidth?(t.width*ui.MAX_ZOOM-window.innerWidth)/(2*ui.MAX_ZOOM):(window.innerWidth-t.width*ui.MAX_ZOOM)/(2*ui.MAX_ZOOM),n=t.height*ui.MAX_ZOOM>window.innerHeight?(t.height*ui.MAX_ZOOM-window.innerHeight)/(2*ui.MAX_ZOOM):(window.innerHeight-t.height*ui.MAX_ZOOM)/(2*ui.MAX_ZOOM);return{x:Math.min(Math.max(e.x,-1*i),i),y:Math.min(Math.max(e.y,-1*n),n)}}setPanOffset(e){const{panStartPosition:t}=oi.Z.state,i=this.clampPanOffset(e);i&&(e.x!==i.x&&(t.x=t.x+(e.x-i.x)),e.y!==i.y&&(t.y=t.y+(e.y-i.y)),oi.Z.setState({...oi.Z.state,panOffset:i,panStartPosition:t}))}canDownload(){var e;const{block:t,imageUrl:i}=oi.Z.state;return t&&(i||(null===(e=t.getProperties())||void 0===e?void 0:e.source)&&dt.Q(t.getProperties().source))}moveToImageOffset(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const{block:i}=oi.Z.state,n=this.getAllImageBlocksOnPage();if(!n)return;const o=n.findIndex((e=>e===i));if(o+e<0||o+e>=n.length)return;$.trackFullScreenAction(this.environment,{type:e>0?"next":"previous",image_count:n.length,image_index:o+e,triggered_by:t?"keypress":"click"}),oi.Z.setState({...oi.Z.state,skipAnimations:!0}),this.isMovingToPrevOrNextTimeout&&clearTimeout(this.isMovingToPrevOrNextTimeout),this.isMovingToPrevOrNextTimeout=setTimeout((()=>{oi.Z.setState({...oi.Z.state,skipAnimations:!1})}),250);const s=n[o+e];$t.dK({blocks:[s]}),this.resetControls()}getSpringConfig(){return{stiffness:100,damping:10,precision:.001}}getStyle(e){const{isOpen:t}=e;return{zIndex:Ke.mJ,position:"fixed",top:0,left:0,right:0,bottom:0,display:"flex",justifyContent:"center",alignItems:"center",pointerEvents:t?"auto":"none",cursor:this.showControls.get()?void 0:"none"}}getBackgroundStyle(){return{position:"absolute",top:0,left:0,right:0,bottom:0,background:Yt.ZP.black}}getBottomContainerStyle(e){return{bottom:30,display:e?"flex":"none",fontSize:14,left:"50%",lineHeight:1.2,position:"absolute",transform:"translate(-50%, 0)"}}getBottomBarPrimaryColor(){return Yt.ZP.white}getBottomBarSecondaryColor(){return Yt.ZP.whiteWithAlpha(.5)}getButtonStyle(e){return{borderRadius:4,opacity:e?.4:1,padding:6}}}function mi(e){const[t,i]=(0,s.useState)(e.initialValue);return o()(Pe.Z,{style:{width:46,color:e.primaryColor},inputStyle:{textAlign:"center",border:"solid 1px rgba(45, 156, 219, 0.72)",borderRadius:3,boxShadow:"0px 0px 0px 3px rgba(45, 156, 219, 0.2)"},onClick:e=>e.stopPropagation(),onChange:e=>{const t=e.target;i(t.value)},value:t,onSubmit:e.onSubmit,focusInitial:!0,selectAll:!0,format:Pe.B.Transparent,right:o()("span",{style:{color:e.secondaryColor}},void 0,"%"),onKeyDown:t=>{t.stopPropagation(),"Escape"===t.key?e.onCancel():"Tab"===t.key&&e.onSubmit(t)}})}k()(ui,"MAX_ZOOM",2),k()(ui,"MIN_ZOOM",.5),k()(ui,"ZOOM_STEP",.5),k()(ui,"INVERSE_ZOOM_STEP",1/ui.ZOOM_STEP),k()(ui,"ZOOM_THRESHOLD",.25),k()(ui,"MOUSE_WHEEL_SCALE",-.002),k()(ui,"TRACK_PAD_SCALE",-.004),k()(ui,"controlBarStyle",{display:"flex",borderRadius:4,background:Yt.ZP.blackWithAlpha(.65)}),k()(ui,"firstButtonPadding",{padding:"6px 6px 6px 10px"}),k()(ui,"lastButtonPadding",{padding:"6px 10px 6px 6px"}),k()(ui,"hoveredButtonStyle",{background:"rgba(255, 255, 255, 0.055)"});const pi=ui;var gi=i(24684),hi=i(98459),fi=i(19889),vi=i(97880),yi=i(82990),Si=i(54642),bi=i(51118),Mi=i(93678),wi=i(617),Ci=i(98742),ki=i(52533),Ti=i(17256),Ii=i(21115),Zi=i(46096),Pi=i(49065),_i=i(78291),xi=i(42922),Fi=i(84787),Ai=i(31278),Bi=i(76798),Ei=i(77137),Ri=i(18647),Di=i(33411),Li=i(91718),Oi=i(46247),Ni=i(26263),Ui=i(17215),Wi=i(16691),Vi=i(4615),zi=i(45953),qi=i(77420),Hi=i(6287),Gi=i(13493),Ki=i(70279),ji=i(26111),Yi=i(68718),Qi=i(82136),Xi=i(95642);class Ji extends r.Z{constructor(){super(...arguments),k()(this,"handleOverrideLinkClick",(e=>{(0,bi.U4)(),ji.navigate({environment:this.environment,url:e})})),k()(this,"loadSnapshot",(async e=>{const{timestamp:t}=e,i=e.block.id,n=await Si.getSnapshotContents(this.environment,e);if("failed"===n.type)throw n.error;const o=zi.Ak.create(n.data.contentMap),s=this.environment.currentUser.id,a=new Ni.Z;for(const{pointer:m,value:p}of o)p&&a.setRecord({pointer:m,userId:s},{...p,role:"reader"});a.snapshotData={blockId:i,timestamp:t};const r=new Map,l=e=>{const t=a.getRecord({pointer:e,userId:s}),i=(0,Wi.dn)(e);t||!(0,Vi.e)(e.id)||r.has(i)||r.set(i,(0,Pi.Kv)(this.props.blockStore,e))};for(const{pointer:m,value:p}of o)if(p&&p.value)if(m.table===_.iU){var d;const{value:e}=p,t=e,i=Ui.jD(t);for(const a of i)l(a);const n=Ui.DF(t)?[]:t.content||[];for(const a of n)l({table:_.iU,id:a});const o=null===(d=t.format)||void 0===d?void 0:d.collection_pointer;o&&l(o);const s=t.collection_id;s&&l({table:Hi.v,id:s});for(const a of Ui.lc(t))l({table:fi.KJ,id:a});t.created_by_table&&t.created_by_id&&(t.created_by_table===fi.KJ?l({table:fi.KJ,id:t.created_by_id}):l({table:qi.cZ,id:t.created_by_id})),t.last_edited_by_table&&t.last_edited_by_id&&(t.last_edited_by_table===fi.KJ?l({table:fi.KJ,id:t.last_edited_by_id}):l({table:qi.cZ,id:t.last_edited_by_id}))}else if(m.table===Gi.n){var c;const{value:e}=p,t=null===(c=e.format)||void 0===c?void 0:c.collection_pointer;t&&l(t)}else if(m.table===Ki.x_){const{value:e}=p,t=e;t.created_by_id&&t.created_by_table&&(t.created_by_table===fi.KJ?l({table:fi.KJ,id:t.created_by_id}):l({table:qi.cZ,id:t.created_by_id}))}const u=Array.from(r.values());return await Promise.all(u.map((async e=>{await e.load();const t=e.getValue();t&&a.setRecord({pointer:e.pointer,userId:s},{role:"reader",value:t})}))),{blockStore:new Lt.Z(this.environment,{table:_.iU,id:i},{inMemoryRecordCache:a}),timestamp:t}}))}getChildContext(){return{...this.context,overrideLinkClick:this.handleOverrideLinkClick}}renderComponent(){const e=this.props.blockStore.id,t=this.props.timestamp,i={request:{block:{id:e,spaceId:(0,hi.CG)(this.props.blockStore.pointer.spaceId)},timestamp:t},performRequest:this.loadSnapshot,render:(e,t,i)=>o()(Di.Z,{show:!i||!t,showDelay:400,showHold:400,render:i=>i?o()("div",{style:this.getSpinnerWrapperStyles()},void 0,o()(ri.Z,{})):e?o()("div",{style:{padding:32}},void 0,o()(x.FormattedMessage,{defaultMessage:"Something went wrong.",id:"pageSnapshotPreview.unknownPreviewLoadError.message"})):t?o()(V.Z,{store:t.blockStore,isDefaultContainer:!0,droppable:!0,render:e=>{let{selectableEvents:i}=e;return a().createElement(Ri.Z,he()({style:{background:this.theme.contentBackground,zIndex:1,flexGrow:1},type:(0,pt.Zy)({environment:this.environment,store:t.blockStore})},i),o()(Xi.Z,{store:t.blockStore,disabled:!0,loadingContainerStore:void 0,context:Qi.S.InAppTemplatePreview,paddingBottom:Xi.Z.paddingBottom(this.environment),paddingLeft:(0,pt.ui)(this.environment),paddingRight:(0,pt.ui)(this.environment),pageCoverHeight:Xi.Z.defaultPageCoverHeight(this.environment)}))}},t.timestamp):void 0})};return a().createElement(Ei.Z,i)}getSpinnerWrapperStyles(){return{padding:32,display:"flex",alignItems:"center",justifyContent:"center"}}}k()(Ji,"contextTypes",r.w),k()(Ji,"childContextTypes",Yi.u);const $i=Ji;class en extends r.Z{constructor(){super(...arguments),k()(this,"renderSnapshotsListRequest",(()=>{const{device:e}=this.environment,t=Zi.Z.state;if(!t.open)return;const i={request:{block:{id:t.blockStore.id,spaceId:(0,hi.CG)(t.blockStore.pointer.spaceId)},size:t.size},performRequest:e=>this.loadSnapshotsList(e,t),render:(i,n,s)=>o()(Di.Z,{show:Boolean(!n||n.snapshots.length>=t.size&&t.openSnapshotNearTimestamp),showDelay:400,showHold:100,render:o=>e.isMobile?this.renderMobileHistory({snapshotValues:n?n.snapshots:[],menuState:t,error:i,initialLoading:o,loadingMore:!s}):this.renderDesktopHistory({snapshotValues:n?n.snapshots:[],menuState:t,error:i,initialLoading:o,loadingMore:!s})})};return a().createElement(Ei.Z,i)})),k()(this,"renderMobileHistory",(e=>{let t,i;return this.historyIsEnabled()?e.loadingMore||0!==e.snapshotValues.length||(t=this.renderUnavailableMessage(en.noSnapshotsMessage,!1)):t=this.renderUnavailableMessage(this.getUnavailableMessage(),Ii.M9(this.environment)||"team"),i=e.error?o()("div",{style:en.wrapStyle},void 0,o()(x.FormattedMessage,{defaultMessage:"Something went wrong",id:"historyModal.errorMessage"})):e.initialLoading?o()("div",{style:en.wrapStyle},void 0,o()(ri.Z,{})):o()(s.Fragment,{},void 0,o()(Ri.Z,{type:E.Z.Y},void 0,this.renderSnapshotsMenuList(e)),this.renderMobileSnapshotPreview(e.menuState)),o()(U.Z,{menuType:A.o.Modal,title:o()(x.FormattedMessage,{defaultMessage:"History",id:"historyModal.mobileHistoryMenu.title"}),left:this.renderMobileHelpButton(),right:o()(W.DoneMenuText,{}),onClickRight:bi.U4,header:t},void 0,i)})),k()(this,"renderDesktopHistory",(e=>{let t;return t=e.error?o()("div",{style:en.wrapStyle},void 0,o()(x.FormattedMessage,{defaultMessage:"Something went wrong",id:"historyModal.desktopModal.errorMessage"})):e.initialLoading?o()("div",{style:en.wrapStyle},void 0,o()(ri.Z,{})):this.historyIsEnabled()?e.menuState.snapshot&&!this.snapshotIsAvailable({snapshot:e.menuState.snapshot,nextFutureSnapshot:e.menuState.nextFutureSnapshot})?this.renderUnavailableMessage(en.restrictedMessage,"enterprise"):e.loadingMore||0!==e.snapshotValues.length?this.renderDesktopSnapshotPreview(e.menuState):this.renderUnavailableMessage(en.noSnapshotsMessage,!1):this.renderUnavailableMessage(this.getUnavailableMessage(),Ii.M9(this.environment)||"team"),o()(s.Fragment,{},void 0,o()("div",{style:{display:"flex",flexDirection:"column",width:"calc(100% - ".concat(en.sidebarWidth,"px)"),boxShadow:"1px 0 0 ".concat(this.theme.regularDividerColor)}},void 0,t),this.renderDesktopSidebar(e))})),k()(this,"renderSnapshotsMenuList",(e=>{const{device:t}=this.environment,{menuState:i,loadingMore:n}=e,r=X().compact(e.snapshotValues.map(((n,s)=>{const r=s>0?e.snapshotValues[s-1]:void 0,l=this.snapshotIsAvailable({snapshot:n,nextFutureSnapshot:r});return{key:n.id,action:()=>{bi.gs({environment:this.environment,snapshot:n,nextFutureSnapshot:r})},render:e=>{const s=n.authors||[],r=this.props.intl.formatList(X().compact(s.map(((e,t)=>{if(e.table===fi.KJ){const t=(0,Pi.Kv)(i.blockStore,e).getValue();if(!t)return;return(0,fi.Nz)(this.props.intl,t)}{const t=(0,Pi.Kv)(i.blockStore,e).getValue();if(!t)return;return t.name}}))),{type:"conjunction",style:"narrow"}),d=o()("div",{style:{...yi.Z.textOverflowStyle}},void 0,r),c=Boolean(i.snapshot&&i.snapshot.id===n.id),u=6*Bt.A0,m=(0,Ti.Z)(parseInt(n.timestamp)),p=m.format("lll");let g=m.format("LL");if((0,Ti.Z)().diff(m)<=u&&(g=m.calendar()),l)return o()(di.Z,{render:i=>a().createElement(Me.Z,he()({},(0,Ci.Z)(e,i),{title:g,focused:!t.isMobile&&c,caption:d})),renderTooltip:()=>o()("div",{style:{maxWidth:270,whiteSpace:"normal"}},void 0,o()("div",{},void 0,p),o()("div",{},void 0,r))},e.key);{const i=!this.historyIsEnabled();return o()(di.Z,{render:n=>a().createElement(Me.Z,he()({},(0,Ci.Z)(n,e),{title:o()("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between"}},void 0,o()("div",{style:{...t.isMobile&&{display:"flex",flex:1},...yi.Z.textOverflowStyle}},void 0,g),!i&&o()(Li.Z,{subscriptionTier:"enterprise",analyticsName:"history_modal",desktopStyle:{marginLeft:8},onClick:()=>this.handleUpgrade("enterprise")})),focused:!t.isMobile&&c,disabled:i,caption:d})),renderTooltip:()=>o()(x.FormattedMessage,{defaultMessage:"Upgrade to view this snapshot.",id:"historyModal.snapshotsMenuList.upgrade.tooltip"}),disableTooltip:!i},e.key)}}}}))),l=i.snapshot&&i.snapshot.id,d=r.findIndex((e=>l===e.key)),c=[{key:"snapshots",render:e=>a().createElement(ce.Z,e),items:r}];return o()(s.Fragment,{},void 0,o()(we.Z,{type:we.i.Vertical,initialFocus:d,sections:c}),o()(Fi.Z,{loading:n,fetchSize:i.size,resultSize:e.snapshotValues.length,onLoadMore:bi.FF}),o()(Di.Z,{show:n,showDelay:300,showHold:100,render:e=>e&&o()("div",{style:en.wrapStyle},void 0,o()(ri.Z,{}))}))})),k()(this,"handleUpgrade",(e=>{Mi.y(this.environment,{from:"history_modal",for:e})})),k()(this,"loadSnapshotsList",(async(e,t)=>{const{device:i}=this.environment,n=await Si.getSnapshotsList(this.environment,e);if("failed"===n.type)throw n.error;const{snapshots:o}=n.data;if(t.openSnapshotNearTimestamp){const e=parseInt(t.openSnapshotNearTimestamp),i=o.findIndex((t=>parseInt(t.timestamp)<e));0===o.length||(0===i?bi.gs({environment:this.environment,snapshot:o[i],nextFutureSnapshot:void 0}):i>0?bi.gs({environment:this.environment,snapshot:o[i-1],nextFutureSnapshot:i>1?o[i-2]:void 0}):o.length<t.size?bi.gs({environment:this.environment,snapshot:o[o.length-1],nextFutureSnapshot:o.length>1?o[o.length-2]:void 0}):bi.FF())}else Boolean(t.snapshot)||i.isMobile||Zi.Z.setState({...t,snapshot:o[0],nextFutureSnapshot:void 0});return n.data})),k()(this,"iconSize",(()=>{const{device:e}=this.environment;return e.isMobile?24:20}))}renderComponent(){const{device:e}=this.environment,t=Zi.Z.state;return e.isMobile?o()(K.ZP,{popupType:K.ZP.PopupType.SlideUp,open:t.open,render:this.renderSnapshotsListRequest,onDismiss:bi.U4}):o()(Xe.Z,{open:t.open,innerStyle:{height:"80vh",width:"80vw",overflow:"hidden",display:"flex"},onDismiss:bi.U4,render:this.renderSnapshotsListRequest,className:ye.Nn})}renderMobileSnapshotPreview(e){if(this.historyIsEnabled())return o()(K.ZP,{popupType:K.ZP.PopupType.SlideUp,open:Boolean(e.snapshot),forceFullScreenSlideUp:!0,render:()=>{if(!e.snapshot)return;const t=this.snapshotIsAvailable({snapshot:e.snapshot,nextFutureSnapshot:e.nextFutureSnapshot}),i=t?o()($i,{blockStore:e.blockStore,timestamp:e.snapshot.timestamp}):this.renderUnavailableMessage(en.restrictedMessage,"enterprise");return o()(U.Z,{menuType:A.o.Modal,title:(0,Ti.Z)(parseInt(e.snapshot.timestamp)).calendar(),right:o()(W.DoneMenuText,{}),onClickRight:bi.zb,leftDisabled:!t,left:o()(x.FormattedMessage,{defaultMessage:"Restore",id:"historyModal.mobileSnapshotMenu.restoreButton.label"}),onClickLeft:()=>bi.xx(this.environment),whiteBackground:t,forceFullScreenSlideUp:!0},void 0,i)}})}hasPermissionToRestore(e){return(0,wi.k5)({environment:this.environment,blocks:[e.blockStore],originRect:void 0,publicEditMode:void 0})}renderDesktopSidebar(e){const{menuState:t}=e,i=Boolean(t.snapshot&&this.snapshotIsAvailable({snapshot:t.snapshot,nextFutureSnapshot:t.nextFutureSnapshot})&&this.hasPermissionToRestore(t)),n=!this.historyIsEnabled();return o()("div",{style:this.getSidebarStyle()},void 0,o()(Ri.Z,{type:E.Z.Y,style:{flex:1}},void 0,this.renderSnapshotsMenuList(e)),o()("div",{style:{display:"flex",padding:14,borderTop:"\n\t\t\t\t\t\t\t1px solid ".concat(this.theme.regularDividerColor,"\n\t\t\t\t\t\t")}},void 0,o()(di.Z,{disableTooltip:!n,renderTooltip:()=>o()(x.FormattedMessage,{defaultMessage:"Upgrade to restore snapshots.",id:"historyModal.desktopModal.sidebar.upgradeMessage.tooltip"}),render:e=>a().createElement(xi.Z,he()({isLarge:!0,onClick:()=>bi.xx(this.environment),disabled:!i},e),o()(x.FormattedMessage,{defaultMessage:"Restore version",id:"historyModal.desktopModal.restoreButton.label"}))}),o()(Je.Z,{isLarge:!0,style:{marginLeft:12},onClick:bi.U4},void 0,o()(x.FormattedMessage,{defaultMessage:"Cancel",id:"historyModal.desktopModal.cancelButton.label"}))),o()(ce.Z,{topBorder:!0,disableDesktopPadding:!0},void 0,o()(ue.Z,{title:o()(x.FormattedMessage,{id:"historyModal.desktopModal.learnMoreButton.label",defaultMessage:"Learn about page history"}),href:(0,te.UY)("guides.pageHistory"),analyticsFrom:"page_history"})))}renderDesktopSnapshotPreview(e){if(e.snapshot)return o()(s.Fragment,{},void 0,o()("div",{style:{display:"flex",alignItems:"center",flexShrink:0,height:45,fontSize:14,paddingLeft:14}},void 0,e.blockStore.hasIcon()&&o()(Ai.Z,{disabled:!0,icon:e.blockStore.getIcon(),isEmptyPage:e.blockStore.isEmptyPage(),size:this.iconSize(),style:{marginRight:6}}),o()(Bi.Z,{store:e.blockStore})),o()($i,{blockStore:e.blockStore,timestamp:e.snapshot.timestamp}))}deviceSupportsUpgrade(e){const{device:t}=this.environment;return!t.isMobile||"personal"===e&&(0,ki.S)({environment:this.environment})}renderUnavailableMessage(e,t){const{device:i}=this.environment,n=_i.default.state.data;let s=this.deviceSupportsUpgrade(t);const a=n&&Ii.GJ(n);return s&&(0,ki.S)({environment:this.environment})&&"personal"===t&&!a&&(s=!1),o()("div",{style:this.getUnavailableMessageStyle()},void 0,this.deviceSupportsUpgrade(t)&&this.renderVersionHistoryIcon(),o()("div",{style:{...!i.isMobile&&{maxWidth:340}}},void 0,e),s&&t&&o()(xi.Z,{isLarge:!0,onClick:()=>this.handleUpgrade(t),style:{marginTop:16}},void 0,o()(x.FormattedMessage,{defaultMessage:"Upgrade",id:"historyModal.upgradeForHistoryButton.label"})))}renderVersionHistoryIcon(){return Xt.Z.versionHistory({width:64,height:"auto",fill:this.theme.lightIconColor,marginBottom:12})}renderMobileHelpButton(){return o()(Oi.Z,{href:(0,te.UY)("guides.pageHistory"),analyticsFrom:"page_history"})}snapshotIsAvailable(e){return!!Rt.Z.isAdminMode||!!this.historyIsEnabled()&&(!e.nextFutureSnapshot||this.snapshotIsWithinSubscriptionTierDayLimit(e.nextFutureSnapshot))}snapshotIsWithinSubscriptionTierDayLimit(e){const t=(0,Ii.CM)(this.environment);if("enterprise"===t)return!0;const i=this.getSnapshotDayLimit(t);return parseInt(e.timestamp)>Date.now()-i*Bt.A0}getSnapshotDayLimit(e){if(!e)return 0;switch(e){case"student":case"personal":return gi.Zm.personal.days;case"team":return gi.Zm.team.days;case"business":return gi.Zm.business.days;case"enterprise":return gi.Zm.enterprise.days;case"team_free":case"free":case"personal_free":return 0;default:return vi.t1(e)}}historyIsEnabled(){return!!Rt.Z.isAdminMode||Ii.t9(this.environment)}getUnavailableMessage(){return o()(s.Fragment,{},void 0,o()(x.FormattedMessage,{defaultMessage:"Version history is not available for free workspaces.",id:"historyModal.unavailableForFreeWorkspaces.messagePart1"}),o()("br",{}),o()(x.FormattedMessage,{defaultMessage:"Please upgrade to one of our paid plans.",id:"historyModal.unavailableForFreeWorkspaces.messagePart2"}))}getSidebarStyle(){return{display:"flex",flexDirection:"column",flexShrink:0,width:en.sidebarWidth}}getUnavailableMessageStyle(){const{device:e}=this.environment;return{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",marginTop:28,padding:16,textAlign:"center",fontSize:14,...e.isMobile?{position:"relative",zIndex:1,background:this.theme.popoverBackground,boxShadow:"\n\t\t\t\t\t\t\t0 -1px 0 ".concat(this.theme.regularDividerColor,",\n\t\t\t\t\t\t\t0 1px 0 ").concat(this.theme.regularDividerColor,"\n\t\t\t\t\t\t")}:{height:"100%"}}}}k()(en,"sidebarWidth",240),k()(en,"restrictedMessage",o()(x.FormattedMessage,{defaultMessage:"Please upgrade to the Enterprise Plan to access versions older than 30 days.",id:"historyModal.upgradeToEnterprise.message"})),k()(en,"noSnapshotsMessage",o()(x.FormattedMessage,{defaultMessage:"This page does not have any snapshots yet. Allow up to 10 minutes for the first snapshot to be generated.",id:"historyModal.noSnapshotsYet.message"})),k()(en,"wrapStyle",{display:"flex",justifyContent:"center",padding:32});const tn=(0,x.injectIntl)(en);var nn=i(67206),on=i(36280),sn=i(73959),an=i(89086),rn=i(66949),ln=i(46650),dn=i(3702);class cn extends r.Z{constructor(){super(...arguments),k()(this,"input",a().createRef()),k()(this,"handleInputChange",((e,t)=>{rn.Z.isOpen()&&rn.Z.setState({...rn.Z.state,value:e,error:t})})),k()(this,"handleSubmit",(()=>{mt.createAndCommit({userAction:"InlineEquationOverlay.handleSubmit",environment:this.environment,perform:e=>{on.gt({environment:this.environment,equationStore:rn.Z,transaction:e})}})})),k()(this,"handleClose",(()=>{on.Wj()})),k()(this,"handleLeft",(e=>{if(!this.input.current)return;const t=this.input.current.getSelection();t&&"altKey"in e&&!e.altKey&&"shiftKey"in e&&!e.shiftKey&&0===t.startIndex&&0===t.endIndex&&(this.handleSubmit(),on.Wj(rn.P.Backward))})),k()(this,"handleRight",(e=>{if(!rn.Z.isOpen())return;if(!this.input.current)return;const t=this.input.current.getSelection();if(!t)return;const i=rn.Z.state.value.length;"altKey"in e&&!e.altKey&&"shiftKey"in e&&!e.shiftKey&&t.startIndex===i&&t.endIndex===i&&(this.handleSubmit(),on.Wj())})),k()(this,"isDisabled",(()=>{var e;if("editing"!==Tt.default.state.mode&&!rn.Z.isOpen())return!0;const t=rn.Z.isOpen()?null===(e=(0,bt.QY)(rn.Z.state.savedTextSelectionState.multiSelection))||void 0===e?void 0:e.store:void 0;if(t&&!t.canEdit())return!0;if(t){const e=(0,sn.J2)(t);if(e&&e.isLocked())return!0}if(t&&t.table===Ki.x_){const e=this.getCommentValue(t),{currentUserStore:i}=S.default.state;if(!e||!i)return!0;if(e.created_by_table!==fi.KJ||i.id!==e.created_by_id)return!0}const i={[dt.GK.User]:dt.GK.User,[dt.GK.Page]:dt.GK.Page,[dt.GK.Comment]:dt.GK.Comment,[dt.GK.Bot]:dt.GK.Bot,[dt.GK.Date]:dt.GK.Date,[dt.GK.ExternalObjectInstance]:dt.GK.ExternalObjectInstance,[dt.GK.TemporaryPage]:dt.GK.TemporaryPage,[dt.GK.TemplateVariable]:dt.GK.TemplateVariable,[dt.GK.FormulaCheckbox]:dt.GK.FormulaCheckbox,[dt.GK.FormulaPageProperty]:dt.GK.FormulaPageProperty,[dt.GK.FormulaUserProperty]:dt.GK.FormulaUserProperty,[dt.GK.FormulaContextValue]:dt.GK.FormulaContextValue};for(const n of Object.values(i))if((0,an.J6)(n))return!0;return!1})),k()(this,"INPUT_ORIGIN_GAP_PX",8)}renderComponent(){if(!rn.Z.isOpen())return;const e=!rn.Z.isOpen(),t=this.isDisabled(),i=this.getInputOriginRect(),n=rn.Z.state.value,s=rn.Z.state.error;return o()(m.DependencyConsumer,{dependency:m.deps.prismjs},void 0,(o=>{if(!e)return a().createElement(dn.Z,{Prism:o,ref:this.input,isOpen:!0,equationValue:n,error:s,displayMode:"inline",disabled:t,originRect:i,originGap:this.INPUT_ORIGIN_GAP_PX,onDismiss:this.handleClose,onChange:this.handleInputChange,onSubmit:this.handleSubmit,onLeft:this.handleLeft,onRight:this.handleRight})}))}getCommentValue(e){return ln.Z.createChildStore(e,{table:Ki.x_,id:e.id,spaceId:(0,hi.CG)(e.pointer.spaceId)}).getValue()}getInputOriginRect(){if(rn.Z.isOpen())return rn.Z.state.savedTextSelectionRect}}const un=cn;var mn=i(94416);class pn extends r.Z{constructor(){super(...arguments),k()(this,"handleOpen",(()=>{mn.Z.setState({open:!0})})),k()(this,"handleClose",(()=>{mn.Z.setState({open:!1})}))}willMount(){yt.inPageSearch.started.addListener(this.handleOpen),yt.inPageSearch.stopped.addListener(this.handleClose)}willUnmount(){yt.inPageSearch.started.removeListener(this.handleOpen),yt.inPageSearch.stopped.removeListener(this.handleClose)}}const gn=pn;var hn=i(96313),fn=i(73744),vn=i(70726),yn=i(48863);function Sn(e){switch(e){case vn.Z.Preview:return o()(x.FormattedMessage,{id:"internalUnfurlingMenu.actions.pasteAsPreview.title",defaultMessage:"Paste as preview",description:"Label to unfurl pasted link as a preview"});case vn.Z.Mention:return o()(x.FormattedMessage,{id:"internalUnfurlingMenu.actions.pasteAsMention.title",defaultMessage:"Paste as mention",description:"Label to unfurl pasted link as an inline mention"});case vn.Z.Link:return o()(x.FormattedMessage,{id:"internalUnfurlingMenu.actions.pasteAsLink.title",defaultMessage:"Paste as link",description:"Label to paste link as a normal URL"});default:(0,vi.t1)(e)}}const bn=function(){const e=(0,Ae.O7)(),t=(0,s.useRef)(null),[i]=(0,d.oR)(yn.Z),n=(0,s.useCallback)((t=>{if(i.open){var n;if(!t)hn.pg({actionType:i.focusedIndex,environment:e,commentStore:null===(n=i.args.commentStore)||void 0===n?void 0:n.state,useTempStores:!1});yn.Z.setState({open:!1})}}),[e,i]),r=(0,s.useCallback)((e=>{i.open&&"ArrowUp"!==e.key&&"ArrowDown"!==e.key&&"Enter"!==e.key&&n(void 0)}),[n,i.open]),l=(0,s.useCallback)((e=>{const o=t.current;if(!i.open||!e.target||!o)return;const s=Le().findDOMNode(o);s&&(s.contains(e.target)||n(void 0))}),[n,i.open]);(0,s.useEffect)((()=>((0,fn.l)(window,"keydown",r),(0,fn.l)(window,"mousedown",l),()=>{(0,fn.Z)(window,"keydown",r),(0,fn.Z)(window,"mousedown",l)})),[r,l]);const c=(0,s.useRef)(!1);function u(t){var n;i.open&&void 0!==t.indexGlobal&&(yn.Z.setState({...i,focusedIndex:t.indexGlobal}),hn.pg({actionType:t.indexGlobal,environment:e,commentStore:null===(n=i.args.commentStore)||void 0===n?void 0:n.state,useTempStores:!0}))}(0,d.VK)((()=>{var t,n,o;const s=null!==(t=i.open&&(null===(n=i.args.commentStore)||void 0===n?void 0:n.state)&&(null===(o=i.args.commentStore.state)||void 0===o?void 0:o.isReady()))&&void 0!==t&&t;var a;s&&!c.current&&i.open&&hn.pg({actionType:i.focusedIndex,environment:e,commentStore:null===(a=i.args.commentStore)||void 0===a?void 0:a.state,useTempStores:!0});c.current=s}),[e,i]);const m=(0,d.VK)((()=>e.device.isMobileNative&&!e.device.isTablet),[e]),p=e.device.isMobile;return o()(K.ZP,{popupType:m?K.ZP.PopupType.SlideUp:K.ZP.PopupType.Popup,open:i.open,originRect:i.open?i.selectionRect:void 0,placementToOrigin:K.ZP.Placement.Top,alignmentToOrigin:K.ZP.Alignment.Start,originGap:4,disableMouseCapture:!0,disableContentScroll:!0,disableDarkOverlayBackground:p,keepFocus:p,render:function(){var n;const{device:s}=e;if(!i.open)return;const r=function(t){const{url:i,args:n}=t,o=[];o.push({title:Sn(vn.Z.Preview),validator:()=>!0,type:vn.Z.Preview}),o.push({title:Sn(vn.Z.Mention),validator:()=>!0,type:vn.Z.Mention}),o.push({title:Sn(vn.Z.Link),validator:()=>!0,type:vn.Z.Link});return[{key:"menu section",render:e=>a().createElement(ce.Z,e),items:X().compact(o.map((t=>{let{title:o,validator:s,type:r}=t;if(s({url:i,baseUrl:Rt.Z.domainBaseUrl,publicDomainName:Rt.Z.publicDomainName})){return{key:"item ".concat(r),render:t=>a().createElement(Me.Z,he()({},t,{title:o,onMouseEnter:i=>{var o;t.onMouseEnter(i),hn.pg({actionType:r,environment:e,commentStore:null===(o=n.commentStore)||void 0===o?void 0:o.state,useTempStores:!0})}})),action:()=>{var t;return hn.pg({actionType:r,environment:e,commentStore:null===(t=n.commentStore)||void 0===t?void 0:t.state,useTempStores:!1})}}}})))}]}(i);let l;return l=s.isMobile?{menuType:A.o.ActionSheet}:{menuType:A.o.Popup,width:320,maxHeight:"40vh"},null!==(n=i.args.commentStore)&&void 0!==n&&n.state&&i.args.commentStore.state.isReady()?a().createElement(U.Z,he()({},l,{className:ye.sr,ref:t}),o()(we.Z,{type:we.i.Vertical,sections:r,onKeyboardArrow:u,initialFocus:0,priority:1})):o()(Di.Z,{show:!0,showDelay:500,showHold:0,render:()=>a().createElement(U.Z,he()({},l,{className:ye.sr,ref:t}),o()(ce.Z,{style:{display:"flex",justifyContent:"center"}},void 0,o()(ri.Z,{})))})},onDismiss:()=>n(void 0)})};var Mn=i(64572),wn=i(88295),Cn=i(45990),kn=i(21325),Tn=i(48709),In=i(18466),Zn=i(1800),Pn=i(64002),_n=i(25186),xn=i(11470);const Fn={...yi.Z.textOverflowStyle,fontWeight:yi.Z.fontWeight.medium,maxWidth:160,display:"inline-block",verticalAlign:"bottom"};function An(e){const{pageTitle:t}=e;return o()(x.FormattedMessage,t?{defaultMessage:"New “{filterText}” page in…",id:"createPageMenuItem.title.withPageName",values:{filterText:o()("span",{style:Fn},void 0,t)}}:{defaultMessage:"Add new page in…",id:"createPageMenuItem.title.withoutPageName"})}function Bn(e){const{pageTitle:t}=e;return o()(x.FormattedMessage,t?{defaultMessage:"New “{filterText}” sub-page",id:"createSubpageMenuItem.title.withPageName",values:{filterText:o()("span",{style:Fn},void 0,t)}}:{defaultMessage:"Add new sub-page",id:"createSubpageMenuItem.title.withoutPageName"})}function En(e){const{inputUrl:t,allSections:i,previousSections:n,sectionToFocus:o,itemToFocus:a}=e,r=(0,Ae.MO)();return(0,s.useMemo)((()=>{if(r)return;if(!t||!o||!a)return 0===i.length?void 0:0;const e=X().sum(n.map((e=>e.items.length)))+o.items.indexOf(a);return Math.max(e,0)}),[r,t,i,n,o,a])}var Rn=i(59054),Dn=i(31299),Ln=i(15447),On=i(88632);function Nn(e){const{state:t,inputUrl:i,query:n,handleLinkSelection:r,disableEmptyQueryResults:l}=e,{savedTextSelectionState:c,focusLinkInput:u}=t,m=(0,Ae.O7)(),[{online:p}]=(0,d.oR)(On.Z),g=(0,s.useMemo)((()=>{var e;const t=null===(e=(0,bt.QY)(c.multiSelection))||void 0===e?void 0:e.store;if(t&&(0,B.NZ)(t))return t}),[c]),[{value:h,status:f}]=(0,Rn.r5)((async()=>{if(!p)return[];if(!n)return l?[]:Ln.X4.state.map((e=>e.pageId));if(!u)return[];return(await(0,Dn.WL)({nearBlock:g,environment:m,query:n,source:"mention_menu",limit:10})).map((e=>e.id))}),[n,g,m,p,l,u]),v=(0,s.useMemo)((()=>{if(i&&"notion"===i.type){const e=h?X().without(h,i.notionPage.blockId):[];return[i,...e]}return h}),[h,i]);return(0,s.useMemo)((()=>{if(!v||0===v.length)return;if(i&&"web"===i.type&&i.url===n)return;const e=In.Z.withListenerIgnored(pt.RM);if(!e)return;const s=t.url?5:3,l=o()(x.FormattedMessage,{id:"selectionLinkButton.linkToPage.linkToBlock",defaultMessage:"Link to block",description:"Shown beneath a page title if linking to a block inside that page"}),d=o()(x.FormattedMessage,{defaultMessage:"Link to page",id:"selectionLinkButton.linkToPageSection.title"});return{items:X().compact(v.map((i=>{const n="object"==typeof i?i.notionPage.peekViewBlockId||i.notionPage.blockId:i,s=Lt.Z.createChildStore(e,{table:_.iU,id:n});return{key:n,action:()=>{if("object"==typeof i){const e=(0,Mn.nR)({pageId:i.notionPage.blockId,peekViewBlockId:i.notionPage.peekViewBlockId,peekMode:i.notionPage.peekMode,discussionId:i.notionPage.discussionId,collectionViewId:i.notionPage.collectionViewId,scrollToBlockId:i.notionPage.scrollToBlockId});r(m,t,e)}else r(m,t,(0,Mn.nR)({pageId:n}))},render:e=>{const t="object"==typeof i&&i.notionPage.scrollToBlockId;return a().createElement(xn.Z,he()({},e,{store:s,caption:t?l:void 0,placeholder:o()(Di.Z,{showHold:300,showDelay:300,show:"resolved"===f,render:e=>o()(x.FormattedMessage,e?{id:"selectionLinkButton.linkToPage.unknownBlock",defaultMessage:"Unknown block"}:{id:"selectionLinkButton.linkToPage.loading",defaultMessage:"Loading..."})})}))}}}))).slice(0,s),title:v.some((e=>Boolean("object"==typeof e&&e.notionPage.scrollToBlockId)))?d:l}}),[v,t,m,n,i,f,r])}var Un=i(23178);function Wn(e){const{state:t}=e,i=(0,Ae.O7)();return(0,s.useMemo)((()=>{if(t.editingToken)return{key:"unlink",action:()=>Cn.PP(i),render:e=>a().createElement(Me.Z,he()({},e,{title:o()(x.FormattedMessage,{id:"selectionLinkButton.removeLink",defaultMessage:"Remove link"}),icon:Xt.Z.trash({width:16})}))}}),[t.editingToken,i])}function Vn(e){const{state:t}=e,i=(0,s.useMemo)((()=>(0,Tn.uP)(t)),[t]),n=(0,s.useMemo)((()=>(0,Tn.dY)(i)),[i]),r=function(e){const{state:t,inputUrl:i,query:n}=e,o=Nn({state:t,inputUrl:i,query:n,handleLinkSelection:zn});return(0,s.useMemo)((()=>o?{key:"mention results",items:o.items,render:e=>a().createElement(ce.Z,he()({},e,{title:o.title,isTitleUppercase:!0}))}:void 0),[o])}({state:t,inputUrl:n,query:i}),l=function(e){const{state:t}=e,i=(0,Ae.O7)(),n=(0,Be.F)();return(0,s.useMemo)((()=>{const e=o()(x.FormattedMessage,{defaultMessage:"Linked to",id:"selectionLinkButton.linkedToSection.title"}),s=(0,Tn.Fs)(t),r=s?(0,Mn.A5)({url:s,baseUrl:Rt.Z.domainBaseUrl,publicDomainName:Rt.Z.publicDomainName}):void 0;if(r&&s){const t=In.Z.withListenerIgnored(pt.RM);if(!t)return;const n=Lt.Z.createChildStore(t,{table:_.iU,id:r});return{key:"linked to",render:t=>a().createElement(ce.Z,he()({title:e,isTitleUppercase:!0},t)),items:[{key:"linked to page",action:e=>{let{event:t}=e;const n=t&&"metaKey"in t&&t.metaKey;n||Un.Z.setState({open:!1}),(0,ji.navigate)({environment:i,url:s,metaClick:n})},render:e=>a().createElement(xn.Z,he()({},e,{store:n}))}]}}if(s)return{key:"linked to",render:t=>a().createElement(ce.Z,he()({title:e,isTitleUppercase:!0},t)),items:[{key:"linked to web",action:e=>{let{event:t}=e;return(0,ji.navigate)({environment:i,url:s,metaClick:t&&"metaKey"in t&&t.metaKey})},render:e=>a().createElement(Me.Z,he()({},e,{title:s,caption:o()(x.FormattedMessage,{defaultMessage:"Web page",id:"selectionLinkButton.linkedToSection.webPage"}),icon:Xt.Z.globe2({width:16,fill:n.mediumIconColor})}))}]}}),[i,t,n])}({state:t}),c=X().compact([r,l]),u=c.length>0,m=function(e){const{state:t,inputUrl:i,query:n}=e,r=(0,Ae.O7)(),[{online:l}]=(0,d.oR)(On.Z);return(0,s.useMemo)((()=>{if(!i)return;if("notion"===i.type&&l)return;let e;return"web"===i.type?e=o()(x.FormattedMessage,{id:"selectionLinkButton.linkToWebPage",defaultMessage:"Link to web page"}):"notion"===i.type?e=o()(x.FormattedMessage,{id:"selectionLinkButton.linkToPage",defaultMessage:"Link to page"}):"other"===i.type?e=o()(x.FormattedMessage,{id:"selectionLinkButton.linkToURL",defaultMessage:"Link to URL"}):(0,vi.t1)(i.type),{key:"link to url",action:()=>zn(r,t,n),render:t=>a().createElement(Me.Z,he()({},t,{title:e,icon:Xt.Z.link({width:16})}))}}),[t,n,r,l,i])}({state:t,inputUrl:n,query:i}),p=function(e){const{state:t,hasResults:i,query:n,linkToUrlItem:r}=e,l=function(e){const{state:t}=e,i=(0,Ae.O7)();return(0,s.useMemo)((()=>{if(t.editingToken)return{key:"copy link",action:()=>function(e,t){const i=(0,Tn.Fs)(t);if(!i)return;const n=(0,Mn.A5)({url:i,baseUrl:Rt.Z.domainBaseUrl,publicDomainName:Rt.Z.publicDomainName}),o=n?(0,Zn.Z)({pageId:n,baseUrl:Rt.Z.domainBaseUrl}):i;_n.RD({environment:e,stringValue:o,copiedMessage:_n.tq.copiedLinkToClipboard}),Cn.F5()}(i,t),render:e=>a().createElement(Me.Z,he()({},e,{title:o()(x.FormattedMessage,{id:"selectionLinkButton.copyLink",defaultMessage:"Copy link",description:"Copies the URL for the focused link to the user's clipboard"}),icon:Xt.Z.copy({width:16})}))}}),[t,i])}({state:t}),d=Wn({state:t}),c=function(e){var t;const{state:i,query:n}=e,r=null===(t=(0,bt.QY)(i.savedTextSelectionState.multiSelection))||void 0===t?void 0:t.store;return(0,s.useMemo)((()=>{if(!n)return;if(!r||!r.isDefaultRecordCache())return;const e=(0,Tn.dY)(n);return e&&(e.url===n||"notion"===e.type&&e.notionPage)?void 0:{key:"create page",action:qn,render:e=>a().createElement(Me.Z,he()({},e,{icon:Xt.Z.alias({width:16}),title:o()(An,{pageTitle:n})}))}}),[n,r])}({state:t,query:n});return(0,s.useMemo)((()=>{const e=X().compact([r,l,d,c]);if(0!==e.length)return{key:"link actions",render:e=>a().createElement(ce.Z,he()({topBorder:i},e)),items:e}}),[i,r,l,d,c])}({query:i,state:t,hasResults:u,linkToUrlItem:m}),g=X().compact([...c,p]);return{sections:g,initialFocus:En({inputUrl:n,allSections:g,previousSections:c,sectionToFocus:p,itemToFocus:m})}}function zn(e,t,i){const n=(0,Pn.D5)(i);n&&(mt.createAndCommit({userAction:"LinkMenu.handleLinkSelection",environment:e,perform:i=>{Cn.gp({environment:e,transaction:i,url:n,editingToken:t.editingToken,savedTextSelectionState:t.savedTextSelectionState}),Un.Z.reset()}}),$.trackUrlPaste(e,{pastedText:n,source:"link_menu"}))}function qn(){const e=Un.Z.state;e.open&&Un.Z.setState({...e,showCreateIn:!0})}var Hn=i(7908);function Gn(e){const{store:t,onClick:i}=e,n=(0,Be.F)(),s=(0,Ae.O7)(),a=(0,d.VK)((()=>t.getIcon()),[t]),r=(0,d.VK)((()=>t instanceof Lt.Z&&t.isEmptyPage()),[t]);return o()(Hn.Z,{style:{display:"flex",alignItems:"center",padding:"4px 6px",marginLeft:12,marginRight:12,borderRadius:3,boxShadow:n.inputBoxShadow,background:n.inputBackground,height:28,fontSize:14,lineHeight:"120%"},onClick:i},void 0,o()(Ai.Z,{disabled:!0,icon:a,isEmptyPage:r,size:s.device.isMobile?24:20,style:{marginRight:4}}),o()(Bi.Z,{store:t}))}function Kn(e){const{state:t,defaultValue:i,onBlur:n,onKeyDown:s}=e,a=(0,Ae.MO)(),r=(0,x.useIntl)(),l=r.formatMessage({defaultMessage:"Paste link or search pages",id:"selectionLinkButton.search.createNewLinkPlaceholder",description:"Placeholder text in the link input field when there is no current link"}),d=r.formatMessage({defaultMessage:"Edit link or search pages",id:"selectionLinkButton.search.editLinkPlaceholder",description:"Placeholder text in the link input field when there is an existing link that will be modified"}),c=!a||!t.showCreateIn,u=a?void 0:!t.showCreateIn&&t.focusLinkInput,m=t.editingToken?d:l;return c?o()(de.ZP,{onFocus:Tn.FV,placeholder:m,value:i||t.url,onChange:jn,onBlur:n,onKeyDown:s,focus:u,focusInitial:a,focusAfterAnimation:!0,preventCaptureArrowShortcuts:!0}):null}const jn=e=>{const t=Un.Z.state;t.open&&Un.Z.setState({...t,url:e.target.value,focusLinkInput:!0})};function Yn(e){const{state:t,showPreview:i,store:n}=e,s=(0,Tn.Fs)(t);return i&&n?o()(Gn,{store:n,onClick:Tn.FV}):o()(Kn,{state:t,onBlur:Tn.cX,onKeyDown:Qn,defaultValue:i?s:void 0})}const Qn=e=>{"Escape"===e.key&&(e.stopPropagation(),(0,Tn.hy)())};function Xn(e){const{title:t,focus:i,defaultTitle:n}=e,a=(0,Ae.O7)(),[r,l]=(0,s.useState)(),d=(0,s.useMemo)((()=>({environment:a,defaultTitle:n,setPlaceholder:l})),[n,a]);return o()(de.ZP,{focus:i,onFocus:eo,onBlur:()=>to(d),onChange:e=>Jn(e,d),onKeyDown:e=>io(e,d),value:r?"":t,placeholder:r,preventCaptureArrowShortcuts:!0,style:{paddingBottom:8}})}const Jn=(e,t)=>{$n(e.target.value,t)},$n=(e,t)=>{const i=Un.Z.state;if(!i.open)return;const{editingToken:n,savedTextSelectionState:o}=i;if(!n)return;if(!e)return void Un.Z.setState({...i,title:""});const{environment:s,setPlaceholder:a}=t;mt.createAndCommit({userAction:"LinkMenu.updateTitle",environment:s,perform:t=>{const r=Cn.iX({environment:s,title:e,transaction:t,editingToken:n,savedTextSelectionState:o});r&&Un.Z.setState({...i,...r,title:e}),a(void 0)}})},eo=()=>{(0,Tn.ZG)(!0)},to=e=>{no(e),(0,Tn.ZG)(!1)},io=(e,t)=>{"Enter"!==e.key&&"Escape"!==e.key||(e.stopPropagation(),to(t))},no=e=>{const t=Un.Z.state;if(!t.open)return;const{defaultTitle:i,setPlaceholder:n}=e;t.title||($n(i,e),n(i))};function oo(e){const{state:t}=e,i=(0,s.useMemo)((()=>(0,Tn.uP)(t)),[t]),n=(0,s.useMemo)((()=>(0,Tn.dY)(i)),[i]),r=function(e){const{state:t,inputUrl:i,query:n,handleLinkSelection:r}=e,{url:l}=t,c=(0,Ae.O7)(),[{online:u}]=(0,d.oR)(On.Z),m=!!l;return(0,s.useMemo)((()=>{let e,s=!1;if(!i&&m)e=o()(x.FormattedMessage,{defaultMessage:"Type a complete URL to link",id:"selectionLinkButton.invalidUrl",description:"Caption for the disabled link to URL menu item when the user has typed an incomplete URL"}),s=!0;else{if(!i)return;if("notion"===i.type&&u)return;"web"===i.type?e=o()(x.FormattedMessage,{id:"selectionLinkButton.linkToWebPage",defaultMessage:"Link to web page"}):"notion"===i.type?e=o()(x.FormattedMessage,{id:"selectionLinkButton.linkToPage",defaultMessage:"Link to page"}):"other"===i.type?e=o()(x.FormattedMessage,{id:"selectionLinkButton.linkToURL",defaultMessage:"Link to URL"}):(0,vi.t1)(i.type)}return{key:"link to url",action:()=>r(c,t,n),render:t=>a().createElement(Me.Z,he()({},t,{title:l,caption:e,icon:Xt.Z.globe2({width:16,paddingTop:4}),disabled:s}))}}),[t,n,c,u,i,r,m,l])}({state:t,inputUrl:n,query:i,handleLinkSelection:so}),l=function(e){const{state:t,inputUrl:i,query:n,additionalItem:r}=e,{editingToken:l}=t,d=Nn({state:t,inputUrl:i,query:n,handleLinkSelection:so,disableEmptyQueryResults:!!l});return(0,s.useMemo)((()=>{if(d||r){return{key:"mention results",items:X().compact([...(null==d?void 0:d.items)||[],r]),render:e=>a().createElement(ce.Z,he()({},e,{title:l?void 0:o()(x.FormattedMessage,{id:"selectionLinkButton.recents.title",defaultMessage:"Recents",description:"Header for suggested recent pages"})}))}}}),[d,r,l])}({state:t,inputUrl:n,query:i,additionalItem:r}),c=(0,Tn.Fs)(t),u=c&&(0,Mn.A5)({url:c,baseUrl:Rt.Z.domainBaseUrl,publicDomainName:Rt.Z.publicDomainName}),m=(0,d.VK)((()=>{if(!u)return;const e=(0,pt.RM)();return e?Lt.Z.createChildStore(e,{table:_.iU,id:u}):void 0}),[u]),p=function(e){const{state:t,url:i,pageStore:n}=e;return(0,s.useMemo)((()=>{let e=o()(x.FormattedMessage,{defaultMessage:"Page or URL",id:"selectionLinkButton.currentInfo.pageOrUrl",description:"Section title for the currently linked page or URL"});const s=!t.focusLinkInput;let r;return n?r={key:"link to page",action:()=>{},render:()=>o()(Yn,{state:t,showPreview:s,store:n})}:i?r={key:"link to web",action:()=>{},render:()=>o()(Yn,{state:t,showPreview:s})}:(e=void 0,r={key:"create link",action:()=>{},render:()=>o()(Yn,{state:t,showPreview:s})}),{key:"page or url",render:t=>a().createElement(ce.Z,he()({title:e},t)),items:[r]}}),[t,i,n])}({state:t,url:c,pageStore:m}),g=function(e){const{state:t,url:i,pageStore:n}=e,{editingToken:r,title:l,focusTitleInput:c}=t,u=(0,d.VK)((()=>n?dt.Q(n.getTitleValue()):void 0),[n]);return(0,s.useMemo)((()=>{if(r)return{key:"link title",render:e=>a().createElement(ce.Z,he()({title:o()(x.FormattedMessage,{defaultMessage:"Link title",id:"selectionLinkButton.currentInfo.linkTitle",description:"Section title for the currently linked page or URL's title"})},e)),items:[{key:"update title",action:()=>{},render:()=>o()(Xn,{title:l,defaultTitle:null!=u?u:i,focus:c})}]}}),[r,l,c,i,u])}({state:t,url:c,pageStore:m}),h=function(e){const{state:t}=e,i=Wn({state:t});return(0,s.useMemo)((()=>{const e=X().compact([i]);if(0!==e.length)return{key:"link actions",render:e=>a().createElement(ce.Z,he()({topBorder:!0},e)),items:e}}),[i])}({state:t});let f,v,y=[];l?(f=X().compact([p,l]),y=X().compact([p]),v=l):f=X().compact([p,g,h]);return{initialFocus:En({inputUrl:n,allSections:f,previousSections:y,sectionToFocus:v,itemToFocus:r}),sections:f}}function so(e,t,i){const n=(0,Pn.D5)(i);if(!n)return;const{editingToken:o,savedTextSelectionState:s,title:a}=t;mt.createAndCommit({userAction:"LinkMenu.handleLinkSelection",environment:e,perform:i=>{const r=Cn.gp({environment:e,transaction:i,url:n,title:a,editingToken:o,savedTextSelectionState:s});r?Un.Z.setState({...t,...r,url:"",focusLinkInput:!1,focusTitleInput:!1}):Un.Z.reset()}}),$.trackUrlPaste(e,{pastedText:n,source:"link_menu"})}var ao=i(54835),ro=i(23566);function lo(){const[e]=(0,d.oR)(Un.Z),t=(0,Ae.Fy)(),i=(0,d.VK)(l.bq,[]),n=(0,d.VK)((()=>{if(!e.open)return!1;if(e.focusLinkInput||e.focusTitleInput)return!1;const t=Tt.default.state;if("editing"!==t.mode)return!0;const i=(0,bt.QY)(t.multiSelection);if(!i)return!0;const{store:n,selection:o}=i;return(0,an.wd)(o)?!dt.oP(n.getValue(),o.startIndex,o.endIndex,dt.GK.Link):!(0,bt._v)(t.multiSelection,e.savedTextSelectionState.multiSelection)}),[e]);return(0,s.useEffect)((()=>{n&&Cn.F5()}),[n]),o()(K.ZP,{popupType:t.isMobile?t.isTablet?K.ZP.PopupType.Popup:K.ZP.PopupType.SlideUp:K.ZP.PopupType.Popup,style:{width:fo(i)},keepFocus:t.isPhone,open:e.open,originRect:e.open?e.selectionRect:void 0,placementToOrigin:K.ZP.Placement.Bottom,alignmentToOrigin:K.ZP.Alignment.Center,originGap:8,disableContentScroll:!0,onDismiss:Cn.F5,render:()=>e.open?o()(co,{state:e}):void 0,preventBlockRenderQueueOnEnter:!t.isMobile})}function co(e){const{state:t}=e,i=(0,Ae.MO)(),n=(0,d.VK)((()=>ao.default.checkGate("edit_link_v2")),[]),[r,l]=(0,s.useState)(!0);if((0,s.useEffect)((()=>l(!1)),[]),t.showCreateIn&&!i)return o()(po,{state:t});const c=!n&&o()(uo,{state:t});let u;return u=i?{menuType:A.o.Modal,title:o()(x.FormattedMessage,{defaultMessage:"Link",id:"selectionLinkButton.mobile.title"}),right:o()(W.CancelMenuText,{}),onClickRight:Cn.F5,header:c,footer:o()(K.ZP,{popupType:K.ZP.PopupType.SlideUp,open:t.showCreateIn||!1,render:()=>o()(po,{state:t})})}:{menuType:A.o.Popup,header:c},o()(Zt.Z,{capture:t.open&&(r||t.focusLinkInput||t.focusTitleInput),allowEsc:!0},void 0,a().createElement(U.Z,u,o()(mo,{state:t,useMenuList:n?oo:Vn})),o()(N.Z,{capture:!0,onCommandSlash:Tn.FV}))}function uo(e){const{state:t}=e;return o()(ce.Z,{isInput:!0,desktopStyle:(0,Tn.X)(t)?{marginBottom:8}:void 0},void 0,o()(Kn,{state:t}))}function mo(e){const{state:t,useMenuList:i}=e,{initialFocus:n,sections:s}=i({state:t});return o()(we.Z,{type:we.i.Vertical,initialFocus:n,sections:s})}function po(e){var t;const{state:i}=e,n=(0,Ae.O7)(),a=(0,s.useCallback)((async e=>{var t;if(!kn.M_(n))return;const o=null===(t=(0,bt.QY)(i.savedTextSelectionState.multiSelection))||void 0===t?void 0:t.store;if(!o)return;const{performResult:{createInState:s}}=await mt.createAndCommitAsync({environment:n,userAction:"LinkMenu.LinkCreateInMenu",waitForServerCommit:!0,perform:async t=>{const s=(0,wn.f8)({environment:n,transaction:t,titleText:i.url||"",createInValue:e,recordStoreParent:o}),[a]=s.createdPages;return a&&Cn.gp({environment:n,url:(0,Mn.nR)({pageId:a.id}),transaction:t,editingToken:i.editingToken,savedTextSelectionState:i.savedTextSelectionState}),await s.moveToStorePromise,{createInState:s}}});await(0,wn.c_)({analyticsFrom:"link_menu",createInState:s})}),[i,n]),r=null===(t=(0,bt.QY)(i.savedTextSelectionState.multiSelection))||void 0===t?void 0:t.store,c=r&&"block"===r.table?r.id:void 0,u=(0,d.VK)(l.bq,[]);return o()(ro.Z,{targets:[],isAddTo:!0,isCreateIn:!0,onAccept:a,captureSelection:!1,restoreSelection:!1,parentBlockId:c,onAutocompleteQueryChange:go,autocompleteQuery:i.createInQuery||"",desktopWidth:fo(u),onCancel:ho})}function go(e){const t=Un.Z.state;t.open&&Un.Z.setState({...t,createInQuery:e})}function ho(){const e=Un.Z.state;e.open&&Un.Z.setState({...e,showCreateIn:!1,createInQuery:""})}function fo(e){return e?400:330}var vo=i(27153),yo=i(91390),So=i(65792),bo=i.n(So),Mo=i(91584),wo=i(96802),Co=i(64964),ko=i(53471),To=i(37181),Io=i(34809);const Zo="fileTypeAnyFiles",Po="fileTypeImages",_o="fileTypeVideos",xo="fileTypeNone";var Fo=i(4323),Ao=i(78609),Bo=i(4391),Eo=i(33846),Ro=i(73657),Do=i(49703);function Lo(e){let{type:t,dropTargetKey:i,children:n,dropzoneStyle:s,onDropFile:r}=e;const[{currentSpaceStore:l}]=(0,d.oR)(S.default);if(!l)return a().createElement(a().Fragment,null,n);const c=e=>1===e.length&&function(e){let{fileMimeType:t,allowedType:i}=e;switch(i){case Zo:return!0;case Po:return function(e){return e.startsWith("image")&&!e.includes("photoshop")}(t);case _o:return function(e){return e.startsWith("video")}(t);case xo:return!1;default:(0,vi.t1)(i)}}({allowedType:t,fileMimeType:e[0]}),u=e=>{let{files:t}=e;c(t.map((e=>e.type)))?r({type:"validFileDrop",file:t[0]}):r({type:"invalidFileDrop",file:t[0]})};return o()(V.Z,{store:l,droppable:!0,render:()=>o()(Do.G,{dropTargetKey:i,canNativeDropOnto:!0,onNativeDrop:u,keepTextSelectionOnDrop:!0,shouldShowDropZone:!0,dropzoneStyle:s,canAcceptDrop:e=>e.isNativeDrag},void 0,n)})}var Oo=i(71669),No=i(16354),Uo=i(81865),Wo=i(62385),Vo=i(30506),zo=i(23321),qo=i(57670),Ho=i(42402),Go=i(78948),Ko=i(6202);const jo=(0,x.defineMessages)({embedPlaceholder:{id:"mediaPicker.embedPlaceholder.text",defaultMessage:"Paste in https://…"},filterPlaceholder:{id:"mediaPicker.emojiFilter.text",defaultMessage:"Filter…"},unsplashPlaceholder:{id:"mediaPicker.unsplashPlaceholder.text",defaultMessage:"Search for an image…"}});class Yo extends r.Z{constructor(){super(...arguments),k()(this,"menuRef",a().createRef()),k()(this,"storeTypes",{embedInputStore:Eo.Z,emojiInputStore:Eo.Z,emojiPickerStore:Ao.Z,iconInputStore:Eo.Z,iconPickerStore:Bo.Z,unsplashInputStore:Eo.Z}),k()(this,"renderUnsplashResults",((e,t,i,n)=>n?!i||i&&!i.length?o()(Ro.Z,{shouldWrapCaption:!0,caption:o()(x.FormattedMessage,{defaultMessage:"No results found.",id:"mediaPicker.unsplash.noResultsText"}),style:{textAlign:this.props.isSmallWidth?"left":"center",color:this.theme.mediumTextColor}}):o()(s.Fragment,{},void 0,i.map((t=>this.renderUnsplashImage(e,t))),o()(Ro.Z,{shouldWrapCaption:!0,caption:o()(x.FormattedMessage,{defaultMessage:"Search to find more results.",id:"mediaPicker.unsplash.searchText"}),style:{textAlign:this.props.isSmallWidth?"left":"center",color:this.theme.mediumTextColor}})):o()("div",{style:this.getLoadingContainerStyle()},void 0,o()(ri.Z,{})))),k()(this,"renderUnsplashImage",((e,t)=>{const{device:i}=this.environment;return o()("div",{style:{width:i.isMobile?"33%":"25%",padding:3}},t.id,o()(Hn.Z,{hoveredStyle:{opacity:.85},onClick:()=>this.handleSelectUnsplashImage(e,t)},void 0,o()(Oo.Z,{src:t.thumbUrl,style:{width:"100%",height:64,objectFit:"cover",objectPosition:"center 0%",borderRadius:3}})),o()(_e.Z,{isSmall:!0,isSecondaryColor:!0,style:{marginTop:2,marginBottom:4}},void 0,o()(x.FormattedMessage,{defaultMessage:"by <inlinetextlink>{authorName}</inlinetextlink>",id:"mediaPicker.unsplash.byAuthor",description:"Caption attributing the author of the Unsplash image",values:{authorName:t.authorName,inlinetextlink:function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return o()(Ho.Z,{external:!0,href:t.unsplashUrl},void 0,i)}}})))})),k()(this,"handleEmbedSubmit",(e=>()=>{const t=this.stores.embedInputStore.state.inputValue;if(t){const i=(0,Qt.Wv)(t,Rt.Z.secureFileS3.url,Rt.Z.secureFileConfig.rootPath,Rt.Z.secureFileConfig.hostname),n=i?i.link:t;e.onChange(n),$.trackUrlPaste(this.environment,{pastedText:n,source:"media_picker"})}})),k()(this,"handleSelectUnsplashImage",(async(e,t)=>{const i=await(0,Io.Z)({environment:this.environment,url:t.downloadUrl,method:"GET",format:"json"});"success"===i.type&&e.onChange({url:i.data.url})})),k()(this,"handleSwipeLeft",(()=>{if(!yo.Z.state.isActive)return;const e=this.getTabs(),t=e.map((e=>e.type)).indexOf(yo.Z.state.currentTab),i=e[t+1];void 0!==i&&this.handleTabChange(i.type)})),k()(this,"handleSwipeRight",(()=>{if(!yo.Z.state.isActive)return;const e=this.getTabs(),t=e.map((e=>e.type)).indexOf(yo.Z.state.currentTab),i=e[t-1];void 0!==i&&this.handleTabChange(i.type)})),k()(this,"handleTabChange",(e=>{yo.Z.state.isActive&&(yo.Z.setState({...yo.Z.state,currentTab:e}),"icon"===e&&(this.setSeenIconPickerNewBadge({environment:this.environment,seen:!0}),yo.Z.state.recordIconLoggingData&&$.trackMediaPicker(this.environment,"select_icon_tab",yo.Z.state.recordIconLoggingData)))})),k()(this,"handleRandomEmojiClick",(()=>{const{device:e}=this.environment,t=this.getTabs().find((e=>e.type===this.props.currentTab));if(t&&"emoji"===t.type){const i=(0,wo.zM)();t.onChange(i,{keepVisible:!e.isMobile})}})),k()(this,"handleRandomIconClick",(()=>{const{device:e}=this.environment,{iconPickerStore:t}=this.stores,i=this.getTabs().find((e=>e.type===this.props.currentTab));if(i&&"icon"===i.type){var n;const o=X().sample(Object.keys(t.getState().allIcons)),s=null!==(n=i.enforceIconColor)&&void 0!==n?n:X().sample(qo.G),a="/icons/".concat(o,"_").concat(s,".svg");i.onChange(a,{keepVisible:!e.isMobile})}})),k()(this,"handleFilterChange",(e=>{const{emojiInputStore:t,emojiPickerStore:i,iconInputStore:n,iconPickerStore:o}=this.stores,s=this.getNumIconPerRow()*(this.environment.device.isMobile?Gt.pq:Gt.II),a=this.getNumIconPerRow()*(this.environment.device.isMobile?zo.L6:zo.OF);t.setState({...t.state,inputValue:e.currentTarget.value}),i.setState({...i.state,loadEmojiCount:s}),n.setState({...n.state,inputValue:e.currentTarget.value}),o.setState({...o.state,loadIconCount:a})}))}renderComponent(){const{device:e}=this.environment,t=this.renderTabsHeader(),i=this.renderInputHeader(),n=(t||i)&&o()(s.Fragment,{},void 0,t,i);let r;if(e.isMobile)r={menuType:A.o.Modal,title:this.props.title,header:n,right:o()(x.FormattedMessage,{defaultMessage:"Close",id:"mediaPicker.mobileCloseButton.label"}),onClickRight:this.props.onCancel,left:this.props.onDelete&&o()(x.FormattedMessage,{defaultMessage:"Remove",id:"mediaPicker.mobileRemoveButton.label"}),onClickLeft:this.props.onDelete};else{r={menuType:A.o.Popup,header:n};const e=this.getTabs().find((e=>e.type===this.props.currentTab)),t=e&&"custom"===e.type?e.tabHeight:void 0;r.width=this.props.popupWidth||300,r.height=t||this.props.popupHeight,r.maxHeight=this.props.maxHeight,r.maxWidth=this.props.maxWidth}return o()(Vo.Z,{onSwipeLeft:this.handleSwipeLeft,onSwipeRight:this.handleSwipeRight,render:e=>a().createElement(U.Z,he()({},r,e,{className:ye.tQ,innerRef:this.menuRef}),this.renderCurrentTab())})}renderTabsHeader(){const{device:e}=this.environment;if(!(this.getTabs().length<=1)||this.props.onDelete){const t={gallery:o()(x.FormattedMessage,{id:"mediaPicker.tabs.gallery",defaultMessage:"Gallery"}),embed:o()(x.FormattedMessage,{id:"mediaPicker.tabs.embedLink",defaultMessage:"Embed link"}),file:o()(x.FormattedMessage,{id:"mediaPicker.tabs.upload",defaultMessage:"Upload"}),emoji:o()(x.FormattedMessage,{id:"mediaPicker.tabs.emoji",defaultMessage:"Emoji"}),icon:o()(x.FormattedMessage,{id:"mediaPicker.tabs.icon",defaultMessage:"Icon",description:"Icon tab heading"}),custom:o()(x.FormattedMessage,{id:"mediaPicker.tabs.custom",defaultMessage:"Custom",description:"Upload or embed a custom image"}),unsplash:o()(s.Fragment,{},void 0,Xt.Z.unsplashLogo({width:12,marginRight:4,height:12}),o()("span",{},void 0,"Unsplash")),drive:o()(x.FormattedMessage,{id:"mediaPicker.tabs.browse",defaultMessage:"Browse"})},i=this.getTabs(),n=i.findIndex((e=>e.type===this.props.currentTab)),a=i.map((e=>e.title||t[e.type])),r=i.find((e=>e.type===this.props.currentTab)),l=r&&"emoji"!==r.type&&e.isAndroid;return o()(z.Z,{tabs:a,selectedIndex:n,onChange:e=>{const t=i[e];this.handleTabChange(t.type)},right:this.props.onDelete&&!e.isMobile&&o()(li.Z,{isGray:!0,onClick:this.props.onDelete},void 0,o()(x.FormattedMessage,{id:"mediaPicker.tabs.remove",defaultMessage:"Remove"})),style:{...l&&{borderBottom:"none"}}})}}renderInputHeader(){const{isPhone:e,isMobile:t,isAndroid:i}=this.environment.device,n=this.getTabs().find((e=>e.type===this.props.currentTab));if(n&&("emoji"===n.type||"icon"===n.type)){const s="emoji"===n.type?this.stores.emojiInputStore.state.inputValue:this.stores.iconInputStore.state.inputValue,r="emoji"===n.type?this.handleRandomEmojiClick:this.handleRandomIconClick;return o()("div",{style:{display:"flex",...e?{}:{marginTop:16,marginBottom:10}}},void 0,o()(de.ZP,{value:s,placeholder:Se.default.formatMessage(jo.filterPlaceholder),autoFocus:!t||void 0,focus:!t||void 0,showClearButton:!0,inputLeft:o()(de.f_,{icon:Xt.Z.searchThick}),onChange:this.handleFilterChange,right:null!=n&&n.hideRandomButton?void 0:o()(di.Z,{renderTooltip:()=>o()(x.FormattedMessage,{id:"mediaPicker.emojiTab.random",defaultMessage:"Random"}),placement:di.Z.Placement.Bottom,render:e=>a().createElement(de.DO,he()({icon:Xt.Z.shuffle,onClick:r},e))}),isRightLastElementOfInput:!0,style:{...i&&{borderBottom:"none"}}}))}}renderCurrentTab(){const e=this.getTabs().find((e=>e.type===this.props.currentTab));if(!e)return o()(x.FormattedMessage,{defaultMessage:"Uh oh! Something went wrong.",id:"mediaPicker.errorMessage"});switch(e.type){case"embed":return this.renderEmbedTab(e);case"file":return this.renderUploadTab(e);case"emoji":return this.renderEmojiTab(e);case"icon":return this.renderIconTab(e);case"gallery":return this.renderGalleryTab(e);case"unsplash":return this.renderUnsplashTab(e);case"drive":return this.renderGoogleDriveTab(e);case"custom":return this.renderCustomEmbedUploadTab(e)}}renderEmojiTab(e){return o()(Gt.ZP,{onSubmit:e.onChange,filter:this.stores.emojiInputStore.state.inputValue||"",store:this.stores.emojiPickerStore,isCallout:this.props.isCallout,iconLoggingData:this.props.recordIconLoggingData,menuRef:this.menuRef})}renderIconTab(e){return o()(zo.ZP,{store:this.stores.iconPickerStore,filter:this.stores.iconInputStore.state.inputValue||"",onSubmit:e.onChange,iconLoggingData:this.props.recordIconLoggingData,enforceIconColor:e.enforceIconColor,menuRef:this.menuRef})}renderGalleryTab(e){return o()("div",{style:{paddingBottom:8}},void 0,X().map(Fo.Z,((t,i)=>o()(ce.Z,{title:o()(No.Z,{style:{marginLeft:-5},href:t.url,external:!0},void 0,o()(Wo.Z,{},void 0,Se.default.formatMessage(t.title))),isTitleUppercase:!0,noTextOverflow:!0},i,o()("div",{style:this.getGalleryWrapStyle()},void 0,t.items.map(((t,i)=>{let{coverUrl:n,title:s,subtitle:r,position:l}=t;return o()("div",{style:{width:"25%",padding:3}},i,o()(di.Z,{originGap:0,placement:di.Z.Placement.Bottom,delayThreshold:600,renderTooltip:()=>o()("div",{style:{maxWidth:180,whiteSpace:"normal"}},void 0,o()("span",{style:{color:this.theme.regularInvertedTextColor}},void 0,Se.default.formatMessage(s))," ",o()("span",{style:{color:this.theme.mediumInvertedTextColor}},void 0,r&&Se.default.formatMessage(r))),render:t=>a().createElement(Hn.Z,he()({hoveredStyle:{opacity:.85}},t,{onClick:()=>{e.onChange({url:n,position:l})}}),o()(Uo.Z,{url:n,width:200,isAuthenticated:!1,render:(e,t)=>t&&o()(Oo.Z,{src:t,style:{width:"100%",height:64,objectFit:"cover",objectPosition:"center ".concat(100*(l||0),"%"),borderRadius:3}})}))}))})))))))}renderUnsplashTab(e){const{device:t}=this.environment;return o()("div",{style:{paddingBottom:8}},void 0,o()(ce.Z,{desktopStyle:{marginTop:8,marginBottom:6}},void 0,o()(de.ZP,{value:this.stores.unsplashInputStore.state.inputValue,placeholder:Se.default.formatMessage(jo.unsplashPlaceholder),showClearButton:!0,focus:!t.isMobile||void 0,onChange:e=>{this.stores.unsplashInputStore.setState({...this.stores.unsplashInputStore.state,inputValue:e.target.value})}})),o()("div",{style:this.getGalleryWrapStyle()},void 0,o()(Ei.Z,{request:this.stores.unsplashInputStore.state.inputValue,debounce:Dn.vp,performRequest:async e=>{const t=await Si.searchUnsplashImages(this.environment,{query:e,page:0});if("success"===t.type)return t.data.results;throw t.error},render:(t,i,n)=>this.renderUnsplashResults(e,t,i,n)})))}renderCustomEmbedUploadTab(e){var t;const{device:i}=this.environment,{data:n}=_i.default.state,s=o()(xi.Z,{onClick:this.handleEmbedSubmit(e),disabled:0===this.stores.embedInputStore.state.inputValue.length,hovered:!1},void 0,e.buttonText||o()(x.FormattedMessage,{defaultMessage:"Link",id:"mediaPicker.embedTab.embedLinkButtonText"})),r=o()(ce.Z,{desktopStyle:{marginTop:16,display:"flex",paddingTop:0,paddingBottom:12}},void 0,o()(de.ZP,{type:"url",value:this.stores.embedInputStore.state.inputValue,placeholder:e.inputPlaceholder||Se.default.formatMessage(jo.embedPlaceholder),autoFocus:!i.isMobile||void 0,showClearButton:!0,focus:!i.isMobile||void 0,onSubmit:this.handleEmbedSubmit(e),onChange:e=>{this.stores.embedInputStore.setState({...this.stores.embedInputStore.state,inputValue:e.target.value})},inputRight:i.isPhone?s:void 0,right:i.isPhone?void 0:s,isRightLastElementOfInput:!0})),l=o()(Lo,{type:null!==(t=this.getAllowedFileTypeFromTab(e))&&void 0!==t?t:xo,dropTargetKey:"uploadTab",onDropFile:t=>{"invalidFileDrop"!==t.type?e.onUpload(t.file):(0,Co.oV)({label:o()(x.FormattedMessage,{id:"mediaPicker.invalidImageDrop.wrongTypeErrorMessage",description:"Error message that shows when a user tries to drop an invalid file type into the image upload modal.",defaultMessage:"Sorry, that file type is not supported."})})},dropzoneStyle:{background:(0,Yt.fn)([Yt.ZP.blueWithAlpha(.14),bo()(this.theme.contentBackground).alpha(.5).css()])}},void 0,o()("div",{style:{marginTop:-24,paddingTop:24}},void 0,e.fileUpload&&o()(ce.Z,{desktopStyle:{marginTop:this.props.isSmallWidth?8:24}},void 0,o()(Ko.Z,{title:o()(x.FormattedMessage,{defaultMessage:"Choose a file",id:"mediaPicker.chooseFile.button.label"}),onClick:()=>this.handleUpload(e),fullWidth:this.props.isSmallWidth})),this.renderMediaCapture(e),e.caption&&o()(Ro.Z,{shouldWrapCaption:!0,caption:e.caption,style:{textAlign:this.props.isSmallWidth?"left":"center",color:this.theme.mediumTextColor}}),e.preventUploadLimitFreeFileSize||n&&Ii.YK(n)&&o()("div",{style:{height:8}}),n&&!e.preventUploadLimitFreeFileSize&&!Ii.YK(n)&&o()(Ro.Z,{shouldWrapCaption:!0,caption:o()("div",{style:{display:"flex",alignItems:"center",justifyContent:this.props.isSmallWidth?"flex-start":"center"}},void 0,o()("div",{style:{marginRight:6,color:this.theme.mediumTextColor}},void 0,o()(x.FormattedMessage,{defaultMessage:"The maximum size per file is {filesize} MB.",id:"mediaPicker.maximumFileSize.notice",values:{filesize:ko.K_}})),!at.default.isOnboarding.state&&o()(Li.Z,{subscriptionTier:Ii.M9(this.environment)||"team",onClick:()=>{this.props.onCancel&&this.props.onCancel()},analyticsName:"media_picker",desktopStyle:{marginBottom:1}}))})));return a().createElement(a().Fragment,null,r,l)}renderUploadTab(e){var t;const{data:i}=_i.default.state;return o()(Lo,{type:null!==(t=this.getAllowedFileTypeFromTab(e))&&void 0!==t?t:xo,dropTargetKey:"uploadTab",onDropFile:t=>{"invalidFileDrop"!==t.type?e.onUpload(t.file):(0,Co.oV)({label:o()(x.FormattedMessage,{id:"mediaPicker.invalidImageDrop.wrongTypeErrorMessage",description:"Error message that shows when a user tries to drop an invalid file type into the image upload modal.",defaultMessage:"Sorry, that file type is not supported."})})},dropzoneStyle:{background:(0,Yt.fn)([Yt.ZP.blueWithAlpha(.14),bo()(this.theme.contentBackground).alpha(.5).css()])}},void 0,o()("div",{style:{marginTop:-24,paddingTop:24}},void 0,e.fileUpload&&o()(ce.Z,{desktopStyle:{marginTop:this.props.isSmallWidth?8:24}},void 0,o()(Ko.Z,{title:o()(x.FormattedMessage,{defaultMessage:"Choose a file",id:"mediaPicker.chooseFile.button.label"}),onClick:()=>this.handleUpload(e),fullWidth:this.props.isSmallWidth})),this.renderMediaCapture(e),e.caption&&o()(Ro.Z,{shouldWrapCaption:!0,caption:e.caption,style:{textAlign:this.props.isSmallWidth?"left":"center",color:this.theme.mediumTextColor}}),e.preventUploadLimitFreeFileSize||i&&Ii.YK(i)&&o()("div",{style:{height:8}}),i&&!e.preventUploadLimitFreeFileSize&&!Ii.YK(i)&&o()(Ro.Z,{shouldWrapCaption:!0,caption:o()("div",{style:{display:"flex",alignItems:"center",justifyContent:this.props.isSmallWidth?"flex-start":"center"}},void 0,o()("div",{style:{marginRight:6,color:this.theme.mediumTextColor}},void 0,o()(x.FormattedMessage,{defaultMessage:"The maximum size per file is {filesize} MB.",id:"mediaPicker.maximumFileSize.notice",values:{filesize:ko.K_}})),!at.default.isOnboarding.state&&o()(Li.Z,{subscriptionTier:Ii.M9(this.environment)||"team",onClick:()=>{this.props.onCancel&&this.props.onCancel()},analyticsName:"media_picker",desktopStyle:{marginBottom:1}}))})))}renderMediaCapture(e){if(e.imageUpload||e.videoUpload)return o()(ce.Z,{desktopStyle:{marginTop:4,display:"flex",justifyContent:"center",marginRight:12,marginLeft:12}},void 0,e.imageUpload&&o()(Je.Z,{isLarge:!0,onClick:()=>this.handleUpload(e,"image/*"),style:{width:"100%"}},void 0,o()(x.FormattedMessage,{defaultMessage:"Upload file",id:"mediaPicker.chooseImage.buttonText"})),e.videoUpload&&o()(Ko.Z,{title:o()(x.FormattedMessage,{defaultMessage:"Choose a video",id:"mediaPicker.chooseVideo.buttonText"}),onClick:()=>this.handleUpload(e,"video/*"),fullWidth:this.props.isSmallWidth}))}renderEmbedTab(e){const{device:t}=this.environment;return o()(s.Fragment,{},void 0,o()(ce.Z,{desktopStyle:{marginTop:8,marginBottom:6}},void 0,o()(de.ZP,{type:"url",value:this.stores.embedInputStore.state.inputValue,placeholder:e.inputPlaceholder||Se.default.formatMessage(jo.embedPlaceholder),autoFocus:!t.isMobile||void 0,showClearButton:!0,focus:!t.isMobile||void 0,onSubmit:this.handleEmbedSubmit(e),onChange:e=>{this.stores.embedInputStore.setState({...this.stores.embedInputStore.state,inputValue:e.target.value})}})),o()(ce.Z,{},void 0,o()(Ko.Z,{onClick:this.handleEmbedSubmit(e),title:e.buttonText||o()(x.FormattedMessage,{defaultMessage:"Link",id:"mediaPicker.embedTab.embedLinkButtonText"}),fullWidth:this.props.isSmallWidth})),e.caption&&o()(Ro.Z,{shouldWrapCaption:!0,caption:e.caption,style:{textAlign:t.isMobile?"left":"center"}}))}renderGoogleDriveTab(e){return o()(Ei.Z,{request:this.environment,performRequest:Mo.vQ,render:(t,i,n)=>{if(!n)return o()(ce.Z,{},void 0,o()(Go.Z,{}));const s=i&&i.accounts?i.accounts:[];return this.renderGoogleDriveAccounts(e,s)}})}renderGoogleDriveAccounts(e,t){return 0===t.length?o()(ce.Z,{},void 0,o()(Me.Z,{title:o()(x.FormattedMessage,{defaultMessage:"Connect Google account",id:"mediaPicker.menuItem.connectFirstGoogleAccount.label"}),onClick:()=>e.onSelect(),focused:!1,style:{color:this.theme.blueColor}}),o()(Ro.Z,{shouldWrapCaption:!1,caption:o()(x.FormattedMessage,{defaultMessage:"Find and embed your Google Drive files.",id:"mediaPicker.menuItem.connectFirstGoogleAccount.caption"})})):o()(s.Fragment,{},void 0,o()(ce.Z,{},void 0,t.map(((t,i)=>o()(Me.Z,{title:o()(x.FormattedMessage,{defaultMessage:"Choose from {accountName}",id:"mediaPicker.menuItem.choosePagesFromAccount.label",values:{accountName:t.accountName}}),onClick:()=>e.onSelect(t),focused:!1},t.accountId)))),o()(ce.Z,{topBorder:!0},void 0,o()(Me.Z,{title:o()(x.FormattedMessage,{defaultMessage:"Connect another account",id:"mediaPicker.menuItem.connectMoreGoogleAccounts.label"}),onClick:()=>e.onSelect(),style:{color:this.theme.mediumTextColor},focused:!1})))}getTabs(){return this.props.tabs}getAllowedFileTypeFromTab(e){return e.fileUpload?Zo:e.imageUpload?Po:e.videoUpload?_o:void 0}setSeenIconPickerNewBadge(e){const{environment:t,seen:i}=e,{currentUserSettingsStore:n}=S.default.state;n&&(0,mt.createAndCommit)({userAction:"mediaPicker.setSeenIconPickerNewBadge",environment:t,perform:e=>{(0,To.d2)({userSettingsStore:n,transaction:e,data:{seen_icon_picker_new:i}})}})}async handleUpload(e,t){const i=await ko.y({multiple:!1,accept:t});i.length&&e.onUpload(i[0])}getNumIconPerRow(){var e,t,i,n;return null!==(e=this.menuRef)&&void 0!==e&&null!==(t=e.current)&&void 0!==t&&t.offsetWidth?((null===(i=this.menuRef)||void 0===i||null===(n=i.current)||void 0===n?void 0:n.offsetWidth)-24)/32:12}getLoadingContainerStyle(){return{display:"flex",alignItems:"center",justifyContent:"center",minHeight:320,flex:1}}getGalleryWrapStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flexWrap:"wrap",alignContent:"flex-start",background:this.theme.popoverBackground,paddingTop:e.isPhone?12:0,paddingBottom:e.isPhone?12:0,paddingLeft:e.isPhone?t.getSafePaddingLeftCSS(14):12,paddingRight:e.isPhone?t.getSafePaddingRightCSS(14):12,boxShadow:e.isPhone?"0 1px 0 ".concat(this.theme.regularDividerColor):""}}}const Qo=Yo;class Xo extends r.Z{constructor(){super(...arguments),k()(this,"handleCloseOverlay",(()=>{vo.Z()}))}renderComponent(){const{device:e}=this.environment,{state:t}=yo.Z;return o()(K.ZP,{popupType:e.isMobile?K.ZP.PopupType.SlideUp:K.ZP.PopupType.Popup,open:t.isActive,originRect:t.isActive?t.originRect:void 0,originGap:t.isActive?t.originGap:void 0,placementToOrigin:K.ZP.Placement.Bottom,alignmentToOrigin:K.ZP.Alignment.Center,preventScaleTransition:!0,onDismiss:this.handleCloseOverlay,render:()=>{if(t.isActive)return a().createElement(Qo,he()({},t,{onCancel:this.handleCloseOverlay}))}})}}const Jo=Xo;var $o=i(41892),es=i(57269),ts=i(32918),is=i(85114),ns=i(2072),os=i(92338),ss=i(9900),as=i(47798),rs=i(52178),ls=i(17731),ds=i(80084),cs=i(472),us=i(63334),ms=i(19111),ps=i(69454),gs=i(72087),hs=i(29026),fs=i(43765),vs=i(60442),ys=i(97680);const Ss=(0,x.defineMessages)({mentionAll:{defaultMessage:"Mention a person, page, or date…",id:"mentionMenu.personPageDate.prompt2"},mentionPersonPage:{defaultMessage:"Mention a person or page…",id:"mentionMenu.personPage.prompt2"},mentionPersonDate:{defaultMessage:"Mention a person or date…",id:"mentionMenu.personDate.prompt2"},mentionPageDate:{defaultMessage:"Mention a page or date…",id:"mentionMenu.pageDate.prompt2"},mentionPerson:{defaultMessage:"Mention a person…",id:"mentionMenu.person.prompt2"},mentionDate:{defaultMessage:"Mention a date…",id:"mentionMenu.date.prompt2"},mentionPage:{defaultMessage:"Type to link or add page…",id:"mentionMenu.page.prompt2"},addPage:{defaultMessage:"Type to add or link page…",id:"mentionMenu.addPage.prompt2"}}),bs=(0,x.defineMessages)({autocompleteToday:{defaultMessage:"Today",id:"mentionMenu.date.autocomplete.today"},autocompleteNextTuesday:{defaultMessage:"Next Tuesday 3pm",id:"mentionMenu.date.autocomplete.nextTuesday"},autocompleteReminder:{defaultMessage:"Remind tomorrow 9am",id:"mentionMenu.date.autocomplete.reminder"},reminder:{defaultMessage:"Remind {dateTime}",id:"mentionMenu.date.remindAtDateTime",description:"dateTime will be a message representing the date (with or without time) that the user wants to be reminded at, like 'Tomorrow 3pm' or 'Mar 1, 2020'"},noResults:{defaultMessage:"No results",id:"mentionMenu.noSearchResults.title",description:"A label describing that no results have been found."}});class Ms extends r.Z{constructor(){super(...arguments),k()(this,"storeTypes",{ignoreSelectionAreaStore:us.Z,localPageMentionRequestStore:gs.Z,localCachePageMentionRequestStore:gs.Z}),k()(this,"renderMentionResult",((e,t)=>{const{intl:i}=this.props,n=ms.Z.state,s=n.open&&n.insertionType,r={sections:[],nextSectionShouldHaveTopBorder:()=>r.sections.length>0,addSection(e){e&&this.sections.push(e)}};"+"===s&&r.addSection(this.getCreatePageMenuSection(r.nextSectionShouldHaveTopBorder())),r.addSection(this.getDateResultsMenuSection(t,r.nextSectionShouldHaveTopBorder())),r.addSection(this.getUserResultsMenuSection(t,r.nextSectionShouldHaveTopBorder())),r.addSection(this.getPageResultsMenuSection(t,r.nextSectionShouldHaveTopBorder())),("@"===s&&this.filterStore.state||"[["===s)&&r.addSection(this.getCreatePageMenuSection(r.nextSectionShouldHaveTopBorder()));const{sections:l}=r;let d,c;if(On.Z.state.online){const e=n.mentionTypes.user,t=n.mentionTypes.page,o=n.mentionTypes.date;let s="";const a=Ss;e&&t&&o?s=i.formatMessage(a.mentionAll):e&&t?s=i.formatMessage(a.mentionPersonPage):e&&o?s=i.formatMessage(a.mentionPersonDate):t&&o?s=i.formatMessage(a.mentionPageDate):e?s=i.formatMessage(a.mentionPerson):o?s=i.formatMessage(a.mentionDate):t&&n&&(s=n.open&&"+"===n.insertionType?i.formatMessage(Ss.addPage):i.formatMessage(a.mentionPage)),this.setTemporaryInputData({title:s,icon:this.renderTemporaryInputEmptyIcon(),allowTabCompletion:!1}),d=void 0}else d=o()(fs.Z,{title:o()(x.FormattedMessage,{defaultMessage:"Please go online to mention a person or page.",id:"mentionMenu.offlineMessage"})});0===l.length&&(c=o()(ce.Z,{},void 0,o()(fs.Z,{title:a().createElement(x.FormattedMessage,bs.noResults)})));const{device:u}=this.environment;let m;return m=this.isActionSheet()?{menuType:A.o.ActionSheet,disableBottomPadding:!0,height:"calc(70vh - ".concat(ps.Z.estimatedNativeWebBottomOverlap(),"px)")}:{menuType:A.o.Popup,width:this.getMenuDesktopWidth(),maxHeight:u.isMobile?"30vh":"40vh",onClickOutside:this.makeHandleCancelCallback()},a().createElement(U.Z,he()({},m,{header:d}),o()(N.Z,{capture:ms.Z.state.open,onBackspace:this.shouldCaptureBackspace()?this.handleEmptyBackspace:void 0,onTab:this.handleTab}),o()(we.Z,{type:we.i.Vertical,initialFocus:this.getMenuInitialFocus(),sections:l,onEmptyEnter:this.makeHandleCancelCallback()}),c)})),k()(this,"handleCreateInAutocompleteQueryChange",(e=>{this.updateOpenState({createInQuery:e})})),k()(this,"renderCreateInMenu",(()=>{const e=ms.Z.state;if(!e.open)return;const t="block"===e.textStore.table?e.textStore.id:void 0;return o()(ro.Z,{targets:[],isAddTo:!0,isCreateIn:!0,onAccept:e=>{as.Br({environment:this.environment,titleText:this.getNormalizedFilter(),ignoreSelectionAreaStore:this.stores.ignoreSelectionAreaStore,createInValue:e,menuListItemAction:void 0})},captureSelection:!0,restoreSelection:!0,parentBlockId:t,onAutocompleteQueryChange:this.handleCreateInAutocompleteQueryChange,ignoreSelectionAreaStore:this.stores.ignoreSelectionAreaStore,autocompleteQuery:e.createInQuery,desktopWidth:this.getMenuDesktopWidth(),onCancel:this.handleCreateInCancel})})),k()(this,"handleCreateInStart",(()=>{this.updateOpenState({showCreateIn:!0})})),k()(this,"handleCreateInCancel",(()=>{this.updateOpenState({showCreateIn:!1,createInQuery:""})})),k()(this,"handleEmptyBackspace",(e=>{this.shouldCaptureBackspace()&&e.preventDefault(),this.makeHandleCancelCallback()()})),k()(this,"makeHandleCancelCallback",(()=>{const e=ms.Z.state,t=this.getNormalizedFilter(),i=as.WI();let n=Date.now();return e.open&&(n=e.openTime),()=>{$.trackMentionMenuAbandon(this.environment,{timeToAbandonInMs:Date.now()-n,queryLength:t.length,analyticsFrom:i}),as.xv()}})),k()(this,"handleTab",(e=>{e.preventDefault();const t=this.tabCompletionString;if(!t)return;const i=Tt.default.state;if("editing"!==i.mode)return;const n=(0,bt.QY)(i.multiSelection);if(!n)return;const o=ms.Z.state;o.open&&o.textStore===n.store&&mt.createAndCommit({userAction:"MentionMenu.handleTab",environment:this.environment,perform:e=>{rs.hJ({environment:this.environment,transaction:e,string:t,store:n.store,selection:n.selection,disableMentions:!0,disableDateMentions:!0,disableEmojiCommands:!0,disableSlashCommands:!0})}})})),k()(this,"tabCompletionString",void 0),k()(this,"letterCharacterClass",(()=>{try{return/\p{L}/u}catch(e){return/[a-zA-Z]/}})()),k()(this,"inputSelectionsStore",this.createComputedStore((()=>{const e=ms.Z.state;if(e.open)return qt.O2(e.textStore,e.oldTextValue,e.insertionType)}))),k()(this,"filterStore",this.createComputedStore((()=>{const e=this.inputSelectionsStore.state,t=ms.Z.state;if(e&&t.open)return qt.ug(t.textStore,e)}))),k()(this,"popupOpenStore",this.createComputedStore((()=>{const e=ms.Z.state;return!!e.open&&("+"!==e.insertionType||""!==this.getNormalizedFilter())}))),k()(this,"performUserMentionRequest",(async e=>{const t=ms.Z.state;if(!t.open)return;const i=t.mentionTypes.user?await this.getUserResults(e):[];return""===e?i.slice(0,2):i.slice(0,20)})),k()(this,"performLocalCachePageMentionRequest",(async()=>{const{currentSpaceStore:e,currentSpaceViewStore:t}=S.default.state;if(!e)return;return ds.hb({environment:this.environment,currentSpaceStore:e,currentSpaceViewStore:t})})),k()(this,"performLocalPageMentionRequest",(e=>{const{localCachePageMentionRequestStore:t}=this.stores,i=t.state.result;if(!i)return;const n=ds.tz({input:e,cache:i});if(!n)return;if(0===n.results.length)return{error:os.Ix.NoResults};const o=pt.RM();if(!o)return;const s=ds.YB({sort:e.query.sort,unsorted:n.results,batchSize:hs.Xv,currentUserId:this.environment.currentUser.id}).map(((e,t)=>({...e,originalPosition:t,store:Lt.Z.createChildStore(o,{table:_.iU,id:e.id})})));return{value:{total:s.length,results:s}}})),k()(this,"performPageMentionRequest",(async e=>{const t=ms.Z.state;if(!t.open)return[];const i=t.mentionTypes.page?await this.getPageResults(e):[];return""===e?i.slice(0,2):i.slice(0,20)})),k()(this,"getUserResults",(async e=>{if(On.Z.state.online){return await Dn.O$({environment:this.environment,query:e,membersOnly:!1})}return[]})),k()(this,"getPageResults",(async e=>{if(!On.Z.state.online)return[];const t=ms.Z.state,i=t.open&&(0,B.NZ)(t.textStore)&&t.textStore;return await Dn.WL({nearBlock:i||void 0,environment:this.environment,query:e,source:"mention_menu",limit:20})})),k()(this,"getDateResults",(e=>{const t=ms.Z.state;if(!t.open)return[];const{intl:i}=this.props,n=t.mentionTypes.reminder;return t.mentionTypes.date?function(e,t,i){if(0===e.length)return X().compact([{label:i.formatMessage(bs.autocompleteToday),value:()=>ns.Lg(ns.x7)},t?void 0:{label:i.formatMessage(bs.autocompleteNextTuesday),value:()=>{const e=ns.bU(ns.x7),t=e.clone().day(2);return t.isSameOrBefore(e)&&t.add(1,"week"),t.add(1,"week"),t.hour(15),{type:"datetime",start_date:t.format(ts.Q1),start_time:t.format(ts.jK),time_zone:ns.x7}}},t?{label:i.formatMessage(bs.autocompleteReminder),value:()=>({type:"datetime",start_date:ns.Ro(ns.x7).start_date,start_time:"09:00",reminder:{unit:"day",value:0,time:ts.HZ},time_zone:ns.x7})}:void 0]);const n=e.normalize("NFKD"),o=t?(0,is.St)(n,i):(0,is.cg)(n,i);if(o){let e=(0,es.ZV)({value:o,date_format:"relative",userTimeZone:ns.x7,intl:i,allowRelativeDates:!0});return o.reminder&&(e=i.formatMessage(bs.reminder,{dateTime:e})),[{label:e,value:()=>o}]}return[]}(e,n,i).slice(0,6):[]})),k()(this,"getTemplateVariableResults",(e=>{const t=ms.Z.state;if(!t.open)return[];if(!t.mentionTypes.templateVariable)return[];const{intl:i}=this.props;return dt.XV(e,i)}))}willMountOrUpdate(){const e=ms.Z.state,t=this.filterStore.state;if(e.open){var i;const n=Tt.default.state,o="editing"===n.mode?(0,bt.QY)(n.multiSelection):void 0,s=(null==o?void 0:o.store)===e.textStore,a=this.stores.ignoreSelectionAreaStore.state.savedTextSelectionStoreState,r=a&&"editing"===a.mode&&(null===(i=(0,bt.QY)(a.multiSelection))||void 0===i?void 0:i.store)===e.textStore;if(!s&&!r)return void as.xv();const l=s&&(null==o?void 0:o.selection),d=this.inputSelectionsStore.state;if(d&&l&&(l.startIndex<d.filter.startIndex||l.endIndex>d.filter.endIndex))return void as.xv();const c=this.filterStore.state&&this.filterStore.state[0];if("+"===e.insertionType&&c&&!c.match(this.letterCharacterClass))return void as.xv();if(void 0===t)return void as.xv()}}renderComponent(){const{device:e}=this.environment,t=ms.Z.state,i=Ue.find((e=>e.props.capture)),n=this.popupOpenStore.state;let s;if(i&&e.isMobile){const e=i.stores.store.state.rect;e&&(s={height:"calc(100vh - ".concat(e.height,"px)")})}const r=t.open&&t.showCreateIn;return o()(K.ZP,{popupType:this.isActionSheet()?K.ZP.PopupType.SlideUp:K.ZP.PopupType.Popup,open:n,originRect:t.open?t.selectionRect:void 0,slideUpWrapStyle:s,placementToOrigin:K.ZP.Placement.Bottom,alignmentToOrigin:K.ZP.Alignment.Start,originGap:8,disableMouseCapture:!0,disableContentScroll:!0,onDismiss:this.makeHandleCancelCallback(),disableDarkOverlayBackground:e.isMobile,keepFocus:!0,render:()=>e.isMobile?a().createElement(a().Fragment,null,this.renderMentionSearch(),o()(K.ZP,{popupType:K.ZP.PopupType.SlideUp,render:this.renderCreateInMenu,open:r,keepFocus:!0})):r?this.renderCreateInMenu():this.renderMentionSearch()})}renderMentionSearch(){var e=this;const t=this.getNormalizedFilter(),i=ms.Z.state,n=cs.default.createMetric("rum.mention_menu_ready"),s={field:"relevance"};return o()(Ei.Z,{requestStore:i.userRequestStore,request:t,performRequest:this.performUserMentionRequest,render:a=>o()(Ei.Z,{requestStore:i.pageRequestStore,request:t,performRequest:this.performPageMentionRequest,debounce:Dn.vp,render:i=>o()(Ei.Z,{requestStore:this.stores.localCachePageMentionRequestStore,request:S.default.state.currentSpaceStore&&S.default.state.currentSpaceStore.id,performRequest:this.performLocalCachePageMentionRequest,render:r=>o()(Ei.Z,{requestStore:this.stores.localPageMentionRequestStore,debounce:Dn.E5,request:{query:{text:t,filters:os.u4({isDeletedOnly:!1,navigableBlockContentOnly:!0,excludeTemplates:!0,requireEditPermissions:void 0}),sort:s},limit:5},performRequest:function(){return Promise.resolve(e.performLocalPageMentionRequest(...arguments))},render:e=>this.renderMentionResult(a||i||e,this.getCurrentMentionResults(n))})})})})}getDateResultsMenuSection(e,t){const{dateResults:i}=e,{intl:n}=this.props,s=this.getNormalizedFilter(),r=this.getTemplateVariableMenuItems(e,"date");if(0===i.length&&0===r.length)return;const l=i.map((e=>{let{label:t,value:i}=e;return{key:t,render:e=>{if(e.focused&&this.setTemporaryInputData({title:t,icon:this.renderTemporaryInputAtMentionIcon(),allowTabCompletion:!0}),(0,is.UL)(t,n)){const o=(0,es.ZV)({value:i(),userTimeZone:ns.x7,intl:n,allowRelativeDates:!1});return a().createElement(Me.Z,he()({},e,{title:t,caption:o,inline:!0}))}return a().createElement(Me.Z,he()({},e,{title:t}))},action:e=>{mt.createAndCommit({userAction:"MentionMenu.menuItem",environment:this.environment,perform:t=>{as.RL({environment:this.environment,annotation:["d",{...i(),date_format:"relative"}],transaction:t,menuListItemAction:e,query:s,mentionType:"date"})}})}}}));return this.applySectionLimit("date",{key:"date results",render:e=>a().createElement(ce.Z,he()({},e,{title:o()(x.FormattedMessage,{defaultMessage:"Date",id:"mentionMenu.dateSection.title"}),topBorder:t,isTitleUppercase:!0})),items:r.concat(l)})}getTemplateVariableMenuItems(e,t){const{templateVariableResults:i}=e,{intl:n}=this.props,o=this.getNormalizedFilter();return i.filter((e=>dt.i6(e,t))).map((e=>({key:e,render:t=>{const i=dt.U$(e,n),o=dt.Z0(e,n);return t.focused&&this.setTemporaryInputData({title:i,icon:this.renderTemporaryInputAtMentionIcon(),allowTabCompletion:!0}),a().createElement(Me.Z,he()({},t,{title:i,caption:o,inline:!0}))},action:t=>{mt.createAndCommit({userAction:"MentionMenu.menuItem",environment:this.environment,perform:i=>{as.RL({environment:this.environment,annotation:["tv",{type:e}],transaction:i,menuListItemAction:t,query:o,mentionType:"templateVariable"})}})}})))}renderSpinner(e){return o()(Di.Z,{show:e,showDelay:500,showHold:300,render:e=>o()(ri.Z,{style:{textAlign:"center",visibility:e?"visible":"hidden",display:"inline",marginLeft:8}})})}renderTemporaryInputEmptyIcon(){const e=ms.Z.state;if(e.open)return"+"===e.insertionType?this.renderTemporaryInputAddIcon():o()("span",{style:{width:"1em",display:"inline-block",verticalAlign:"-0.15em",fill:this.theme.mediumIconColor,marginRight:"0.2em"}},void 0,Xt.Z.searchThick())}renderTemporaryInputAddIcon(){return o()("span",{style:{width:"1em",display:"inline-block",verticalAlign:"-0.15em",fill:this.theme.mediumIconColor,marginRight:"0.2em"}},void 0,Xt.Z.plus())}renderTemporaryInputPageIcon(e){return(0,ss.tp)({pageValue:e.getValue(),pageRole:e.getRole(),showEmojiInline:!0,emojiType:(0,ls.e)(this.environment),baseUrl:Rt.Z.domainBaseUrl,getRecordValue:e.getRecordValue,isClient:!0,isSafariOrIOS:this.environment.device.isSafari||this.environment.device.isIOS,currentUserId:this.environment.currentUser.id,theme:this.theme.mode})}renderTemporaryInputAtMentionIcon(){return o()("span",{style:{width:"1em",display:"inline-block",verticalAlign:"-0.15em",fill:this.theme.mediumIconColor,marginRight:"0.2em"}},void 0,Xt.Z.at())}getUserResultsMenuSection(e,t){const{userResults:i}=e,n=this.getNormalizedFilter(),s=this.getTemplateVariableMenuItems(e,"user");if(0===i.length&&0===s.length)return;const r=X().compact(i.map((e=>({key:e.id,render:t=>(t.focused&&this.setTemporaryInputData({title:(0,fi.Nz)(this.props.intl,e),icon:this.renderTemporaryInputAtMentionIcon(),allowTabCompletion:!0}),a().createElement(ys.Z,he()({},t,{user:e,useEmailAsTooltip:!0}))),action:t=>{mt.createAndCommit({userAction:"MentionMenu.menuItem",environment:this.environment,perform:i=>{as.RL({environment:this.environment,annotation:(0,dt.tE)(e.id),transaction:i,menuListItemAction:t,query:n,mentionType:"user"})}})}}))));return this.applySectionLimit("user",{key:"user results",render:e=>a().createElement(ce.Z,he()({},e,{title:o()(x.FormattedMessage,{defaultMessage:"People",id:"mentionMenu.peopleSection.title"}),topBorder:t,isTitleUppercase:!0})),items:s.concat(r)})}getPageResultsMenuSection(e,t){const{pageResults:i}=e,n=this.getNormalizedFilter(),s=a().createElement(a().Fragment,null,0===i.length?a().createElement(x.FormattedMessage,bs.noResults):o()(x.FormattedMessage,{defaultMessage:"Link to page",id:"mentionMenu.pagesSection.title2"}),this.renderSpinner(ms.Z.state.pageRequestStore.state.loading));return this.applySectionLimit("page",{key:"page results",render:e=>a().createElement(ce.Z,he()({},e,{title:s,topBorder:t,isTitleUppercase:!0})),items:X().compact(i.map((e=>{const t=pt.RM();if(!t)return;const i=Lt.Z.createChildStore(t,{table:_.iU,id:e});return{key:e,render:e=>{if(e.focused){const e=i.getValue();if(e){const t=(0,Ui.T5)({table:i.table,value:e,getRecordValue:i.getRecordValue,userTimeZone:ns.x7,intl:this.props.intl});this.setTemporaryInputData({title:t||"",icon:this.renderTemporaryInputPageIcon(i),allowTabCompletion:!0})}}return a().createElement(xn.Z,he()({},e,{store:i}))},action:t=>{mt.createAndCommit({userAction:"MentionMenu.getPageResultsMenuSection",environment:this.environment,perform:i=>{as.RL({environment:this.environment,annotation:["p",e],transaction:i,menuListItemAction:t,query:n,mentionType:"page"})}})}}})))})}getCreatePageMenuSection(e){if(!this.canCreatePage())return;const t=ms.Z.state;if(!t.open)return;const{intl:i}=this.props,n=this.getNormalizedFilter(),s="@"===t.insertionType?o()(x.FormattedMessage,{id:"mentionMenu.createPageSection.title",defaultMessage:"New page"}):void 0;return{key:"create page",render:t=>a().createElement(ce.Z,he()({title:s,isTitleUppercase:!0},t,{topBorder:e})),items:[{key:"add new subpage",action:async e=>{const i=(0,wn.gt)(t.textStore);i&&await as.Br({environment:this.environment,ignoreSelectionAreaStore:this.stores.ignoreSelectionAreaStore,titleText:this.getNormalizedFilter(),createInValue:i.createInValue,onPageCreated:e=>{e&&""===dt.Q(e.getTitleValue())&&ji.navigateToBlock({environment:this.environment,store:e})},menuListItemAction:e})},render:e=>{e.focused&&this.setTemporaryInputData({title:0===n.length?i.formatMessage(Ss.addPage):"",icon:this.renderTemporaryInputAddIcon(),allowTabCompletion:!1});const t=t=>a().createElement(Me.Z,he()({},(0,Ci.Z)(t||{},e),{icon:Xt.Z.plus({width:16}),title:o()(Bn,{pageTitle:this.getNormalizedFilter()})}));return this.environment.device.isMobile?t():o()(di.Z,{renderTooltip:()=>o()(vs.Z,{imageURL:$o.Z.images.tooltips.pageMenu.newSubpagePng,imageWidth:140,imageHeight:100,caption:a().createElement(x.FormattedMessage,ro.s.createSubpage)}),placement:di.Z.Placement.Right,delayThreshold:0,render:e=>t(e)})}},{key:"open create in menu",action:this.handleCreateInStart,render:e=>{e.focused&&this.setTemporaryInputData({title:0===n.length?i.formatMessage(Ss.addPage):"",icon:this.renderTemporaryInputAddIcon(),allowTabCompletion:!1});const t=o()(An,{pageTitle:this.getNormalizedFilter()}),s=i=>a().createElement(Me.Z,he()({},(0,Ci.Z)(i||{},e),{icon:Xt.Z.alias({width:16}),title:t}));return this.environment.device.isMobile?s():o()(di.Z,{renderTooltip:()=>o()(vs.Z,{imageURL:$o.Z.images.tooltips.pageMenu.newPageInPng,imageWidth:140,imageHeight:100,caption:a().createElement(x.FormattedMessage,ro.s.newPageIn)}),placement:di.Z.Placement.Right,delayThreshold:0,render:e=>s(e)})}}]}}applySectionLimit(e,t){const i=ms.Z.state;if(!i.open)return t;if(i.expandSection&&i.expandSection===e)return t;const{items:n}=t,s=this.environment.device.isPhone?3:5;if(n.length<=s)return t;const r=[...n.slice(0,s),{key:"show more",render:e=>a().createElement(Me.Z,he()({},e,{icon:Xt.Z.dots({width:16,fill:this.theme.mediumTextColor}),title:o()("span",{style:{color:this.theme.mediumTextColor}},void 0,o()(x.FormattedMessage,{defaultMessage:"{numberMore} more results",id:"mentionMenu.showMoreResultsButton.title",values:{numberMore:n.length-s}}))})),action:()=>{this.updateOpenState({expandSection:e})}}];return{...t,items:r}}updateOpenState(e){const t=ms.Z.state;t.open&&ms.Z.setState({...t,...e})}getNormalizedFilter(){const e=this.filterStore.state;return e?ms.Z.state.open&&"@"===ms.Z.state.insertionType&&this.environment.device.isAndroid&&e.startsWith("@")?e.slice(1).trim():ms.Z.state.open&&"[["===ms.Z.state.insertionType&&e.endsWith("]]")?e.slice(0,-2).trim():e.trim():""}setTemporaryInputData(e){const t=ms.Z.state;if(!t.open)return;if(!e)return void t.temporaryInputData.set(void 0);const{device:i}=this.environment,{title:n,icon:o,allowTabCompletion:s}=e,a=this.filterStore.state||"",r=n.toLowerCase().startsWith(a)?n.slice(a.length):"";this.tabCompletionString=s?r:void 0;const l=i.isFirefox?void 0:o;t.temporaryInputData.set({prefix:t.insertionType,suffix:"[["===t.insertionType&&a.endsWith("]]")?"]]":"",completion:r,prefixIcon:l})}getCurrentMentionResults(e){const t=ms.Z.state,i=t.userRequestStore.state.result||[],n=t.pageRequestStore.state.result||[],o=this.getDateResults(this.getNormalizedFilter()),s=this.getTemplateVariableResults(this.getNormalizedFilter());let a=n;const{result:r}=this.stores.localPageMentionRequestStore.state;if(r&&!r.error){const e=r.value.results,t=pt.RM();a=t?ds.oO({results:{local:e,server:n.map(((e,i)=>({...e,originalPosition:i,store:Lt.Z.createChildStore(t,{table:_.iU,id:e.id})})))}})||[]:e}let l;l=this.getNormalizedFilter()?a.map((e=>e.id)):Ln.X4.state.map((e=>e.pageId));const d=t.userRequestStore.state.ready&&t.pageRequestStore.state.ready;return d&&cs.default.emit(this.environment,e,void 0),{userResults:i,pageResults:l,dateResults:o,templateVariableResults:s,ready:d}}canCreatePage(){return!!ms.Z.state.mentionTypes.createPage}isActionSheet(){const{device:e}=this.environment;return e.isMobileNative&&!e.isTablet}shouldCaptureBackspace(){return""===this.filterStore.state}getMenuInitialFocus(){if(""!==this.getNormalizedFilter())return 0}getMenuDesktopWidth(){return(0,l.bq)()?400:330}}const ws=(0,x.injectIntl)(Ms);var Cs=i(42239);class ks extends r.Z{constructor(){super(...arguments),k()(this,"cancelDragTimeout",void 0),k()(this,"handleDragOver",(e=>{e.preventDefault(),this.startDrag(e),this.continueDragThrottled(e)})),k()(this,"handleDrop",(e=>{e.preventDefault();const t=Array.from(e.dataTransfer.files);t.length>0&&mt.createAndCommit({userAction:"NativeDragHandler.handleDrop",environment:this.environment,perform:e=>{Cs._4({environment:this.environment,files:t,analyticsFrom:"native_drag",transaction:e})}})})),k()(this,"startDrag",(e=>{Cs.f$(this.environment,{startX:e.clientX,startY:e.clientY,stores:[],isNativeDrag:!0,getGhostElement:void 0})&&ei.ZH(this.environment)})),k()(this,"continueDrag",(e=>{this.cancelDragTimeout&&window.clearTimeout(this.cancelDragTimeout),this.cancelDragTimeout=window.setTimeout(this.cancelDrag,this.getCancelDragTimeoutMS()),Cs.td(this.environment,{currentX:e.clientX,currentY:e.clientY})})),k()(this,"continueDragThrottled",X().throttle(this.continueDrag,ks.dragOverThrottleMS)),k()(this,"cancelDrag",(()=>{Cs.cQ(this.environment)}))}didMount(){super.didMount(),window.addEventListener("dragover",this.handleDragOver),window.addEventListener("drop",this.handleDrop)}willUnmount(){super.willUnmount(),window.removeEventListener("dragover",this.handleDragOver),window.removeEventListener("drop",this.handleDrop)}getCancelDragTimeoutMS(){const{device:e}=this.environment;return e.isLinux?2e3:200}}k()(ks,"dragOverThrottleMS",62.5);const Ts=ks;i(85827);var Is=i(40902),Zs=i(15145),Ps=i(44615),_s=i(65311),xs=i(2688),Fs=i(12252),As=i(76487);class Bs extends r.Z{constructor(){super(...arguments),k()(this,"lastEmitValue",-1),k()(this,"lastSentBadgeNumber",void 0),k()(this,"lastSentCurrentSpaceBadgeNumber",void 0),k()(this,"handleNotificationEmit",(async(e,t)=>{if(t===this.lastEmitValue)return;this.lastEmitValue=t;const i=await Si.getUserNotifications(this.environment,{size:1e3});if("failed"===i.type)return;const{results:n}=i.data;As.Z.setState({results:n}),this.syncInitialBadgeNumber();const o=X().union.apply(null,n.map((e=>e.unreceived.notificationIds)));for(const s of o)this.displayNotification(s)})),k()(this,"handleNotificationEmitThrottled",X().throttle(this.handleNotificationEmit,1e3)),k()(this,"handleNotificationEmitWhenActive",((e,t)=>{Fs.Z.whenActive((()=>{this.handleNotificationEmitThrottled(e,t)}))})),k()(this,"listenerReference",void 0),k()(this,"updateBadgeNumbers",(()=>{const{results:e}=As.Z.state,{mobileNative:t}=this.environment,i=e.reduce(((e,t)=>e+t.unread.mentions),0);if(t){const e=As.Z.getUnreadCountForCurrentSpace().mentions;i===this.lastSentBadgeNumber&&e===this.lastSentCurrentSpaceBadgeNumber||t.setBadgeNumber(i,e),this.lastSentCurrentSpaceBadgeNumber=e}i!==this.lastSentBadgeNumber&&(i>0?yt.setBadge("".concat(i)):yt.setBadge("")),this.lastSentBadgeNumber=i})),k()(this,"syncInitialBadgeNumber",X().once(this.updateBadgeNumbers))}willMount(){this.startMessageListeners(),As.Z.addListener(this.updateBadgeNumbers),this.environment.mobileNative&&S.default.addListener(this.updateBadgeNumbers)}willUnmount(){this.stopMessageListeners(),As.Z.removeListener(this.updateBadgeNumbers),this.environment.mobileNative&&S.default.removeListener(this.updateBadgeNumbers)}startMessageListeners(){const{currentUserStore:e}=S.default.state;if(e){const t=(0,Ps.Lp)(e.id);this.listenerReference=xs.Z.addListener(t,this.handleNotificationEmitWhenActive,void 0,this.environment)}}stopMessageListeners(){this.listenerReference&&xs.Z.removeListener(this.listenerReference,this.environment)}async displayNotification(e){const t=(0,Pi.Kv)(this.props.rootStore,{table:_s.uX,id:e});await t.load();const i=t.getValue();if(!i)return;const n=(0,B.No)(t,i.activity_id,i.space_id);await n.load();const o=n.getValue(),{currentUserStore:s,currentSpaceViewStore:a}=S.default.state;if(s&&a&&o&&!o.invalid&&!Is.BX(o,s.id)&&await yt.shouldSendNotification()&&"undefined"!=typeof Notification){if(await a.load(),!a.isDefined())return;if(!Is.OJ(o))return;if(!a.getNotifyDesktop())return;if(!this.environment.device.isDesktop)return;const e=(0,(await m.deps.desktop.loader()).PushNotification)({activity:o,getRecordValue:t.getRecordValue,userTimeZone:ns.x7,intl:this.props.intl});if(!e)return;const{subject:i,body:n}=e;new Notification(i,{body:n,silent:!0}).addEventListener("click",(()=>{const e=Is.hY({activity:o,getRecordValue:t.getRecordValue,baseUrl:Rt.Z.domainBaseUrl}),i=Is.Fb(o),n=(0,Zs.k6)(e,[i,"desktop_push"]);ji.navigate({environment:this.environment,url:n})}))}}}const Es=(0,x.injectIntl)(Bs);var Rs=i(22889),Ds=i(58261);class Ls extends r.Z{constructor(){super(...arguments),k()(this,"renderTooltip",(()=>o()(N.Z,{capture:!0,onEnter:this.handleEnter,onCommandEnter:this.handleCommandEnter},void 0,a().createElement(a().Fragment,null,o()(x.FormattedMessage,{defaultMessage:"Open page",id:"pageMentionOverlay.openPage"}),o()("div",{},void 0,o()(Ds.Z,{onlyShowFirst:!0,name:"enter",style:{color:this.theme.mediumInvertedTextColor}})))))),k()(this,"handleEnter",(e=>{const t=this.pageMentionTokenStore.state;if(!t)return;const{pageId:i,store:n}=t;if(!i)return;e.preventDefault&&e.preventDefault();const o=Lt.Z.createChildStore(n,{table:_.iU,id:i});ji.navigateToBlock({store:o,environment:this.environment,visitType:Rs.vu.Link})})),k()(this,"handleCommandEnter",(e=>{const t=this.pageMentionTokenStore.state;if(!t)return;const{pageId:i,store:n}=t;if(!i)return;e.preventDefault();const o=Lt.Z.createChildStore(n,{table:_.iU,id:i});ji.navigateToBlock({store:o,environment:this.environment,visitType:Rs.vu.Link,metaClick:!0})})),k()(this,"pageMentionTokenStore",this.createComputedStore((()=>{const e=Tt.default.state;if("editing"!==e.mode)return;const t=(0,bt.QY)(e.multiSelection);if(!t)return;const{store:i,selection:n}=t;if(n.endIndex!==n.startIndex+1)return;const o=i.getValue(),s=dt.b1(o,n.startIndex);if(!s||!dt.eO(s))return;const[a]=dt.jD([s]);return{pageId:a,store:i}})))}renderComponent(){if(this.environment.device.isMobile)return;const e=Mt.getSelectionRect(),t=this.pageMentionTokenStore.state;return o()(di.Z,{render:()=>{},renderTooltip:this.renderTooltip,originRect:e,forceVisibleState:Boolean(t&&e),placement:di.Z.Placement.Bottom})}}const Os=Ls;var Ns=i(52989),Us=i(69784);class Ws extends r.Z{constructor(){super(...arguments),k()(this,"handleKey",(e=>{Us.Z.state.isActive&&(e.preventDefault(),(0,Ns.MZ)({environment:this.environment,currentX:Us.Z.state.currentX,currentY:Us.Z.state.currentY,toggle:e.shiftKey}))})),k()(this,"handleMouseMove",(e=>{Us.Z.state.isActive&&(e.preventDefault(),(0,Ns.MZ)({environment:this.environment,currentX:e.clientX,currentY:e.clientY,toggle:e.shiftKey}))})),k()(this,"handleMouseUp",(e=>{Us.Z.state.isActive&&((0,ti.N9)(e)||e.preventDefault(),(0,Ns.qw)(this.environment))}))}willMount(){window.addEventListener("keydown",this.handleKey),window.addEventListener("keyup",this.handleKey),window.addEventListener("mousemove",this.handleMouseMove),window.addEventListener("mouseup",this.handleMouseUp)}willUnmount(){window.removeEventListener("keydown",this.handleKey),window.removeEventListener("keyup",this.handleKey),window.removeEventListener("mousemove",this.handleMouseMove),window.removeEventListener("mouseup",this.handleMouseUp)}renderComponent(){return null}}const Vs=Ws;var zs=i(43008),qs=i(64951),Hs=i(65187);class Gs extends r.Z{constructor(){super(...arguments),k()(this,"renderPopupContent",(()=>o()(js,{})))}renderComponent(){const{device:e}=this.environment,{blockStore:t,originRect:i}=qs.Z.state;return o()(K.ZP,{popupType:e.isMobile?K.ZP.PopupType.SlideUp:K.ZP.PopupType.Popup,open:Boolean(t),originRect:i,placementToOrigin:K.ZP.Placement.Bottom,alignmentToOrigin:K.ZP.Alignment.Center,originGap:4,onDismiss:()=>zs.x(this.environment),render:this.renderPopupContent})}}class Ks extends r.Z{didMount(){const{blockStore:e}=qs.Z.state;if(!e)return;const t=e.getTitleStore();t&&St.mT({environment:this.environment,store:t,canSelectAllBlocks:!1})}renderComponent(){const{device:e}=this.environment,{blockStore:t}=qs.Z.state;if(!t)return;const i=t.getTitleStore();if(!i)return;let n;return n=e.isMobile?{menuType:A.o.ActionSheet}:{menuType:A.o.Popup,width:380},a().createElement(U.Z,n,o()("div",{style:this.getWrapStyle()},void 0,o()(Hs.Z,{store:i,disabled:!t.canEdit(),onEsc:()=>zs.x(this.environment),onEnter:()=>zs.x(this.environment),disableSlashCommands:!0,disableEmojiCommands:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,placeholder:this.props.intl.formatMessage({defaultMessage:"Untitled",id:"renameFileMenuPopup.input.placeholder"}),style:this.getInputStyle(),pasteBehavior:"inline"})))}getWrapStyle(){return{display:"flex",alignItems:"center",color:this.theme.regularTextColor,fontSize:"13px",padding:"4px 8px"}}getInputStyle(){return{display:"flex",alignItems:"center",flexGrow:1,fontSize:14,lineHeight:"20px",paddingTop:4,paddingBottom:4,paddingLeft:10,paddingRight:10,width:"100%",borderRadius:3,boxShadow:this.theme.inputBoxShadow,background:this.theme.inputBackground,cursor:"text",position:"relative"}}}const js=(0,x.injectIntl)(Ks),Ys=Gs;var Qs=i(52771),Xs=i(82187),Js=i(73063);class $s extends r.Z{constructor(){super(...arguments),k()(this,"renderPopupContent",(()=>{const{renderDelete:e}=Xs.Z.state;return o()(ta,{renderDelete:Boolean(e)})}))}renderComponent(){const{device:e}=this.environment,{clonedBlockStore:t,originRect:i}=Xs.Z.state;return o()(K.ZP,{popupType:e.isMobile?K.ZP.PopupType.SlideUp:K.ZP.PopupType.Popup,open:Boolean(t),originRect:i,placementToOrigin:K.ZP.Placement.Bottom,alignmentToOrigin:K.ZP.Alignment.Center,originGap:4,onDismiss:()=>Qs.x(this.environment),render:this.renderPopupContent})}}class ea extends r.Z{constructor(){super(...arguments),k()(this,"handleRecordIconChange",(e=>{const{clonedBlockStore:t}=Xs.Z.state;if(t){const i=t.getIconStore();i&&mt.createAndCommit({userAction:"RenamePageMenuPopup.handleRecordIconChange",environment:this.environment,perform:t=>{ut.sO({store:i,value:e,transaction:t})}})}}))}didMount(){const{clonedBlockStore:e}=Xs.Z.state;if(!e)return;const t=e.getTitleStore();t&&St.mT({environment:this.environment,store:t,canSelectAllBlocks:!1})}renderComponent(){const{device:e}=this.environment,{clonedBlockStore:t}=Xs.Z.state;if(!t)return;const i=t.getTitleStore();if(!i)return;const{renderDelete:n}=this.props;let s;return s=e.isMobile?{menuType:A.o.ActionSheet}:{menuType:A.o.Popup,width:380},a().createElement(U.Z,s,o()("div",{style:this.getWrapStyle()},void 0,this.renderIcon(t),o()(Hs.Z,{store:i,disabled:!t.canEdit(),onEsc:()=>Qs.x(this.environment),onEnter:()=>Qs.x(this.environment),disableSlashCommands:!0,disableEmojiCommands:!0,disableSelectAllBlocks:!0,disableSelectionDrag:!0,disableStyleAnnotations:!0,placeholder:this.renderEmptyTitlePlaceholder(),style:this.getInputStyle(),pasteBehavior:"inline"}),n&&t.canEdit()&&this.renderDeleteButton()))}renderDeleteButton(){return o()(Js.Z,{icon:e=>Xt.Z.trash({height:20,width:20,...e}),style:{marginLeft:6},hasBackground:!0,isDarkIconColor:!0,showShadow:!0,onClick:async()=>{const{originalBlockStore:e}=Xs.Z.state;e&&await $t.Qw({environment:this.environment,blocks:[e]}),Qs.x(this.environment)}})}renderIcon(e){const t={width:28,height:28,marginRight:6,flexShrink:0,flexGrow:0,boxShadow:"inset 0 0 0 1px ".concat(this.theme.darkDividerColor)};if(e.canEdit()){var i,n;const s=null===(i=e.getIconStore())||void 0===i?void 0:i.table;return o()(Ai.Z,{disabled:!1,bucket:"secure",store:e,icon:e.getIcon(),isEmptyPage:e.isEmptyPage(),size:18,style:t,iconLoggingData:{recordTable:s,source:"breadcrumb",block_type:e.getType(),collection_id:"collection"===s?null===(n=e.getIconStore())||void 0===n?void 0:n.id:void 0},onChange:this.handleRecordIconChange})}return o()(Ai.Z,{disabled:!0,icon:e.getIcon(),isEmptyPage:e.isEmptyPage(),size:18,style:t})}renderEmptyTitlePlaceholder(){const{clonedBlockStore:e}=Xs.Z.state,{intl:t}=this.props;if(!e)return;const i=e.getValue();return i?(0,Ui.Q2)({table:e.table,value:i,getRecordValue:e.getRecordValue,userTimeZone:ns.x7,intl:t}):void 0}getWrapStyle(){return{display:"flex",alignItems:"center",color:this.theme.regularTextColor,fontSize:"13px",padding:"4px 8px"}}getInputStyle(){return{display:"flex",alignItems:"center",flexGrow:1,fontSize:14,lineHeight:"20px",paddingTop:4,paddingBottom:4,paddingLeft:10,paddingRight:10,width:"100%",borderRadius:3,boxShadow:this.theme.inputBoxShadow,background:this.theme.inputBackground,cursor:"text",position:"relative"}}}const ta=(0,x.injectIntl)(ea),ia=$s;var na=i(4083),oa=i(13264);class sa extends r.Z{constructor(){super(...arguments),k()(this,"renderDiscussion",(()=>{const{device:e}=this.environment;if(oa.Z.state.open){const{discussionStore:t,discussionInputStore:i,blockStore:n}=oa.Z.state;let s;return s=e.isMobile?{menuType:A.o.Modal,title:o()(x.FormattedMessage,{defaultMessage:"Comments",id:"discussion.mobileReplyMenu.title"}),right:o()(x.FormattedMessage,{defaultMessage:"Close",id:"discussion.mobileReplyMenu.closeButton.label"}),onClickRight:()=>na.UZ(this.environment),whiteBackground:!0}:{menuType:A.o.Popup,width:420,maxWidth:e.isMobileBrowser?"80vw":"100%"},a().createElement(U.Z,s,o()(L.Z,{capture:!0,render:()=>o()(D.Z,{store:t,discussionInputStore:i,onDismiss:()=>na.UZ(this.environment),format:F.O2.Menu,isFirst:!0,isOnly:!0,discussionLocation:"reply_menu",showResolveButtonByDefaultIfPossible:!0,blockStore:n})}))}}))}renderComponent(){const{device:e}=this.environment,{open:t,rect:i}=oa.Z.state;return o()(K.ZP,{popupType:e.isMobile?K.ZP.PopupType.SlideUp:K.ZP.PopupType.Popup,open:t,originRect:i,placementToOrigin:K.ZP.Placement.Bottom,alignmentToOrigin:K.ZP.Alignment.Center,originGap:4,onDismiss:()=>na.UZ(this.environment),render:this.renderDiscussion})}}const aa=sa;var ra=i(80503),la=i(85377),da=i(56863),ca=i(40959),ua=i(87078),ma=i(45162),pa=i(67669),ga=i(15723),ha=i(17903),fa=i(4548),va=i(42057),ya=i(49557),Sa=i(4935),ba=i(99757),Ma=i(13966),wa=i(31945),Ca=i(64131),ka=i(82945),Ta=i(40464),Ia=i(32404),Za=i(73383);class Pa extends r.Z{constructor(){super(...arguments),k()(this,"mouseIsDownExternally",!1),k()(this,"lastRenderState",void 0),k()(this,"renderOverlay",(()=>{const{isActive:e}=ya.Z.state;return o()(ai.Z,{isVisible:e,enterAnimationStyle:{opacity:0},animationStyle:{opacity:1},exitAnimationStyle:{opacity:0},springConfig:{opacity:{stiffness:100,damping:10,precision:1e-4}},render:this.renderAnimated,onAnimationEnd:this.handleAnimationEnd})})),k()(this,"renderAnimated",(()=>{const{top:e,left:t}=ya.Z.state,i=this.canOnlyDiscussStore.state,n=Math.max(i?t:t-Pa.leftOffset,0),s=i?"12px 0":12;return o()("div",{className:ye.Qc,style:{pointerEvents:"none",position:"absolute",top:e,left:0,display:"flex",width:"100%"}},void 0,o()("div",{style:{flexShrink:1,width:n,minWidth:24}}),(0,ii.Z)((e=>a().createElement("div",he()({style:{pointerEvents:"none",padding:s}},e),this.lastRenderState&&this.renderMenu(this.lastRenderState)))),o()("div",{style:{flexGrow:1,flexShrink:1,minWidth:36}}))})),k()(this,"updateRichTextState",(()=>{const e=ya.Z.state;if(Un.Z.state.open||Sa.Z.state.open)return;if(ba.n.state)return da.w();const t=Tt.default.state;if("empty"===t.mode)return da.w();const i=(0,ma.L5)(t.multiSelection);if(0===i.length)return da.w();if(!i.every((e=>{let{store:t}=e;return t.table===_.iU||t.table===Ki.x_||t.table===Hi.v})))return da.w();if(!this.environment.currentUser.isLoggedIn()||!i.every((e=>{let{store:t}=e;return t.canComment()})))return;const n=Mt.get();if(pt.JE())return da.w();if(i.some((e=>{let{editable:t}=e;return t.props.disableAnnotation})))return da.w();if(i.some((e=>{let{editable:t}=e;return t.props.disabled})))return da.w();const o=i.map((e=>{let{editable:t}=e;return t.getContextClosestSelectableStore()}));if(o.some(((e,t)=>e&&i[t].store.table!==Ki.x_&&(e.isLocked()||e.isNavigableAncestorLocked()))))return da.w();if(this.mouseIsDownExternally&&e.blockTarget!==o[0])return da.w();const s=i.some((e=>{let{store:t}=e;if(t.table!==_.iU)return!1;const i=t.getRecordStoreAtRootPath().getValue();return!!i&&Pa.richTextMenuBlockTypesDenylist[i.type]}));if(s)return da.w();const a=n?Mt.getRect(n):void 0;if(a&&!ga.kK(a,(0,ua.Z)()))return da.w();if(Xs.Z.isActive()||qs.Z.isActive()||rn.Z.isOpen()||s||!n||!this.hasNonCollapsedTextSelection()||kt.state.open)return da.w();let r=0,l=0;if(a){r=a.left;const e=25,t=a.top-Pa.height-e,i=ra.R6(this.environment.device.isElectronMac),n=this.environment.WindowSizeStore.state.height-Pa.height-e;l=Math.min(Math.max(t,i),n)}0===Math.abs(ya.Z.state.top-l)&&Math.abs(ya.Z.state.left-r)<10&&(l=ya.Z.state.top,r=ya.Z.state.left),ya.Z.setState({...ya.Z.state,isActive:!0,isAnimatingClosed:!1,top:l,left:r,blockTarget:se.default.state.stores[0]})})),k()(this,"updateRichTextStateThrottled",X().throttle(this.updateRichTextState,200,{leading:!1})),k()(this,"handleAnimationEnd",(()=>{ya.Z.state.isActive||ya.Z.setState({...ya.Z.state,isAnimatingClosed:!1}),this.lastRenderState=this.renderStateStore.state})),k()(this,"renderStateStore",this.createComputedStore((()=>{const{isActive:e,blockTarget:t}=ya.Z.state,i=Tt.default.state;if(!e||"empty"===i.mode)return;const{multiSelection:n}=i,o=(0,bt.qS)(n),s=Tt.default.isEditingComment(),a=Tt.default.isEditingCaption(),r=t&&t.getParentTable()===Hi.v,l=this.pageContext&&this.pageContext.publicEditModeStore.state,d=!(0,pa.YF)(l)&&(n.start.store.canEdit()&&n.end.store.canEdit()),c=t&&t.getType(),u=c&&Pa.richTextMenuActionsDenylist[c],m={isSingleStoreSelection:o,showTurnInto:Boolean(o&&!s&&!r&&!a&&t&&d),showBold:Boolean(d),showItalic:Boolean(d),showStrikethrough:Boolean(d),showUnderline:Boolean(d),showCode:Boolean(d),showLink:Boolean(o&&d),showHighlight:Boolean(d&&!s),showDiscuss:Boolean(!s&&t&&!r),showEquation:Boolean(o&&d),showMention:Boolean(o&&!s&&t&&!r&&d),showActionButton:Boolean(o&&!s&&!a&&t&&!r),blockTarget:t,isComment:s};if(u&&u.size>0)for(const p of u)m[p]=!1;return m}))),k()(this,"canOnlyDiscussStore",this.createComputedStore((()=>{const e=this.renderStateStore.state;return e&&e.showDiscuss&&!e.showBold})))}didMount(){se.default.addListener(this.updateRichTextStateThrottled),Tt.default.addListener(this.updateRichTextStateThrottled),ha.Z.addListener(this.updateRichTextState),va.Z.addListener(this.updateRichTextState),fa.Z.addListener(this.updateRichTextState)}willUnmount(){Tt.default.removeListener(this.updateRichTextStateThrottled),se.default.removeListener(this.updateRichTextStateThrottled),ha.Z.removeListener(this.updateRichTextState),va.Z.removeListener(this.updateRichTextState),fa.Z.removeListener(this.updateRichTextState)}willMountOrUpdate(){const e=this.renderStateStore.state;e&&(this.lastRenderState=e)}renderComponent(){const{isActive:e,isAnimatingClosed:t}=ya.Z.state;return o()(u.Z,{open:e||t,render:this.renderOverlay})}renderMenu(e){const{isActive:t}=ya.Z.state;return o()("div",{style:{display:"inline-flex",alignItems:"stretch",height:Pa.height,background:this.theme.popoverBackground,overflow:"hidden",fontSize:14,lineHeight:1.2,borderRadius:3,boxShadow:this.theme.mediumBoxShadow,pointerEvents:t?"auto":"none"},onMouseDown:e=>e.preventDefault()},void 0,e.showTurnInto&&e.blockTarget&&this.renderTurnInto(e.blockTarget),e.showLink&&this.renderLinkButton(!0),e.showDiscuss&&e.blockTarget&&this.renderCommentButton(e.blockTarget),o()("div",{style:{display:"flex"}},void 0,e.showBold&&this.renderBoldButton(),e.showItalic&&this.renderItalicButton(),e.showUnderline&&this.renderUnderlineButton(),e.showStrikethrough&&this.renderStrikethroughButton(),e.showCode&&this.renderCodeButton(),e.showEquation&&this.renderEquationButton()),e.showHighlight&&o()(Ca.Z,{style:this.getBorderRight()}),e.showMention&&this.renderMention(),e.showActionButton&&e.blockTarget&&this.renderActionButton(e.blockTarget))}renderTurnInto(e){let t=o()(x.FormattedMessage,{defaultMessage:"Turn into",id:"richTextMenu.turnIntoButton.label"});const{intl:i}=this.props,n=e.getType();if(n){const e=ca.Hc[n];t=e&&e.displayName||t}return o()(wa.Z,{popupType:wa.Z.PopupType.Popup,buttonPopupStore:Sa.Z,originGap:4,renderOrigin:e=>o()(di.Z,{renderTooltip:()=>i.formatMessage({defaultMessage:"Turn into",id:"richTextMenu.turnIntoButton.tooltip"}),render:i=>a().createElement(Hn.Z,he()({style:{display:"flex",alignItems:"center",padding:"0 8px",whiteSpace:"nowrap",...this.getBorderRight()}},(0,Ci.Z)(e,i)),t,Xt.Z.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor}))}),render:()=>o()(U.Z,{menuType:A.o.Popup},void 0,o()(le.Z,{context:{blocks:[e],environment:this.environment,publicEditMode:void 0},sections:[la.gH],onAccept:t=>{const i=e.getType(),n=e.getFormat();da.w(),$.trackBlockAction(this.environment,{analyticsName:t.analyticsName,from:"rich_text_menu",block_id:e.id,block_type:i,is_toggleable:i?(0,ie._A)(i,n):void 0})}})),onClick:()=>{$.trackRichTextMenuClick(this.environment,{action:"turn_into"})}})}renderBoldButton(){return o()(Ta.Z,{type:"b",tooltipLabel:o()(s.Fragment,{},void 0,o()("div",{},void 0,o()(x.FormattedMessage,{defaultMessage:"Bold",id:"richTextMenu.boldButton.tooltip"})),o()("div",{},void 0,o()(Ds.Z,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleBold"})))},void 0,o()("span",{style:{fontWeight:yi.Z.fontWeight.semibold}},void 0,"B"))}renderItalicButton(){return o()(Ta.Z,{type:"i",tooltipLabel:o()(s.Fragment,{},void 0,o()("div",{},void 0,o()(x.FormattedMessage,{defaultMessage:"Italicize",id:"richTextMenu.italicsButton.tooltip"})),o()("div",{},void 0,o()(Ds.Z,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleItalics"})))},void 0,o()("span",{style:{fontStyle:"italic"}},void 0,"i"))}renderStrikethroughButton(){return o()(Ta.Z,{type:"s",tooltipLabel:o()(s.Fragment,{},void 0,o()("div",{},void 0,o()(x.FormattedMessage,{defaultMessage:"Strike-through",id:"richTextMenu.strikeThroughButton.tooltip"})),o()("div",{},void 0,o()(Ds.Z,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleStrike"})))},void 0,o()("span",{style:{textDecoration:"line-through"}},void 0,"S"))}renderUnderlineButton(){return o()(Ta.Z,{type:"_",tooltipLabel:o()(s.Fragment,{},void 0,o()("div",{},void 0,o()(x.FormattedMessage,{defaultMessage:"Underline",id:"richTextMenu.underlineButton.tooltip"})),o()("div",{},void 0,o()(Ds.Z,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleUnderline"})))},void 0,o()("span",{style:{textDecoration:"underline"}},void 0,"U"))}renderCodeButton(){return o()(Ta.Z,{type:"c",style:{padding:"0 6px"},tooltipLabel:o()(s.Fragment,{},void 0,o()("div",{},void 0,o()(x.FormattedMessage,{defaultMessage:"Mark as code",id:"richTextMenu.markAsCodeButton.tooltip"})),o()("div",{},void 0,o()(Ds.Z,{style:{color:this.theme.mediumInvertedTextColor},name:"toggleCode"})))},void 0,Xt.Z.code({width:15,height:15}))}renderLinkButton(e){const t=this.environment.device.isMobile;return o()(Za.Z,{style:this.getBorderRight()},void 0,e&&Xt.Z.alias({width:t?18:16,height:t?18:16,marginRight:4,fill:this.theme.regularIconColor}),o()("span",{style:{borderBottom:"1px solid ".concat(this.theme.linkDecorationColor)}},void 0,o()(x.FormattedMessage,{defaultMessage:"Link",id:"richTextMenu.linkButton.tooltip"})),e&&Xt.Z.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor}))}renderEquationButton(){return o()(Ia.Z,{style:this.getBorderRight(),onClick:()=>{$.trackRichTextMenuClick(this.environment,{action:"e"}),da.w()}},void 0,Xt.Z.equation({width:16,height:16}))}renderMention(){return o()(di.Z,{renderTooltip:()=>o()(s.Fragment,{},void 0,o()("div",{},void 0,o()(x.FormattedMessage,{defaultMessage:"Mention a person,{br}page, or date",id:"richTextMenu.mentionButton.tooltip",values:{br:o()("br",{})}})),o()("div",{style:{color:this.theme.mediumInvertedTextColor}},void 0,"@")),render:e=>a().createElement(Hn.Z,he()({style:{...this.getBorderRight(),padding:"0 8px"}},e,{onClick:()=>{as.lZ(this.environment,{page:!0,createPage:!0,user:!0,bot:!0,date:!0,reminder:!0,templateVariable:!0}),$.trackRichTextMenuClick(this.environment,{action:"mention"})}}),Xt.Z.mention({width:14,fill:this.theme.regularTextColor}))})}renderCommentButton(e){return o()(ka.Z,{style:this.getBorderRight(),blockStore:e})}renderActionButton(e){return o()(Ma.Z,{store:e,style:{borderRight:"none",borderRadius:0,padding:0,width:30,height:"none"},iconStyle:{fill:this.theme.regularTextColor},fadeIn:!1,onClick:()=>{$.trackRichTextMenuClick(this.environment,{action:"more"})}})}hasNonCollapsedTextSelection(){const e=Mt.get();return!!e&&!e.collapsed&&"empty"!==Tt.default.state.mode&&!(0,bt.iG)(Tt.default.state.multiSelection)}getBorderRight(){return{boxShadow:"1px 0 0 ".concat(this.theme.regularDividerColor),marginRight:1}}}k()(Pa,"richTextMenuBlockTypesDenylist",{[xt.ZP.factory]:!0}),k()(Pa,"richTextMenuActionsDenylist",{[xt.ZP.code]:new Set(["showMention","showCode"]),[xt.ZP.table]:new Set(["showTurnInto","showActionButton"]),[xt.ZP.tableRow]:new Set(["showTurnInto","showActionButton"])}),k()(Pa,"leftOffset",60),k()(Pa,"height",32);const _a=(0,x.injectIntl)(Pa);i(65069);var xa=i(14248),Fa=i(14714),Aa=i(66094),Ba=i(12211),Ea=i(50628);const Ra=200;var Da;function La(e){return e.type===Da.Selectable?{type:tt.Dl.Selectable,store:e.target.props.store,direction:e.direction}:{type:tt.Dl.DropTarget,key:e.target.props.dropTargetKey,direction:e.direction}}function Oa(e){const{target:t,device:i,direction:n,points:o}=e;return n===tt.vh.Onto||!i.isPhone||t.props.dropzoneShouldNeverUseOrigin?o.mousePoint:{x:o.originPoint.x,y:o.mousePoint.y}}function Na(e){return e instanceof Aa.Z?{type:Da.Selectable,target:e}:{type:Da.DropTarget,target:e}}function Ua(e){if(!(e&&e instanceof Aa.Z))return!1;let t=e;const i=tt.ZP.state;if(!i.isDragging)return!1;const{draggedStores:n}=i;for(;t;){if(n.indexOf(t.props.store)>=0)return!0;t=t.getContextClosestSelectable()}return!1}function Wa(e){const{dropzoneMustBeWithinHorizontalBound:t,device:i}=e;return t?0:i.isPhone?9999:0}function Va(e){switch(e.direction){case tt.vh.Onto:return function(e){const{device:t,isNativeDrag:i,rect:n,target:o,points:s,priority:a,canAcceptDrop:r}=e,l=tt.vh.Onto,d=Oa({device:t,target:o,direction:l,points:s});if((i?o.props.canNativeDropOnto:o.props.canDropOnto)&&qa(d,n)&&!Ua(o)&&r(o,l))return{...Na(o),direction:l,left:n.left,top:n.top,width:n.width,height:n.height,priority:a}}(e);case tt.vh.Left:return function(e){const{device:t,isNativeDrag:i,rect:n,target:o,points:s,priority:a,optionKeyDown:r,canAcceptDrop:l}=e,d=tt.vh.Left,c=Oa({device:t,target:o,direction:d,points:s});if((i?o.props.canNativeDropLeft:o.props.canDropLeft)&&n&&c.y>=n.top&&c.y<=n.bottom&&Math.abs(c.x-n.left)<=200&&(r||!Ua(o))&&l(o,d))return{...Na(o),direction:d,left:n.left,top:n.top,width:0,height:n.height,priority:a}}(e);case tt.vh.Right:return function(e){const{device:t,isNativeDrag:i,rect:n,target:o,points:s,priority:a,optionKeyDown:r,canAcceptDrop:l}=e,d=tt.vh.Right,c=Oa({device:t,target:o,direction:d,points:s});if((i?o.props.canNativeDropRight:o.props.canDropRight)&&n&&c.y>=n.top&&c.y<=n.bottom&&Math.abs(c.x-n.right)<=Ra&&(r||!Ua(o))&&l(o,d))return{...Na(o),direction:d,left:n.right,top:n.top,width:0,height:n.height,priority:a}}(e);case tt.vh.Above:return function(e){const{device:t,isNativeDrag:i,rect:n,target:o,points:s,priority:a,optionKeyDown:r,canAcceptDrop:l}=e,d=Wa({dropzoneMustBeWithinHorizontalBound:o.props.dropzoneMustBeWithinHorizontalBound,device:t}),c=tt.vh.Above,u=Oa({device:t,target:o,direction:c,points:s});if((i?o.props.canNativeDropAbove:o.props.canDropAbove)&&n&&u.x>=n.left-14-d&&u.x<=n.right+d&&(r||!Ua(o))&&l(o,c))return{...Na(o),direction:c,left:n.left,top:n.top,width:n.width,height:0,priority:a}}(e);case tt.vh.Below:return function(e){const{device:t,isNativeDrag:i,rect:n,target:o,points:s,priority:a,optionKeyDown:r,canAcceptDrop:l}=e,d=Wa({dropzoneMustBeWithinHorizontalBound:o.props.dropzoneMustBeWithinHorizontalBound,device:t}),c=tt.vh.Below,u=Oa({device:t,target:o,direction:c,points:s});if((i?o.props.canNativeDropBelow:o.props.canDropBelow)&&n&&u.x>=n.left-14-d&&u.x<=n.right+d&&(r||!Ua(o))&&l(o,tt.vh.Below))return{...Na(o),direction:tt.vh.Below,left:n.left,top:n.bottom,width:n.width,height:0,priority:a}}(e)}}function za(e){const{device:t,rect:i,target:n,points:o,optionKeyDown:s}=e;return qa(Oa({device:t,target:n,direction:tt.vh.Onto,points:o}),i)&&Ua(n)&&!s}function qa(e,t){return Boolean(t&&e.x>=t.left&&e.x<=t.right&&e.y>=t.top&&e.y<=t.bottom)}!function(e){e[e.Selectable=0]="Selectable",e[e.DropTarget=1]="DropTarget"}(Da||(Da={}));var Ha=i(28314),Ga=i(35026),Ka=i(17031),ja=i(27406),Ya=i(81844),Qa=i(16339),Xa=i(95802),Ja=i(88923),$a=i(91681),er=i(86486);class tr extends r.Z{constructor(){super(...arguments),k()(this,"isUpdatingDragState",!1),k()(this,"didTouchEnd",!1),k()(this,"lastMouseInfo",void 0),k()(this,"handleWindowMouseMove",(e=>{if(this.didTouchEnd)return void(this.didTouchEnd=!1);e&&(this.lastMouseInfo={target:e.target,x:e.clientX,y:e.clientY});const{isDragging:t}=tt.ZP.state;if(t)this.updateDragState();else{if(!this.lastMouseInfo)return;this.updateHoverState(this.lastMouseInfo.target,this.lastMouseInfo.x,this.lastMouseInfo.y)}})),k()(this,"handleDragBlockStoreChange",(()=>{this.isUpdatingDragState||this.handleWindowMouseMoveThrottled(void 0)})),k()(this,"handleWindowMouseMoveThrottled",X().throttle((e=>In.Z.withListenerIgnored((()=>this.handleWindowMouseMove(e)))),60)),k()(this,"handleSelectionChange",(()=>{const{isDragging:e}=tt.ZP.state;vt.default.afterNextFlush((()=>{this.lastMouseInfo&&!e&&this.updateHoverState(this.lastMouseInfo.target,this.lastMouseInfo.x,this.lastMouseInfo.y)}))})),k()(this,"handleSelectionChangeThrottled",X().throttle(this.handleSelectionChange,60)),k()(this,"handleWindowKeyEvent",(()=>{const{isDragging:e}=tt.ZP.state;e&&this.updateDragState()})),k()(this,"handleWindowTouchEnd",(()=>{this.didTouchEnd=!0})),k()(this,"handleWindowScroll",(()=>{ei.Ch(),this.clearHoverState()})),k()(this,"handleWindowResize",(()=>{ei.Ch(),this.clearHoverState()})),k()(this,"handleGlobalMenuIsOpenChange",(()=>{const e=er.default.state,t=pt.kw.state;e.isOpen&&!e.menuIsOpen&&t&&er.default.reset()})),k()(this,"memoizedCanDragCache",new WeakMap),k()(this,"memoizedCanDrag",(e=>{const t=this.memoizedCanDragCache.get(e);if(this.memoizedCanDragCache.has(e))return t;const i=(0,wi.OO)({environment:this.environment,blocks:e,publicEditMode:this.pageContext&&this.pageContext.publicEditModeStore.state});return this.memoizedCanDragCache.set(e,i),i})),k()(this,"getDropZonePriority",(e=>{var t;return null!==(t=null==e?void 0:e.priority)&&void 0!==t?t:0}))}didMount(){super.didMount();const{device:e}=this.environment;fn.l(window,"mousemove",this.handleWindowMouseMoveThrottled),se.default.addListener(this.handleSelectionChangeThrottled),e.isIOS&&fn.l(window,"touchend",this.handleWindowTouchEnd),fn.l(window,"keydown",this.handleWindowKeyEvent),fn.l(window,"keyup",this.handleWindowKeyEvent),tt.ZP.addListener(this.handleDragBlockStoreChange),fn.l(window,"scroll",this.handleWindowScroll,!0),fn.l(window,"resize",this.handleWindowResize),pt.kw.addListener(this.handleGlobalMenuIsOpenChange),ei.Jy()}willUnmount(){super.willUnmount();const{device:e}=this.environment;fn.Z(window,"mousemove",this.handleWindowMouseMoveThrottled),se.default.removeListener(this.handleSelectionChangeThrottled),e.isIOS&&fn.Z(window,"touchend",this.handleWindowTouchEnd),fn.Z(window,"keydown",this.handleWindowKeyEvent),fn.Z(window,"keyup",this.handleWindowKeyEvent),tt.ZP.removeListener(this.handleDragBlockStoreChange),fn.Z(window,"scroll",this.handleWindowScroll,!0),fn.Z(window,"resize",this.handleWindowResize),pt.kw.removeListener(this.handleGlobalMenuIsOpenChange)}updateDragState(){if(this.isUpdatingDragState)throw new Error("Assertion failure, updateDragState() called when this.isUpdatingDragState === true!");this.isUpdatingDragState=!0;try{this.updateDragStateInner()}finally{this.isUpdatingDragState=!1}}updateDragStateInner(){const e=tt.ZP.state;if(!e.isDragging)return;const{draggedStores:t,currentX:i,currentY:n,offsetX:o,offsetY:s,isNativeDrag:a}=e,r={x:i,y:n},l={x:i-o,y:n-s},d=this.findNearbyDropZones({mousePoint:r,originPoint:l},t[0],a);if(d.ontoDropZone)tt.ZP.setState({...e,currentDropZone:d.ontoDropZone,currentHintDropZones:[],currentParentStore:void 0});else if(d.verticalDropZone)tt.ZP.setState({...e,currentDropZone:d.verticalDropZone,currentHintDropZones:[],currentParentStore:void 0});else{if(d.horizontalDropZones.length>0){const t=d.horizontalDropZones[0],i=X().tail(d.horizontalDropZones);if(t.type===tt.Dl.Selectable){const n=Xa.C.findSelectableFromStore(t.store);if(n){const o=n.getContextClosestSelectable();let s;return o&&o.props.store!==t.store&&o.props.shouldShowParentHalo&&(s=o.props.store),void tt.ZP.setState({...e,currentDropZone:t,currentHintDropZones:i,currentParentStore:s})}}else{if(ja.Z.findDropTargetFromKey(t.key))return void tt.ZP.setState({...e,currentDropZone:t,currentHintDropZones:i,currentParentStore:void 0})}}tt.ZP.setState({...e,currentDropZone:void 0,currentHintDropZones:[],currentParentStore:void 0})}}clearHoverState(){const e=er.default.state;e.isOpen&&!e.menuIsOpen&&er.default.reset()}updateHoverState(e,t,i){const n=er.default.state;if(!n.isOpen||!n.menuIsOpen){const o=this.findHoverMenuTarget(e,t,i);o?n.isOpen&&o.selectable.props.store===n.currentStore||er.default.setState({isOpen:!0,currentStore:o.selectable.props.store,container:o.container,menuIsOpen:!1}):er.default.reset()}}getHighestDropZonePriorityRects(e){const t=this.getDropZonePriority(X().maxBy(e,this.getDropZonePriority));return e.filter((e=>this.getDropZonePriority(e)===t))}getSelectableContainerPriority(e){return(se.default.state.droppableContainerStack||[]).indexOf(e)}findNearbyDropZones(e,t,i){const{device:n}=this.environment,o=Ha.yA(),s=function(){const{selectableRectMap:e}=Ea.Z.state,{dropTargetRectMap:t}=Ba.Z.state,i=new Map;return e.forEach(((e,t)=>{i.set(t,e)})),t.forEach(((e,t)=>{i.set(t,e)})),i}(),a=s.keys();let r=a.next();const l=Xa.C.findSelectableFromStore(t),d=l?l.getContextSelectableContainer():void 0;let c=[];for(;!r.done;){const t=r.value;r=a.next();const l=s.get(t),u=t.getContextSelectableContainer();if(n.isPhone&&u!==d)continue;if(!u||u.props.disable)continue;const m=this.getSelectableContainerPriority(u),p={device:this.environment.device,isNativeDrag:i,rect:l,target:t,points:e,priority:m,optionKeyDown:o.option,canAcceptDrop:(e,t)=>this.selectableCanAcceptDrop(e,t)};if(za(p))return{ontoDropZone:void 0,verticalDropZone:void 0,horizontalDropZones:[]};c.push(...X().compact([Va({...p,direction:tt.vh.Onto}),Va({...p,direction:tt.vh.Left}),Va({...p,direction:tt.vh.Right}),Va({...p,direction:tt.vh.Above}),Va({...p,direction:tt.vh.Below})]))}c=this.getHighestDropZonePriorityRects(c);const u=c.filter((e=>e.direction===tt.vh.Above||e.direction===tt.vh.Below)),m=X().minBy(u,(t=>Math.abs(t.top-this.getReferencePointForRect(t,e).y)));let p=u.filter((e=>{let{top:t}=e;return Math.abs(t-(m?m.top:0))<=tr.competingHorizontalDropZoneMinDist}));if(p.length>1){p=p.filter((t=>{const i=this.getReferencePointForRect(t,e).x,n=Wa({device:this.environment.device});return i>=t.left-n&&i<=t.left+t.width+n})),p=X().sortBy(p,(e=>{let{left:t}=e;return t}));let t=0;for(;t<p.length-1;t++){const i=p[t+1],n=this.getReferencePointForRect(i,e).x;if(i.left>n)break}p=p.slice(0,t+1),p.reverse()}const g=p.map(La);let h;const f=c.filter((e=>e.direction===tt.vh.Onto)),v=X().minBy(f,(e=>e.height));if(v){u.some((t=>{const i=this.getReferencePointForRect(t,e).y;return Math.abs(t.top-i)<tr.competingOntoDropZoneVerticalOffset}))||(h=La(v))}let y;const S=c.filter((e=>e.direction===tt.vh.Left||e.direction===tt.vh.Right));let b=X().minBy(S,(t=>{const i=this.getReferencePointForRect(t,e).x;return Math.abs(t.left-i)}));if(b){const e=b,t=S.filter((t=>Math.abs(t.left-e.left)<tr.verticalDropZoneAmbiguousDist));t.length>0&&(b=X().minBy(t,(e=>e.left)))}if(b){const e=b;u.some((t=>t.top>=e.top&&t.top+t.height<=e.top+e.height))||(y=La(b))}return{ontoDropZone:h,verticalDropZone:y,horizontalDropZones:g}}findHoverMenuTarget(e,t,i){if($a.Z.state.isResizing||tt.ZP.state.isDragging||Us.Z.state.isActive||pt.kw.state)return;const{selectableRectMap:n}=Ea.Z.state,o=Qa.Z.getMembersByDOMOrder().find((t=>{const i=t.getNode();return Boolean(i&&i.contains(e))})),s=se.default.getCurrentDefaultContainer(),a=o||s;if(!a)return;const r=n.keys();let l=r.next();const d=[];for(;!l.done;){const e=l.value,o=n.get(e);(e.props.shouldShowHoverMenu||e.props.shouldShowCommentMenu)&&e.getContextSelectableContainer()===a&&o&&i>=o.top&&i<=o.bottom&&t>=o.left-tr.hoverMaxHorizontalOffset&&t<=o.right&&d.push(e),l=r.next()}const c=X().sortBy(d,(e=>{const t=n.get(e);return t?-t.left:1/0})),u=c.find((e=>{const t=e.getNode();if(t){if(c.find((i=>{if(i!==e){const e=i.getNode();return Boolean(e&&t.contains(e))}return!1})))return!1}return!0}));return u?{selectable:u,container:a}:void 0}selectableCanAcceptDrop(e,t){if(b.Z.state.isOpen&&!Ja.default.state.open)return!1;if(M.Z.state.isOpen)return!1;const i=tt.ZP.state,n=i.isDragging?i.draggedStores:[],o=!!i.isDragging&&i.isNativeDrag;let s,a,r,l=!1,d=!1;n.find((e=>{const t=Ya.Z.findOutlinerItemFromStore(e);return!!t&&(s=t,a=t.props.type,l=t.props.isTopLevelItem,!0)}));const c=e instanceof Aa.Z?Ya.Z.findOutlinerItemFromStore(e.props.store):void 0,u=null==c?void 0:c.props.parentStore;var m;c&&(r=c.props.type,d=c.props.isTopLevelItem||"team"===(null===(m=c.props.parentStore)||void 0===m?void 0:m.table));if(this.isDraggingSharedPageOutOfTopLevelTeamSection({draggingOutlinerItem:s,selectableOutlinerItemParent:u,direction:t}))return!1;if(!(e instanceof Aa.Z))return e.props.canAcceptDrop({direction:t,draggingStores:n,isNativeDrag:o});const p=e.props.store,g=p.getAncestorCollectionStore();if(t===tt.vh.Onto&&g){const e=g.id;if(n.find((t=>{const i=t.getAncestorCollectionStore();return Boolean(t instanceof Lt.Z&&i&&i.id===e)})))return!1}if(e.props.groupsPointer){if(e.props.groupsPointer.find((e=>!(0,xa.WL)(e)))){if(n.find((t=>{var i;const n=Xa.C.findSelectableFromStore(t);return(null==n||null===(i=n.props)||void 0===i?void 0:i.groupsPointer)&&e.props.groupsPointer&&!(0,Fa.HH)(n.props.groupsPointer,e.props.groupsPointer)})))return!1}}const h=Boolean(n.find((e=>e.isCollectionView())));if(h&&p.getAncestorCollectionStore()&&t!==tt.vh.Onto&&"bookmarks"!==a)return!1;if(h&&p.isCollectionView()&&t===tt.vh.Onto)return!1;if(h&&p.isCollectionView()&&!p.getRecordStoreUIParent()&&t!==tt.vh.Onto)return!1;if(c&&t!==tt.vh.Onto&&!d&&!(0,wi.M)({environment:this.environment,blocks:[c.props.store],publicEditMode:this.pageContext&&this.pageContext.publicEditModeStore.state}))return!1;if(r&&o)return!1;if("bookmarks"===a&&l&&("bookmarks"!==r||!d||t===tt.vh.Onto))return!1;if("bookmarks"===r&&d&&t!==tt.vh.Onto&&("bookmarks"!==a||!l))return!1;if(s&&s.props.isTopLevelItem&&"team"===s.props.type&&s.props.parentStore&&s.props.parentStore.table===J.e0){const e=s.props.parentStore,t=oe.Z.createChildStore(e,{...e.pointer,table:J.e0});if(t&&!(0,Ga.Hn)({teamStore:t,environment:this.environment}))return!1}if(c&&c.props.isTopLevelItem&&"team"===c.props.type&&c.props.parentStore&&c.props.parentStore.table===J.e0){const e=c.props.parentStore,t=oe.Z.createChildStore(e,{...e.pointer,table:J.e0});if(t&&!(0,Ga.Hn)({teamStore:t,environment:this.environment}))return!1}if("shared"===r&&("shared"!==a||!l)&&t!==tt.vh.Onto)return!1;if(r&&d&&t!==tt.vh.Onto){if(n.find((e=>{const t=e.getType();return Boolean(!t||!_.Z7[t])})))return!1}const{device:f}=this.environment;if(r&&f.isMobile&&t===tt.vh.Onto&&d)return!1;if(n.find((e=>Boolean(e instanceof Lt.Z&&e.isInlineCollectionView())))&&(t===tt.vh.Left||t===tt.vh.Right))return!1;if(n.some((e=>Boolean(Ka.Z.findCollectionTemplatePickerItemFromStore(e))))!==Boolean(Ka.Z.findCollectionTemplatePickerItemFromStore(p)))return!1;if(t===tt.vh.Onto&&p&&!(0,wi.J5)({environment:this.environment,blocks:[p],publicEditMode:this.pageContext&&this.pageContext.publicEditModeStore.state}))return!1;if(!this.memoizedCanDrag(n))return!1;if(n.some((e=>e.isTransclusionType()))){if(p.findRecordStoreUIAncestor((e=>{if(e===p)return!1;const t=e.isTable("block")&&e.isPath([])&&e.getValue();return Boolean(t&&(0,Ui.nq)(t.type))})).ancestor)return!1}return!0}getReferencePointForRect(e,t){return Oa({device:this.environment.device,target:e.target,points:t})}isDraggingSharedPageOutOfTopLevelTeamSection(e){var t;const{draggingOutlinerItem:i,selectableOutlinerItemParent:n,direction:o}=e;if(i&&"team"===i.props.type&&i.props.isTopLevelItem&&(null===(t=i.props.parentStore)||void 0===t?void 0:t.pointer.table)===J.e0){const e=i.props.parentStore;if(!(i.props.store.getParentId()===e.pointer.id||n&&n.pointer.id===e.pointer.id&&o!==tt.vh.Onto))return!0}return!1}}k()(tr,"hoverMaxHorizontalOffset",150),k()(tr,"competingOntoDropZoneVerticalOffset",7),k()(tr,"verticalDropZoneAmbiguousDist",20),k()(tr,"competingHorizontalDropZoneMinDist",2);const ir=tr;var nr=i(74647),or=i(49427),sr=i(7755);class ar extends r.Z{constructor(){super(...arguments),k()(this,"cachedPageViewRect",void 0),k()(this,"previousMousePosition",void 0),k()(this,"mouseSpeed",1/0),k()(this,"timerId",void 0),k()(this,"setPreviousMousePosition",((e,t)=>{this.previousMousePosition={x:e,y:t},clearTimeout(this.timerId),this.timerId=setTimeout((()=>{this.previousMousePosition=void 0}),100)})),k()(this,"handleWindowMouseMove",(e=>{(0,st.ZP)({event:e,context:st.Af.SidebarMouseMove,callback:()=>{if(this.updatePageViewRectThrottled(),void 0!==this.previousMousePosition&&(this.mouseSpeed=Math.sqrt(Math.pow(e.clientX-this.previousMousePosition.x,2)+Math.pow(e.clientY-this.previousMousePosition.y,2))),this.setPreviousMousePosition(e.clientX,e.clientY),this.cachedPageViewRect){const{sidebarMinTriggerWidth:t,sidebarOpenWidthPercent:i}=ar,n=sr.TC.state,o=(0,Z.Wk)(this.environment),s=e.clientX,a=this.cachedPageViewRect.left,r=Math.max(a*i,t,sr.Ic.get());s<r&&!Ja.default.isCenterPeekOpen()&&this.mouseSpeed<ar.mouseSpeedThreshold&&0!==this.mouseSpeed&&!n&&nr.open(),s>o&&s>r&&n&&nr.close()}}})})),k()(this,"handleWindowMouseOut",(e=>{e.toElement||e.relatedTarget||nr.close()})),k()(this,"handleWindowResize",(e=>{this.environment.WindowSizeStore.state.width<nr.OnlyOneSidebarVisibleWidthThreshold&&(0,Z.Sx)(this.environment)&&(0,Z.in)(this.environment)&&nr.setExpand({environment:this.environment,isExpanded:!1})})),k()(this,"updatePageViewRectThrottled",X().throttle(this.updatePageViewRect,500))}didMount(){window.addEventListener("mousemove",this.handleWindowMouseMove),window.addEventListener("mouseout",this.handleWindowMouseOut),window.addEventListener("resize",this.handleWindowResize)}willUnmount(){window.removeEventListener("mousemove",this.handleWindowMouseMove),window.removeEventListener("mouseout",this.handleWindowMouseOut),window.removeEventListener("resize",this.handleWindowResize)}updatePageViewRect(){const e=this.getPageViewWrapEl();this.cachedPageViewRect=e?e.getBoundingClientRect():document.body.getBoundingClientRect()}getPageViewWrapEl(){const{mainEditorCurrentBlockStore:e}=S.default.state,t=or.Z.find((t=>t.props.store===e));if(t){const e=t.getContentWrapEl();if(e)return e}}}k()(ar,"sidebarOpenWidthPercent",.38),k()(ar,"sidebarMinTriggerWidth",18),k()(ar,"mouseSpeedThreshold",5);const rr=ar;var lr=i(13991),dr=i(84084),cr=i(68204),ur=i(10743);class mr extends r.Z{constructor(){super(...arguments),k()(this,"renderMenu",(()=>{const{device:e}=this.environment,t=ur.Z.state;if(!t.open)return;const i=this.getSections(t),n=this.getFilter(t);let s;return s=e.isMobileNative&&!e.isTablet?{menuType:A.o.ActionSheet}:{menuType:A.o.Popup,width:this.getWidth(),maxHeight:"40vh",onClickOutside:dr.xv},a().createElement(U.Z,s,o()(le.Z,{sections:i,onAccept:this.handleAccept,context:{environment:this.environment,blocks:se.default.state.stores,originRect:t.selectionRect,publicEditMode:void 0},filter:n,initialFocus:0,onEmptyEnter:this.handleCancel,useLimit:!0}))})),k()(this,"handleCancel",(()=>{dr.xv()})),k()(this,"handleAccept",(e=>{const t=se.default.state.stores[0];if(t){const i=t.getType(),n=t.getFormat();$.trackBlockAction(this.environment,{analyticsName:e.analyticsName,from:"slash_menu",block_id:t.id,block_type:i,is_toggleable:i?(0,ie._A)(i,n):void 0})}mt.createAndCommit({userAction:"SlashMenu.handleAccept",environment:this.environment,perform:e=>{dr.RL({environment:this.environment,transaction:e})}})}))}willMountOrUpdate(){let e=ur.Z.state;if(e.open){const i=Tt.default.state;if("editing"!==i.mode)return!1;const n=this.getFilter(e),o=(0,cr.sG)({sections:this.getSections(e),context:{blocks:se.default.state.stores,environment:this.environment,publicEditMode:void 0},query:n||""});let s=0;if(n)if(0===o.length)s=n.length-e.lettersAtLastResult;else{var t;const i={...e,lettersAtLastResult:null!==(t=null==n?void 0:n.length)&&void 0!==t?t:0};ur.Z.setState(i),e=i}const{multiSelection:a}=i;(0,bt.qS)(a)&&a.start.store===e.textStore&&!qt.Ye(n,!0,o.length,s,e.textStore)||dr.xv()}}renderComponent(){const{device:e}=this.environment,t=ur.Z.state;return o()(K.ZP,{popupType:e.isMobileNative&&!e.isTablet?K.ZP.PopupType.SlideUp:K.ZP.PopupType.Popup,open:t.open,originRect:t.open?t.selectionRect:void 0,placementToOrigin:K.ZP.Placement.Bottom,alignmentToOrigin:K.ZP.Alignment.Start,originGap:4,disableMouseCapture:!0,disableContentScroll:!0,preventBlockRenderQueueOnEnter:!0,onDismiss:this.handleCancel,render:this.renderMenu})}getFilter(e){return qt.zK(e.textStore,e.oldTextValue,!e.isAddMenu)}getSections(e){const{insertActions:t,slashActions:i}=la.wg.state;return e.isAddMenu?t:i}getWidth(){return"fr-FR"===lr.SP?375:324}}const pr=mr;var gr=i(1310),hr=i(10339),fr=i(84076);class vr extends r.Z{constructor(){super(...arguments),k()(this,"showingAnimatedList",new si.default(!1)),k()(this,"handleShow",(()=>{this.showingAnimatedList.set(!0)})),k()(this,"handleHide",(()=>{this.showingAnimatedList.set(!1)}))}renderComponent(){const{currentItem:e}=gr.Z.state,t=Boolean(e||this.showingAnimatedList.get());return o()(u.Z,{open:t,render:()=>o()(hr.Z,{render:()=>X().compact([this.renderCurrentItem()]),onShow:this.handleShow,onHide:this.handleHide})})}renderCurrentItem(){var e;const{currentItem:t}=gr.Z.state;if(!t)return;const i=null!==(e=null==t?void 0:t.position)&&void 0!==e?e:"bottom",{WindowSizeStore:n,device:s}=this.environment;let a=24;if(s.isMobileNative&&s.isIOS){a=ps.Z.state.estimatedKeyboardWebViewOverlap>0?24+ps.Z.estimatedNativeWebBottomOverlap():n.getSafePaddingBottomCSS(24+ps.Z.estimatedNativeWebBottomOverlap())}const r="top"===i?{top:24}:{bottom:a};return o()(ai.Z,{isVisible:!0,enterAnimationStyle:{translateY:"top"===i?-50:50,opacity:1,scale:1},animationStyle:{translateY:0,opacity:1,scale:1},exitAnimationStyle:{translateY:0,opacity:0,scale:.95},render:()=>o()("div",{style:{...r,position:"fixed",left:0,width:"100%",display:"flex",zIndex:Ke.E}},void 0,o()("div",{style:{background:this.theme.tooltipBackground,color:this.theme.regularInvertedTextColor,borderRadius:3,padding:"6px 12px",boxShadow:this.theme.largeBoxShadow,margin:"0 auto",fontSize:14,display:"flex",alignItems:"center"}},void 0,t.label,t.helpUrl&&o()(fr.Z,{href:t.helpUrl,external:!0,style:{marginLeft:8,width:16,height:16}},void 0,Xt.Z.help({fill:this.theme.mediumInvertedTextColor})),t.button))},t.key)}}const yr=vr;var Sr=i(94507),br=i(61464);function Mr(){const e=(0,Ae.O7)(),{currentSpaceStore:t}=(0,d.Kw)(S.default),i=e.currentUser.id,n=(0,d.VK)((()=>null==t?void 0:t.id),[t]);return(0,s.useEffect)((()=>{if(!n||!i)return;const t=xs.Z.addListener((0,Ps.pD)({userId:i,spaceId:n}),(async(t,o)=>{(function(e){var t;let{spaceId:i,userId:n,emitValue:o}=e;const s=null===(t=br.Z.getUserJoinedTeamsState({userId:n,spaceId:i}))||void 0===t?void 0:t.lastEmitValue;if(s===o)return!1;if(void 0===s&&br.Z.getHasFetched({userId:n,spaceId:i}))return!1;return!0})({spaceId:n,userId:i,emitValue:o})&&await(0,Sr.m)({environment:e,spaceId:n,userId:i,emitValue:o});const s=br.Z.getUserJoinedTeamsState({userId:i,spaceId:n});s&&br.Z.setUserJoinedTeamsState({userId:i,spaceId:n,state:{...s,lastEmitValue:o}})}),void 0,e);return function(){t&&xs.Z.removeListener(t,e)}}),[e,i,n]),null}var wr=i(30397);const Cr=function(){const e=(0,Ae.O7)(),{currentSpaceStore:t,currentUserStore:i}=(0,d.Kw)(S.default),[,n,o]=(0,d.oR)(wr.Z),a=null==i?void 0:i.id;return(0,s.useEffect)((()=>{if(!t||!a)return;const i=xs.Z.addListener((0,Ps.je)(t.id),(async(i,s)=>{if(!o.shouldRefetchTeamsInSpace({currentUserId:a,currentSpaceId:t.id,emitValue:s}))return;const r=await(0,l.qX)({environment:e,spaceStore:t,includeArchived:!1,currentUserId:a});n({teams:r,lastEmitData:{spaceId:t.id,userId:a,value:s}})}),void 0,e);return function(){i&&xs.Z.removeListener(i,e)}}),[t,a,e,n,o]),null};var kr=i(89475),Tr=i(4926),Ir=i(1634),Zr=i(51077);class Pr extends r.Z{constructor(){super(...arguments),k()(this,"handleConnectClick",(async()=>{const e=Ir.Z.state,{currentSpaceStore:t}=S.default.state;e.open&&t&&(await(0,kr.h)({environment:this.environment,integration:e.integration,spaceId:t.id,unfurlUrl:e.unfurlUrl,externalObjectInstanceBlockId:e.externalObjectInstanceBlockId}),this.markPopupAsDismissed(e.integration.id),$.trackConnectExternalIntegration(this.environment,{integrationId:e.integration.id,from:"external_object_instance_inline_popup"}),Ir.Z.reset())})),k()(this,"handleCloseClick",(()=>{const e=Ir.Z.state;e.open&&this.markPopupAsDismissed(e.integration.id),Ir.Z.reset()})),k()(this,"markPopupAsDismissed",(e=>{const{currentUserSettingsStore:t}=S.default.state;t&&(0,mt.createAndCommit)({userAction:"UnfurlingInformationPopup.markPopupAsDismissed",environment:this.environment,perform:i=>{To.GK({transaction:i,userSettingsStore:t,integrationId:e})}})}))}renderComponent(){const e=Ir.Z.state;if(!e.open)return;const t=e.integration.info.icon;return t?o()("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",cursor:"default",padding:16,background:this.theme.popoverBackground,borderRadius:3,boxShadow:this.theme.lightBoxShadow,position:"absolute",bottom:65+Tr.Z.state,right:16+Tr.Z.state,width:240,zIndex:Ke.hT,clipPath:"inset(-10px -10px -10px -10px)"}},void 0,o()(Zr.Z,{type:"image_url",imageURL:t,size:38,style:{marginBottom:6}}),o()("div",{style:{color:this.theme.regularTextColor,fontSize:14,fontWeight:yi.Z.fontWeight.semibold,marginBottom:6,textAlign:"center"}},void 0,o()(x.FormattedMessage,{id:"inlineUnfurlingAuthenticationPopup.title",defaultMessage:"Connect to {integration}",values:{integration:e.integration.name}})),o()("div",{style:{color:this.theme.mediumTextColor,fontSize:12,marginBottom:8,textAlign:"center",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"}},void 0,o()(x.FormattedMessage,{id:"inlineUnfurlingAuthenticationPopup.caption",defaultMessage:"You, and anyone else who has access to this Notion page, will see rich previews that update live.",description:"Displays the first time a user pastes a link that we have a Link Preview integration for."}),o()(Ho.Z,{href:(0,te.UY)("guides.unfurling"),external:!0},void 0,o()(x.FormattedMessage,{id:"inlineUnfurlingAuthenticationPopup.learnMore.text",defaultMessage:"Learn more"}))),o()(xi.Z,{onClick:this.handleConnectClick,style:{width:"100%"}},void 0,o()(x.FormattedMessage,{id:"inlineUnfurlingAuthenticationPopup.connectButton",defaultMessage:"Connect"})),o()(Js.Z,{icon:Xt.Z.close,onClick:this.handleCloseClick,style:{position:"absolute",top:6,right:6}})):void 0}}const _r=(0,x.injectIntl)(Pr);var xr=i(89314),Fr=i(80064);class Ar extends r.Z{constructor(){super(...arguments),k()(this,"menuRef",(0,s.createRef)()),k()(this,"renderMenu",(()=>{const{device:e}=this.environment,t=Fr.Z.state;if(!t.open)return;const{allOptionTypes:i}=t,n={key:"embed section",render:e=>a().createElement(ce.Z,e),items:i.map((e=>({key:e,render:t=>a().createElement(Me.Z,he()({},t,{title:this.renderTitleForOptionType(e),onMouseEnter:i=>{t.onMouseEnter(i),this.updateUnfurlingOptionType(e)}})),action:()=>this.handleDismiss(e)})))};let s;return s=e.isMobile?{menuType:A.o.ActionSheet}:{menuType:A.o.Popup,width:320,maxHeight:"40vh"},a().createElement(U.Z,he()({},s,{className:ye.b_,ref:this.menuRef}),o()(we.Z,{type:we.i.Vertical,sections:[n],initialFocus:0,onKeyboardArrow:this.handleMenuListKeyboardArrow,priority:1}))})),k()(this,"handleDefaultDismiss",(()=>{this.handleDismiss(void 0)})),k()(this,"handleDismiss",(e=>{(0,mt.createAndCommit)({userAction:"UnfurlingMenu.handleDismiss",environment:this.environment,perform:t=>{xr.xv({environment:this.environment,setType:e,transaction:t})}})})),k()(this,"updateUnfurlingOptionType",(e=>{(0,mt.createAndCommit)({userAction:"UnfurlingMenu.handleMenuListKeyboardArrow",environment:this.environment,perform:t=>{xr.hJ({environment:this.environment,type:e,useTemporaryRecordCache:!0,transaction:t,intl:this.props.intl})}})})),k()(this,"handleMenuListKeyboardArrow",(e=>{const t=Fr.Z.state;if(!t.open||void 0===e.indexGlobal)return;const i=t.allOptionTypes[e.indexGlobal];i&&this.updateUnfurlingOptionType(i)})),k()(this,"handleWindowKeydown",(e=>{Fr.Z.state.open&&"ArrowUp"!==e.key&&"ArrowDown"!==e.key&&"Enter"!==e.key&&this.handleDismiss(void 0)})),k()(this,"handleWindowMousedown",(e=>{const t=Fr.Z.state,i=this.menuRef.current;if(!t.open||!e.target||!i)return;const n=Le().findDOMNode(i);n&&(n.contains(e.target)||this.handleDismiss(void 0))}))}willMount(){(0,fn.l)(window,"keydown",this.handleWindowKeydown),(0,fn.l)(window,"mousedown",this.handleWindowMousedown)}willUnmount(){(0,fn.Z)(window,"keydown",this.handleWindowKeydown),(0,fn.Z)(window,"mousedown",this.handleWindowMousedown)}renderComponent(){const{device:e}=this.environment,t=Fr.Z.state;return o()(K.ZP,{popupType:e.isMobileNative&&!e.isTablet?K.ZP.PopupType.SlideUp:K.ZP.PopupType.Popup,open:Boolean(t.open&&t.renderRect),originRect:t.open?t.renderRect:void 0,placementToOrigin:K.ZP.Placement.Top,alignmentToOrigin:K.ZP.Alignment.Start,originGap:4,disableMouseCapture:!0,disableContentScroll:!0,disableDarkOverlayBackground:e.isMobile,keepFocus:e.isMobile,render:this.renderMenu,onDismiss:this.handleDefaultDismiss})}renderTitleForOptionType(e){return"preview"===e?o()(x.FormattedMessage,{id:"unfurlingMenu.actions.pasteAsPreview.title",defaultMessage:"Paste as preview"}):"mention"===e?o()(x.FormattedMessage,{id:"unfurlingMenu.actions.pasteAsMention.title",defaultMessage:"Paste as mention"}):"link"===e?o()(x.FormattedMessage,{id:"unfurlingMenu.actions.pasteAsLink.title",defaultMessage:"Paste as link"}):"collection"===e?o()(x.FormattedMessage,{id:"unfurlingMenu.actions.pasteAsDatabase.title",defaultMessage:"Paste as database"}):void(0,vi.t1)(e)}}const Br=(0,x.injectIntl)(Ar);class Er extends r.Z{willMount(){this.environment.device.isMobile&&document.addEventListener("gesturestart",(function(e){e.preventDefault()}))}renderComponent(){const e=this.environment.currentUser.isLoggedIn(),{isMobile:t,isElectron:i}=this.environment.device,{currentSpaceStore:n}=S.default.state;return o()(s.Fragment,{},void 0,o()(gn,{}),o()(Y,{}),o()(Ge,{}),o()(aa,{}),o()(y,{}),o()(lt,{}),o()(w.Z,{priority:-1,capture:!0}),o()(ir,{}),e&&!t&&o()(rr,{}),e&&n&&o()(Es,{rootStore:n}),e&&((0,l.bq)()||(0,l.XL)())&&o()(Cr,{}),e&&(0,l.bq)()&&o()(Mr,{}),o()(ot,{}),o()(Ts,{}),o()(pe,{}),o()(ia,{}),o()(Ys,{}),o()(pi,{}),o()(Fe,{}),!t&&o()(_a,{}),o()(un,{}),o()(Os,{}),o()(Jo,{}),o()(Ie.Z,{store:b.Z}),o()(Ie.Z,{store:M.Z}),o()(ws,{}),o()(pr,{}),o()(jt,{}),o()(Vt,{}),o()(Br,{}),o()(bn,{}),o()(_r,{}),o()(Te,{}),o()(yr,{}),o()(lo,{}),i&&o()(_t,{}),o()(ft,{}),o()(et,{}),o()(Vs,{}),e&&o()(tn,{}),o()(nn.s,{}))}}const Rr=Er},31140:(e,t,i)=>{i.r(t),i.d(t,{default:()=>dt});var n=i(97464),o=i.n(n),s=i(77094),a=i.n(s),r=i(77422),l=i.n(r),d=(i(33948),i(96486)),c=i.n(d),u=i(67294),m=i.n(u),p=i(73935),g=i.n(p),h=i(83355),f=i(41892),v=i(15070),y=i(53397),S=i(26825),b=i(27006),M=i(21202),w=i(77420),C=i(29369),k=i(19889),T=i(32739),I=i(64684),Z=i(97880),P=i(82990),_=i(5366),x=i(50906),F=i(25186),A=i(47307),B=i(76464),E=i(80456),R=i(95477),D=i(617),L=i(28020),O=i(43250),N=i(4708),U=i(84210),W=i(60709),V=i(86785),z=i(67669),q=i(75472),H=i(33665),G=i(38755),K=i(16639),j=i(21115),Y=i(23537),Q=i(77907),X=i(34859),J=i(27832),$=i(49085);class ee extends $.Z{getInitialState(){return{selectedTab:0}}}const te=ee;var ie=i(88632),ne=i(85834),oe=i(54835),se=i(42330),ae=i(80270),re=i(49065),le=i(20431),de=i(20454),ce=i(78291),ue=i(52878),me=i(12318),pe=i(2771),ge=i(7908),he=i(12793),fe=i(22368),ve=i(1743),ye=i(56940),Se=i(78140),be=i(40721),Me=i(63296),we=i(91941),Ce=i(31278),ke=i(76798),Te=i(18647),Ie=i(58032),Ze=i(70301),Pe=i(64369),_e=i(25383),xe=i(25735),Fe=i(46247),Ae=i(480),Be=i(28350),Ee=i(24405),Re=i(8848),De=i(91376),Le=i(81236);function Oe(e){const{permissionItemWrapStyle:t,safePaddingRightCSS:i,safePaddingLeftCSS:n}=e,[{publicSpaceDataMap:o}]=(0,Be.oR)(Le.Z),s=(0,Ee.F)(),{isMobile:r}=(0,Ae.Fy)(),{canChangeSettings:l,currentSpaceId:d}=(0,Be.VK)((()=>{var e,t;return{canChangeSettings:null===(e=J.default.state.currentSpaceStore)||void 0===e?void 0:e.canAdmin(),currentSpaceId:null===(t=J.default.state.currentSpaceStore)||void 0===t?void 0:t.id}}),[]);if(r)return null;if(!d)return null;const c=o[d];if(!c)return null;return c.domainIsAutogenerated&&l?a()("span",{style:{...t,display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",textAlign:"center",padding:"8px 8px",paddingLeft:n,paddingRight:i,color:s.mediumTextColor,backgroundColor:s.inputBackground}},void 0,a()("div",{style:{display:"flex"}},void 0,a()(Pe.Z,{isSmall:!0,isMobile:!1,isSecondaryColor:!0,style:{paddingRight:"4px"}},void 0,a()(_.FormattedMessage,{defaultMessage:"Set a domain for your public links in",id:"blockPermissionsSettings.learnAboutAutogeneratedDomains.setDomainForPublicLinks"})),a()("span",{style:{cursor:"pointer",userSelect:"none",WebkitUserSelect:"none",color:Re.ZP.inherit},onClick:()=>{De.r({currentTab:"settings"})}},void 0,a()(Pe.Z,{isSmall:!0,isMobile:!1,isSecondaryColor:!1,style:{textDecoration:"underline"}},void 0,a()(_.FormattedMessage,{defaultMessage:"Settings",id:"blockPermissionsSettings.learnAboutAutogeneratedDomains.openSettingsCTA"}))))):null}var Ne=i(21523),Ue=i(23596);function We(e){let{store:t,permissionStore:i,blockTeamPermission:n,isInherited:o,tooltip:s,isSubscribed:r}=e;return a()(Ue.Z,{format:Ue.Z.Format.Workspace,currentBlockStore:t,store:i,permissionItem:n.permissionItem,disabled:!0,icon:y.Z.privateTeam(),title:a()(_.FormattedMessage,{defaultMessage:"Members of a private teamspace",id:"blockPermissionsSettings.permissionItem.teamAccess.privateTeam",description:"All members of a private teamspace"}),tooltip:s,isSubscribed:r,isInherited:o,upgradeButtonName:"team_permission_item",onChange:()=>{}})}var Ve=i(94044),ze=i(42922);class qe extends h.Z{renderComponent(){return a()(ge.Z,{hovered:this.props.hovered,onClick:this.props.onClick,disabled:this.props.disabled,disabledFeedback:!0,style:{...this.getButtonStyle(),...this.props.isLarge&&{height:32},...this.props.style},hoveredStyle:{background:this.theme.buttonHoveredBackground},pressedStyle:{background:this.theme.buttonPressedBackground},onMouseDown:this.props.onMouseDown,onMouseEnter:this.props.onMouseEnter,onMouseLeave:this.props.onMouseLeave,className:this.props.className},void 0,this.props.children)}getButtonStyle(){return{display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,whiteSpace:"nowrap",height:28,borderRadius:3,boxShadow:this.theme.plainButtonBoxShadow,background:this.theme.inputBackground,color:this.theme.mediumTextColor,fill:Re.ZP.white,lineHeight:1.2,paddingLeft:12,paddingRight:12,fontSize:14}}}const He=qe;class Ge extends h.Z{renderComponent(){const{store:e}=this.props;let t,i;const n="on"===oe.default.getEligibleGroup({experimentId:"better_integrations",defaultGroup:"control"});return e.canEditMembership()?t=!0:(t=!1,i=a()(_.FormattedMessage,{id:"inviteUserButton.tooltip.fullAccessOnlyMessage",defaultMessage:"Only those with full access can add people."})),a()(Ie.Z,{renderTooltip:()=>i,disableTooltip:t,render:e=>m().createElement("div",o()({style:{display:"flex",alignItems:"center",gap:Ve.p_}},e),a()(He,{onClick:this.props.onClick,disabled:!t&&!0,style:{flex:1,justifyContent:"flex-start",height:30,overflow:"hidden"}},void 0,a()("div",{style:{textOverflow:"ellipsis",overflow:"hidden"}},void 0,a()(_.FormattedMessage,n?{defaultMessage:"Add emails or people",id:"ContexualInvites.inviteUserModal.searchInput.placeholderWithoutBots",description:"Placeholder text for the search input in the invite user modal"}:{defaultMessage:"Add emails, people, integrations…",id:"ContexualInvites.inviteUserModal.searchInput.placeholder",description:"Placeholder text for the search input in the invite user modal"}))),a()(ze.Z,{isLarge:!0,onClick:this.props.onClick,disabled:!t&&!0,style:{minWidth:Ve.UF}},void 0,a()(_.FormattedMessage,{id:"inviteUserButton.invitePersonLabel",defaultMessage:"Invite"})))})}}const Ke=Ge;var je=i(38363),Ye=i(25464),Qe=i(61519),Xe=i(84076),Je=i(62385);function $e(e){const{showRestoreButton:t,store:i,type:n,confirmationModalStore:o}=e,{isMobile:s}=(0,Ae.Fy)(),r=(0,Be.VK)((()=>V.uJ(i)[1]),[i]),l=(0,Ee.y)((e=>({container:{display:"flex",minHeight:20,marginLeft:-4,flexDirection:s?"column":"row",alignItems:s?"flex-start":"center",paddingTop:s?14:10,paddingBottom:8,paddingLeft:16,paddingRight:12},banner:{display:"flex",flexDirection:"row",width:"100%",fontSize:s?14:12},icon:{width:s?19:16,fill:e.mediumIconColor},iconContainer:{width:20,height:20,display:"flex",justifyContent:"center",alignItems:"center",marginRight:s?11:5,marginLeft:s?5:0},messageContainer:{display:"flex",flexDirection:"column"},label:{display:"inline",marginLeft:s?5:0,marginBottom:s?2:0,color:s?e.regularTextColor:e.lightTextColor,marginRight:6},buttonContainer:{marginLeft:-5},divider:{opacity:"75%"}})),[s]);return s?m().createElement(m().Fragment,null,a()("div",{style:l.container},void 0,a()("div",{style:l.banner},void 0,a()("div",{style:l.iconContainer},void 0,it[n](l.icon)),a()("div",{style:l.messageContainer},void 0,a()(Pe.Z,{isMultiline:!0,isSmall:!0,style:l.label},void 0,a()(tt,{type:n,navigableParentStore:r,showRestoreButton:t})),t&&a()(et,{store:i,type:n,confirmationModalStore:o})))),a()(Qe.Z,{size:1,style:l.divider})):a()("div",{style:l.container},void 0,a()("div",{style:l.banner},void 0,a()("div",{style:l.iconContainer},void 0,it[n](l.icon)),a()("div",{},void 0,a()(Pe.Z,{isMultiline:!0,isSmall:!0,isSecondaryColor:!0,style:l.label},void 0,a()(tt,{type:n,navigableParentStore:r,showRestoreButton:t})),t&&a()("span",{style:l.buttonContainer},void 0,a()(et,{store:i,type:n,confirmationModalStore:o})))))}function et(e){const{type:t,confirmationModalStore:i,store:n}=e,o=(0,Ee.y)((e=>({button:{color:e.regularTextColor,fontWeight:P.Z.fontWeight.medium},tooltip:{width:210,whiteSpace:"initial"}})),[]),s=(0,Ae.O7)();function r(){i.setState({open:!1,onClose:void 0})}if("restore-team"===t){const e=()=>{i.setState({open:!0,onClose:r,type:"restoreTeamPermissions",permissionChanges:[],onAccept:()=>{E.createAndCommit({userAction:"PermissionsRestoreBanner.restoreTeamPermissions",environment:s,perform:e=>{B.Kh({environment:s,store:n,transaction:e})}})}})};return a()(Ie.Z,{style:o.tooltip,placement:Ye.u.Bottom,renderTooltip:()=>a()(_.FormattedMessage,{defaultMessage:"Reset page permissions to match default teamspace permissions",id:"permissionsRestoreBanner.tooltip.teamPermissions",description:"Tooltip for a button explaining that page permissions will be cleared to match teamspace defaults."}),render:t=>m().createElement("span",t,a()(Je.Z,{style:o.button,onClick:e},void 0,a()(_.FormattedMessage,{id:"permissionsRestoreBanner.button.teamPermissions",defaultMessage:"Reset",description:"Action for when user wants to restore permissions to a page."})))})}if("unrestrict"===t){const e=()=>{const e=n.getPermissionItems(),t=V.Om(n),o=t?(0,S.Wo)(V.fJ(t)):[],a=(0,S.Xr)(e,o);i.setState({open:!0,onClose:r,type:"restore",permissionChanges:a,onAccept:()=>{n.getPermissionsStore().canAdmin()?E.createAndCommit({userAction:"PermissionsRestoreBanner.restoreRestrictedPermissions",environment:s,perform:e=>{B.MX({environment:s,store:n,transaction:e})}}):B.hs({environment:s,store:n})}})};return a()(Je.Z,{style:o.button,onClick:e},void 0,a()(_.FormattedMessage,{id:"permissionsRestoreBanner.button.restrictedPermissions",defaultMessage:"Restore",description:"Action for when user wants to restore permissions to a page."}))}(0,Z.t1)(t)}function tt(e){const{type:t,navigableParentStore:i,showRestoreButton:n}=e,{isMobile:o}=(0,Ae.Fy)(),s=(0,Ee.y)((e=>({linkBox:{color:e.mediumTextColor},title:{display:"inline"}})),[]),r=(0,Be.VK)((()=>{if(i instanceof ae.Z)return(0,U.Z)({store:i,fullyQualified:!1})}),[i]);switch(t){case"restore-team":{const e=o;return a()(_.FormattedMessage,{id:"pageShareMenu.restoreTeamPermissionsBanner.label",defaultMessage:"Page access is different from {linkBoxWithPageTitle}.",description:"This text tells the user that this permission setting for the page is not the same as the teamspace default page permissions.",values:{linkBoxWithPageTitle:a()(Xe.Z,{disabled:e,style:e?void 0:s.linkBox,underline:!e,inline:!0,onClick:()=>(0,je.RF)(i.id)},void 0,a()(ke.Z,{style:s.title,shouldWrap:!0,maxLength:o||!n?void 0:30,store:i}))}})}case"unrestrict":{const e=o&&i.table===C.e0;return a()(_.FormattedMessage,{id:"pageShareMenu.restrictedAccessBanner.label",defaultMessage:"Access restricted. May not be shared with everyone from {linkBoxWithPageTitle}.",description:"This text tells the user that this permission setting for the page is NOT inherited from the parent page.",values:{linkBoxWithPageTitle:a()(Xe.Z,{disabled:e,style:e?void 0:s.linkBox,underline:!e,inline:!0,onClick:i.table===C.e0?()=>{i.table===C.e0&&(0,je.RF)(i.id)}:void 0,href:r},void 0,a()(ke.Z,{shouldWrap:!0,maxLength:o||!n?void 0:30,store:i,style:{display:"inline"}}))}})}default:(0,Z.t1)(t)}}const it={unrestrict:y.Z.eyeHide,"restore-team":y.Z.info};var nt=i(53009),ot=i(62512),st=i(93686),at=i(60442);class rt extends h.Z{constructor(){super(...arguments),l()(this,"storeTypes",{restrictConfirmationModalStore:me.default.of({open:!1,onClose:void 0}),blockPermissionsSettingsStore:te,universalMemberInviteStore:ue.Z}),l()(this,"renderInShareMenu",this.createComputedStore((()=>!this.environment.device.isMobile))),l()(this,"contextualInviteMode",this.createComputedStore((()=>this.renderInShareMenu.state?(0,N.qb)(this.environment)?"milestone_2":"milestone_1":"modal"))),l()(this,"renderBotPermissionTooltip",(()=>a()(at.Z,{imageWidth:240,caption:a()(_.FormattedMessage,{defaultMessage:"This is an integration in your workspace.",id:"blockPermissionsSettings.botPermission.tooltip"})}))),l()(this,"renderPublicPermissionTooltip",(()=>a()(at.Z,{imageURL:f.Z.images.tooltips.share.publicPagePng,imageWidth:240,imageHeight:120,caption:a()(_.FormattedMessage,{defaultMessage:"Anybody with the link can access the page.",id:"blockPermissionsSettings.publicPermission.tooltip"})}))),l()(this,"renderSpacePermissionTooltip",(()=>a()(at.Z,{imageURL:f.Z.images.tooltips.share.workspacePng,imageWidth:240,imageHeight:180,caption:a()(_.FormattedMessage,{defaultMessage:"For all members in your workspace, this page will show up in the <boldtext>Workspace</boldtext> section in their sidebar.",values:{boldtext:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return a()("span",{style:{fontWeight:P.Z.fontWeight.bold}},void 0,t)}},id:"blockPermissionsSettings.spacePermission.tooltip"})}))),l()(this,"renderTeamMemberPermissionTooltip",(e=>a()(at.Z,{imageURL:void 0,imageWidth:240,imageHeight:180,caption:a()(_.FormattedMessage,{defaultMessage:"Applies to all owners and non-guest teamspace members of {teamName}.",values:{teamName:e},id:"blockPermissionsSettings.teamPermission.tooltip",description:"A tooltip indicating that this permission item role applies to all owners and teamspace members of the given teamspace."})}))),l()(this,"renderTeamOwnerPermissionTooltip",(e=>a()(at.Z,{imageURL:void 0,imageWidth:240,imageHeight:180,caption:a()(_.FormattedMessage,{defaultMessage:"Applies to all owners of {teamName}.",values:{teamName:e},id:"blockPermissionsSettings.teamOwnerPermission.tooltip",description:"Tooltip indicating how many owners are being granted a specific level of access to a page."})}))),l()(this,"renderGroupPermissionTooltip",(e=>{const t=(0,K.kF)({intl:this.props.intl,group:e});return a()(xe.Y,{group:e,limit:15,noMembersMessage:a()(at.Z,{imageURL:f.Z.images.tooltips.share.sharedPng,imageWidth:240,imageHeight:120,caption:a()(_.FormattedMessage,{defaultMessage:"For all members of the {groupName} group, this page will show up in the <boldtext>Shared</boldtext> section in their sidebar.",values:{boldtext:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return a()("span",{style:{fontWeight:P.Z.fontWeight.bold}},void 0,t)},groupName:t},id:"blockPermissionsSettings.groupPermission.tooltip"})})})})),l()(this,"renderUserPermissionItem",(e=>{const{store:t}=this.props,i=e.from.table===M.iU?ae.Z.createChildStore(t,{table:M.iU,id:e.from.blockId}):le.Z.createChildStore(t,{table:C.e0,id:e.from.teamId}),n=de.Z.createChildStore(t,{table:k.KJ,id:e.permissionItem.user_id}).getValue(),o=i.id!==t.id,s=n?a()(_e.Z,{userValue:n,size:Ue.Z.iconSize}):a()(lt,{style:{height:Ue.Z.iconSize,width:Ue.Z.iconSize,borderRadius:20},theme:this.theme}),{data:r}=ce.default.state,l=(r?j.uF(r):[]).find((t=>t.userId===e.permissionItem.user_id)),d=Boolean(l&&!b.zz(l.role)&&!b.J5(l.role)),c=n&&n.email?d?a()("div",{style:P.Z.textOverflowStyle},void 0,a()(fe.B,{})," • ",n.email):n.email:void 0;return a()("div",{},e.permissionItem.user_id,a()(Ue.Z,{format:Ue.Z.Format.User,currentBlockStore:t,store:i,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:s,title:n?(0,k.Nz)(this.props.intl,n)||a()(_.FormattedMessage,{defaultMessage:"Invitation sent",id:"blockPermissionsSettings.sentInvitation.message"}):a()(lt,{style:{height:8,width:81,borderRadius:3},theme:this.theme}),subtitle:n?c:a()(lt,{style:{height:8,width:139,borderRadius:3,marginTop:10},theme:this.theme}),isSubscribed:this.isSubscribed(),isInherited:o,tooltip:o?this.renderInheritedPermissionTooltip(i):void 0,upgradeButtonName:"user_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,onChange:async t=>{await this.handlePermissionItemChange({isInherited:o,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))})),l()(this,"maybeRenderBotPermissionItem",(e=>{const{store:t}=this.props,{currentUserRootStore:i,currentSpaceStore:n,mainEditorCurrentBlockStore:o}=J.default.state;if(!i||!n||!o)return;const s=e.from.table===M.iU?ae.Z.createChildStore(t,{table:M.iU,id:e.from.blockId}):le.Z.createChildStore(t,{table:C.e0,id:e.from.teamId}),r=(0,re.Kv)(t,{table:w.cZ,id:e.permissionItem.bot_id,spaceId:n.id}),l=r.getValue();if(l&&!l.alive)return;if(l&&(0,v.oA)(l)){if(l.parent_id!==i.id)return;{const t=o.getRole()||"none";if(!(0,S.yY)(t,e.permissionItem.role))return}}const d=s.id!==t.id,c=(null==l?void 0:l.name)||a()(lt,{style:{height:8,width:81,borderRadius:3},theme:this.theme}),u=a()(Ze.Z,{botValue:l,size:Ue.Z.iconSize});return a()("div",{},r.id,a()(Ue.Z,{format:Ue.Z.Format.Workspace,currentBlockStore:t,store:s,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:u,title:c,tooltip:d?this.renderInheritedPermissionTooltip(s):this.renderBotPermissionTooltip(),subtitle:l?a()("div",{style:P.Z.textOverflowStyle},void 0,y.Z.bot({width:12,display:"inline",verticalAlign:"middle",fill:this.theme.mediumIconColor})," ",a()(_.FormattedMessage,{defaultMessage:"Integration",id:"blockPermissionsSettings.permissionsForBot.label",description:"Inform user that this page is shared with a bot."})," · ",(0,v.oA)(l)?a()(_.FormattedMessage,{defaultMessage:"Only visible to you",id:"blockPermissionsSettings.permissionsForBot.personalBot.label"}):a()(_.FormattedMessage,{defaultMessage:"Shared with workspace",id:"blockPermissionsSettings.permissionsForBot.spaceBot.label"})):a()(lt,{style:{height:8,width:139,borderRadius:3,marginTop:10},theme:this.theme}),isSubscribed:this.isSubscribed(),isInherited:d,upgradeButtonName:"bot_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,onChange:async t=>{await this.handlePermissionItemChange({isInherited:d,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))})),l()(this,"handleCopy",(()=>{const e=(0,U.Z)({store:this.props.store});F.RD({environment:this.environment,stringValue:e,copiedMessage:F.tq.copiedLinkToClipboard}),this.props.buttonPopupStore.setState({open:!1})})),l()(this,"handleMoveTo",(()=>{const e=g().findDOMNode(this);se.Z.setState({isOpen:!0,rect:null==e?void 0:e.getBoundingClientRect(),targets:J.default.state.mainEditorCurrentBlockStore?[J.default.state.mainEditorCurrentBlockStore]:[],autocompleteQuery:"",moveToContext:"permission_settings",isAddTo:!1,lastPageId:se.Z.state.lastPageId,needsConfirmation:!1}),this.props.buttonPopupStore.setState({open:!1})})),l()(this,"handleMobileNativeShareClick",(()=>{const{mobileNative:e}=this.environment,t=T.u5({schemeUrl:window.location.href,baseUrl:R.Z.domainBaseUrl});e&&e.share(t)})),l()(this,"handleCloseRestrictConfirmationModal",(()=>{this.stores.restrictConfirmationModalStore.setState({open:!1,onClose:void 0})})),l()(this,"handlePermissionItemChange",(async e=>{const{isInherited:t,oldPermissionItem:i,newPermissionItem:n}=e;if(!(0,S.Kf)(i,n))throw new Error("Permission type mismatch.");const o=(0,S.nl)(i.role,n.role);if(t&&o!==n.role)return void this.handleRestrictPermission(n);const s=this.props.store.isTopLevel();if(s&&b.ix(n)){const{data:e}=ce.default.state,t=e?j.su(e):1;if(!(0,Y.bq)()&&b.YX(i.role)&&!b.YX(n.role)&&t>1){if(!(await A.confirmUserAction({message:a()("span",{},void 0,a()(_.FormattedMessage,{defaultMessage:"Are you sure you want to make this page private? <semibold>Only you will be able to access it.</semibold>",values:{semibold:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return a()("span",{style:{fontWeight:P.Z.fontWeight.semibold}},void 0,t)}},id:"blockPermissionsSettings.confirmationDialog.private.message"})),acceptLabel:a()(_.FormattedMessage,{defaultMessage:"Move to Private",id:"blockPermissionsSettings.confirmationDialog.privateButton.label"})})))return}else if(!(0,Y.bq)()&&s&&!b.YX(i.role)&&b.YX(n.role)){if(!(await A.confirmUserAction({message:a()("span",{},void 0,a()(_.FormattedMessage,{defaultMessage:"Are you sure you want to share this page with the workspace? <semibold>It will be accessible by all {memberCount} members.</semibold>",id:"blockPermissionsSettings.confirmationDialog.workspace.message",values:{semibold:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return a()("span",{style:{fontWeight:P.Z.fontWeight.semibold}},void 0,t)},memberCount:t}})),acceptLabel:a()(_.FormattedMessage,{defaultMessage:"Move to workspace",id:"blockPermissionsSettings.confirmationDialog.workspaceButton.label"})})))return}}!s&&i.role!==n.role&&o!==i.role&&x.trackWidenPermission(this.environment),E.createAndCommit({userAction:"BlockPermissionsSettings.handlePermissionItemChange",environment:this.environment,perform:e=>{B.ep({environment:this.environment,store:this.props.store,permissionItems:[n],transaction:e})}})})),l()(this,"handleRestrictPermission",(e=>{const t=()=>{E.createAndCommit({userAction:"BlockPermissionsSettings.onAccept",environment:this.environment,perform:t=>{B.Pk({environment:this.environment,store:this.props.store,permissionItem:e,shouldInherit:!0,transaction:t})}})};"none"===e.role?this.stores.restrictConfirmationModalStore.setState({open:!0,onClose:this.handleCloseRestrictConfirmationModal,type:"remove",permissionItem:e,onAccept:t}):this.stores.restrictConfirmationModalStore.setState({open:!0,onClose:this.handleCloseRestrictConfirmationModal,type:"restrict",onAccept:t})})),l()(this,"handleInviteGuestButtonClick",(()=>{const{permissionsInviteStore:e,contextualInviteStore:t}=this.stores.universalMemberInviteStore.state,i=this.renderInShareMenu.state,n={environment:this.environment,permissionsInviteStore:e,store:this.props.store,isSubscribed:this.isSubscribed()};i?((0,q.z5)({...n,renderInShareModal:!0}),t.setState({...t.state,inviteStage:ne.TG.share_page,flowId:e.state.flowId})):(0,q.z5)({...n,renderInShareModal:!1})}))}renderComponent(){const{device:e}=this.environment;let t;return t=e.isMobile?{menuType:W.o.Modal,title:a()(_.FormattedMessage,{defaultMessage:"Share",id:"blockPermissionsSettings.mobileShareMenu.title"}),left:this.renderMobileHelpButton(),right:a()(be.DoneMenuText,{}),onClickRight:this.props.onClose}:{menuType:W.o.Popup,maxHeight:"90vh"},m().createElement(m().Fragment,null,m().createElement(nt.Z,this.stores.restrictConfirmationModalStore.state),m().createElement(Se.Z,o()({},t,{className:O.B8}),a()(ve.Z,{capture:!0,allowEsc:!0},void 0,a()(ye.Z,{capture:!0,ignoreBlockSelection:!0,restoreSelection:!1,focusOffscreenInput:!1,render:()=>{if(!ie.Z.state.online)return this.renderOfflineMessage();const e=this.getSpaceStore();return e&&this.stores.universalMemberInviteStore.stage!==ne.TG.closed?this.renderPermissionsInviteInShareModal(e):this.renderPermissions()}}))))}renderMobileHelpButton(){return a()(Fe.Z,{href:(0,H.UY)("guides.sharing"),analyticsFrom:"sharing"})}renderOfflineMessage(){const{device:e}=this.environment;return a()("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",height:160}},void 0,a()(Pe.Z,{isMobile:e.isMobile,isSecondaryColor:!0,isMultiline:!0,style:{textAlign:"center"}},void 0,a()(_.FormattedMessage,{defaultMessage:"Please go online to publish & share.",id:"blockPermissionsSettings.offline.prompt"})))}renderPermissions(){const{device:e,WindowSizeStore:t}=this.environment,{currentSpaceStore:i}=J.default.state,n="on"===oe.default.getEligibleGroup({experimentId:"better_integrations",defaultGroup:"control"}),o=this.getInnerPermissionUIModel({currentSpaceStore:i,currentBlockStore:this.props.store,isBetterIntegrationsEnabled:n}),{showRestrictedPermissionBanner:s,mostPermissivePublicItem:r,permissionItemsCount:l}=o,d=this.shouldShowPublicPermissionItem(),c={};let m=X.Z.Y;if(e.isMobile)c.backgroundColor=this.theme.contentBackground,m=X.Z.None;else switch(c.maxHeight="calc(90vh - 370px)",l){case 0:break;case 1:c.minHeight=60;break;default:c.minHeight=90}return a()("div",{style:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column"}},void 0,e.isMobile&&a()(u.Fragment,{},void 0,this.renderContentOnlyEditorEducationPill(),s?this.renderRestrictedPermissionBanner():this.maybeRenderRestoreTeamPermissionsBanner(),a()("div",{style:{display:"flex",paddingTop:8,paddingBottom:8,paddingRight:t.getSafePaddingRightCSS(14),background:this.theme.sidebarBackground}},void 0,this.renderPageLinkButton()),a()("div",{style:{borderBottom:"1px solid ".concat(this.theme.regularDividerColor)}})),this.renderInShareMenu.state&&this.renderAddGuests(),a()(Te.Z,{style:c,type:m},void 0,!e.isMobile&&this.renderContentOnlyEditorEducationPill(),!e.isMobile&&(s?this.renderRestrictedPermissionBanner():this.maybeRenderRestoreTeamPermissionsBanner()),this.renderVariousPermissions(o)),!e.isMobile&&this.renderShareToWeb(d,r,!e.isMobile),this.renderFooter())}renderInviteButton(){const{store:e}=this.props,{modalOpen:t}=this.stores.universalMemberInviteStore.state.permissionsInviteStore.state;return m().createElement(m().Fragment,null,t&&this.renderPermissionsInviteModal(),a()(Ke,{store:e,onClick:()=>{this.handleInviteGuestButtonClick()}}))}renderPageLinkButton(){const{device:e}=this.environment;return a()(Ie.Z,{delayThreshold:0,placement:Ie.Z.Placement.Bottom,renderTooltip:()=>this.getPageLinkInfoTooltip(),render:t=>m().createElement(Me.Z,o()({isLarge:!0,onClick:e.isMobileNative?this.handleMobileNativeShareClick:this.handleCopy,style:{marginLeft:12,flex:1,height:this.environment.device.isMobile?36:void 0,background:this.theme.contentBackground}},t),e.isMobileNative?a()(_.FormattedMessage,{id:"pageShareMenu.sharePageLinkButton.label",defaultMessage:"Share page link"}):a()(_.FormattedMessage,{id:"pageShareMenu.copyPageLinkButton.label",defaultMessage:"Copy page link"}))})}renderVariousPermissions(e){let{showPublicPermission:t,showTeamPermission:i,showSpacePermission:n,showUserPermissions:o,mostPermissivePublicItem:s,mostPermissiveTeamOwnerItem:r,mostPermissiveTeamMemberItem:l,mostPermissiveSpaceItem:d,mostPermissiveGroupPermissions:c,mostPermissiveTeamPermissions:m,mostPermissiveUserPermissions:p,mostPermissiveBotPermissions:g,permissionItemsCount:h,spacePermissionGroups:f}=e;const{device:v}=this.environment,y="on"===oe.default.getEligibleGroup({experimentId:"better_integrations",defaultGroup:"control"});return a()(u.Fragment,{},void 0,v.isMobile&&this.renderShareToWeb(t,s,v.isMobile),!this.renderInShareMenu.state&&this.renderAddGuests(),i&&r&&this.renderTeamOwnerPermissionItem(r),i&&l&&this.renderTeamMemberPermissionItem(l),n&&this.renderSpacePermissionItem(d),a()("div",{style:{...this.getPermissionItemWrapStyle(),paddingBottom:h>0?8:void 0}},void 0,this.renderGroupPermissions({spacePermissionGroups:f,mostPermissiveGroupPermissions:c}),this.renderTeamPermissions({mostPermissiveTeamPermissions:m}),o&&a()("div",{},void 0,p.map(this.renderUserPermissionItem)),!y&&g.map(this.maybeRenderBotPermissionItem).filter(Z.$K)))}getMostPermissiveTeamMemberItem(e){let{mostPermissivePermissions:t,store:i,teamId:n}=e;if(!n)return;const o=t.find((e=>{let{permissionItem:t}=e;return(0,I.J2)(t,n)}));return o||{permissionItem:{type:"explicit_team_permission",role:"none",team_id:n},from:{table:M.iU,blockId:i.id}}}getMostPermissiveTeamOwnerItem(e){let{mostPermissivePermissions:t,store:i,teamId:n}=e;if(!n)return;const o=t.find((e=>{let{permissionItem:t}=e;return(0,I.jc)(t,n)}));return o||{permissionItem:{type:"explicit_team_owner_permission",role:"none",team_id:n},from:{table:M.iU,blockId:i.id}}}getMostPermissiveSpaceItem(e){let{mostPermissivePermissions:t,store:i,teamStore:n}=e;const o=t.find((e=>{let{permissionItem:t}=e;return b.ix(t)}));return o||{permissionItem:{type:"space_permission",role:"none"},from:n&&"none"===n.getSpacePermissionRole()?{table:C.e0,teamId:n.id}:{table:M.iU,blockId:i.id}}}getMostPermissivePublicItem(e){let{mostPermissivePermissions:t,store:i}=e;const n=t.find((e=>{let{permissionItem:t}=e;return b.$D(t)}));return n||{permissionItem:{type:"public_permission",role:"none"},from:{table:M.iU,blockId:i.id}}}maybeRenderRestoreTeamPermissionsBanner(){const{store:e}=this.props;if(e.isTopLevelTeamPage()&&e.canAdmin()&&e.getPermissionItems().filter((e=>!b.FB(e))).length>0)return a()($e,{type:"restore-team",showRestoreButton:!0,store:e,confirmationModalStore:this.stores.restrictConfirmationModalStore})}renderRestrictedPermissionBanner(){const{store:e}=this.props,t=V.uJ(e)[1],i=D.or([D.zz,D.xD([D.c2,D.ff(D.zz)])])({environment:this.environment,blocks:[e],publicEditMode:void 0});if(t&&t.canRead()){const n=t instanceof le.Z?t.hasFullAccess():i;return a()($e,{type:"unrestrict",showRestoreButton:n,store:e,confirmationModalStore:this.stores.restrictConfirmationModalStore})}}renderShareToWeb(e,t,i){return i?a()("div",{},void 0,e&&this.renderPublicPermissionItem({publicPermission:t,shadowBottom:!0}),this.renderAutogeneratedDomainCTA({publicPermissionRole:t.permissionItem.role,shadowBottom:!0})):a()("div",{},void 0,this.renderAutogeneratedDomainCTA({publicPermissionRole:t.permissionItem.role,shadowBottom:!1}),e&&this.renderPublicPermissionItem({publicPermission:t,shadowBottom:!1}))}renderAutogeneratedDomainCTA(e){const{publicPermissionRole:t,shadowBottom:i}=e;if("none"===t)return;const{WindowSizeStore:n}=this.environment;return a()(Oe,{permissionItemWrapStyle:this.getPermissionItemWrapStyle(i),safePaddingLeftCSS:n.getSafePaddingLeftCSS(8),safePaddingRightCSS:n.getSafePaddingRightCSS(8)})}renderPublicPermissionItem(e){const{store:t}=this.props,{publicPermission:i,shadowBottom:n}=e,o=i.from.table===M.iU?ae.Z.createChildStore(t,{table:M.iU,id:i.from.blockId}):le.Z.createChildStore(t,{table:C.e0,id:i.from.teamId}),s=o.id!==t.id;return a()("div",{style:this.getPermissionItemWrapStyle(n),className:O.a8},void 0,a()(Ue.Z,{format:Ue.Z.Format.Web,currentBlockStore:t,store:o,permissionItem:i.permissionItem,disabled:!this.canEdit(),icon:y.Z.globe({width:26,height:26,fill:this.theme.lightIconColor}),title:a()(_.FormattedMessage,{defaultMessage:"Share to web",id:"blockPermissionsSettings.permissionItem.linkSharing"}),subtitle:b.J5(i.permissionItem.role)?a()(_.FormattedMessage,{defaultMessage:"Anyone with the link can edit and comment",id:"blockPermissionsSettings.publicPermission.canEdit"}):b.RF(i.permissionItem.role)?a()(_.FormattedMessage,{defaultMessage:"Anyone with the link can comment",id:"blockPermissionsSettings.publicPermission.canComment"}):b.YX(i.permissionItem.role)?a()(_.FormattedMessage,{defaultMessage:"Anyone with the link can view",id:"blockPermissionsSettings.publicPermission.canRead"}):a()(_.FormattedMessage,{defaultMessage:"Publish and share link with anyone",id:"blockPermissionsSettings.publicPermission.none"}),tooltip:s?this.renderInheritedPermissionTooltip(o):this.renderPublicPermissionTooltip(),isSubscribed:this.isSubscribed(),isInherited:s,upgradeButtonName:"public_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,switcherRole:"reader",onChange:async e=>{await this.handlePermissionItemChange({isInherited:s,oldPermissionItem:i.permissionItem,newPermissionItem:e})}}))}renderSpacePermissionItem(e){const{store:t}=this.props,i=e.from.table===M.iU?ae.Z.createChildStore(t,{table:M.iU,id:e.from.blockId}):le.Z.createChildStore(t,{table:C.e0,id:e.from.teamId}),n=this.getSpaceStore();if(null==n||!n.isDefined())return;const o=(0,G.getSpacePermissionItems)(n).filter((e=>b.J5(b.cY(e)))),s=i.id!==t.id;return a()("div",{style:{width:"100%"},className:O.af},void 0,a()(Ue.Z,{format:Ue.Z.Format.Workspace,currentBlockStore:t,store:i,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:this.renderSpaceIcon(),title:a()(_.FormattedMessage,{defaultMessage:"Everyone at {workspaceName}",id:"blockPermissionsSettings.permissionItem.workspaceAccessNew",values:{workspaceName:(0,G.getSpaceName)(this.environment,n)}}),tooltip:s?this.renderInheritedPermissionTooltip(i):!(0,Y.bq)()&&this.renderSpacePermissionTooltip(),subtitle:a()(_.FormattedMessage,{defaultMessage:"{numberOfWorkspaceMembers, plural, one {{numberOfWorkspaceMembers} person} other {{numberOfWorkspaceMembers} people}}",id:"blockPermissionsSettings.spacePermission.none",values:{numberOfWorkspaceMembers:o.length}}),isSubscribed:this.isSubscribed(),isInherited:s,upgradeButtonName:"space_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,onChange:async t=>{await this.handlePermissionItemChange({isInherited:s,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))}renderTeamMemberPermissionItem(e){var t,i;const{store:n}=this.props,{permissionItem:o}=e,s=e.from.table===M.iU?ae.Z.createChildStore(n,{table:M.iU,id:e.from.blockId}):le.Z.createChildStore(n,{table:C.e0,id:e.from.teamId}),r=this.getSpaceStore(),l=b.zU(o)?o.team_id:null===(t=V.VP(n))||void 0===t?void 0:t.id;if(!l||!r)return;const d=le.Z.createChildStore(r,{table:C.e0,id:l,spaceId:r.id});if(!r.isDefined())return;const c=s.id!==n.id;if(!d.isDefined())return a()("div",{style:{width:"100%"},className:O.YH},void 0,a()(We,{store:n,permissionStore:s,blockTeamPermission:e,tooltip:c&&this.renderInheritedPermissionTooltip(s),isSubscribed:this.isSubscribed(),isInherited:c}));const u=d.getMembers(),m=(0,I.Xk)({teamMembers:u,spaceGroups:r.getPermissionGroups()}).length,p=null!==(i=d.getName())&&void 0!==i?i:"";return a()("div",{style:{width:"100%"},className:O.YH},void 0,a()(Ue.Z,{format:Ue.Z.Format.Workspace,currentBlockStore:n,store:s,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:this.renderTeamIcon(d),title:a()(_.FormattedMessage,{defaultMessage:"Members of {teamName}",id:"blockPermissionsSettings.permissionItem.teamAccess",description:"All teamspace members of the given teamspace name",values:{teamName:p}}),tooltip:c?this.renderInheritedPermissionTooltip(s):this.renderTeamMemberPermissionTooltip(p),subtitle:a()(_.FormattedMessage,{defaultMessage:"{membersCount, plural, one {{membersCount} person} other {{membersCount} people}}",id:"blockPermissionsSettings.teamPermission.subtitle",description:"A sub-title indicating the number of members in the teamspace.",values:{membersCount:m}}),isSubscribed:this.isSubscribed(),isInherited:c,upgradeButtonName:"team_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,onChange:async t=>{await this.handlePermissionItemChange({isInherited:c,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))}renderTeamOwnerPermissionItem(e){var t,i;const{store:n}=this.props,{permissionItem:o}=e,s=e.from.table===M.iU?ae.Z.createChildStore(n,{table:M.iU,id:e.from.blockId}):le.Z.createChildStore(n,{table:C.e0,id:e.from.teamId}),r=this.getSpaceStore(),l=b.LW(o)?o.team_id:null===(t=V.VP(n))||void 0===t?void 0:t.id;if(!l||!r)return;const d=le.Z.createChildStore(r,{table:C.e0,id:l,spaceId:r.id}),c=(0,I.XO)({membership:d.getMembers()}),u=c.length,m=c.map((e=>de.Z.createChildStore(n,{table:k.KJ,id:e}))),p=s.id!==n.id,g=null!==(i=d.getName())&&void 0!==i?i:"";return a()("div",{style:{width:"100%"},className:O.Zm},void 0,a()(Ue.Z,{format:Ue.Z.Format.Workspace,currentBlockStore:n,store:s,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:a()(ot.n,{teamStore:d,ownerStores:m}),title:a()(_.FormattedMessage,{defaultMessage:"Owners of {teamName}",id:"blockPermissionsSettings.permissionItem.teamOwnerAccess",description:"The title for a permission item that defines the access given to all owners of a team",values:{teamName:g}}),tooltip:p?this.renderInheritedPermissionTooltip(s):this.renderTeamOwnerPermissionTooltip(g),subtitle:a()(_.FormattedMessage,{defaultMessage:"{teamOwnersCount, plural, one {{teamOwnersCount} person} other {{teamOwnersCount} people}}",id:"blockPermissionsSettings.teamOwnerPermission.subtitle",description:"The sub-title for a permission item that defines the access given to all owners of a teamspace",values:{teamOwnersCount:u}}),isSubscribed:this.isSubscribed(),isInherited:p,upgradeButtonName:"team_owner_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,onChange:async t=>{await this.handlePermissionItemChange({isInherited:p,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))}renderInheritedPermissionTooltip(e){const t=e.getIcon();return a()("div",{style:{whiteSpace:"normal",width:180}},void 0,a()(_.FormattedMessage,{defaultMessage:"This access is based on {inlineIconAndName}. Changing this access will restrict permissions of this page.",id:"blockPermissionsSettings.restrictedPermissions.tooltip",values:{inlineIconAndName:a()("span",{style:{whiteSpace:"nowrap",fontWeight:P.Z.fontWeight.bold}},void 0,t&&a()(Ce.Z,{disabled:!0,icon:t,isEmptyPage:!1,size:12,style:{marginRight:4,display:"inline-block",verticalAlign:"middle"}}),a()(ke.Z,{store:e,style:{display:"inline"}}))}}))}renderSpaceIcon(){const{currentSpaceStore:e}=J.default.state;return e?a()(st.p,{disabled:!0,store:e,size:Ue.Z.iconSize}):y.Z.team()}renderTeamIcon(e){return a()(st.p,{disabled:!0,store:e,size:Ue.Z.iconSize})}renderTeamPermissions(e){const{mostPermissiveTeamPermissions:t}=e;return t.map((e=>b.LW(e.permissionItem)?this.renderTeamOwnerPermissionItem(e):this.renderTeamMemberPermissionItem(e)))}renderGroupPermissions(e){const{currentSpaceStore:t}=J.default.state,{spacePermissionGroups:i,mostPermissiveGroupPermissions:n}=e;return n.map((e=>{const n=e.permissionItem.group_id,o=i.find((e=>e.id===n));if(o&&t)return this.renderGroupPermissionItem(e,o,t.id)}))}renderGroupPermissionItem(e,t,i){const{store:n,intl:o}=this.props,s=e.from.table===M.iU?ae.Z.createChildStore(n,{table:M.iU,id:e.from.blockId}):le.Z.createChildStore(n,{table:C.e0,id:e.from.teamId}),r=t.user_ids||[],l=(0,K.kF)({intl:o,group:t}),d=s.id!==n.id,c=t.icon&&a()(Ce.Z,{disabled:!0,title:l,icon:t.icon?{pointer:{table:"space",id:i},icon:t.icon}:void 0,isEmptyPage:!1,size:18});return a()("div",{style:{fontWeight:400},className:O.gG},t.id,a()(Ue.Z,{format:Ue.Z.Format.Workspace,currentBlockStore:n,store:s,permissionItem:e.permissionItem,disabled:!this.canEdit(),icon:a()(he.Z,{size:Ue.Z.iconSize}),title:l,tag:c,tooltip:d?this.renderInheritedPermissionTooltip(s):this.renderGroupPermissionTooltip(t),subtitle:a()("div",{},void 0,a()(_.FormattedMessage,{defaultMessage:"Group",id:"blockPermissionsSettings.groupPermission.label",description:"Indicates a group of members"})," · ",a()(_.FormattedMessage,{defaultMessage:"{numberOfGroupMembers, plural, one {{numberOfGroupMembers} person} other {{numberOfGroupMembers} people}}",id:"blockPermissionsSettings.groupPermission.none",values:{numberOfGroupMembers:r.length}})),isSubscribed:this.isSubscribed(),isInherited:d,upgradeButtonName:"group_permission_item",onUpgradeButtonClick:this.props.onUpgradeButtonClick,onChange:async t=>{await this.handlePermissionItemChange({isInherited:d,oldPermissionItem:e.permissionItem,newPermissionItem:t})}}))}renderAddGuests(){const{device:e,WindowSizeStore:t}=this.environment;return a()(ge.Z,{mobileFeedback:e.isMobile,disabled:!0},void 0,a()("div",{style:{...this.getMenuItemStyle(),paddingTop:e.isMobile?12:10,paddingBottom:e.isMobile?12:10,paddingLeft:t.getSafePaddingLeftCSS(14),paddingRight:t.getSafePaddingRightCSS(14)}},void 0,a()("div",{style:{width:"100%"}},void 0,this.renderInviteButton())))}renderContentOnlyEditorEducationPill(){const{store:e}=this.props,t=e.getRole();if(t&&b.WY(t))return a()(pe.V,{userSettingsStore:void 0,style:{margin:void 0,borderRadius:void 0}})}renderPermissionsInviteInShareModal(e){if(!this.renderInShareMenu.state)return null;const t=this.contextualInviteMode.state;if("modal"===t)return null;const{device:i}=this.environment,{store:n}=this.props,o=V.VP(n);return a()(Q.LazyUniversalMemberInvite,{universalInviteStore:this.stores.universalMemberInviteStore,mode:t,spaceStore:e,store:n,disabled:!this.canEdit(),membersOnly:Boolean(!o&&(null==e?void 0:e.getDisableGuests())||o&&o.getDisableGuests()),isSubscribed:this.isSubscribed(),onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:"invite_permission_block",shouldGrow:!0,buttonStyle:{height:i.isMobile?36:28}})}renderPermissionsInviteModal(){const{currentSpaceStore:e}=J.default.state,{device:t}=this.environment,{store:i}=this.props,n=V.VP(i);return a()(Q.LazyPermissionsInviteWithModal,{store:i,disabled:!this.canEdit(),membersOnly:Boolean(!n&&(null==e?void 0:e.getDisableGuests())||n&&n.getDisableGuests()),isSubscribed:this.isSubscribed(),onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:"invite_permission_block",shouldGrow:!0,buttonStyle:{height:t.isMobile?36:28},permissionsInviteStore:this.stores.universalMemberInviteStore.state.permissionsInviteStore})}getPermissionItemWrapStyle(){return{boxShadow:arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"0 -1px 0 ".concat(this.theme.regularDividerColor):"0 1px 0 ".concat(this.theme.regularDividerColor),width:"100%"}}getMenuItemStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",alignItems:"center",minHeight:52,paddingTop:8,paddingBottom:8,paddingLeft:e.getSafePaddingLeftCSS(16),paddingRight:e.getSafePaddingRightCSS(12)}}renderFooter(){const{device:e,WindowSizeStore:t}=this.environment,{store:i}=this.props,n={environment:this.environment,blocks:[i],publicEditMode:void 0},s=D.xD([D._z,D.zz,D.KE,D.Gg,D.jl,D.ff(D.uZ),D.ff(D.xw)])(n);return a()("div",{style:{display:"flex",alignItems:e.isMobile?"flex-start":"center",boxShadow:"0 -1px 0 ".concat(this.theme.regularDividerColor),paddingLeft:t.getSafePaddingRightCSS(8),paddingRight:t.getSafePaddingRightCSS(8),flexDirection:"column-reverse",...!e.isMobile&&{flexDirection:"row",justifyContent:"space-between",padding:"4px 4px"}}},void 0,!e.isMobile&&a()(u.Fragment,{},void 0,a()(Ne.Z,{}),a()("div",{},void 0,(0,Y.bq)()&&s&&a()(we.Z,{isSmall:!0,onClick:this.handleMoveTo,mobileFeedback:e.isMobile,style:{height:24,paddingRight:8,color:this.theme.regularTextColor,marginRight:0}},void 0,y.Z.moveTo({width:14,height:14,fill:this.theme.regularIconColor,marginLeft:0,marginRight:6}),a()(Pe.Z,{isSmall:!0,isMobile:e.isMobile,style:{color:this.theme.regularTextColor}},void 0,a()(_.FormattedMessage,{id:"blockPermissionsSettings.moveToButton.label",defaultMessage:"Move to"}))),a()(Ie.Z,{delayThreshold:0,placement:Ie.Z.Placement.Bottom,renderTooltip:()=>this.getPageLinkInfoTooltip(),render:t=>m().createElement(we.Z,o()({isSmall:!0,onClick:()=>{e.isMobileNative?this.handleMobileNativeShareClick():this.handleCopy(),x.trackCopyLinkFromPermissionsSetting(this.environment)},mobileFeedback:e.isMobile,style:{height:e.isMobile?44:24,width:e.isMobile?"100%":void 0,paddingLeft:8,paddingRight:8,color:this.theme.regularTextColor}},t),y.Z.link({width:e.isMobile?16:14,height:e.isMobile?16:14,fill:this.theme.regularIconColor,marginLeft:e.isMobile?2:0,marginRight:e.isMobile?8:6}),a()(Pe.Z,{isSmall:!0,isMobile:e.isMobile,style:{color:this.theme.regularTextColor}},void 0,a()(_.FormattedMessage,{id:"blockPermissionsSettings.copyLinkButton.label",defaultMessage:"Copy link"})))}))))}getSpaceStore(){return V.Pj(this.props.store)||J.default.state.currentSpaceStore}isSubscribed(){const{data:e}=ce.default.state;return Boolean(e&&j.YK(e))}canEdit(){return b.zz(this.props.store.getRole()||"editor")}shouldShowPublicPermissionItem(){const{currentSpaceStore:e}=J.default.state,t=V.VP(this.props.store);return Boolean(t&&!t.getDisablePublicAccess()||!t&&!(null!=e&&e.getDisablePublicAccess()))}getPageLinkInfoTooltip(){const e=(0,z.YO)(this.props.store).map((e=>{let{permissionItem:t}=e;return t})),t=e.find((e=>"public_permission"===e.type)),i=e.find((e=>"space_permission"===e.type)),n=e.filter((e=>"user_permission"===e.type)),o=e.filter((e=>"group_permission"===e.type||"team_permission"===e.type||"team_owner_permission"===e.type||"explicit_team_permission"===e.type||"explicit_team_owner_permission"===e.type));return t?a()("div",{},void 0,a()(_.FormattedMessage,{defaultMessage:"This page has public link access, so anyone{br}with the link will be able to view the page.",id:"blockPermissionsSettings.publicLinkInfo.tooltip",values:{br:a()("br",{})}})):i?a()("div",{},void 0,a()(_.FormattedMessage,{defaultMessage:"This page has workspace access, so anyone{br}in the workspace will be able to view the link.",id:"blockPermissionsSettings.workspacePermissions.tooltip",values:{br:a()("br",{})}})):n.length>1||o.length>0?a()("div",{},void 0,a()(_.FormattedMessage,{defaultMessage:"Only you and other invited members{br}and guests will be able to view the link.",id:"blockPermissionsSettings.userPermissions.tooltip",values:{br:a()("br",{})}})):a()("div",{},void 0,a()(_.FormattedMessage,{defaultMessage:"Only you can access this page,{br}so the link will only work for you.",id:"blockPermissionsSettings.privatePermissions.tooltip",values:{br:a()("br",{})}}))}getInnerPermissionUIModel(e){let{currentSpaceStore:t,currentBlockStore:i,isBetterIntegrationsEnabled:n}=e;const o=(0,z.YO)(i);let s=[];if(t){const e=t.getValue();e&&e.permission_groups&&(s=e.permission_groups)}const a=V.VP(i),r=this.getMostPermissivePublicItem({mostPermissivePermissions:o,store:i}),l=this.getMostPermissiveSpaceItem({mostPermissivePermissions:o,store:i,teamStore:a}),d=this.getMostPermissiveTeamMemberItem({mostPermissivePermissions:o,store:i,teamId:null==a?void 0:a.id}),u=this.getMostPermissiveTeamOwnerItem({mostPermissivePermissions:o,store:i,teamId:null==a?void 0:a.id});let m=o.filter((e=>{let{permissionItem:t}=e;return b.hV(t)}));m=c().sortBy(m,(e=>{if(t){const i=t.getValue();if(i&&i.permission_groups)return i.permission_groups.findIndex((t=>t.id===e.permissionItem.group_id))}return e.permissionItem.group_id}));let p=o.filter((e=>{let{permissionItem:t}=e;return(b.zU(t)||b.LW(t))&&t.team_id!==(null==a?void 0:a.id)}));const g=new Map;p.forEach(((e,t)=>{let{permissionItem:i}=e;g.has(i.team_id)||g.set(i.team_id,t)})),p=c().sortBy(p,[e=>{let{permissionItem:t}=e;return g.get(t.team_id)||0},e=>{let{permissionItem:t}=e;return"explicit_team_owner_permission"===t.type?0:1}]);const h=o.filter((e=>{let{permissionItem:t}=e;return b.jg(t)})),f=o.filter((e=>{let{permissionItem:t}=e;return b.FB(t)})),v=this.shouldShowPublicPermissionItem(),y=(0,L.k_)(this.environment).state,S=Boolean(null==a?void 0:a.isDefined());let w=y&&y.showWorkspaceSection||t&&"team"===t.getPlanType()||"none"!==l.permissionItem.role;(0,Y.bq)()&&(w=t&&"team"===t.getPlanType()||"none"!==l.permissionItem.role);const C=w||S||h.length>1||h.length&&!b.zz(h[0].permissionItem.role)||m.length||b.YX(l.permissionItem.role);return{showRestrictedPermissionBanner:o.some((e=>b.Le(e.permissionItem)&&e.from.table===M.iU&&e.from.blockId===i.id)),showPublicPermission:v,showTeamPermission:S,showSpacePermission:w,showUserPermissions:C,mostPermissivePublicItem:r,mostPermissiveTeamOwnerItem:u,mostPermissiveTeamMemberItem:d,mostPermissiveSpaceItem:l,mostPermissiveGroupPermissions:m,mostPermissiveTeamPermissions:p,mostPermissiveUserPermissions:h,mostPermissiveBotPermissions:f,permissionItemsCount:(C?h.length:0)+(n?0:f.length)+(w?1:0)+(S?1:0),spacePermissionGroups:s}}}const lt=e=>a()("div",{style:{...e.style,background:e.theme.lightDividerColor}}),dt=(0,_.injectIntl)(rt)},85324:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Z});var n=i(97464),o=i.n(n),s=i(77094),a=i.n(s),r=(i(41817),i(67294)),l=i.n(r),d=i(480),c=i(24405),u=i(41892),m=i(86658),p=i(82990),g=i(63143),h=i(5366),f=i(92108),v=i(36867),y=i(45293),S=i(10182),b=i(42922),M=i(91941),w=i(92660),C=i(29551);function k(){const e=(0,c.y)(I,[]),t=(0,d.O7)();return a()(b.Z,{isLarge:!0,style:e.acceptAllButton,onClick:()=>{f.a9(t,{necessary:!0,preference:!0,performance:!0,targeting:!0}),y.Z.setState({open:!1}),(0,f.qo)()}},void 0,l().createElement(h.FormattedMessage,m.ze.acceptAllButtonLabel))}function T(){const e=(0,c.y)(I,[]);return a()(S.Z,{hasDismissButton:!0,onDismiss:()=>{y.Z.setState({open:!1})},renderOrigin:t=>l().createElement(M.Z,o()({},t,{isLarge:!0,isGray:!0,style:e.moreOptionsButton}),l().createElement(h.FormattedMessage,m.ze.moreOptionsButtonLabel))})}function I(e){return{modal:{maxWidth:400,padding:24},image:{height:100},title:{marginTop:8,color:e.regularTextColor,fontWeight:p.Z.fontWeight.semibold,fontSize:18},description:{color:e.mediumTextColor,textAlign:"center",fontSize:14,marginTop:8,marginBottom:18},acceptAllButton:{width:"100%",marginBottom:6},moreOptionsButton:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center"}}}const Z=(0,h.injectIntl)((function(){const e=(0,d.O7)().currentUser.id;(0,r.useEffect)((()=>{if(!e)return;(0,v._)(e);const t=window.setInterval((()=>{(0,v._)(e)}),g.A0);return()=>{window.clearInterval(t)}}),[e]);const t=(0,c.y)(I,[]);return a()(w.Z,{onDismiss:()=>{},render:()=>a()("div",{style:t.modal},void 0,a()(C.gq,{flexDirection:"column",justifyContent:"center",alignItems:"center"},void 0,a()("img",{style:t.image,src:u.Z.images.feedbackThankYouPng}),a()("div",{style:t.title},void 0,a()(h.FormattedMessage,{id:"cookieModal.requestConsent.title",defaultMessage:"Set your cookie preferences",description:"Title of the modal shown when requesting cookie consent."})),a()("div",{style:t.description},void 0,(0,m.Fd)(f.Tz,"banner")),a()(k,{}),a()(T,{}))),requireOnline:!0,modalStore:y.Z})}))},42333:(e,t,i)=>{i.r(t),i.d(t,{default:()=>q});var n=i(77094),o=i.n(n),s=i(77422),a=i.n(s),r=(i(33948),i(96486)),l=i.n(r),d=i(67294),c=i.n(d),u=i(83355),m=i(18466),p=i(41892),g=i(53397),h=i(82990),f=i(51454),v=i(5366),y=i(54642),S=i(17215),b=i(73409),M=i(68989);function w(e,t,i){if(i){const{templateId:n}=i;return e.some((e=>e.milestone===t&&e.template_id===n))}return e.some((e=>e.milestone===t))}var C=i(33929),k=i(38755),T=i(21115),I=i(27832),Z=i(4926),P=i(49085);const _="rate",x="send",F="thanks";class A extends P.Z{getInitialState(){return{starRating:void 0,step:_}}}const B=A;var E=i(5188),R=i(65381),D=i(42922),L=i(7908),O=i(74194),N=i(3386),U=i(31278),W=i(29551);const V=(0,v.defineMessages)({additionalFeedbackPlaceholder:{id:"csatPopup.additionalFeedback.placeholder",defaultMessage:"Tell us more..."}});class z extends u.Z{constructor(){super(...arguments),a()(this,"storeTypes",{csatPopupStore:B}),a()(this,"renderCancel",(()=>o()(L.Z,{onClick:this.handleCancel,style:this.getCancelStyle(),hoveredStyle:{background:this.theme.buttonPressedBackground}},void 0,g.Z.closeSmall({width:14,fill:this.theme.mediumTextColor})))),a()(this,"renderStep",(()=>{const{step:e}=this.stores.csatPopupStore.state,{currentSpaceStore:t}=I.default.state;let i;if(t){const e=t.getInitialUseCases();e&&(i=l().sample(e))}return c().createElement(c().Fragment,null,o()(R.Z,{isVisible:e===_,enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0,translateY:-120},render:()=>o()("div",{style:{paddingBottom:40}},void 0,this.renderIcon(),this.renderFeedbackPrompt(i))}),o()(R.Z,{isVisible:e===_||e===x,enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},render:()=>o()("div",{style:this.getSlideContainerStyle()},void 0,this.renderStars(i),this.renderInput(),this.renderSendButton())}),o()(R.Z,{isVisible:e===F,animationStyle:this.getAnimationStyle(e===F),enterAnimationStyle:this.getEnterExitAnimationStyle(),exitAnimationStyle:this.getEnterExitAnimationStyle(),render:this.renderThanks}))})),a()(this,"renderThanks",(()=>o()("div",{},void 0,o()("img",{style:{width:165,height:80},src:p.Z.images.feedbackThankYouPng}),o()("div",{style:this.getThanksHeaderStyle()},void 0,o()(v.FormattedMessage,{defaultMessage:"Thanks for your feedback!",id:"csatPopup.thanks.header"})),o()("div",{style:this.getThanksDescriptionStyle()},void 0,o()(v.FormattedMessage,{defaultMessage:"Your feedback will help us make Notion better.",id:"csatPopup.thanks.description"}))))),a()(this,"renderIcon",(()=>{const{mainEditorCurrentBlockStore:e}=I.default.state;if(e){const t=e.getIcon();if(t)return o()(W.gq,{justifyContent:"center",alignItems:"center"},void 0,o()(U.Z,{icon:t,isEmptyPage:!1,size:32,disabled:!0}))}return o()(W.gq,{justifyContent:"center",alignItems:"center"},void 0,g.Z.notionLogo({width:32,height:32}))})),a()(this,"renderFeedbackPrompt",(e=>{switch(e){case"doc_notes":return o()("div",{style:this.getFeedbackPromptStyle()},"feedback-prompt",o()(v.FormattedMessage,{defaultMessage:"How satisfied are you with using Notion for notes & docs?",id:"csatPopup.feedbackPrompt.docNotesLabel"}));case"project_management":return o()("div",{style:this.getFeedbackPromptStyle()},"feedback-prompt",o()(v.FormattedMessage,{defaultMessage:"How satisfied are you with managing projects and tasks in Notion?",id:"csatPopup.feedbackPrompt.projManagementLabel"}));case"wiki":return o()("div",{style:this.getFeedbackPromptStyle()},"feedback-prompt",o()(v.FormattedMessage,{defaultMessage:"How satisfied are you with using Notion for team wikis?",id:"csatPopup.feedbackPrompt.wikiLabel"}));default:const t=this.shouldRenderAsNPS(e);return o()("div",{style:this.getFeedbackPromptStyle()},"feedback-prompt",o()(v.FormattedMessage,t?{defaultMessage:"How likely are you to recommend Notion to a friend?",id:"csatPopup.feedbackPrompt.enterpriseDefaultLabel"}:{defaultMessage:"How satisfied are you with using Notion? ",id:"csatPopup.feedbackPrompt.defaultlabel"}))}})),a()(this,"renderInput",(()=>{const{step:e,additionalFeedback:t}=this.stores.csatPopupStore.state;return o()(N.Z,{capture:!0,onBackspace:l().identity,onLeft:l().identity,onRight:l().identity,onSelectAll:l().identity,onRedo:l().identity,onUndo:l().identity,onCut:l().identity,onCopy:l().identity,onPaste:l().identity,onKeypress:l().identity,onDelete:l().identity,onTab:l().identity},void 0,o()(O.Z,{textarea:!0,style:this.getInputContainerStyle(),focus:e===x,value:t,placeholder:C.default.formatMessage(V.additionalFeedbackPlaceholder),onChange:e=>{this.stores.csatPopupStore.setState({...this.stores.csatPopupStore.state,additionalFeedback:e.target.value})}}))})),a()(this,"renderSendButton",(()=>o()(D.Z,{isLarge:!0,style:this.getButtonStyle(),onClick:this.handleSend},void 0,o()(v.FormattedMessage,{id:"csatPopup.sendButton.label",defaultMessage:"Send"})))),a()(this,"renderStars",(e=>{const{starRating:t,step:i}=this.stores.csatPopupStore.state,n=e=>{let{rating:n}=e;return o()("div",{style:this.getStarStyle(),onMouseEnter:()=>{i===_&&this.stores.csatPopupStore.setState({...this.stores.csatPopupStore.state,starRating:n})},onClick:()=>{this.stores.csatPopupStore.setState({starRating:n,step:x})}},void 0,g.Z.star({width:18,fill:this.theme.mediumIconColor,position:"absolute",opacity:t&&t>=n?0:1}),g.Z.starFilled({width:18,fill:"#F6C050",position:"absolute",opacity:t&&t>=n?1:0}))},s=()=>{const i=this.shouldRenderAsNPS(e);switch(t){case 1:return o()(v.FormattedMessage,i?{defaultMessage:"Very unlikely",id:"csatPopup.stars.1StarLabelNps"}:{defaultMessage:"Very dissatisfied",id:"csatPopup.stars.1StarLabel"});case 2:return o()(v.FormattedMessage,i?{defaultMessage:"Somewhat unlikely",id:"csatPopup.stars.2StarLabelNps"}:{defaultMessage:"Somewhat dissatisfied",id:"csatPopup.stars.2StarLabel"});case 3:return o()(v.FormattedMessage,i?{defaultMessage:"Not likely nor unlikely",id:"csatPopup.stars.3StarLabelNps"}:{defaultMessage:"Not dissatisfied nor satisfied",id:"csatPopup.stars.3StarLabel"});case 4:return o()(v.FormattedMessage,i?{defaultMessage:"Somewhat likely",id:"csatPopup.stars.4StarLabelNps"}:{defaultMessage:"Somewhat satisfied",id:"csatPopup.stars.4StarLabel"});case 5:return o()(v.FormattedMessage,i?{defaultMessage:"Very likely",id:"csatPopup.stars.5StarLabelNps"}:{defaultMessage:"Very satisfied",id:"csatPopup.stars.5StarLabel"});default:return o()(v.FormattedMessage,{defaultMessage:"Select an option",id:"csatPopup.stars.notSpecifiedLabel"})}};return o()("div",{onMouseLeave:()=>{l().delay((()=>{this.stores.csatPopupStore.state.step===_&&this.stores.csatPopupStore.setState({...this.stores.csatPopupStore.state,starRating:void 0})}),500)},style:this.getStarsContainerStyle()},void 0,o()("div",{style:this.getStarsStyle()},void 0,o()(n,{rating:1}),o()(n,{rating:2}),o()(n,{rating:3}),o()(n,{rating:4}),o()(n,{rating:5})),o()("div",{style:this.getStarLabelStyle()},void 0,o()(s,{})))})),a()(this,"handleCancel",(async()=>{const{state:e}=E.Z;if(!e.open)return;const{open:t,...i}=e;if(t&&"trigger"===i.type){const{currentSpaceStore:e}=I.default.state;if(!e)return;await y.submitCsatFeedback(this.environment,{spaceId:e.id,rating:void 0,additionalFeedback:void 0,templateId:void 0,...i})}E.Z.setState({...E.Z,open:!1})})),a()(this,"handleSend",(async()=>{const{additionalFeedback:e,starRating:t}=this.stores.csatPopupStore.state,{currentSpaceStore:i}=I.default.state;if(!i||!t)return;const{state:n}=E.Z;if(!n.open)return;const{open:o,...s}=n,a="passive"===s.type?await y.submitCsatFeedback(this.environment,{spaceId:i.id,rating:t,additionalFeedback:e,type:s.type,milestone:void 0,templateId:void 0}):await y.submitCsatFeedback(this.environment,{spaceId:i.id,rating:t,additionalFeedback:e,templateId:void 0,...s});if("success"!==a.type)throw a.error;this.stores.csatPopupStore.setState({...this.stores.csatPopupStore.state,step:F}),l().delay((()=>{E.Z.setState({...E.Z,open:!1}),l().delay((()=>{this.stores.csatPopupStore.reset()}),1e3)}),2e3)})),a()(this,"flexCenteredStyle",{display:"flex",alignItems:"center",flexDirection:"column"})}willMount(){const{userSettingsStore:e,blockStore:t,spaceStore:i}=this.props;if(e&&t&&i){const n=this.environment;if("CsatMilestoneStore"in n){const o=m.Z.withListenerIgnored((()=>function(e,t){const{userSettingsStore:i,blockStore:n,spaceStore:o}=t,s=i.getSettings(),a=null==s?void 0:s.signup_time,{CsatMilestoneStore:r}=e,{data:d}=r.state,c=864e5,u=e=>Math.floor((Date.now()-e)/c);if(!o.isDefined()||!d)return;const{milestones:m}=d;if(!m)return;if(Math.max(...m.map((e=>e.created_time)))>Date.now()-24192e5)return;if(a){const e=u(a),t=l().sample(o.getInitialUseCases())||"legacy";if(e>=180){if(!w(m,b.Hf))return{milestone:b.Hf,useCase:t}}else if(e>=90){if(!w(m,b.Vx))return{milestone:b.Vx,useCase:t}}else if(e>=28){if(!w(m,b.Sh))return{milestone:b.Sh,useCase:t}}else if(e>=7&&!w(m,b.zK))return{milestone:b.zK,useCase:t}}const p=n.getValue(),g=p?(0,S.zc)(p,"block"):void 0;return p&&g&&(0,M.JY)(g)&&u(p.created_time)>=7&&!w(m,b.a0,{templateId:g.id})?{milestone:b.a0,useCase:"legacy",templateId:g.id}:void 0}(n,{userSettingsStore:e,blockStore:t,spaceStore:i})));if(o){const{milestone:e,useCase:t,templateId:i}=o;l().delay((()=>{E.Z.setState({open:!0,milestone:e,type:"trigger",useCase:t,templateId:i})}),2e3)}}}}renderComponent(){const{device:e}=this.environment;if(e.isMobile)return;const{currentSpaceStore:t}=I.default.state;return t&&!(0,k.isGuestOfSpace)(t)?o()(R.Z,{isVisible:E.Z.state.open,animationStyle:this.getAnimationStyle(E.Z.state.open),enterAnimationStyle:this.getEnterExitAnimationStyle(),exitAnimationStyle:this.getEnterExitAnimationStyle(),springConfig:this.getSpringConfig(),render:()=>o()("div",{style:this.getContainerStyle()},void 0,this.renderCancel(),o()("div",{style:this.getInnerContainerStyle()},void 0,this.renderStep()))}):void 0}shouldRenderAsNPS(e){const t=T.CM(this.environment),{state:i}=E.Z,n=i.open&&"trigger"===i.type;return"enterprise"===t&&!e&&n}getSpringConfig(){return{scale:{stiffness:58,damping:4.3}}}getAnimationStyle(e){return{opacity:e?1:0,scale:e?1:.96}}getEnterExitAnimationStyle(){return{opacity:0,scale:.96}}getThanksHeaderStyle(){return{color:this.theme.regularTextColor,fontWeight:h.Z.fontWeight.semibold,fontSize:14}}getThanksDescriptionStyle(){return{color:this.theme.mediumTextColor,fontSize:12}}getButtonStyle(){return{width:"calc(100% - 30px)"}}getInputContainerStyle(){const{step:e}=this.stores.csatPopupStore.state;return{width:"calc(100% - 30px)",display:"block",background:this.theme.popoverBackground,height:80,marginTop:10,marginBottom:10,opacity:e===_?0:1}}getStarLabelStyle(){return{fontSize:12,color:this.theme.mediumTextColor,paddingTop:4}}getFeedbackPromptStyle(){return{paddingTop:12,paddingBottom:12,color:this.theme.regularTextColor,fontWeight:h.Z.fontWeight.semibold,fontSize:14,lineHeight:1.4,width:188}}getStarStyle(){return{display:"inline-flex",position:"relative",width:20,height:20,marginRight:3}}getSlideContainerStyle(){const{step:e}=this.stores.csatPopupStore.state;return{...this.flexCenteredStyle,position:"absolute",transition:"transform 200ms ease",width:240,transform:e===_?"translateY(120px)":"translateY(0px)"}}getStarsContainerStyle(){return{width:"100%",...this.flexCenteredStyle}}getStarsStyle(){return{display:"flex",cursor:"pointer"}}getContainerStyle(){return{background:this.theme.popoverBackground,borderRadius:5,boxShadow:this.theme.mediumBoxShadow,position:"absolute",bottom:65+Z.Z.state,right:16+Z.Z.state,zIndex:f.hT}}getInnerContainerStyle(){return{...this.flexCenteredStyle,width:240,height:195,overflow:"hidden",position:"relative",padding:12,cursor:"default",textAlign:"center",justifyContent:"center"}}getCancelStyle(){return{position:"absolute",top:"10px",right:"10px",background:this.theme.buttonHoveredBackground,borderRadius:"100%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",zIndex:10}}}const q=(0,v.injectIntl)(z)},1459:(e,t,i)=>{i.r(t),i.d(t,{default:()=>ee});var n=i(77094),o=i.n(n),s=i(77422),a=i.n(s),r=(i(33948),i(67294)),l=i.n(r),d=i(83355),c=i(5366),u=i(79257),m=i(11599),p=i(27832),g=i(85680),h=i(88923),f=i(44532),v=i(97464),y=i.n(v),S=(i(85827),i(96486)),b=i.n(S),M=i(99036),w=i(6695),C=i(53397),k=i(82990),T=i(50906),I=i(96802),Z=i(80456),P=i(84210),_=i(60709),x=i(29376),F=i(33665),A=i(92547),B=i(81870),E=i(26909),R=i(44514),D=i(79131),L=i(84076),O=i(78140),N=i(28992),U=i(40721),W=i(91941),V=i(31278),z=i(76798),q=i(72495),H=i(61766),G=i(12318),K=i(43700),j=i(69872);class Y extends d.Z{constructor(){super(...arguments),a()(this,"storeTypes",{hovered:G.default.of(!1),buttonPopupStore:G.default.of(new H.Z)})}renderComponent(){const{schema:e,property:t,format:i,showAsSectionMenu:n,handlePageSectionClick:s}=this.props,a=e[t];if(!a)return;const r=this.getPropertyVisibility(a);return o()(j.Z,{onMouseEnter:()=>this.stores.hovered.set(!0),onMouseLeave:()=>this.stores.hovered.set(!1),focused:this.stores.hovered.get(),showDragHandle:!this.environment.device.isMobile,showExtensionArrow:!1,propertySchema:a,format:j.Z.DisplayFormat.Name,dontShrinkRight:!0,ignoreLocalHoverState:!0,locked:this.props.locked,onClick:()=>{if(!this.props.locked){const e=this.stores.buttonPopupStore.get();e.setState({open:!e.state.open})}},right:o()(K.Z,n&&s?{buttonPopupStore:this.stores.buttonPopupStore.get(),visibility:r,visibilityLevels:["show","hide","hide_if_empty","inline","minimal"],locked:this.props.locked,onSelect:e=>s(e,t,i),onClose:()=>this.stores.hovered.set(!1),type:"relation_property",propertySchema:a,showAsMenu:!0}:{buttonPopupStore:this.stores.buttonPopupStore.get(),visibility:r,locked:this.props.locked,onSelect:e=>this.handleVisibilitySelectClick(e),onClose:()=>this.stores.hovered.set(!1),type:"property",propertySchema:a})},t)}getPropertyVisibility(e){const{visibility:t}=this.props;switch(t){case"hide_if_empty":return m.kq({propertySchema:e})?"hide_if_empty":"show";default:return t}}handleVisibilitySelectClick(e){const{property:t,format:i,store:n}=this.props;Z.createAndCommit({userAction:"CustomizePageMenu.handleShowAsClick",environment:this.environment,perform:o=>{u.M0({property:t,visibility:e,format:i,store:n,transaction:o})}})}}const Q=Y;class X extends d.Z{constructor(){super(...arguments),a()(this,"storeTypes",{lockStore:A.Z}),a()(this,"handleDraggableDrop",(e=>{const t=this.getCollectionPageProperties();if(t){const i=e.map((e=>t.find((t=>t.property===e))));u.D2({environment:this.environment,properties:i,store:this.props.store})}})),a()(this,"handleDraggableDropSections",(e=>{const t=this.getCollectionPageSections();if(t){const i=e.map((e=>t.find((t=>t.section===e))));t&&Z.createAndCommit({userAction:"CustomizePageMenu.handleDraggableDropSections",environment:this.environment,perform:e=>{u.Do({environment:this.environment,pageSectionFormats:i,store:this.props.store,transaction:e})}})}})),a()(this,"handleShowAsClick",((e,t,i,n)=>{const o=m.$0();if(!o)return!1;let s=n.collection_page_sections||[];if(!i[t])return;const a=s.findIndex((e=>e.section===t));-1!==a?s[a]={section:t,visibility:e}:s=[...s,{section:t,visibility:e}];const r="inline"===e||"minimal"===e?"section":"show";s&&(Z.createAndCommit({userAction:"CustomizePageMenu.handleShowAsClick",environment:this.environment,perform:e=>{u.Do({environment:this.environment,pageSectionFormats:s,store:o,transaction:e}),u.M0({property:t,visibility:r,store:o,format:n,transaction:e})}}),T.trackRelationShowAs(this.environment,{from:"page_properties",mode:"inline"===e?"page_section":"minimal"===e?"minimal_page_section":"property"}))})),a()(this,"handleShowAsSectionMenuClick",((e,t,i)=>{const n=m.$0();if(!n)return;let o=i.collection_page_sections||[];if("inline"===e||"minimal"===e){const s=o.findIndex((e=>e.section===t));-1!==s?o[s]={section:t,visibility:e}:o=[...o,{section:t,visibility:e}];const a="inline"===e||"minimal"===e?"section":"show";o&&(Z.createAndCommit({userAction:"CustomizePageMenu.handleShowAsPageSectionClick",environment:this.environment,perform:e=>{u.Do({environment:this.environment,pageSectionFormats:o,store:n,transaction:e}),u.M0({property:t,visibility:a,store:n,format:i,transaction:e})}}),T.trackRelationShowAs(this.environment,{from:"page_properties",mode:"minimal"===e?"minimal_page_section":"page_section"}))}else{const o=w.AX.find((t=>t===e));if(!o)return;Z.createAndCommit({userAction:"CustomizePageMenu.handleShowAsPropertyClick",environment:this.environment,perform:e=>{u.M0({property:t,visibility:o,store:n,format:i,transaction:e})}}),T.trackRelationShowAs(this.environment,{from:"page_properties",mode:"property"})}})),a()(this,"handleToggleLockClick",(()=>{const e=m.$0();if(!e)return!1;const t=e.getParentBlockStore();t&&(Z.createAndCommit({userAction:"CustomizePageMenu.handleToggleLockClick",environment:this.environment,perform:e=>{I.Wq({environment:this.environment,store:t,isLocked:!m.p1(),transaction:e})}}),this.stores.lockStore.setState({justUnlocked:!this.stores.lockStore.state.justUnlocked}))}))}renderComponent(){const{device:e}=this.environment,t=this.createComputedStore((()=>"page"===this.props.type?this.props.store.isExternalObjectInstancePageBlockStore():this.props.store.isSyncedCollection()));let i;i=e.isMobile?{menuType:_.o.Modal,right:o()(U.DoneMenuText,{}),onClickRight:u.xv,title:this.props.intl.formatMessage({id:"customizePageMenu.mobileHeader.label",defaultMessage:"Customize page"})}:{menuType:_.o.Popup,minWidth:400};const n=this.getNormalizedFormat();return l().createElement(O.Z,y()({},i,{header:this.renderHeader()}),(this.props.locked||this.stores.lockStore.state.justUnlocked)&&this.renderLockControls(),this.renderPageSectionsSectionMenuItem(n,t.state),this.renderPropertiesSectionMenuItem(n))}renderLockControls(){return o()("div",{style:{fontSize:12,display:"flex",justifyContent:"center",alignItems:"center",borderTop:"1px solid ".concat(this.theme.regularDividerColor),borderBottom:"1px solid ".concat(this.theme.regularDividerColor),background:this.theme.sidebarBackground,color:this.theme.mediumTextColor,paddingTop:6,paddingBottom:6}},void 0,o()("span",{style:{display:"inline-block",verticalAlign:"middle",paddingRight:6}},void 0,this.stores.lockStore.state.justUnlocked?C.Z.unlocked({height:12,width:12,fill:this.theme.mediumIconColor}):C.Z.locked({height:12,width:12,fill:this.theme.mediumIconColor})),this.stores.lockStore.state.justUnlocked?o()(c.FormattedMessage,{id:"customizePageMenu.unlocked.header",defaultMessage:"Settings unlocked on parent database."}):o()(c.FormattedMessage,{id:"customizePageMenu.locked.header",defaultMessage:"Settings locked on parent database."}),o()(W.Z,{style:{fontSize:12,color:this.theme.mediumTextColor,fontWeight:k.Z.fontWeight.semibold,marginLeft:2,paddingLeft:4,paddingRight:4,height:20},onClick:this.handleToggleLockClick},void 0,this.stores.lockStore.state.justUnlocked?o()(c.FormattedMessage,{id:"customizePageMenu.lock.label",defaultMessage:"Re-lock"}):o()(c.FormattedMessage,{id:"customizePageMenu.unlock.label",defaultMessage:"Unlock"})))}renderPropertiesSectionMenuItem(e){const t=this.getSchema();if(!t||"page"===this.props.type)return;const i=this.getPageCustomization(e);if(!i)return;const{propertyVisibility:n}=i;if(!n)return;const s=n.reduce(((e,t)=>(e[t.property]=t.visibility,e)),{}),a=this.getCollectionPageSections().filter((e=>"inline"===e.visibility||"minimal"===e.visibility)).map((e=>e.section)),r=b().difference(this.getCollectionPageProperties().map((e=>e.property)),a);return o()(q.Z,{style:{opacity:this.props.locked?.5:1},title:o()(c.FormattedMessage,{id:"customizePageMenu.propertiesSection.header",defaultMessage:"Properties"})},void 0,o()(D.Z,{direction:D.K.Vertical,keys:r,renderKey:i=>{var n;const a=null===(n=t[i])||void 0===n?void 0:n.type;if("collection"===this.props.type)return"relation"===a&&(0,x.Lt)()?o()(Q,{schema:t,visibility:s[i],property:i,format:e,store:this.props.store,locked:this.props.locked,showAsSectionMenu:!0,handlePageSectionClick:this.handleShowAsSectionMenuClick}):o()(Q,{schema:t,visibility:s[i],property:i,format:e,store:this.props.store,locked:this.props.locked})},onDrop:this.handleDraggableDrop}))}renderPageSectionsSectionMenuItem(e,t){const i=this.getSchema();if(!i)return;const n=this.getPageCustomization(e);if(!n)return;const{pageSectionVisibility:s}=n;if(!s)return;const a=this.getCollectionPageSections().map((e=>e.section)),r={topLevelDiscussions:!t,backLinks:!0,pageComments:!t};return l().createElement(l().Fragment,null,o()(q.Z,{style:{opacity:this.props.locked?.5:1},title:o()(c.FormattedMessage,{id:"customizePageMenu.sectionsSection.header",defaultMessage:"Sections"}),topBorder:!this.props.locked&&!this.stores.lockStore.state.justUnlocked},void 0,o()("div",{style:{marginLeft:8}},void 0,a.length>0&&o()(q.Z,{style:{opacity:this.props.locked?.5:1,width:"100%",paddingBottom:0,paddingTop:0}},void 0,o()(D.Z,{direction:D.K.Vertical,keys:a,renderKey:t=>{if("collection"===this.props.type&&"inline"===(0,m.ab)(void 0,t))return this.renderRelationSectionMenuItem(i,t,e)},onDrop:this.handleDraggableDropSections}),o()(D.Z,{direction:D.K.Vertical,keys:a,renderKey:t=>{if("collection"===this.props.type&&"minimal"===(0,m.ab)(void 0,t))return this.renderRelationSectionMenuItem(i,t,e)},onDrop:this.handleDraggableDropSections})),r.topLevelDiscussions&&o()(N.Z,{title:o()(c.FormattedMessage,{id:"customizePageMenu.pageSections.topLevelPageDiscussionsTitle",defaultMessage:"Top-level page discussions"}),icon:C.Z.speechBubbleThick({height:16,width:16}),right:o()(K.Z,{visibility:s.comments,visibilityLevels:["section_show","section_hide"],locked:this.props.locked,onSelect:t=>{u.W4({environment:this.environment,pageSection:"comments",visibility:t,store:this.props.store,format:e})},type:"page"})}),r.backLinks&&o()(N.Z,{title:o()(c.FormattedMessage,{id:"customizePageMenu.pageSections.backlinksTitle",defaultMessage:"Backlinks"}),icon:C.Z.alias({height:16,width:16,transform:"rotate(180deg)"}),right:o()(K.Z,{visibility:s.backlinks,locked:this.props.locked,visibilityLevels:["section_show","section_hide","section_collapsed"],onSelect:t=>{u.W4({environment:this.environment,pageSection:"backlinks",visibility:t,store:this.props.store,format:e})},type:"page"})}),r.pageComments&&o()(N.Z,{title:o()(c.FormattedMessage,{id:"customizePageMenu.pageSections.pageCommentsTitle",defaultMessage:"Page comments"}),icon:C.Z.speechBubbleThick({height:16,width:16}),right:o()(K.Z,{visibility:(0,m.ab)(s,"margin_comments"),visibilityLevels:["inline","minimal"],locked:this.props.locked,onSelect:t=>{u.W4({environment:this.environment,pageSection:"margin_comments",visibility:t,store:this.props.store,format:e})},type:"page"})}))))}renderRelationSectionMenuItem(e,t,i){var n;return o()("div",{style:{display:"inline-flex",width:"100%"}},void 0,o()(N.Z,{title:null===(n=e[t])||void 0===n?void 0:n.name,icon:C.Z.typesRelation({height:14,width:14,color:this.theme.mediumIconColor,fill:this.theme.mediumIconColor,fontWeight:k.Z.fontWeight.medium}),disabled:this.props.locked,showDragHandle:!this.environment.device.isMobile,right:o()(K.Z,{visibility:(0,m.ab)(void 0,t),visibilityLevels:["section_hide","inline","minimal"],locked:this.props.locked,onSelect:n=>{this.handleShowAsClick(n,t,e,i)},type:"page",showAsMenu:!0})}))}renderHeader(){if(this.environment.device.isMobile)return;const{store:e}=this.props;if(e){const t=e.getIcon(),i="collection"===this.props.type?this.props.store.getParentBlockStore():void 0,n=t&&o()(V.Z,{icon:t,isEmptyPage:!1,size:14,disabled:!0,style:{display:"inline-flex",marginRight:2}}),s=o()(z.Z,{store:e,style:{display:"inline"}}),a=i?o()(R.Q,{prefix:o()(c.FormattedMessage,{id:"customizePageMenu.header.allPages.label",defaultMessage:"Customize all pages in",description:"Text to tell the user that their changes will apply to all pages in the database"}),viewName:i?l().createElement(l().Fragment,null,o()(L.Z,{onClick:u.xv,href:(0,P.Z)({store:i,fullyQualified:!1}),inline:!0},void 0,n,s)):l().createElement(l().Fragment,null,n,s)}):o()(c.FormattedMessage,{id:"customizePageMenu.header.singlePage.label",defaultMessage:"Customize this page view",description:"Header text showing in the customize page menu for pages that aren't part of a database"});return o()(N.Z,{style:{...E.ZP.headingStyle},title:a,right:o()(B.Z,{helpButtonContext:"customize_page_menu",href:(0,F.UY)("guides.customizePageView")})})}}getSchema(){if("collection"!==this.props.type)return this.props.store.getSchema();{const e=this.props.store.getValue();if(e)return M.oC(e)}}getNormalizedFormat(){const{store:e}=this.props,t=e.getFormat(),i=this.getSchema();if(!i)return{};const n=e.getSpaceId();return w.iB(t,i,void 0,w.j5.Collection,n)}getCollectionPageProperties(){if("collection"!==this.props.type)return[];return this.getNormalizedFormat().collection_page_properties||[]}getCollectionPageSections(){if("collection"!==this.props.type)return[];return this.getNormalizedFormat().collection_page_sections||[]}getPageCustomization(e){return{propertyVisibility:e.property_visibility,pageSectionVisibility:e.page_section_visibility}}}const J=X;class $ extends d.Z{constructor(){super(...arguments),a()(this,"renderModal",(()=>{if(!g.Z.state.isOpen)return;const e=m.$0(),{mainEditorCurrentBlockStore:t}=p.default.state,i=h.default.state.open&&h.default.state.target||t;return e?o()(J,{store:e,type:"collection",intl:this.props.intl,locked:m.p1()}):i?o()(J,{store:i,type:"page",intl:this.props.intl,locked:!1}):void 0}))}renderComponent(){const{device:e}=this.environment,t=g.Z.state;return o()(f.ZP,{popupType:e.isMobile?f.ZP.PopupType.SlideUp:f.ZP.PopupType.Popup,alignmentToOrigin:f.ZP.Alignment.Center,open:t.isOpen,render:this.renderModal,originRect:t.isOpen?t.rect:void 0,onDismiss:()=>u.xv()})}}const ee=(0,c.injectIntl)($)},92660:(e,t,i)=>{i.d(t,{Z:()=>l});var n=i(77094),o=i.n(n),s=(i(67294),i(83355)),a=i(22346),r=i(44532);class l extends s.Z{renderComponent(){const{render:e}=this.props,{device:t}=this.environment,i=this.props.modalStore.state;return t.isMobile?o()(r.ZP,{open:i.open,popupType:r.ZP.PopupType.SlideUp,origin:this.props.origin,onDismiss:this.props.onDismiss,render:e,style:this.props.style}):o()(a.Z,{open:i.open,preventHideChildrenWhileOpening:!0,render:e,onDismiss:this.props.onDismiss,style:this.props.style})}}},29345:(e,t,i)=>{i.r(t),i.d(t,{default:()=>W});var n=i(77094),o=i.n(n),s=i(77422),a=i.n(s),r=(i(33948),i(96486)),l=i.n(r),d=i(67294),c=i.n(d),u=i(83355),m=i(41892),p=i(8848),g=i(53397),h=i(30845),f=i(82990),v=i(5366),y=i(50906),S=i(33929),b=i(49085);class M extends b.Z{getInitialState(){return{step:"initial"}}}const w=M;var C=i(66205),k=i(65381),T=i(42922),I=i(7908),Z=i(74194),P=i(3386),_=i(22346),x=i(91941),F=i(97464),A=i.n(F),B=i(52275),E=i(63296),R=i(14871);class D extends u.Z{renderComponent(){const{intl:e,question:t}=this.props,i={setup_trial:o()(v.FormattedMessage,{id:"enterpriseContactModalQuestionSelect.question.setup_trial",defaultMessage:"Setup an enterprise trial"}),live_demo:o()(v.FormattedMessage,{id:"enterpriseContactModalQuestionSelect.question.live_demo",defaultMessage:"Schedule a live demo"}),plan_help:o()(v.FormattedMessage,{id:"enterpriseContactModalQuestionSelect.question.plan_help",defaultMessage:"Need help choosing a plan"}),other:o()(v.FormattedMessage,{id:"enterpriseContactModalQuestionSelect.question.other",defaultMessage:"Other"})},n={menuTitle:e.formatMessage({defaultMessage:"Your question",id:"enterpriseContactModal.yourQuestion.title"}),items:["setup_trial","live_demo","plan_help","other"],width:"auto",minWidth:280,getKey:e=>e,selectedItem:t,originGap:4,onSelect:e=>{this.props.onSelect(e)},renderItem:e=>c().createElement(B.Z,A()({title:i[e.key]},e)),renderOrigin:e=>c().createElement(E.Z,A()({},e,{isLarge:!0,style:{...this.getInputStyle(),...this.props.invalid&&{border:"1px solid ".concat(p.ZP.red)}}}),o()("div",{style:{display:"flex",alignItems:"center",color:t?this.theme.regularTextColor:this.theme.lightTextColor}},void 0,t?i[t]:o()(v.FormattedMessage,{defaultMessage:"Select question",id:"enterpriseContactModal.selectQuestion.label"})),g.Z.expand({width:10,fill:this.theme.lightIconColor}))};return c().createElement(R.Z,A()({key:"onboarding"},n))}getInputStyle(){const{device:e}=this.environment;return{backgroundColor:this.theme.whiteButtonBackground,height:31,...e.isMobile&&{height:42},padding:"2px 10px",display:"flex",alignItems:"center",justifyContent:"space-between",borderRadius:3,border:0,transition:"box-shadow 0.3s ease",boxShadow:"0 0 0 1px ".concat(this.theme.outlineButtonBorder),background:this.theme.buttonBackground}}}const L=(0,v.injectIntl)(D);var O=i(29551);const N=(0,v.defineMessages)({additionalFeedbackPlaceholder:{id:"enterpriseContactModal.additionalFeedback.placeholder",defaultMessage:"What would you like to learn more about?"}});class U extends u.Z{constructor(){super(...arguments),a()(this,"storeTypes",{store:w}),a()(this,"renderMenu",(()=>o()("div",{style:this.getContainerStyle()},void 0,this.renderCancel(),o()(O.gq,{style:this.getInnerContainerStyle(),alignItems:"center",alignContent:"center"},void 0,this.renderStep())))),a()(this,"renderInitial",(()=>{const{invalidField:e}=this.stores.store.state;if(C.Z.state.open)return o()("div",{style:{...this.getSlideUpStyle(),padding:20}},void 0,g.Z.speechBubbleThin({width:"100%",height:24}),o()("div",{style:{fontSize:14,fontWeight:f.Z.fontWeight.semibold,paddingTop:6,paddingBottom:4}},void 0,o()(v.FormattedMessage,{id:"enterpriseContactModal.initial.header",defaultMessage:"Get in touch with sales"})),o()("div",{style:{fontSize:12,color:this.theme.mediumTextColor,width:200,margin:"0 auto"}},void 0,o()(v.FormattedMessage,{id:"enterpriseContactModal.initial.caption",defaultMessage:"We'll work with you on your setup and help you land on the best plan."})),o()("div",{style:{...this.getLabelStyle(),marginTop:24}},void 0,o()(v.FormattedMessage,{id:"enterpriseContactModal.initial.nameLabel",defaultMessage:"Your name"})),o()(Z.Z,{focusInitial:!0,value:this.getName(),placeholder:"Ada Lovelace",style:{marginRight:4,...this.getInputStyle(),..."name"===e&&this.getInvalidInputStyle()},onChange:e=>{C.Z.setState({...C.Z.state,open:!0,name:void 0}),this.stores.store.setState({...this.stores.store.state,name:e.target.value}),y.trackEnterpriseSalesContactUpdated(this.environment,{contactFieldType:"name",contactFieldValue:e.target.value})}}),o()("div",{style:this.getLabelStyle()},void 0,o()(v.FormattedMessage,{id:"enterpriseContactModal.initial.emailLabel",defaultMessage:"Your work email"})),o()(Z.Z,{value:this.getEmail(),placeholder:"ada@lovelace.app",type:"email",style:{marginRight:4,...this.getInputStyle(),..."email"===e&&this.getInvalidInputStyle()},onChange:e=>{C.Z.setState({...C.Z.state,open:!0,email:void 0}),this.stores.store.setState({...this.stores.store.state,email:e.target.value}),y.trackEnterpriseSalesContactUpdated(this.environment,{contactFieldType:"email",contactFieldValue:e.target.value})}}),o()("div",{style:this.getLabelStyle()},void 0,o()(v.FormattedMessage,{id:"enterpriseContactModal.initial.companySizeLabel",defaultMessage:"Company size"})),o()(O.gq,{},void 0,this.getCompanySizeButtonData().map((e=>{let{type:t,message:i,style:n}=e;return o()(x.Z,{isLightGray:!0,isLarge:!0,style:{...this.getBaseButtonStyle(),...this.stores.store.state.companySize===t&&this.getSelectedButtonStyle(),...n},onClick:()=>{this.stores.store.setState({...this.stores.store.state,companySize:t}),y.trackEnterpriseSalesContactUpdated(this.environment,{contactFieldType:"companySize",contactFieldValue:t})}},void 0,i)}))),o()("div",{style:this.getLabelStyle()},void 0,o()(v.FormattedMessage,{id:"enterpriseContactModal.initial.questionLabel",defaultMessage:"Your question"})),o()(L,{question:this.stores.store.state.question,invalid:"question"===e,onSelect:e=>{this.stores.store.setState({...this.stores.store.state,question:e,step:"other"===e?"additional_input":"initial"}),y.trackEnterpriseSalesContactUpdated(this.environment,{contactFieldType:"question",contactFieldValue:"other"===e?"additional_input":"initial"})}}),o()(Z.Z,{textarea:!0,textareaElementAttributes:{style:this.getInnerTextAreaStyle()},style:this.getTextAreaStyle(),focus:"additional_input"===this.stores.store.state.step,value:this.stores.store.state.additionalFeedback,placeholder:S.default.formatMessage(N.additionalFeedbackPlaceholder),onChange:e=>{this.stores.store.setState({...this.stores.store.state,additionalFeedback:e.target.value}),y.trackEnterpriseSalesContactUpdated(this.environment,{contactFieldType:"additionalFeedback",contactFieldValue:e.target.value})}}))})),a()(this,"renderCancel",(()=>o()(I.Z,{onClick:()=>{y.trackEnterpriseSalesContactDismissed(this.environment),this.handleCancel()},style:this.getCancelStyle(),hoveredStyle:{background:this.theme.buttonPressedBackground}},void 0,g.Z.closeSmall({width:14,fill:this.theme.mediumTextColor})))),a()(this,"renderThanks",(()=>o()("div",{},void 0,o()("img",{style:{width:165,height:80},src:m.Z.images.feedbackThankYouPng}),o()("div",{style:this.getThanksHeaderStyle()},void 0,o()(v.FormattedMessage,{id:"enterpriseContactModal.thanks.caption",defaultMessage:"We've received your inquiry and will be contacting you via email shortly."}))))),a()(this,"handleCancel",(()=>{C.Z.setState({open:!1})}))}renderComponent(){return o()(_.Z,{preventHideChildrenWhileOpening:!0,open:C.Z.state.open,render:this.renderMenu,onDismiss:this.handleCancel})}renderStep(){const{step:e}=this.stores.store.state;return c().createElement(c().Fragment,null,o()(k.Z,{isVisible:"initial"===e||"additional_input"===e,enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},render:()=>o()(P.Z,{capture:!0,onBackspace:l().identity,onLeft:l().identity,onRight:l().identity,onSelectAll:l().identity,onRedo:l().identity,onUndo:l().identity,onCut:l().identity,onCopy:l().identity,onPaste:l().identity,onKeypress:l().identity,onDelete:l().identity,onTab:l().identity},void 0,this.renderInitial())}),o()(k.Z,{isVisible:"thanks"===e,animationStyle:this.getAnimationStyle("thanks"===e),enterAnimationStyle:this.getEnterExitAnimationStyle(),exitAnimationStyle:this.getEnterExitAnimationStyle(),render:this.renderThanks}),o()(k.Z,{isVisible:"initial"===e||"additional_input"===e,enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},render:()=>o()(T.Z,{isLarge:!0,style:{marginTop:17,width:284,position:"absolute",bottom:20},onClick:()=>{const e=this.getInvalidField();if(e){const{question:t}=this.stores.store.state;this.stores.store.setState({...this.stores.store.state,step:"initial",invalidField:e,question:"other"===t?void 0:t})}else this.stores.store.setState({...this.stores.store.state,invalidField:void 0,step:"thanks"}),C.Z.state.open&&y.trackEnterpriseSalesContact(this.environment,{email:C.Z.state.email,name:C.Z.state.name,...this.stores.store.state}),l().delay((()=>{C.Z.reset(),l().delay((()=>{this.stores.store.reset()}),1e3)}),2e3)}},void 0,o()(v.FormattedMessage,{id:"enterpriseContactModal.initial.sendLabel",defaultMessage:"Send"}))}))}getName(){if(C.Z.state.open)return this.stores.store.state.name||C.Z.state.name}getEmail(){if(C.Z.state.open)return this.stores.store.state.email||C.Z.state.email}getInvalidField(){const e=this.getEmail(),t=this.getName(),{question:i,companySize:n}=this.stores.store.state;return t?e&&h.B(e,"email")?n?i?void 0:"question":"company_size":"email":"name"}getCompanySizeButtonData(){return[{type:"1_100",message:o()(v.FormattedMessage,{id:"enterpriseContactModal.initial.1_100Label",defaultMessage:"1-100"})},{type:"101_1000",message:o()(v.FormattedMessage,{id:"enterpriseContactModal.initial.101_1000Label",defaultMessage:"101-1,000"}),style:{marginLeft:8,marginRight:8}},{type:"1001+",message:o()(v.FormattedMessage,{id:"enterpriseContactModal.initial.1000PlusLabel",defaultMessage:"1,001+"})}]}getThanksHeaderStyle(){return{color:this.theme.regularTextColor,fontWeight:f.Z.fontWeight.semibold,fontSize:14}}getContainerStyle(){return{background:this.theme.popoverBackground,borderRadius:5,boxShadow:this.theme.mediumBoxShadow}}getCancelStyle(){return{position:"absolute",top:"10px",right:"10px",background:this.theme.buttonHoveredBackground,borderRadius:"100%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",zIndex:10}}getInnerContainerStyle(){return{width:320,height:470,overflow:"hidden",position:"relative",padding:20,cursor:"default",textAlign:"center",justifyContent:"center"}}getLabelStyle(){return{marginTop:17,fontSize:12,color:this.theme.mediumTextColor,fontWeight:f.Z.fontWeight.medium,lineHeight:"135%",marginBottom:4,textAlign:"left"}}getInputStyle(){return{backgroundColor:this.theme.whiteButtonBackground,height:31}}getInvalidInputStyle(){return{border:"1px solid ".concat(p.ZP.red)}}getAnimationStyle(e){return{opacity:e?1:0,scale:e?1:.96}}getEnterExitAnimationStyle(){return{opacity:0,scale:.96}}getBaseButtonStyle(){return{border:"1px solid #E7E6E5",flexGrow:1,justifyContent:"center"}}getSelectedButtonStyle(){return{color:p.ZP.blue,border:"1px solid ".concat(p.ZP.blue)}}getSlideUpStyle(){const{step:e}=this.stores.store.state;return{position:"absolute",transition:"transform 200ms ease",transform:"initial"===e?"translateY(153px)":"translateY(-180px)"}}getInnerTextAreaStyle(){return{width:"100%",height:"100%",background:"none",border:"none",resize:"none"}}getTextAreaStyle(){return{width:"100%",background:this.theme.popoverBackground,display:"block",padding:"7px 10px",height:310,marginTop:17,marginBottom:17,transition:"opacity 200ms ease-in",opacity:"additional_input"===this.stores.store.state.step?1:.001}}}const W=U},75765:(e,t,i)=>{i.r(t),i.d(t,{default:()=>J});var n=i(97464),o=i.n(n),s=i(77094),a=i.n(s),r=i(77422),l=i.n(r),d=(i(33948),i(96486)),c=i.n(d),u=i(67294),m=i.n(u),p=i(83355),g=i(41892),h=i(43593),f=i(32056),v=i(98459),y=i(75246),S=i(5366),b=i(70630),M=i(93678),w=i(60709),C=i(98742),k=i(61766),T=i(88632),I=i(54835),Z=i(71071),P=i(42922),_=i(52275),x=i(1743),F=i(74194),A=i(78140),B=i(58189),E=i(91941),R=i(72495),D=i(54368),L=i(24006),O=i(87968),N=i(33411),U=i(58032),W=i(64369),V=i(92660),z=i(6202),q=i(60442),H=i(42115);const G=["pdf","html","markdown"],K=["currentView","all"],j=e=>e>.1&&e<2,Y=["everything","no_files"];class Q extends p.Z{constructor(){super(...arguments),l()(this,"storeTypes",{includeContentsPopupStore:k.Z,exportTypePopupStore:k.Z,pdfFormatPopupStore:k.Z,collectionViewExportTypePopupStore:k.Z}),l()(this,"renderMenu",(()=>{const{device:e}=this.environment;if(!T.Z.state.online)return this.renderOffline();const t=Z.ZP.state;return t.open&&e.isMobile?this.renderMobileModal(t):t.open?this.renderDesktopModal(t):void 0})),l()(this,"handleSelectExportType",((e,t)=>{const i=Z.ZP.state;if(!i.open)return;const{exportOptions:n}=i;if(e===n.exportType)return;let o;o="pdf"===e?{...n,exportType:"pdf",pdfFormat:b.GI(t)}:{...n,exportType:e},b.BO(this.environment,{...i,exportOptions:o})})),l()(this,"handleSelectPaperFormat",(e=>{const t=Z.ZP.state;t.open&&Z.Sw(t)&&b.BO(this.environment,{...t,exportOptions:{...t.exportOptions,pdfFormat:e}})})),l()(this,"handleSelectIncludeContents",(e=>{const t=Z.ZP.state;t.open&&b.BO(this.environment,{...t,exportOptions:{...t.exportOptions,includeContents:e}})})),l()(this,"handleSelectCollectionExportType",(e=>{const t=Z.ZP.state;t.open&&b.BO(this.environment,{...t,exportOptions:{...t.exportOptions,collectionViewExportType:e}})})),l()(this,"handleToggleFlattenExportFiletree",(()=>{const e=Z.ZP.state;e.open&&b.BO(this.environment,{...e,exportOptions:{...e.exportOptions,flattenExportFiletree:!e.exportOptions.flattenExportFiletree}})})),l()(this,"handleToggleRecursive",(()=>{const e=Z.ZP.state;if(e.open){if(Z.Sw(e)&&!b.y1(this.environment))return M.y(this.environment,{from:"export_modal",for:"enterprise"}),void this.handleUpgrade();b.BO(this.environment,{...e,recursive:!e.recursive})}})),l()(this,"handleSetScalePercent",(e=>{const t=Z.ZP.state;t.open&&Z.Sw(t)&&b.BO(this.environment,{...t,exportOptions:{...t.exportOptions,scale:e}})})),l()(this,"handleCancel",(()=>{b.Qr()})),l()(this,"handleSubmit",(()=>{if(!this.canSubmit())return;const e=Z.ZP.state;e.open&&(b.Qr(),e.root.table===y.bx?b.AW(this.environment,{spaceId:e.root.id,exportOptions:e.exportOptions}):b.ZO(this.environment,{block:{id:e.root.id,spaceId:(0,v.CG)(e.root.spaceId)},recursive:e.recursive,exportOptions:e.exportOptions}))})),l()(this,"handleUpgrade",(()=>{b.Qr()}))}renderComponent(){return a()(V.Z,{onDismiss:this.handleCancel,render:this.renderMenu,requireOnline:!0,modalStore:Z.ZP})}renderOffline(){return a()("div",{style:this.getOfflineStyle()},void 0,a()(S.FormattedMessage,{defaultMessage:"Please go online to export.",id:"exportModal.offlineMessage.description"}))}renderMobileModal(e){const t={menuType:w.o.Modal,title:a()(S.FormattedMessage,{id:"exportModal.title",defaultMessage:"Export"}),right:a()(S.FormattedMessage,{id:"exportModal.closeButton.label",defaultMessage:"Close"}),onClickRight:this.handleCancel};return m().createElement(A.Z,t,a()(B.Z,{type:B.i.Vertical,initialFocus:void 0,sections:[{key:"exportOptions",render:e=>m().createElement(R.Z,e),items:this.getMobileExportOptionsMenuItems(e)},{key:"actions",render:e=>{let{children:t,...i}=e;return m().createElement(R.Z,o()({isSubmitButton:!0},i),t)},items:[{key:"submit",render:e=>{const{onClick:t,...i}=e;return m().createElement(z.Z,o()({},i,{onClick:t||this.handleSubmit,disabled:!this.canSubmit(),title:a()(S.FormattedMessage,{id:"exportModal.exportButton.label",defaultMessage:"Export"})}))},action:this.handleSubmit}]}]}))}renderDesktopModal(e){const{device:t,currentUser:i}=this.environment,n=Z.Sw(e)&&!b.y1(this.environment)&&("on"===I.default.getGroup("show-business-plan")?"business":"enterprise"),s=this.environment.device.isWindows;return a()("div",{style:this.getModalWrapStyle()},void 0,a()(D.Z,{isMenuItem:t.isMobile,buttonPopupStore:this.stores.exportTypePopupStore,label:a()(S.FormattedMessage,{id:"exportModal.exportFormat.description",defaultMessage:"Export format"}),selectedTitle:this.getBlockExportTypeTitle(e.exportOptions.exportType),renderMenuSections:e=>[{key:"exportType",render:e=>m().createElement(R.Z,e),items:G.map((t=>this.getBlockExportTypeMenuListItem(t,e,i.id)))}]}),e.exportOptions.collectionViewId&&a()(D.Z,{isMenuItem:t.isMobile,buttonPopupStore:this.stores.collectionViewExportTypePopupStore,label:a()(S.FormattedMessage,{id:"exportModal.includeDatabases.description",defaultMessage:"Include databases",description:"Shown if user is exporting a collection, to let the user select if they want to export everything in the collection or not."}),selectedTitle:this.getCollectionViewExportTypeTitle(e.exportOptions.collectionViewExportType||"currentView"),renderMenuSections:e=>[{key:"exportCollection",render:e=>m().createElement(R.Z,e),items:K.map((t=>this.getCollectionViewExportTypeMenuListItem(t,e)))}]}),a()(D.Z,{isMenuItem:t.isMobile,buttonPopupStore:this.stores.includeContentsPopupStore,label:a()(S.FormattedMessage,{id:"exportModal.includeContents.description",defaultMessage:"Include content"}),selectedTitle:this.getBlockIncludeContentsTitle(e.exportOptions.includeContents||"everything"),renderMenuSections:e=>[{key:"includeContents",render:e=>m().createElement(R.Z,e),items:Y.map((t=>this.getIncludeContentsMenuListItem(t,e)))}]}),Z.Sw(e)&&m().createElement(m().Fragment,null,a()(D.Z,{isMenuItem:t.isMobile,buttonPopupStore:this.stores.pdfFormatPopupStore,label:a()(S.FormattedMessage,{id:"exportModal.pageFormat.description",defaultMessage:"Page format"}),selectedTitle:this.getPDFFormatTitle(e.exportOptions.pdfFormat),renderMenuSections:e=>[{key:"isoPaperFormats",render:e=>m().createElement(R.Z,e),items:h.lJ.map((t=>this.getPaperFormatMenuListItem(t,e)))},{key:"otherPaperFormats",render:e=>m().createElement(R.Z,o()({topBorder:!0},e)),items:h.bY.map((t=>this.getPaperFormatMenuListItem(t,e)))}]}),this.renderScalePercent()),"space"!==e.root.table&&a()(H.Z,{requireUpgradeToTier:n,analyticsName:"export_modal",onClick:this.handleToggleRecursive,render:(i,s)=>m().createElement("div",o()({},i,{style:{display:"flex",alignItems:"center",height:32}}),a()("div",{style:{display:"flex",alignItems:"center",marginRight:"auto",color:this.theme.lightTextColor,fontSize:14}},void 0,a()(S.FormattedMessage,{defaultMessage:"Include subpages",id:"exportModal.includeSubpages.label"})," ",s&&a()("div",{style:{marginLeft:8}},void 0,s)),a()(L.Z,{on:e.recursive,isAndroid:t.isAndroid,disabled:Boolean(n)})),renderUpgradeTooltip:()=>a()(q.Z,{imageURL:g.Z.images.tooltips.upsells.exportPdfSubpagesPng,imageWidth:240,imageHeight:100,title:a()(S.FormattedMessage,{defaultMessage:"Upgrade to include subpages in PDF exports",id:"exportModal.pdfSubpageUpgradeTooltip.title"}),caption:a()(S.FormattedMessage,{defaultMessage:"Creates a zip file containing all the pages nested inside the current page as PDF files.",id:"exportModal.pdfSubpageUpgradeTooltip.caption"})}),tooltipPlacement:U.Z.Placement.Left,upgradeButtonDesktopStyle:{marginTop:2},onUpgradeClick:this.handleUpgrade}),a()(O.Z,{title:a()(S.FormattedMessage,{id:"exportModal.flattenExportFiletree.description",defaultMessage:"Create folders for subpages",description:"Toggle for whether or not to creates folders for each block hierarchy in recursive export"}),subtitle:"",style:{color:this.theme.lightTextColor,fontSize:14,display:"flex",alignItems:"center",marginRight:"auto",height:32},on:void 0===e.exportOptions.flattenExportFiletree?!s:!e.exportOptions.flattenExportFiletree,disabled:!e.recursive,onChange:()=>this.handleToggleFlattenExportFiletree()}),a()("div",{style:{display:"flex",alignItems:"center",marginTop:16}},void 0,a()(E.Z,{isGray:!0,style:{marginLeft:"auto",marginRight:8},onClick:this.handleCancel},void 0,a()(S.FormattedMessage,{defaultMessage:"Cancel",id:"exportModal.cancelButton.label"})),a()(P.Z,{onClick:this.handleSubmit,disabled:!this.canSubmit()},void 0,a()(S.FormattedMessage,{defaultMessage:"Export",id:"exportModal.exportButton.label"}))))}renderScalePercent(){const e=this.getScalePercent();return m().createElement(m().Fragment,null,a()("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",height:32}},void 0,a()(W.Z,{style:{color:this.theme.lightTextColor}},void 0,a()(S.FormattedMessage,{id:"exportModal.pageScale.description",defaultMessage:"Scale percent"})),a()(X,{value:e,onChange:this.handleSetScalePercent})),!j(e)&&a()(N.Z,{show:!0,showDelay:500,showHold:100,render:e=>e&&a()("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",minHeight:32,padding:"4px 0"}},void 0,a()(W.Z,{isSmall:!0,isMultiline:!0,style:{color:this.theme.errorText}},void 0,a()(S.FormattedMessage,{id:"exportModal.pageScale.invalidScaleError",defaultMessage:"Scale percent must be a number between 10 and 200",description:"Shown if the scale percent for pdf export is outside of range."})))}))}getMobileExportOptionsMenuItems(e){const{currentUser:t,device:i}=this.environment;return c().compact([{key:"export type",render:n=>m().createElement(D.Z,o()({},n,{isMenuItem:i.isMobile,buttonPopupStore:this.stores.exportTypePopupStore,label:a()(S.FormattedMessage,{defaultMessage:"Export format",id:"exportModal.exportFormat.description"}),selectedTitle:this.getBlockExportTypeTitle(e.exportOptions.exportType),renderMenuSections:e=>[{key:"exportType",render:e=>m().createElement(R.Z,e),items:G.map((i=>this.getBlockExportTypeMenuListItem(i,e,t.id)))}]})),action:()=>{this.stores.exportTypePopupStore.setState({open:!0})}},Z.Sw(e)&&{key:"pdf format",render:t=>m().createElement(D.Z,o()({},t,{isMenuItem:i.isMobile,buttonPopupStore:this.stores.pdfFormatPopupStore,label:a()(S.FormattedMessage,{defaultMessage:"Page format",id:"exportModal.pageFormat.description"}),selectedTitle:this.getPDFFormatTitle(e.exportOptions.pdfFormat),renderMenuSections:e=>[{key:"isoPaperFormats",render:e=>m().createElement(R.Z,e),items:h.lJ.map((t=>this.getPaperFormatMenuListItem(t,e)))},{key:"otherPaperFormats",render:e=>m().createElement(R.Z,o()({topBorder:!0},e)),items:h.bY.map((t=>this.getPaperFormatMenuListItem(t,e)))}]})),action:()=>{this.stores.pdfFormatPopupStore.setState({open:!0})}},"space"!==e.root.table&&{key:"recursive",render:t=>{let{onClick:n,key:s,...r}=t;const l=Z.Sw(e)&&!b.y1(this.environment)&&(I.default.getGroup("show-business-plan")?"business":"enterprise");return a()(H.Z,{requireUpgradeToTier:l,analyticsName:"export_modal",onClick:n,render:(t,n)=>{const s=(0,C.Z)(r,t);return m().createElement(_.Z,o()({},s,{title:a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()(S.FormattedMessage,{defaultMessage:"Include subpages",id:"exportModal.includeSubpages.label"})," ",n&&a()("div",{style:{marginLeft:8}},void 0,n)),right:m().createElement(L.Z,o()({},s,{on:e.recursive,isAndroid:i.isAndroid,disabled:Boolean(l)}))}))},renderUpgradeTooltip:()=>a()(q.Z,{imageURL:g.Z.images.tooltips.upsells.exportPdfSubpagesPng,imageWidth:240,imageHeight:100,title:a()(S.FormattedMessage,{defaultMessage:"Upgrade to include subpages in PDF exports",id:"exportModal.pdfSubpageUpgradeTooltip.title"}),caption:a()(S.FormattedMessage,{defaultMessage:"Creates a zip file containing all the pages nested inside the current page as PDF files.",id:"exportModal.pdfSubpageUpgradeTooltip.caption"})}),tooltipPlacement:U.Z.Placement.Left,upgradeButtonDesktopStyle:{marginTop:2},onUpgradeClick:this.handleUpgrade},s)},action:this.handleToggleRecursive}])}getBlockExportTypeTitle(e){switch(e){case"pdf":return a()(S.FormattedMessage,{id:"exportModal.exportFormatButton.pdf.label",defaultMessage:"PDF"});case"markdown":return a()(S.FormattedMessage,{id:"exportModal.exportFormatButton.markdownAndCSV.label",defaultMessage:"Markdown & CSV"});case"html":return a()(S.FormattedMessage,{id:"exportModal.exportFormatButton.html.label",defaultMessage:"HTML"})}}getBlockIncludeContentsTitle(e){switch(e){case"everything":return a()(S.FormattedMessage,{id:"exportModal.includeContentTypes.everything.label",defaultMessage:"Everything"});case"no_files":return a()(S.FormattedMessage,{id:"exportModal.includeContentTypes.no_files.label",defaultMessage:"No files or images"})}}getCollectionViewExportTypeTitle(e){switch(e){case"all":return a()(S.FormattedMessage,{id:"exportModal.includeDatabases.all.label",defaultMessage:"Everything",description:"Shown if user is choosing to export every page in the collection."});case"currentView":return a()(S.FormattedMessage,{id:"exportModal.includeDatabases.currentView.label",defaultMessage:"Current view",description:"Shown if user is choosing to export only the pages in the current view of the collection."})}}getPDFFormatTitle(e){switch(e){case"Letter":return a()(S.FormattedMessage,{id:"exportModal.pageFormatButton.letter.label",defaultMessage:"Letter"});case"A3":return a()(S.FormattedMessage,{id:"exportModal.pageFormatButton.a3.label",defaultMessage:"A3"});case"A4":return a()(S.FormattedMessage,{id:"exportModal.pageFormatButton.a4.label",defaultMessage:"A4"});case"Legal":return a()(S.FormattedMessage,{id:"exportModal.pageFormatButton.legal.label",defaultMessage:"Legal"});case"Tabloid":return a()(S.FormattedMessage,{id:"exportModal.pageFormatButton.tabloid.label",defaultMessage:"Tabloid"})}}getBlockExportTypeMenuListItem(e,t,i){const n=Z.ZP.state,s=n.open&&"pdf"===e&&"space"===n.root.table&&!b.y1(this.environment)&&("on"===I.default.getGroup("show-business-plan")?"business":"enterprise");return{key:e,action:()=>{if(t.close(),s)return M.y(this.environment,{from:"export_modal",for:s}),void this.handleUpgrade();this.handleSelectExportType(e,i)},render:i=>{let{onClick:n,key:r,...l}=i;return a()(H.Z,{requireUpgradeToTier:s,analyticsName:"export_modal",onClick:n,onUpgradeClick:()=>{t.close(),this.handleUpgrade()},render:(t,i)=>m().createElement(_.Z,o()({},(0,C.Z)(l,t),{title:this.getBlockExportTypeTitle(e),right:i})),renderUpgradeTooltip:()=>a()(q.Z,{imageURL:g.Z.images.tooltips.upsells.exportPdfSubpagesPng,imageWidth:240,imageHeight:100,title:a()(S.FormattedMessage,{defaultMessage:"Upgrade to export the workspace as PDFs",id:"exportModal.workspacePdfUpgradeTooltip.title"}),caption:a()(S.FormattedMessage,{defaultMessage:"Creates a zip file containing all pages in the workspace as PDF files.",id:"exportModal.workspacePdfUpgradeTooltip.caption"})}),tooltipPlacement:U.Z.Placement.Left,upgradeButtonDesktopStyle:{marginTop:2}},r)}}}getIncludeContentsMenuListItem(e,t){return{key:e,action:()=>{t.close(),this.handleSelectIncludeContents(e)},render:t=>m().createElement(_.Z,o()({},t,{title:this.getBlockIncludeContentsTitle(e)}))}}getCollectionViewExportTypeMenuListItem(e,t){return{key:e,action:()=>{t.close(),this.handleSelectCollectionExportType(e)},render:t=>m().createElement(_.Z,o()({},t,{title:this.getCollectionViewExportTypeTitle(e)}))}}getPaperFormatMenuListItem(e,t){return{key:e,action:()=>{t.close(),this.handleSelectPaperFormat(e)},render:t=>m().createElement(_.Z,o()({},t,{title:this.getPDFFormatTitle(e)}))}}getScalePercent(){const e=Z.ZP.state;return e.open&&Z.Sw(e)?void 0===e.exportOptions.scale?1:e.exportOptions.scale:1}canSubmit(){return j(this.getScalePercent())}getModalWrapStyle(){return{width:320,padding:24,fontSize:14}}getOfflineStyle(){return{...this.getModalWrapStyle(),color:this.theme.mediumTextColor}}}function X(e){let{value:t,onChange:i}=e;const n=(0,S.useIntl)(),o=m().useCallback((e=>{const t=e.target.value,n=(0,f._g)(t)||(0,f.p3)(t);let o;"object"==typeof n?o="percent"===n.format?n.value:n.value/100:"number"==typeof n&&(o=n/100),void 0!==o&&i(o)}),[i]),[s,r]=m().useState(!1),l=m().useMemo((()=>(0,f.uf)(Math.round(100*t),"number",n)),[t,n]);return a()(x.Z,{capture:s},void 0,a()(F.Z,{value:l,onChange:o,onFocus:()=>r(!0),onBlur:()=>r(!1),style:{width:60},inputStyle:{textAlign:"right"}}))}const J=Q},79027:(e,t,i)=>{i.r(t),i.d(t,{default:()=>S});var n=i(77094),o=i.n(n),s=i(77422),a=i.n(s),r=(i(33948),i(67294)),l=i(83355),d=i(41892),c=i(82990),u=i(5366),m=i(91376),p=i(17311),g=i(7844),h=i(42922),f=i(22346),v=i(62385);class y extends l.Z{constructor(){super(...arguments),a()(this,"handleModalDismiss",(()=>{g.Z.state.open&&g.Z.state.onDecline&&g.Z.state.onDecline(),g.Z.setState({open:!1})})),a()(this,"handleConnectClick",(()=>{g.Z.state.open&&g.Z.state.onConfirm(),g.Z.setState({open:!1})})),a()(this,"handleConnectedAppsClick",(()=>{this.handleModalDismiss(),m.r({currentTab:"connected_apps"})}))}renderComponent(){const{device:e}=this.environment,t=g.Z.state;return o()(f.Z,{open:t.open,innerStyle:y.wrapStyle,preventHideChildrenWhileOpening:!0,render:()=>o()(r.Fragment,{},void 0,o()("div",{style:y.modalHeaderWrapStyle},void 0,o()("img",{src:d.Z.images.googleDriveLogoPng,style:{width:50,display:"inline-block"}}),o()("div",{style:this.getModalMessageStyle()},void 0,o()(u.FormattedMessage,{defaultMessage:"Notion cannot access the Google Drive file you are trying to embed.",id:"googleAuthPromptModal.noAccessFile.errorMessage"})),e.isMobileNative?o()("div",{style:this.getModalMessageStyle()},void 0,o()(u.FormattedMessage,{defaultMessage:"Please use Notion on desktop to connect a new account.",id:"googleAuthPromptModal.mobileUseDesktopPrompt.errorMessage"})):o()(h.Z,{isLarge:!0,onClick:this.handleConnectClick},void 0,o()(u.FormattedMessage,{defaultMessage:"Connect to Google",id:"googleAuthPromptModal.connectToGoogleButton.label"})),!e.isMobile&&this.renderConnectedAccountsLink())),onDismiss:this.handleModalDismiss})}renderConnectedAccountsLink(){return o()("div",{style:{display:"block",marginTop:p.Z.vertical.tiny}},void 0,o()(v.Z,{underlined:!0,onClick:this.handleConnectedAppsClick},void 0,o()(u.FormattedMessage,{defaultMessage:"See my connected accounts",id:"googleAuthPromptModal.seeConnectedAccountsButton.label"})))}getModalMessageStyle(){return{fontSize:16,lineHeight:1.5,fontWeight:c.Z.fontWeight.medium,marginTop:15,marginBottom:20,color:this.theme.mediumTextColor}}}a()(y,"wrapStyle",{padding:"24px 36px 24px",minWidth:300,maxWidth:400}),a()(y,"modalHeaderWrapStyle",{textAlign:"center",marginTop:8,marginBottom:18,justifyContent:"space-between"});const S=y},39069:(e,t,i)=>{i.r(t),i.d(t,{default:()=>je});var n=i(77094),o=i.n(n),s=i(77422),a=i.n(s),r=(i(33948),i(67294)),l=i.n(r),d=i(83355),c=i(53397),u=i(82990),m=i(5366),p=i(50906),g=i(26111),h=i(33665),f=i(27832),v=i(47593),y=i(16354),S=i(22346),b=i(91941),M=i(97464),w=i.n(M),C=i(41892),k=(i(65069),i(96486)),T=i.n(k),I=i(41432),Z=i(7406);const P=["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/vnd.openxmlformats-officedocument.wordprocessingml.template","application/vnd.ms-word.document.macroEnabled.12","application/vnd.ms-word.template.macroEnabled.12"],_=["text/plain",".md",".mdown",".markdown",".mkdn",".mkd",".Rmd",".md.txt"],x={markdown:_,csv:["text/plain",".csv"],html:["text/html"],docx:P,gdocs:P,dropbox:P,quip:["text/html",_],workflowy:["text/plain"],confluence:["application/zip"]};var F=i(32056),A=i(29477),B=i(98459),E=i(21202),R=i(72340),D=i(33954),L=i(33929),O=i(17256),N=i(46190),U=i(90365),W=i(82066),V=i(80270),z=i(54642),q=i(47307),H=i(94419),G=i(92625),K=i(9953),j=i(29974),Y=i(80456),Q=i(53471);const X=(0,m.defineMessages)({uploadingOneFile:{id:"importActions.uploadingOneFile.loadingMessage",defaultMessage:"Uploading… ({percentComplete}%)"},uploadingMultipleFilesNotStarted:{id:"importActions.uploadingMultipleFilesNotStarted.loadingMessage",defaultMessage:"Uploaded 0 of {totalNumberOfFiles}"},uploadingMultipleFilesInProgress:{id:"importActions.uploadingMultipleFilesInProgress.loadingMessage",defaultMessage:"Uploaded {numberOfUploadedFiles} of {totalNumberOfFiles}"},uploadingMultipleFilesComplete:{id:"importActions.uploadingMultipleFilesComplete.loadingMessage",defaultMessage:"Uploaded {totalNumberOfFiles} of {totalNumberOfFiles}"},importingOneFile:{id:"importActions.importingOneFile.loadingMessage",defaultMessage:"Importing…"},importingMultipleFilesNotStarted:{id:"importActions.importingMultipleFilesNotStarted.loadingMessage",defaultMessage:"Imported 0 of {totalNumberOfFiles}"},importingMultipleFilesInProgress:{id:"importActions.importingMultipleFilesInProgress.loadingMessage",defaultMessage:"Imported {numberOfImportedFiles} of {totalNumberOfFiles}"},importingMultipleFilesComplete:{id:"importActions.importingMultipleFilesComplete.loadingMessage",defaultMessage:"Imported {totalNumberOfFiles} of {totalNumberOfFiles}"},importingFromTrelloMessage:{id:"importActions.importingFromTrello.loadingMessage",defaultMessage:"{importingCount, plural, one {Importing {importingCount} board from Trello} other {Importing {importingCount} boards from Trello}}"},importingFromAsanaMessage:{id:"importActions.importingFromAsana.loadingMessage",defaultMessage:"{importingCount, plural, one {Importing {importingCount} project from Asana} other {Importing {importingCount} projects from Asana}}"},importingFromEvernoteMessage:{id:"importActions.importingFromEvernote.loadingMessage",defaultMessage:"{importingCount, plural, one {Importing {importingCount} notebook from Evernote} other {Importing {importingCount} notebooks from Evernote}}"},importFailed:{id:"importActions.importFailedError.message",defaultMessage:"Import failed."},fileImportFailedSizeTooLarge:{id:"importActions.fileImportFailedError.sizeTooLarge.message",defaultMessage:"Import failed: file exceeds 5MB.",description:"importFile failure message when file exceeds 5MB"},trelloImportFailed:{id:"importActions.trelloImportFailedError.message",defaultMessage:"Trello import failed."},asanaImportFailed:{id:"importActions.asanaImportFailedError.message",defaultMessage:"Asana import failed."},evernoteImportFailed:{id:"importActions.evernoteImportFailedError.message",defaultMessage:"Evernote import failed."},importTitle:{id:"importActions.importTitle",defaultMessage:"Import {date}",description:"'Import' is a noun"}});function J(e){const{environment:t,spaceStore:i,spaceViewStore:n}=e,{performResult:o}=Y.createAndCommit({userAction:"importActions.result",environment:t,perform:e=>{const o=L.default.formatMessage(X.importTitle,{date:(0,O.Z)().format("ll")}),s=j.KE({environment:t,spaceStore:i,spaceViewStore:n,isPrivate:!0,prepend:!0,title:"".concat(o," Logs"),transaction:e}),a=A.UZ();return e.postSubmitCallbacks.push((e=>{e?a.reject(e):a.resolve()})),{deferred:a,pageId:s.id}}});return o}async function $(e){const{environment:t,spaceStore:i,spaceViewStore:n,notebooks:o,userSettingsStore:s}=e;if(0===o.length)throw new Error("Expected at least one notebook");G.j({message:X.importingFromEvernoteMessage,interpolatedValues:{importingCount:o.length}}),U.Z.setState({open:!1});const a=await async function(e){const{environment:t,spaceStore:i,spaceViewStore:n,notebooks:o}=e,{serverCommitResult:s,performResult:{blockStores:a}}=Y.createAndCommit({userAction:"importActions.createStacks",environment:t,perform:e=>{const s=T().uniq(T().compact(o.map((e=>e.stack)))).sort().reverse(),a={};let r=e=>!0;return o.length>1&&s.length>0&&(s.forEach((s=>{const r=j.KE({environment:t,spaceStore:i,spaceViewStore:n,isPrivate:!0,prepend:!0,loading:!1,title:s,transaction:e}),l=r.getContentStore();o.filter((e=>e.stack===s)).forEach((i=>{const n=K.j4({environment:t,type:I.ZP.copyIndicator,inMemoryRecordCache:r.inMemoryRecordCache,transaction:e,spaceId:l.pointer.spaceId});H.R3({parent:l,append:n,transaction:e}),a[i.guid]=n}))})),r=e=>!Boolean(e.stack)),o.filter(r).reverse().forEach((o=>{const s=j.KE({environment:t,spaceStore:i,spaceViewStore:n,isPrivate:!0,prepend:!0,loading:!0,title:o.title,transaction:e});a[o.guid]=s})),{blockStores:a}}});return await s,a}({environment:t,spaceStore:i,spaceViewStore:n,notebooks:o}),r=a[o[0].guid];try{return await async function(e){const{environment:t,spaceStore:i,spaceViewStore:n,notebooks:o,waitForNotebook:s,notebookMapping:a,userSettingsStore:r}=e;let l;if(A.dC(o,2,(async e=>{await Promise.all(e.map((async e=>{const i=a[e.guid];if(!i)throw new Error("Missing notebook page ".concat(e.guid));const n=A.UZ();i===s&&(l=n),await async function(e){const{environment:t,notebookStore:i,notebook:n,firstCompleted:o}=e,s=z.importEvernote(t,{notebookId:n.guid,block:{id:i.id,spaceId:(0,B.CG)(i.pointer.spaceId)},timestamp:Date.now(),parentTable:E.iU}),{value:a}=await s.next();if(a.error)throw console.error(a.error),Y.createAndCommit({userAction:"importActions.importEvernoteNotebook",environment:t,perform:e=>{const t=i.getParentBlockStore();if(t){const n=t.getContentStore();H.Od({parent:n,remove:i,transaction:e})}}}),a.error;o.resolve(void 0)}({environment:t,notebookStore:i,notebook:e,firstCompleted:n})})))})),!l)throw new Error("waitForNotebookFirstCompleted not defined.");const d=r.getSettings();null!=d&&d.created_evernote_getting_started||await j.FI({environment:t,type:"evernote",spaceStore:i,spaceViewStore:n,userSettingsStore:r});await l.promise}({environment:t,waitForNotebook:r,notebookMapping:a,notebooks:o,spaceStore:i,spaceViewStore:n,userSettingsStore:s}),G.x(),r}catch(l){throw q.showErrorMessage(L.default.formatMessage(X.evernoteImportFailed)),G.x(),l}}async function ee(e){const t=await z.getTrelloBoards(e,{});return"success"===t.type?t.data:(console.error(t.error),{boards:[]})}async function te(e){const t=await z.getAsanaWorkspaces(e,{});if("success"===t.type){const{account:e}=t.data;return e?t.data:{workspaces:[],projects:{}}}return console.error(t.error),{workspaces:[],projects:{}}}async function ie(e){try{const t=await z.getEvernoteNotebooks(e,{});if("success"===t.type){const{notebooks:e,userInfo:i}=t.data;return{notebooks:e,userInfo:i}}return console.error(t.error),{notebooks:[],userInfo:void 0}}catch(t){return console.error(t),{notebooks:[],userInfo:void 0}}}var ne=i(60709),oe=i(88632),se=i(72087),ae=i(51582),re=i(31945),le=i(8848),de=i(7908);class ce extends d.Z{renderComponent(){const{title:e,actionButton:t,onClick:i}=this.props;return o()(de.Z,{onClick:i,style:this.getButtonStyle()},void 0,this.renderIcon(),o()("div",{style:{minWidth:0,width:"100%"}},void 0,o()("div",{style:{display:"flex"}},void 0,o()("div",{style:ce.titleStyle},void 0,e),o()("div",{style:{marginLeft:"auto"}},void 0,t)),this.renderCaption()))}renderIcon(){const{icon:e,logo:t}=this.props;return t?o()("img",{style:ce.imageIconStyle,src:t}):e?o()("div",{style:this.getIconWrapStyle()},void 0,e(this.getIconStyle())):void 0}renderCaption(){const{caption:e}=this.props;if(e)return o()("div",{style:this.getCaptionStyle()},void 0,e)}getButtonStyle(){return{display:"flex",alignItems:"center",padding:10,paddingRight:8,borderRadius:3,marginBottom:12,cursor:"pointer",boxShadow:this.theme.lightBoxShadow,transition:"background 200ms ease-out",background:this.theme.importOptionsButtonBackground}}getIconWrapStyle(){return{display:"flex",alignItems:"center",justifyContent:"center",width:ce.iconSize,height:ce.iconSize,borderRadius:3,marginRight:8,color:this.theme.mediumTextColor,background:this.theme.importOptionsIconWrapBackground}}getIconStyle(){return{flexShrink:0,width:ce.iconSize,height:ce.iconSize}}getCaptionStyle(){return{fontSize:12,color:this.theme.mediumTextColor,wordBreak:"keep-all",...!this.props.shouldWrapCaption&&{...u.Z.textOverflowStyle}}}}a()(ce,"iconSize",28),a()(ce,"imageIconStyle",{flexShrink:0,width:ce.iconSize,height:ce.iconSize,borderRadius:3,marginRight:10,background:le.ZP.white}),a()(ce,"titleStyle",{fontSize:16,fontWeight:u.Z.fontWeight.medium});const ue=ce;var me=i(31942),pe=i(49085);class ge extends pe.Z{getInitialState(){return{searchQuery:"",selection:new Set}}}const he=ge;var fe=i(42922),ve=i(52275),ye=i(97758),Se=i(68894),be=i(78140),Me=i(28992),we=i(58189),Ce=i(43765),ke=i(72495),Te=i(62385),Ie=i(64369);class Ze extends d.Z{renderComponent(){return o()("div",{style:this.getStyle()},void 0,"·")}getStyle(){return{display:"inline-block",textAlign:"center",color:this.props.disabled?this.theme.lightTextColor:this.theme.mediumTextColor,userSelect:"none",WebkitUserSelect:"none",width:8}}}const Pe=Ze;class _e extends d.Z{constructor(){super(...arguments),a()(this,"storeTypes",{store:he}),a()(this,"handleSelectAllClick",(()=>{const{sections:e,analyticsName:t}=this.props,{store:i}=this.stores,{selection:n}=i.state;for(const o of e)for(const e of o.items)n.add(e.key);i.emit(),p.trackIntegrationSelectAll(this.environment,{integration_name:t})})),a()(this,"handleDeselectAllClick",(()=>{const{analyticsName:e}=this.props,{store:t}=this.stores,{selection:i}=t.state;i.clear(),t.emit(),p.trackIntegrationDeselectAll(this.environment,{integration_name:e})})),a()(this,"handleToggleItem",(e=>{const{analyticsName:t}=this.props,{store:i}=this.stores,{selection:n}=i.state;n.has(e.key)?(n.delete(e.key),p.trackIntegrationSelectItem(this.environment,{integration_name:t})):(n.add(e.key),p.trackIntegrationDeselectItem(this.environment,{integration_name:t})),i.emit()})),a()(this,"handleImport",(()=>{const{sections:e}=this.props,{selection:t}=this.stores.store.state,i=T().flatten(e.map((e=>e.items))),n=[];t.forEach((e=>{const t=i.find((t=>t.key===e));t&&n.push(t)})),this.props.onComplete(n)}))}willMount(e){const t=this.stores.store.state.selection,[i]=e.sections;if(i){const[e]=i.items;e&&t.add(e.key)}this.stores.store.emit()}renderComponent(){return o()(be.Z,{menuType:ne.o.Popup,header:this.renderMenuHeader(),footer:this.renderMenuFooter(),width:280,maxHeight:350},void 0,this.renderMenuList())}renderMenuHeader(){const{searchInputPlaceholder:e}=this.props,{searchQuery:t}=this.stores.store.state,i=Boolean(t);return o()(ke.Z,{isInput:!0,desktopStyle:{paddingBottom:2}},void 0,o()(Se.ZP,{focus:!0,focusAfterAnimation:!0,value:t,onChange:e=>{const{store:t}=this.stores;t.setState({...t.state,searchQuery:e.target.value})},placeholder:e}),o()(Me.Z,{isTokenTitle:!0,style:{marginTop:2},title:o()("div",{style:{marginLeft:-3}},void 0,o()(Te.Z,{onClick:this.handleSelectAllClick,disabled:i,disabledFeedback:!0},void 0,o()(m.FormattedMessage,{id:"importPopup.selectAll",defaultMessage:"Select all"})),o()(Pe,{disabled:i}),o()(Te.Z,{onClick:this.handleDeselectAllClick,disabled:i,disabledFeedback:!0},void 0,o()(m.FormattedMessage,{id:"importPopup.deselectAll",defaultMessage:"Deselect all"})))}))}renderMenuFooter(){const e=0===this.stores.store.state.selection.size;return o()(ke.Z,{topBorder:!0,desktopStyle:{paddingTop:8,paddingBottom:8}},void 0,o()(Me.Z,{title:o()(fe.Z,{disabled:e,onClick:this.handleImport},void 0,o()(m.FormattedMessage,{id:"integrationImportPopup.importButton.label",defaultMessage:"Import"}))}))}renderMenuList(){const{sections:e,noSearchResultsPlaceholder:t}=this.props,{store:i}=this.stores,{searchQuery:n,selection:s}=i.state,a=e.map((e=>{const t=(0,me.ZP)(n,e.items,(t=>"".concat(t.name," ").concat(e.name)));return{...e,items:t}})).filter((e=>e.items.length>0));if(0===a.length)return o()(ke.Z,{},void 0,o()(Ce.Z,{title:t}));const r=a.map((t=>({key:t.name,render:i=>l().createElement(ke.Z,w()({},i,{title:e.length>1?t.name:void 0})),items:t.items.map((e=>{const t=()=>this.handleToggleItem(e);return{key:e.key,render:i=>l().createElement(ve.Z,w()({},i,{title:e.name,icon:o()(ye.Z,{checked:s.has(e.key),size:16,onClick:t}),right:void 0!==e.count&&o()(Ie.Z,{isSmall:!0},void 0,e.count)})),action:t}}))})));return o()(we.Z,{type:we.i.Vertical,initialFocus:void 0,sections:r})}}const xe=_e;class Fe extends d.Z{constructor(){super(...arguments),a()(this,"handleClickImportAsana",(()=>{p.trackClickImportButton(this.environment,{import_source:"asana",from:this.props.analyticsFrom})})),a()(this,"handleAsanaAuth",(async()=>{await ae.w({environment:this.environment,requestStore:this.props.requestStore})})),a()(this,"handleRemoveAsana",(async()=>{await z.disconnectAsana(this.environment,{}),await this.props.requestStore.refresh(),p.trackRemoveIntegration(this.environment,{integration_name:"asana"})})),a()(this,"handleImportAsanaComplete",(async(e,t)=>{const i=T().flatten(T().values(e.projects)).filter((e=>Boolean(t.find((t=>t.key===e.gid.toString())))));p.trackImportIntegration(this.environment,{integration_name:"asana",count:t.length});const n=await async function(e){const{environment:t,projects:i,spaceStore:n,spaceViewStore:o}=e;G.j({message:X.importingFromAsanaMessage,interpolatedValues:{importingCount:i.length}}),N.Z.setState({open:!1});const{serverCommitResult:s,performResult:{pages:a}}=Y.createAndCommit({userAction:"importActions.importAsana",environment:t,perform:e=>({pages:i.map((i=>j.KE({environment:t,spaceStore:n,spaceViewStore:o,isPrivate:!0,prepend:!0,loading:!0,title:i.name,transaction:e})))})});await s;try{return await Promise.all(a.map((async(e,n)=>{const o=i[n],{value:s}=await z.importAsana(t,{block:{id:e.id,spaceId:(0,B.CG)(e.pointer.spaceId)},projectId:o.gid}).next();if(s.error)throw s.error}))),G.x(),a[0]}catch(r){throw Y.createAndCommit({userAction:"importActions.importAsana",environment:t,perform:e=>{for(const t of a)H.Od({parent:n.getPagesStore(),remove:t,transaction:e})}}),q.showErrorMessage(L.default.formatMessage(X.asanaImportFailed)),G.x(),new Error((0,Z.tg)(r).message)}}({environment:this.environment,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,projects:i});this.props.onComplete(n)}))}renderComponent(){const{asanaResult:e,intl:t}=this.props,{account:i,workspaces:n,projects:s}=e,a=n.map((e=>{const t=s[e.gid]||[];return{key:e.gid.toString(),name:e.name,items:t.map((e=>({key:e.gid.toString(),name:e.name})))}})),r={title:"Asana",logo:C.Z.images.import.asanaPng,caption:i&&i,actionButton:i&&this.props.renderItemActionsButton([{name:t.formatMessage({id:"asanaImportOption.actionsMenu.import",defaultMessage:"Import"}),action:()=>N.Z.setState({open:!0})},{name:t.formatMessage({id:"asanaImportOption.actionsMenu.connectAnotherAccount",defaultMessage:"Connect another account"}),action:this.handleAsanaAuth},{name:t.formatMessage({id:"asanaImportOption.actionsMenu.removeIntegration",defaultMessage:"Remove"}),action:this.handleRemoveAsana}]),onClick:()=>{}},{device:d}=this.environment;return o()(re.Z,{popupType:d.isMobile?re.Z.PopupType.SlideUp:re.Z.PopupType.Popup,buttonPopupStore:N.Z,onClick:this.handleClickImportAsana,render:()=>o()(xe,{searchInputPlaceholder:t.formatMessage({id:"asanaImportOption.search.placeholder",defaultMessage:"Search for a project…",description:"'Project' is an Asana term."}),noSearchResultsPlaceholder:t.formatMessage({id:"asanaImportOption.search.noResultsPlaceholder",defaultMessage:"No projects",description:"'Project' is an Asana term."}),analyticsName:"asana",sections:a,onComplete:t=>this.handleImportAsanaComplete(e,t)}),renderOrigin:e=>{let{onClick:t}=e;return l().createElement(ue,w()({},r,{onClick:i?t:this.handleAsanaAuth}))}})}}const Ae=(0,m.injectIntl)(Fe);var Be=i(73063),Ee=i(68785),Re=i(44532),De=i(77137),Le=i(58032),Oe=i(83805),Ne=i(78291);class Ue extends d.Z{constructor(){super(...arguments),a()(this,"handleClickImportEvernote",(()=>{p.trackClickImportButton(this.environment,{import_source:"evernote",from:this.props.analyticsFrom})})),a()(this,"handleRemoveEvernote",(async()=>{await z.disconnectEvernote(this.environment,{}),await this.props.requestStore.refresh(),p.trackRemoveIntegration(this.environment,{integration_name:"evernote"})})),a()(this,"handleEvernoteAuth",(async()=>{await Oe.e({environment:this.environment,requestStore:this.props.requestStore})})),a()(this,"handleImportEvernoteComplete",(async(e,t)=>{const{notebooks:i}=e,n=i.filter((e=>Boolean(t.find((t=>t.key===e.guid)))));p.trackImportIntegration(this.environment,{integration_name:"evernote",count:t.length});const o=await $({environment:this.environment,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,userSettingsStore:this.props.userSettingsStore,notebooks:n});this.props.onComplete(o)})),a()(this,"handleEvernoteHelpClick",(()=>{g.navigateToExternalURL({environment:this.environment,url:(0,h.UY)("guides.importEvernote")})}))}renderComponent(){const{device:e}=this.environment,{evernoteResult:t,intl:i}=this.props,{userInfo:n,notebooks:s}=t,a=T().groupBy(s,(e=>e.stack||"")),r=Object.keys(a).map((e=>{const t=e||"Top-Level";return{key:t,name:t,items:(a[e]||[]).map((e=>({key:e.guid,name:e.title,count:e.noteCount})))}})),{data:d}=Ne.default.state,c=Boolean(d&&d.credits.find((e=>"import_evernote"===e.type&&e.activated))),u={title:"Evernote",logo:C.Z.images.import.evernotePng,shouldWrapCaption:!n&&!c,caption:n?n.name||n.username||n.email:c?void 0:i.formatMessage({id:"evernoteImportOption.caption.getCredit",defaultMessage:"Get $5 in credit on import"}),actionButton:n?this.props.renderItemActionsButton([{name:i.formatMessage({id:"evernoteImportOption.actionsMenu.learnMore",defaultMessage:"Learn more"}),action:this.handleEvernoteHelpClick},{name:i.formatMessage({id:"evernoteImportOption.actionsMenu.import",defaultMessage:"Import"}),action:()=>U.Z.setState({open:!0})},{name:i.formatMessage({id:"evernoteImportOption.actionsMenu.connectAnotherAccount",defaultMessage:"Connect another account"}),action:this.handleEvernoteAuth},{name:i.formatMessage({id:"evernoteImportOption.actionsMenu.removeIntegration",defaultMessage:"Remove"}),action:this.handleRemoveEvernote}]):this.props.defaultActionButton,onClick:()=>{}};return o()(re.Z,{popupType:e.isMobile?re.Z.PopupType.SlideUp:re.Z.PopupType.Popup,buttonPopupStore:U.Z,onClick:this.handleClickImportEvernote,render:()=>o()(xe,{searchInputPlaceholder:i.formatMessage({id:"evernoteImportOption.search.placeholder",defaultMessage:"Search for a notebook…",description:"'Notebook' is an Evernote term."}),noSearchResultsPlaceholder:i.formatMessage({id:"evernoteImportOption.search.noResultsPlaceholder",defaultMessage:"No notebooks",description:"'Notebook' is an Evernote term."}),analyticsName:"evernote",sections:r,onComplete:e=>this.handleImportEvernoteComplete(t,e)}),renderOrigin:e=>{let{onClick:t}=e;return l().createElement(ue,w()({},u,{onClick:n?t:this.handleEvernoteAuth}))}})}}const We=(0,m.injectIntl)(Ue);var Ve=i(52192);class ze extends d.Z{constructor(){super(...arguments),a()(this,"handleClickImportTrello",(()=>{p.trackClickImportButton(this.environment,{import_source:"trello",from:this.props.analyticsFrom})})),a()(this,"handleTrelloAuth",(async()=>{await Ve.M({environment:this.environment,requestStore:this.props.requestStore})})),a()(this,"handleRemoveTrello",(async()=>{await z.disconnectTrello(this.environment,{}),await this.props.requestStore.refresh(),p.trackRemoveIntegration(this.environment,{integration_name:"trello"})})),a()(this,"handleImportTrelloComplete",(async(e,t)=>{const{boards:i}=e,n=i.filter((e=>Boolean(t.find((t=>t.key===e.id)))));p.trackImportIntegration(this.environment,{integration_name:"trello",count:t.length});const o=await async function(e){const{environment:t,boards:i,spaceStore:n,spaceViewStore:o}=e;G.j({message:X.importingFromTrelloMessage,interpolatedValues:{importingCount:i.length}}),W.Z.setState({open:!1});const{performResult:{deferred:s,pages:a}}=Y.createAndCommit({userAction:"importActions.importTrello",environment:t,perform:e=>{const s=i.map((i=>j.KE({environment:t,spaceStore:n,spaceViewStore:o,isPrivate:!0,prepend:!0,loading:!0,title:i.name,transaction:e}))),a=A.UZ();return e.postSubmitCallbacks.push((e=>{e?a.reject(e):a.resolve()})),{deferred:a,pages:s}}});await s.promise;try{return await Promise.all(a.map((async(e,n)=>{const o=i[n],{value:s}=await z.importTrello(t,{boardId:o.id,block:{id:e.id,spaceId:(0,B.CG)(e.pointer.spaceId)}}).next();if(s.error)throw s.error}))),G.x(),a[0]}catch(r){throw Y.createAndCommit({userAction:"importActions.importTrello",environment:t,perform:e=>{for(const t of a)H.Od({parent:n.getPagesStore(),remove:t,transaction:e})}}),q.showErrorMessage(L.default.formatMessage(X.trelloImportFailed)),G.x(),new Error((0,Z.tg)(r).message)}}({environment:this.environment,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,boards:n});this.props.onComplete(o)}))}renderComponent(){const{device:e}=this.environment,{trelloResult:t,intl:i}=this.props,{account:n,boards:s}=t,a={key:"default",name:i.formatMessage({id:"trelloImportOption.boardProperty.defaultName",defaultMessage:"Boards"}),items:s.map((e=>({key:e.id,name:e.name})))},r={title:"Trello",logo:C.Z.images.import.trelloPng,actionButton:n&&this.props.renderItemActionsButton([{name:i.formatMessage({id:"trelloImportOption.actionsMenu.import",defaultMessage:"Import"}),action:()=>W.Z.setState({open:!0})},{name:i.formatMessage({id:"trelloImportOption.actionsMenu.connectAnotherAccount",defaultMessage:"Connect another account"}),action:this.handleTrelloAuth},{name:i.formatMessage({id:"trelloImportOption.actionsMenu.removeIntegration",defaultMessage:"Remove"}),action:this.handleRemoveTrello}]),onClick:()=>{}};return o()(re.Z,{popupType:e.isMobile?re.Z.PopupType.SlideUp:re.Z.PopupType.Popup,buttonPopupStore:W.Z,onClick:this.handleClickImportTrello,render:()=>o()(xe,{searchInputPlaceholder:i.formatMessage({id:"trelloImportOption.search.placeholder",defaultMessage:"Search for a board…",description:"'Board' is a Trello term."}),noSearchResultsPlaceholder:i.formatMessage({id:"trelloImportOption.search.noResultsPlaceholder",defaultMessage:"No boards",description:"'Board' is a Trello term."}),analyticsName:"trello",sections:[a],onComplete:e=>this.handleImportTrelloComplete(t,e)}),renderOrigin:e=>{let{onClick:t}=e;return l().createElement(ue,w()({},r,{onClick:n?t:this.handleTrelloAuth}))}})}}const qe=(0,m.injectIntl)(ze);class He extends d.Z{constructor(){super(...arguments),a()(this,"storeTypes",{trelloRequestStore:se.Z,asanaRequestStore:se.Z,evernoteRequestStore:se.Z}),a()(this,"handleFileUploadClick",(async e=>{p.trackClickImportButton(this.environment,{import_source:e,from:this.props.analyticsFrom});const t=await async function(e){const{environment:t,pageStore:i,spaceStore:n,isTeamPage:o,spaceViewStore:s,uploadType:a}=e;let r;try{const e=await Q.y({multiple:!0,accept:x[a].join(",")});if(0===e.length)return;const l=1===e.length;if("confluence"===a){const i=(0,R.f)(t)?16106127360:2684354560;if(e[0].size>i)throw new Z.nY("Maximum upload size exceeded",{clientData:{type:"upload_file_size_exceeded",messageValues:{maxSize:F.td(i,1)}}})}const d=await new Promise(((i,n)=>{Q.IL({environment:t,uploadType:a,files:e,bucket:"temporary",preventLimitFreeFileSize:!0,onBatchStart:()=>{G.j({message:l?X.uploadingOneFile:X.uploadingMultipleFilesNotStarted,interpolatedValues:{totalNumberOfFiles:e.length,percentComplete:0}})},onBatchProgress:t=>{let{uploadedFiles:i,progressPercent:n}=t;G.j({message:l?X.uploadingOneFile:X.uploadingMultipleFilesInProgress,interpolatedValues:{numberOfUploadedFiles:i,totalNumberOfFiles:e.length,percentComplete:n}})},onBatchComplete:t=>{G.j({message:l?X.uploadingOneFile:X.uploadingMultipleFilesComplete,interpolatedValues:{totalNumberOfFiles:e.length,percentComplete:100}}),i(t)},onBatchError:n})}));let c,u;if(i&&i.isEmptyPage())e.length>1||i.isInsideCollection()?(c=i.id,u="AppendToBlock"):(c=i.id,u="ReplaceBlock");else{const{performResult:i}=Y.createAndCommit({userAction:"importActions.result",environment:t,perform:i=>{const a=L.default.formatMessage(X.importTitle,{date:(0,O.Z)().format("ll")}),r=j.KE({environment:t,spaceStore:n,spaceViewStore:s,isPrivate:!o,prepend:!o,title:a,transaction:i});let l;l=e.length>1?"AppendToBlock":"ReplaceBlock";const d=A.UZ();return i.postSubmitCallbacks.push((e=>{e?d.reject(e):d.resolve()})),{deferred:d,createdPage:r,pageId:r.id,importType:l}}});r=i.createdPage,c=i.pageId,u=i.importType,await i.deferred.promise}const m=d.map(((t,i)=>({fileURL:t,fileName:e[i].name})));let p=0;G.j({message:l?X.importingOneFile:X.importingMultipleFilesInProgress,interpolatedValues:{numberOfImportedFiles:p,totalNumberOfFiles:e.length}});for(const{fileURL:i,fileName:o}of m){if("confluence"===a){let e;if((0,R.f)(t)){const i=J({environment:t,spaceStore:n,spaceViewStore:s});await i.deferred.promise,e=i.pageId}const a=z.importConfluenceExport(t,{fileURL:i,fileName:o,page:{id:c,spaceId:n.id},...e&&{loggerPageId:e}});for await(const t of a){if(t.error)throw t.error;t.value.isComplete||G.j(t.value.status)}}else if("AppendToBlock"===u){const{value:e}=await z.importFile(t,{fileURL:i,fileName:o,importType:u,block:{id:c,spaceId:n.id}}).next();if(e.error)throw e.error}else if("ReplaceBlock"===u){const{value:e}=await z.importFile(t,{fileURL:i,fileName:o,importType:u,block:{id:c,spaceId:n.id}}).next();if(e.error)throw e.error}p++,G.j({message:l?X.importingOneFile:X.importingMultipleFilesInProgress,interpolatedValues:{numberOfImportedFiles:p,totalNumberOfFiles:e.length}})}return G.x(),V.Z.createChildStore(n,{table:E.iU,id:c})}catch(c){var l,d;let e;G.x(),Y.createAndCommit({userAction:"importActions.importFiles",environment:t,perform:e=>{r&&H.Od({parent:n.getPagesStore(),remove:r,transaction:e})}});let i=null;throw c instanceof Z.hm&&c.clientData?i=c.clientData:c instanceof Z.nY&&"upload_file_size_exceeded"===(null===(l=c.body)||void 0===l||null===(d=l.clientData)||void 0===d?void 0:d.type)&&(i=c.body.clientData),e=i&&i.type&&D.zP[i.type]?L.default.formatMessage(D.zP[i.type],i.messageValues):"ImportFileSizeTooLargeError"===(0,Z.tg)(c).message?L.default.formatMessage(X.fileImportFailedSizeTooLarge):L.default.formatMessage(X.importFailed),q.showErrorMessage(e),c}}({environment:this.environment,pageStore:this.props.pageStore,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,uploadType:e});t&&this.props.onComplete(t)}))}renderComponent(){if(!oe.Z.state.online)return o()("div",{style:{...He.wrapStyle,fontSize:14,color:this.theme.mediumTextColor}},void 0,o()(m.FormattedMessage,{id:"importOptions.offlineErrorMessage",defaultMessage:"Please go online to import."}));const{analyticsFrom:e}=this.props;return this.renderRequests((t=>t?o()("div",{style:He.wrapStyle},void 0,this.renderOptions(t)):o()("div",{style:"onboarding"===e?{}:He.wrapStyle},void 0,o()(Ee.Z,{}))))}renderOptions(e){return o()("div",{style:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gridAutoRows:"1fr",gap:"4px 16px",width:"100%"}},void 0,this.renderEvernoteImportOption(e.evernoteResult),this.renderTrelloImportOption(e.trelloResult),this.renderAsanaImportOption(e.asanaResult),this.renderConfluenceImportOption(),o()(ue,{title:o()(m.FormattedMessage,{id:"importOptions.textMarkdown.title",defaultMessage:"Text & Markdown",description:"Button title for importing plain text and/or Markdown content into Notion"}),icon:c.Z.importText,onClick:()=>this.handleFileUploadClick("markdown")}),o()(ue,{title:"CSV",icon:c.Z.importCSV,onClick:()=>this.handleFileUploadClick("csv")}),o()(ue,{title:"HTML",icon:c.Z.importHTML,onClick:()=>this.handleFileUploadClick("html")}),o()(ue,{title:"Word",logo:C.Z.images.import.wordPng,onClick:()=>this.handleFileUploadClick("docx")}),o()(ue,{title:"Google Docs",logo:C.Z.images.import.googleDocsPng,actionButton:this.renderHelpButtonToURL((0,h.UY)("guides.importGoogleDocs")),onClick:()=>this.handleFileUploadClick("gdocs")}),o()(ue,{title:"Dropbox Paper",logo:C.Z.images.import.dropboxPaperPng,actionButton:this.renderHelpButtonToURL((0,h.UY)("guides.importDropboxPaper")),onClick:()=>this.handleFileUploadClick("dropbox")}),o()(ue,{title:"Quip",logo:C.Z.images.import.quipPng,actionButton:this.renderHelpButtonToURL((0,h.UY)("guides.importQuip")),onClick:()=>this.handleFileUploadClick("quip")}),o()(ue,{title:"Workflowy",logo:C.Z.images.import.workflowyPng,actionButton:this.renderHelpButtonToURL((0,h.UY)("guides.importWorkflowy")),onClick:()=>this.handleFileUploadClick("workflowy")}))}renderRequests(e){return o()(De.Z,{request:this.environment,performRequest:ee,requestStore:this.stores.trelloRequestStore,render:(t,i)=>o()(De.Z,{request:this.environment,performRequest:te,requestStore:this.stores.asanaRequestStore,render:(t,n)=>o()(De.Z,{request:this.environment,performRequest:ie,requestStore:this.stores.evernoteRequestStore,render:(t,o)=>e(i&&n&&o?{trelloResult:i,asanaResult:n,evernoteResult:o}:void 0)})})})}renderTrelloImportOption(e){return o()(qe,{trelloResult:e,analyticsFrom:this.props.analyticsFrom,renderItemActionsButton:this.renderItemActionsButton,onComplete:this.props.onComplete,requestStore:this.stores.trelloRequestStore,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,userSettingsStore:this.props.userSettingsStore})}renderAsanaImportOption(e){return o()(Ae,{asanaResult:e,analyticsFrom:"onboarding",renderItemActionsButton:this.renderItemActionsButton,onComplete:this.props.onComplete,requestStore:this.stores.asanaRequestStore,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,userSettingsStore:this.props.userSettingsStore})}renderConfluenceImportOption(){return o()(ue,{title:"Confluence",logo:C.Z.images.import.confluencePng,onClick:()=>this.handleFileUploadClick("confluence"),actionButton:this.renderHelpButtonToURL((0,h.UY)("guides.importConfluence"))})}renderEvernoteImportOption(e){return o()(We,{evernoteResult:e,analyticsFrom:"onboarding",renderItemActionsButton:this.renderItemActionsButton,defaultActionButton:this.renderHelpButtonToURL((0,h.UY)("guides.importEvernote")),onComplete:this.props.onComplete,requestStore:this.stores.evernoteRequestStore,spaceStore:this.props.spaceStore,spaceViewStore:this.props.spaceViewStore,userSettingsStore:this.props.userSettingsStore})}renderHelpButtonToURL(e){return o()(Le.Z,{renderTooltip:()=>o()(m.FormattedMessage,{id:"importOptions.helpButton.tooltip",defaultMessage:"Learn about how to import"}),render:t=>l().createElement(y.Z,w()({external:!0,href:e,style:{marginLeft:"auto"}},t),o()(Be.Z,{icon:c.Z.help}))})}renderItemActionsButton(e){return o()(re.Z,{popupType:Re.kQ.Popup,renderOrigin:e=>l().createElement(Be.Z,w()({icon:c.Z.dots},e)),render:t=>{const i={key:"section",render:e=>l().createElement(ke.Z,e),items:e.map((e=>{let{name:i,action:n}=e;return{key:i,render:e=>l().createElement(ve.Z,w()({},e,{title:i})),action:()=>{n(),t.close()}}}))};return o()(be.Z,{menuType:ne.o.Popup,width:200},void 0,o()(we.Z,{type:we.i.Vertical,initialFocus:void 0,sections:[i]}))}})}}a()(He,"wrapStyle",{display:"flex",alignItems:"center",justifyContent:"center",width:752,minHeight:240}),a()(He,"optionsColumnStyle",{width:240});const Ge=He;class Ke extends d.Z{constructor(){super(...arguments),a()(this,"handleModalDismiss",(()=>{v.Z.setState({open:!1})})),a()(this,"handleImportComplete",(e=>{v.Z.setState({open:!1}),g.navigateToBlock({environment:this.environment,store:e})}))}renderComponent(){const e=v.Z.state;return o()(S.Z,{open:e.open,innerStyle:Ke.wrapStyle,preventHideChildrenWhileOpening:!0,render:()=>o()(r.Fragment,{},void 0,o()("div",{style:Ke.modalTopbarWrapStyle},void 0,o()("div",{style:Ke.modalTopbarHeaderStyle},void 0,o()(m.FormattedMessage,{id:"importModal.importButton.label",defaultMessage:"Import"})),this.renderHelpButton()),o()("div",{},void 0,this.renderImportOptions(e))),onDismiss:this.handleModalDismiss})}renderHelpButton(){return o()(y.Z,{href:(0,h.UY)("guides.import"),onClick:()=>p.trackClickHelpButton(this.environment,{from:"import"}),external:!0},void 0,o()(b.Z,{isSmall:!0,icon:c.Z.help,isGray:!0},void 0,o()(m.FormattedMessage,{id:"importModal.helpButton.label",defaultMessage:"Learn about importing"})))}renderImportOptions(e){const{mainEditorCurrentBlockStore:t,currentSpaceStore:i,currentSpaceViewStore:n,currentUserSettingsStore:s}=f.default.state;if(t&&i&&n&&s)return o()(Ge,{pageStore:e.open&&e.pageStore?e.pageStore:t,spaceStore:i,spaceViewStore:n,userSettingsStore:s,analyticsFrom:"modal",onComplete:this.handleImportComplete,readOnlyCreditButton:!1})}}a()(Ke,"wrapStyle",{padding:"24px 36px 24px",minWidth:300}),a()(Ke,"modalTopbarWrapStyle",{display:"flex",alignItems:"center",marginTop:8,marginBottom:18}),a()(Ke,"modalTopbarHeaderStyle",{fontSize:24,lineHeight:1.2,marginBottom:6,fontWeight:u.Z.fontWeight.bold,marginRight:"auto"});const je=Ke},21523:(e,t,i)=>{i.d(t,{Z:()=>h});var n=i(77094),o=i.n(n),s=(i(67294),i(83355)),a=i(53397),r=i(5366),l=i(50906),d=i(33665),c=i(23537),u=i(16354),m=i(91941),p=i(64369);class g extends s.Z{renderComponent(){const{device:e,WindowSizeStore:t}=this.environment;return o()(u.Z,{href:(0,d.UY)("guides.sharing"),onClick:()=>l.trackClickHelpButton(this.environment,{from:"sharing"}),style:{width:e.isMobile?"100%":void 0},external:!0},void 0,o()(m.Z,{mobileFeedback:e.isMobile,isSmall:!0,style:{display:"flex",alignItems:"center",width:e.isMobile?"100%":void 0,height:e.isMobile?44:24,paddingTop:e.isMobile?12:4,paddingBottom:e.isMobile?12:4,paddingLeft:t.getSafePaddingLeftCSS(8),paddingRight:t.getSafePaddingRightCSS(12),...this.props.style},disabled:Boolean(this.props.disableHover)},void 0,o()("div",{style:{marginLeft:e.isMobile?2:0,marginRight:e.isMobile?8:6}},void 0,a.Z.help({width:e.isMobile?16:14,height:e.isMobile?16:14,fill:e.isMobile?this.theme.mediumIconColor:this.theme.lightIconColor})),o()(p.Z,{isSmall:!0,isMobile:e.isMobile,isSecondaryColor:!e.isMobile},void 0,(0,c.bq)()?o()(r.FormattedMessage,{defaultMessage:"Learn more",id:"blockPermissionsSettings.learnMore.prompt"}):o()(r.FormattedMessage,{defaultMessage:"Learn about sharing",id:"blockPermissionsSettings.learnAboutSharing.prompt"}))))}}const h=g},70765:(e,t,i)=>{i.d(t,{h:()=>d});var n=i(77094),o=i.n(n),s=(i(33948),i(67294)),a=i.n(s),r=i(24405),l=i(43250);function d(e){const{paragraphs:t}=e,i=(0,r.y)((e=>({skeletonRect:{borderRadius:3,backgroundColor:e.lightDividerColor}})),[]),n=null==t?void 0:t.map((e=>{const t={height:e.lineHeight,marginTop:e.lineMargin,marginBottom:e.lineMargin},n={marginTop:e.sectionMargin,marginBottom:e.sectionMargin},s=[...Array(e.repeat||1)].map((s=>o()("div",{style:{...n}},void 0,e.sectionWidths.map((e=>o()("div",{className:l.MD,style:{...i.skeletonRect,...t,width:"".concat(e,"%")}}))))));return a().createElement(a().Fragment,null," ",s," ")}));return a().createElement(a().Fragment,null," ",n," ")}},93187:(e,t,i)=>{i.r(t),i.d(t,{default:()=>v});var n=i(77094),o=i.n(n),s=i(77422),a=i.n(s),r=(i(33948),i(67294),i(83355)),l=i(5366),d=i(11302),c=i(80456),u=i(39883),m=i(90447),p=i(42330),g=i(44532),h=i(23566);class f extends r.Z{constructor(){super(...arguments),a()(this,"renderModal",(()=>{const e=p.Z.state;if(e.isOpen)return o()(h.Z,{captureSelection:!0,restoreSelection:!this.environment.device.isMobile,autocompleteQuery:e.autocompleteQuery,targets:e.targets,onAutocompleteQueryChange:this.handleAutocompleteQueryChange,onAccept:this.handleAccept,onCancel:this.handleCancel,desktopWidth:330,isAddTo:e.isAddTo,isCreateIn:!1})})),a()(this,"completeMoveTransaction",(async e=>{await c.createAndCommitAsync({environment:this.environment,userAction:"MoveToMenuRenderer.completeMoveTransaction",waitForServerCommit:!1,perform:async t=>{await d.RL({environment:this.environment,value:e,transaction:t})}})})),a()(this,"handleAccept",(async e=>{const t=p.Z.state.isOpen&&p.Z.state.needsConfirmation,i=p.Z.state.isOpen&&p.Z.state.targets||[];if(t){await(0,m.vW)({environment:this.environment,moveToLocation:(0,m.WH)(e),movedItems:i})?this.completeMoveTransaction(e):this.handleCancel()}else{for(const e of i){const t=await(0,u.SC)({environment:this.environment,block:e,action:"move"});"user_canceled"===t?this.handleCancel():t.length>1&&p.Z.state.isOpen&&p.Z.setState({...p.Z.state,targets:t})}this.completeMoveTransaction(e)}})),a()(this,"handleCancel",(()=>{d.xv(this.environment)})),a()(this,"handleAutocompleteQueryChange",(e=>{p.Z.state.isOpen&&p.Z.setState({...p.Z.state,autocompleteQuery:e})}))}renderComponent(){const{device:e}=this.environment,t=p.Z.state;return o()(g.ZP,{popupType:e.isMobile?g.ZP.PopupType.SlideUp:g.ZP.PopupType.Popup,alignmentToOrigin:g.ZP.Alignment.Start,open:t.isOpen,render:this.renderModal,originRect:t.isOpen?t.rect:void 0,onDismiss:()=>d.xv(this.environment)})}}const v=(0,l.injectIntl)(f)},79590:(e,t,i)=>{i.r(t),i.d(t,{default:()=>w});var n=i(77094),o=i.n(n),s=i(67294),a=i.n(s),r=i(24405),l=(i(33948),i(480)),d=i(28350),c=i(59054),u=i(63143),m=i(5366),p=i(31299),g=i(65452),h=i(28020),f=i(35026),v=i(27832),y=i(12318),S=i(68128),b=i(54124);const M=function(e){const{teamId:t}=e,i=(0,l.O7)(),[{currentSpaceStore:n,currentSpaceViewStore:r,currentUserSettingsStore:M,currentUserStore:w}]=(0,d.oR)(v.default),C=(0,d.VK)((()=>{if(!t)return;const e=(0,h.k_)(i).state;if(r&&e){var n;const i=null==r||null===(n=r.getTeamsStores())||void 0===n?void 0:n.find((e=>e.id===t));if(i){var o;const n=e.teamPagesMap.get(t),s=n?Array.from(n.values()):[],a=null!==(o=i.getPinnedPagesStore().getValue())&&void 0!==o?o:[];return{type:"team",teamStore:i,teamPages:s,pinnedPages:a}}}}),[i,r,t]),k=(0,s.useMemo)((()=>({query:"",filter:"all",numPagesShown:S.k4})),[]),[T,I]=a().useState(k),[{status:Z}]=(0,c.r5)((async()=>{const e=null==n?void 0:n.id,t=null==w?void 0:w.id;t&&e&&await(0,g.l)({environment:i,spaceId:e,userId:t})}),[i,n,w],{debounce:p.vp,interval:30*u.C0}),P=(0,m.useIntl)(),_=(0,d.VK)((()=>{if(!C)return[];const e=(0,f.l6)({allSharedPages:C.teamPages,state:T,intl:P,teamStore:C.teamStore});return(0,f.vs)({sharedPageItems:e})}),[C,T,P]),x=(0,s.useMemo)((()=>new y.default(!1)),[]);return a().useEffect((()=>{var e;null===(e=i.mobileNative)||void 0===e||e.markTransitionReady({type:"modal",id:"NativeTeamsOutlinerViewAllPopover"})})),n&&r&&M&&C?o()(b.Z,{isLoading:"pending"===Z,state:T,setState:I,type:"team",spaceStore:n,spaceViewStore:r,sharedPages:_,allSharedPageIds:C.teamPages.map((e=>{let{id:t}=e;return t})),visiblePageIds:C.pinnedPages,openStore:x,teamStore:C.teamStore}):null};const w=function(e){const{route:t}=e,i=(0,r.F)();return"teamOutlinerViewAll"===t.tab?o()("div",{style:{background:i.popoverBackground}},void 0,o()(M,{teamId:t.teamId})):null}},7811:(e,t,i)=>{i.r(t),i.d(t,{default:()=>H});var n=i(97464),o=i.n(n),s=i(77094),a=i.n(s),r=i(77422),l=i.n(r),d=(i(33948),i(67294)),c=i.n(d),u=i(83355),m=i(53397),p=i(89101),g=i(68989),h=i(82990),f=i(5366),v=i(50906),y=i(54564),S=i(47307),b=i(85997),M=i(26111),w=i(80456),C=i(43250),k=i(34859),T=i(27832),I=i(88632),Z=i(54835),P=i(56638),_=i(88923),x=i(50795),F=i(42922),A=i(7908),B=i(57770),E=i(68785),R=i(40721),D=i(22346),L=i(44532),O=i(18647),N=i(89302),U=i(31792),W=i(14694);class V extends u.Z{constructor(){super(...arguments),l()(this,"storeTypes",{mouseStore:U.Z,labelMouseStore:U.Z}),l()(this,"handleToggleClick",(()=>{const{section:e}=this.props;v.trackToggleTemplateSection(this.environment,{section_name:e.sectionName,action:this.isOpen()?"close":"open"}),this.isOpen()?b.Jj(e.sectionName):b.GS(e.sectionName)})),l()(this,"handleMouseMove",(()=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!0}))),l()(this,"handleMouseLeave",(()=>this.stores.mouseStore.setState({...this.stores.mouseStore.state,mouseEntered:!1}))),l()(this,"handleLabelMouseMove",(()=>{const{labelMouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!0})})),l()(this,"handleLabelMouseLeave",(()=>{const{labelMouseStore:e}=this.stores;e.setState({...e.state,mouseEntered:!1})}))}renderComponent(){const{renderSection:e}=this.props,t=!this.isOpen();return a()("div",{onMouseMove:this.handleMouseMove,onMouseLeave:this.handleMouseLeave,style:this.getButtonContainerStyle()},void 0,this.renderLabel(),!t&&e())}renderLabel(){const e=!this.isOpen();return a()(W.Z,{isMobile:this.props.isMobile,disableMobileBorder:e,shouldShowMobileMarginBottom:e,style:this.getSectionSidebarItemStyle(),childrenStyle:{overflow:"visible"}},void 0,a()("div",{style:{display:"flex",alignItems:"center"}},void 0,a()(A.Z,{onClick:this.handleToggleClick,onMouseMove:this.handleLabelMouseMove,onMouseLeave:this.handleLabelMouseLeave,style:this.getLabelButtonStyle()},void 0,!Boolean(this.props.forceOpen)&&m.Z.triangle(this.getArrowStyle()),a()("span",{style:this.getToggleButtonStyle()},void 0,this.props.icon&&a()("span",{style:{paddingRight:4,display:"inline-block"}},void 0,this.props.icon),this.props.section.name))))}isOpen(){const{section:e,expandedSections:t}=this.props;return!!t&&-1!==t.indexOf(e.sectionName)}getSectionSidebarItemStyle(){return{minHeight:24,padding:0}}getSectionLabelStyle(){return{lineHeight:1,marginBottom:1,color:this.theme.sidebarTextColor,fontWeight:h.Z.fontWeight.semibold,marginLeft:9}}getMobileSectionLabelStyle(){return{lineHeight:1,color:this.theme.sidebarTextColor,fontWeight:h.Z.fontWeight.semibold,marginLeft:9}}getLabelButtonStyle(){return{display:"flex",alignItems:"center",paddingBottom:12,paddingTop:12,paddingLeft:25,...this.props.isMobile&&{marginBottom:8},width:"100%"}}getToggleButtonStyle(){const{labelMouseStore:e}=this.stores,{mouseEntered:t}=e.state;return{...this.props.isMobile?this.getMobileSectionLabelStyle():this.getSectionLabelStyle(),color:t?this.theme.regularTextColor:this.theme.mediumTextColor,transition:"color 100ms ease-out"}}getButtonContainerStyle(){const e=!this.isOpen(),{first:t}=this.props;return{...t?{borderTop:"1px solid ".concat(this.theme.regularDividerColor)}:{},borderBottom:"1px solid ".concat(this.theme.regularDividerColor),width:"100%",paddingBottom:e?0:10}}getArrowStyle(){return{width:"0.6875em",height:"0.6875em",transition:"transform 200ms ease-out",transform:"rotateZ(".concat(this.isOpen()?180:90,"deg)"),fill:this.theme.regularIconColor}}}const z=V;class q extends u.Z{constructor(){super(...arguments),l()(this,"storeTypes",{templateRecordCacheStore:x.$}),l()(this,"renderMobilePopup",(()=>{const e=P.Z.state;if(e.open)return a()(R.default,{title:a()(f.FormattedMessage,{defaultMessage:"Try this template",id:"pageTemplateModal.mobileModal.title"}),left:a()(R.CancelMenuText,{}),onClickLeft:this.handleDismiss,right:e.isLoading?a()(E.Z,{}):a()(f.FormattedMessage,{defaultMessage:"Use",id:"pageTemplateModal.mobileModal.useButton.label",description:"'Use' is utilized as a verb for a button label on the top right of a mobile menu, indicating to the user to click on the button to use the template they are previewing."}),onClickRight:this.handleUseTemplateClick,forceFullScreenSlideUp:!0},void 0,this.renderPreview(e))})),l()(this,"renderModal",(()=>{const e=P.Z.state;if(e.open)return a()("div",{style:q.modalStyle,className:C.fH},void 0,this.renderPreview(e),this.renderSidebar(e))})),l()(this,"handleDismiss",(async()=>{const{inMemoryRecordCache:e}=this.stores.templateRecordCacheStore.state;if(e.appliedTransaction){await this.showEditConfirmDialog()?this.accept(!0):this.close()}else this.close()})),l()(this,"handleUseTemplateClick",(async()=>{const{inMemoryRecordCache:e}=this.stores.templateRecordCacheStore.state;if(e.appliedTransaction){await this.showEditConfirmDialog()?this.accept(!0):this.accept(!1)}else this.accept(!1)})),l()(this,"handleItemClick",(async e=>{const{inMemoryRecordCache:t}=this.stores.templateRecordCacheStore.state;if(t.appliedTransaction){await this.showEditConfirmDialog()?this.accept(!0):this.setCurrentItem(e)}else this.setCurrentItem(e);v.trackTemplateModalItemClick(this.environment,{template_name:e.name})}))}willMountOrUpdate(){const e=P.Z.state,{currentSpaceViewStore:t}=T.default.state;e.open&&t&&w.createAndCommit({userAction:"PageTemplateModal.willMountOrUpdate",environment:this.environment,perform:i=>{b.GF({item:e.item,spaceViewStore:t,transaction:i})}})}renderComponent(){const{device:e}=this.environment,t=P.Z.state;return e.isMobile?a()(L.GI,{open:t.open,render:this.renderMobilePopup,forceFullScreenSlideUp:!0,onDismiss:this.handleDismiss,popupType:e.isMobile?L.GI.PopupType.SlideUp:L.GI.PopupType.Popup}):a()(D.Z,{open:t.open,render:this.renderModal,onDismiss:this.handleDismiss})}renderSidebar(e){const{currentSpaceViewStore:t,currentSpaceStore:i}=T.default.state;if(!t||!i)return;const n=b.YH(),s=(0,g.dz)(this.props.intl),r="on"===Z.default.getGroup("suggested-templates");return a()("div",{style:this.getSidebarStyle()},void 0,a()(F.Z,{isLarge:!0,onClick:this.handleUseTemplateClick,style:q.useTemplateButtonStyle,disabled:e.isLoading||!I.Z.state.online},void 0,e.isLoading&&a()(E.Z,{isWhite:!0,style:{marginRight:6}}),a()(f.FormattedMessage,{defaultMessage:"Use this template",id:"pageTemplateModal.useTemplateButton.label"})),a()(O.Z,{style:q.scrollerStyle,type:k.Z.Y},void 0,r&&a()(z,{isMobile:!1,section:s,expandedSections:[...n||[],"suggested"],spaceStore:i,spaceViewStore:t,showAddPageButton:!1,first:!0,forceOpen:!0,icon:m.Z.sparkles({width:12}),renderSection:()=>a()(d.Fragment,{},void 0,s.items.map(((t,i)=>{const n=e.item.rootId===t.rootId,s=n?this.hoveredButtonStyle():{};return c().createElement(A.Z,o()({hovered:n,style:s,key:i},this.props,{onClick:()=>this.handleItemClick(t)}),this.renderSidebarItem(t))})))},"suggested"),e.sections.map(((s,l)=>a()(z,{isMobile:!1,section:s,expandedSections:n,spaceStore:i,spaceViewStore:t,showAddPageButton:!1,first:!r&&0===l,renderSection:()=>a()(d.Fragment,{},void 0,s.items.map(((t,i)=>{const n=e.item.rootId===t.rootId,s=n?this.hoveredButtonStyle():{};return c().createElement(A.Z,o()({hovered:n,style:s,key:i},this.props,{onClick:()=>this.handleItemClick(t)}),this.renderSidebarItem(t))})))},s.sectionName))),a()(A.Z,{onClick:()=>{v.trackBrowseMoreTemplatesLink(this.environment),(0,M.navigateToExternalURL)({environment:this.environment,url:p._j.templates})},style:this.fixedLinkStyle(),hoveredStyle:{background:this.theme.sidebarHideButtonHoveredBackground},pressedStyle:{background:this.theme.sidebarHideButtonPressedBackground}},void 0,m.Z.typesRelation(this.fixedLinkIconStyle()),a()(f.FormattedMessage,{defaultMessage:"Browse more templates",id:"pageTemplateModal.goToFullTemplateGalleryButton.label"}))))}renderSidebarItem(e){return a()(W.Z,{style:{paddingLeft:30,fontWeight:h.Z.fontWeight.semibold},isMobile:!1,icon:a()("div",{style:this.getIconWrapStyle()},void 0,a()(B.Z,{size:20,emoji:e.emoji}))},void 0,e.name)}renderPreview(e){const{device:t}=this.environment;return a()(N.Z,{previewRootId:e.item.previewRootId,isFrontPage:!1,style:t.isMobile?q.previewMobileStyle:q.previewStyle,templateRecordCacheStore:this.stores.templateRecordCacheStore,disabled:!1},e.item.previewRootId)}accept(e){const{inMemoryRecordCache:t}=this.stores.templateRecordCacheStore.state,i=P.Z.state,{currentSpaceViewStore:n,currentSpaceStore:o,mainEditorCurrentBlockStore:s}=T.default.state;if(i.open&&n&&o){const a=s&&s.isEmptyPage()?s:void 0,r=_.default.state.open&&_.default.state.target&&_.default.state.target.isEmptyPage()?_.default.state.target:void 0;b.RL({environment:this.environment,item:i.item,spaceStore:o,spaceViewStore:n,useRecordCache:e?t:void 0,initializeStore:i.createNewPage?void 0:a||r,isPrivate:i.isPrivate,from:i.createNewPage?"sidebar":"newPage"})}}close(){b.xv(this.environment),y.LZ()}setCurrentItem(e){P.Z.state.open&&b.zO({templateItem:e,currentUserId:this.environment.currentUser.id})}showEditConfirmDialog(){return new Promise(((e,t)=>{S.showDialog({message:a()(f.FormattedMessage,{id:"pageTemplateModal.modifiedTemplateDialog.prompt",defaultMessage:"It looks like you've modified the template. Would you like to save your edits?"}),showCancel:!1,keepFocus:!0,items:[{label:a()(f.FormattedMessage,{id:"pageTemplateModal.modifiedTemplateDialog.saveButton.label",defaultMessage:"Save edits"}),onAccept:()=>{e(!0)}},{label:a()(f.FormattedMessage,{id:"pageTemplateModal.modifiedTemplateDialog.discardEditsButton.label",defaultMessage:"Discard"}),color:"red",onAccept:()=>{e(!1)}}]})}))}getSidebarStyle(){return{width:q.sidebarWidth,color:this.theme.mediumTextColor,background:"dark"===this.theme.mode?this.theme.popoverBackground:this.theme.sidebarBackground,display:"flex",flexDirection:"column",borderTopRightRadius:q.borderRadius,borderBottomRightRadius:q.borderRadius}}getIconWrapStyle(){return{color:this.theme.regularTextColor,position:"relative"}}hoveredButtonStyle(){return{color:this.theme.regularTextColor,fontWeight:h.Z.fontWeight.medium}}fixedLinkStyle(){return{padding:12,color:this.theme.mediumTextColor,background:"dark"===this.theme.mode?this.theme.popoverBackground:this.theme.sidebarBackground,fontSize:13,fontWeight:h.Z.fontWeight.medium,display:"flex",alignItems:"center",position:"absolute",bottom:0,right:0,height:45,width:q.sidebarWidth,borderTop:"1px solid ".concat(this.theme.regularDividerColor)}}fixedLinkIconStyle(){return{width:12,height:12,marginLeft:8,marginRight:10,marginBottom:0,fill:this.theme.regularIconColor,fontWeight:h.Z.fontWeight.medium}}}l()(q,"sidebarWidth",240),l()(q,"borderRadius",3),l()(q,"modalStyle",{display:"flex",width:"85vw",height:"85vh",borderRadius:q.borderRadius}),l()(q,"useTemplateButtonStyle",{position:"relative",marginTop:16,marginLeft:20,marginRight:20,marginBottom:16,whiteSpace:"nowrap"}),l()(q,"previewStyle",{width:"calc(100% - ".concat(q.sidebarWidth,"px)"),flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",overflow:"hidden"}),l()(q,"previewMobileStyle",{width:"100%",flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",overflow:"hidden"}),l()(q,"scrollerStyle",{flexGrow:1,flexShrink:1,paddingBottom:44});const H=(0,f.injectIntl)(q)},23596:(e,t,i)=>{i.d(t,{Z:()=>ue});var n=i(97464),o=i.n(n),s=i(77094),a=i.n(s),r=i(77422),l=i.n(r),d=(i(33948),i(96486)),c=i.n(d),u=i(67294),m=i.n(u),p=i(83355),g=i(41892),h=i(53397),f=i(27006),v=i(98459),y=i(21202),S=i(29369),b=i(5366),M=i(50906),w=i(25186),C=i(38363),k=i(84210),T=i(21115),I=i(61766),Z=i(54835),P=i(81236),_=i(12318),x=i(7908),F=i(74194),A=i(84076),B=i(63296),E=i(91941),R=i(76798),D=i(24006),L=i(58032),O=i(64369),N=i(7567),U=i(13991),W=i(480),V=i(28350),z=i(24405),q=i(39336),H=i(63143),G=i(28020),K=i(43250),j=i(60709),Y=i(31194),Q=i(52275),X=i(31945),J=i(78140),$=i(58189),ee=i(72495),te=i(93289),ie=i(82902);function ne(e){const t=(0,W.Fy)(),[,,i]=(0,V.oR)(void 0,I.Z),n=(0,z.F)(),s=(0,W.O7)(),r=(0,V.VK)((()=>(0,T.y$)(s)),[s]),{buttonMenuItemStyle:l}=(0,z.y)((()=>({buttonMenuItemStyle:{opacity:e.disabled?.6:1}})),[e.disabled]);return m().createElement(X.Z,o()({},e.upsellEvents,{disablePopup:!r,disabled:e.disabled,popupType:t.isMobile?X.Z.PopupType.SlideUp:X.Z.PopupType.Popup,buttonPopupStore:i,renderOrigin:t=>m().createElement(Q.Z,o()({},t,{focused:!1,style:l,title:a()(O.Z,{},void 0,a()(b.FormattedMessage,{id:"publicPermissionItem.expirationTime.label",defaultMessage:"Link expires"})," ",e.upgradeLabel),right:m().createElement(E.Z,o()({},t,{ignoreLocalHoverState:!0,style:{paddingLeft:0,paddingRight:0}}),a()(oe,{permissionItem:e.permissionItem}),h.Z.chevronDown({width:10,marginLeft:4,fill:n.lightIconColor}))})),placementToOrigin:Y.Iw.Bottom,render:i=>{const n=[{key:"options",render:e=>m().createElement(ee.Z,e),items:ae().map((t=>({key:t.type,action:()=>{se(e,s,t.time),i.close()},render:e=>m().createElement(Q.Z,o()({},e,{focused:e.focused,disabled:!1,title:t.title,caption:t.caption}))})))},{key:"custom",render:e=>m().createElement(ee.Z,o()({},e,{topBorder:!0})),items:[{key:"custom",action:()=>{i.close()},render:(t,n)=>m().createElement(ie.Z,o()({},t,{renderOrigin:e=>m().createElement(Q.Z,o()({},e,{disabled:!1,title:a()(b.FormattedMessage,{id:"publicPermissionItem.expiration.chooseDate",defaultMessage:"Choose date"})})),onFocus:n.onFocus,disableDefaultClick:!0,renderExtension:(t,n)=>a()("div",{style:{padding:"18px 14px 14px"}},void 0,m().createElement(te.Z,o()({},t,{firstDayOfWeek:G.AK.state,value:e.permissionItem.expiration_timestamp||(new Date).getTime(),onChange:t=>{se(e,s,t),n.close(),i.close()},disabledDays:{before:new Date}})))}))}]}];let r;return r=t.isMobile?{menuType:j.o.Modal,title:a()(b.FormattedMessage,{id:"publicPermissionsMenu.expiration.mobile.title",defaultMessage:"Expiration time"}),right:a()(b.FormattedMessage,{id:"publicPermissionsMenu.expiration.mobile.label",defaultMessage:"Done"}),onClickRight:i.close}:{menuType:j.o.Popup,width:264},m().createElement(J.Z,o()({className:K.Ip},r),a()($.Z,{type:$.i.Vertical,initialFocus:void 0,sections:n}))}}))}function oe(e){const{permissionItem:t}=e;return!t.expiration_timestamp||(0,f.o7)(t)?a()(b.FormattedMessage,{id:"publicPermissionItem.expiration.never",defaultMessage:"Never"}):a()(O.Z,{},void 0,(0,q.default)(e.permissionItem.expiration_timestamp).fromNow())}function se(e,t,i){const{permissionItem:n,onChange:o}=e;if("public_permission"!==n.type)return;if(void 0!==i&&i<=(new Date).getTime())return;const s=n,a=c().clone(s),r=i;a.expiration_timestamp=r,o(a),(0,M.trackSetExpirationTimeOnPublicPage)(t,{expiration_time:r})}function ae(){const e=(new Date).getTime()+H.U6,t=(new Date).getTime()+H.A0,i=(new Date).getTime()+7*H.A0;return[{type:"never",time:void 0,title:a()(b.FormattedMessage,{id:"publicPermissionItem.expiration.never",defaultMessage:"Never"})},{type:"hour",time:e,title:a()(b.FormattedMessage,{id:"permissionItem.publicPermissionItem.expiration.hour",defaultMessage:"In an hour"}),caption:new Intl.DateTimeFormat(U.SP,{hour:"numeric",minute:"numeric"}).format(e)},{type:"day",time:t,title:a()(b.FormattedMessage,{id:"permissionItem.publicPermissionItem.expiration.day",defaultMessage:"In a day"}),caption:new Intl.DateTimeFormat(U.SP,{day:"numeric",month:"long",hour:"numeric",minute:"numeric"}).format(t)},{type:"week",time:i,title:a()(b.FormattedMessage,{id:"permissionItem.publicPermissionItem.expiration.week",defaultMessage:"In a week"}),caption:new Intl.DateTimeFormat(U.SP,{day:"numeric",month:"long",hour:"numeric",minute:"numeric"}).format(i)}]}var re=i(60442),le=i(42115);let de;!function(e){e[e.Web=0]="Web",e[e.Workspace=1]="Workspace",e[e.User=2]="User"}(de||(de={}));class ce extends p.Z{constructor(){super(...arguments),l()(this,"copiedLinkTimeout",void 0),l()(this,"copiedLink",new _.default(!1)),l()(this,"showLinkOptions",new _.default(!1)),l()(this,"storeTypes",{buttonPopupStore:I.Z}),l()(this,"renderLinkOptionsButton",(()=>a()(E.Z,{onClick:this.handleShowLinkOptionsClick,style:{...this.getPublicAccessOptionStyle()}},void 0,a()(O.Z,{isSmall:!0},void 0,a()(b.FormattedMessage,{defaultMessage:"Show link options",id:"pagePermissionItem.showLinkOptions.label"}),h.Z.chevronDown({width:9,height:9,marginLeft:4,display:"inline"}))))),l()(this,"renderAllowEditsTooltip",(()=>a()(re.Z,{caption:a()(b.FormattedMessage,{defaultMessage:"Any logged in Notion user can edit this page. Share the secret link with people you trust.",id:"pagePermissionItem.allowEdits.tooltip"}),imageHeight:120,imageWidth:240,imageURL:g.Z.images.tooltips.share.allowEditingPng}))),l()(this,"renderAllowCommentsTooltip",(()=>a()(re.Z,{caption:a()(b.FormattedMessage,{defaultMessage:"Any logged in Notion user can comment on this page.",id:"pagePermissionItem.allowComments.tooltip"}),imageHeight:120,imageWidth:240,imageURL:g.Z.images.tooltips.share.allowCommentsPng}))),l()(this,"renderAllowSearchEngineTooltip",(()=>a()(re.Z,{caption:a()(b.FormattedMessage,{defaultMessage:"If allowed, your public page may appear in search engines such as Google, but only if you or someone else links to it elsewhere on the web.",id:"pagePermissionItem.allowSearchEngine.tooltip"}),imageHeight:120,imageWidth:240,imageURL:g.Z.images.tooltips.share.allowSearchEnginesPng}))),l()(this,"renderAllowSearchEngineUpgradeTooltip",(()=>a()(re.Z,{imageURL:g.Z.images.tooltips.upsells.searchEngineIndexingPng,imageWidth:240,imageHeight:100,title:a()(b.FormattedMessage,{defaultMessage:"Upgrade for search engine indexing",id:"pagePermissionItem.searchEngineUpgradeTooltip.title"}),caption:a()(b.FormattedMessage,{defaultMessage:"Have your page appear in search engine results.",id:"pagePermissionItem.searchEngineUpgradeTooltip.caption"})}))),l()(this,"renderAllowDuplicateTooltip",(()=>a()(re.Z,{caption:a()(b.FormattedMessage,{defaultMessage:"If allowed, this will allow other people to duplicate your public page to their workspace.",id:"pagePermissionItem.allowDuplicateTemplate.tooltip"}),imageHeight:120,imageWidth:240,imageURL:g.Z.images.tooltips.share.allowDuplicatePng}))),l()(this,"handleCopy",(()=>{const e=(0,k.Z)({store:this.props.currentBlockStore,preferPublicLink:!0,getSpaceDomain:()=>{var e;return null===(e=P.Z.getPublicSpaceData(this.environment,(0,v.CG)(this.props.currentBlockStore.getSpaceId())))||void 0===e?void 0:e.domain}});w.RD({environment:this.environment,stringValue:e,copiedMessage:w.tq.copiedLinkToClipboard}),clearTimeout(this.copiedLinkTimeout),this.copiedLink.set(!0),this.copiedLinkTimeout=window.setTimeout((()=>{this.copiedLink.set(!1)}),1e3),M.trackCopyWebLink(this.environment)})),l()(this,"handleShowLinkOptionsClick",(()=>{this.showLinkOptions.set(!0)})),l()(this,"handleToggleAllowEdits",(()=>{const{permissionItem:e}=this.props;"public_permission"===e.type&&this.props.onChange({...e,role:"read_and_write"===e.role?"comment_only":"read_and_write"})})),l()(this,"handleToggleAllowComments",(()=>{const{permissionItem:e}=this.props;"public_permission"===e.type&&this.props.onChange({...e,role:"comment_only"===e.role||"read_and_write"===e.role?"reader":"comment_only"})})),l()(this,"handleToggleSearchEngine",(()=>{const{permissionItem:e}=this.props;if("public_permission"===e.type){const t=e,i=Boolean(t.allow_search_engine_indexing),n=c().clone(t),o=!i;n.allow_search_engine_indexing=o,this.props.onChange(n),M.trackToggleAllowSearchEngineIndexing(this.environment,{allow_search_engine_indexing:o})}})),l()(this,"handleToggleDuplicate",(()=>{const{permissionItem:e}=this.props;if("public_permission"===e.type){const t=e,i=void 0===t.allow_duplicate||!0===t.allow_duplicate,n=c().clone(t),o=!i;n.allow_duplicate=o,this.props.onChange(n),M.trackToggleAllowDuplicate(this.environment,{allow_duplicate:o})}})),l()(this,"handleRoleSelect",(e=>{const t=c().clone(this.props.permissionItem);t.role=e,this.props.onChange(t)})),l()(this,"handleSwitcherButtonClick",(()=>{"none"===this.role?this.handleRoleSelect(this.props.switcherRole||"editor"):this.handleRoleSelect("none")})),l()(this,"handleUserItemClick",(()=>{this.stores.buttonPopupStore.setState({...this.stores.buttonPopupStore.state,open:!0})}))}willMount(e){super.willMount(e),f.$D(e.permissionItem)&&"none"===e.permissionItem.role&&this.showLinkOptions.set(!0)}renderComponent(){const{device:e}=this.environment,{tooltip:t}=this.props,i=this.isUserItem()||!this.isPublicPermissionItem?this.handleUserItemClick:this.handleSwitcherButtonClick;return a()(u.Fragment,{},void 0,t?a()(L.Z,{delayThreshold:0,renderTooltip:()=>t,render:t=>m().createElement(x.Z,o()({disabled:this.props.disabled,mobileFeedback:e.isMobile,style:{...this.props.disabled?{cursor:"not-allowed"}:{}},onClick:i},t),this.renderMenuItem()),placement:L.Z.Placement.Left}):a()(x.Z,{disabled:this.props.disabled,style:{...this.props.disabled?{cursor:"not-allowed"}:{}},onClick:i},void 0,this.renderMenuItem()),this.renderPublicPermissionSettings())}renderMenuItem(){const{device:e}=this.environment,{isInherited:t,permissionItem:i}=this.props,n=this.isUserItem(),o=this.isBotPermissionItem(),s=!n&&!o,r=f.ix(i)||f.hV(i),l=!(this.isPublicPermissionItem||r&&"none"===this.role);return a()("div",{className:"notranslate",style:this.getMenuItemStyle(n)},void 0,a()("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",width:32,height:32,marginRight:e.isMobile?12:10}},void 0,this.props.icon),a()("div",{style:{marginRight:"auto",minWidth:0}},void 0,a()("div",{style:{display:"flex",flexDirection:"row"}},void 0,a()(O.Z,{style:{...!n&&{fontWeight:400}}},void 0,this.props.title),this.props.tag&&a()("div",{style:{marginLeft:4}},void 0,this.props.tag)),this.props.subtitle&&a()(O.Z,{isSmall:!0},void 0,this.props.subtitle),t&&this.renderInheritedRecordTitle()),a()("div",{style:{display:"flex",alignItems:"center",flexShrink:0,marginLeft:8}},void 0,this.isPublicPermissionItem?m().createElement(m().Fragment,null,l&&!r&&a()(N.Z,{role:this.role,table:y.iU,blockType:this.props.currentBlockStore.getType(),type:i.type,disabled:this.props.disabled,isSubscribed:this.props.isSubscribed,isUserPermission:this.permissionItemIsUserItem(i),onChange:this.handleRoleSelect,onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:this.props.upgradeButtonName,buttonPopupStore:this.stores.buttonPopupStore,buttonStyle:{marginRight:e.isMobile||n||o?-6:8,color:this.theme.mediumTextColor,fontSize:e.isMobile?14:12}}),s&&a()(D.Z,{on:"none"!==this.role,onClick:this.handleSwitcherButtonClick,disabled:this.props.disabled,isAndroid:e.isAndroid})):a()(N.Z,{role:this.role,table:y.iU,blockType:this.props.currentBlockStore.getType(),type:i.type,disabled:this.props.disabled,isSubscribed:this.props.isSubscribed,isUserPermission:this.permissionItemIsUserItem(i),onChange:this.handleRoleSelect,onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:this.props.upgradeButtonName,buttonPopupStore:this.stores.buttonPopupStore,buttonStyle:{marginRight:-6,color:this.theme.mediumTextColor,fontSize:e.isMobile?14:12},showPermissionOverrideWarning:this.props.isInherited})))}getPublicPermissionSettingsHeight(e){const{device:t}=this.environment;return e?0:t.isMobile?this.showLinkOptions.get()?240:94:this.showLinkOptions.get()?200:88}renderPublicPermissionSettings(){const{device:e}=this.environment,{permissionItem:t}=this.props;if(f.$D(t)){const i="none"===this.role;return a()("div",{style:{maxHeight:this.getPublicPermissionSettingsHeight(i),transition:"max-height ease 200ms, padding-bottom ease 200ms",overflow:"hidden",paddingBottom:i?0:this.showLinkOptions.get()?12:8}},void 0,this.renderPageLinkButton(),this.showLinkOptions.get()?m().createElement(m().Fragment,null,m().createElement(m().Fragment,null,Z.default.checkGate("expiring_public_links")&&a()(le.Z,{alwaysAllowClick:Boolean(t.expiration_timestamp),onClick:()=>{},analyticsName:"public_permission_item_expiration",requireUpgradeToTier:!(0,T.y$)(this.environment)&&(0,T.M9)(this.environment),tooltipPlacement:L.Z.Placement.Left,renderTooltip:this.renderAllowSearchEngineTooltip,renderUpgradeTooltip:this.renderAllowSearchEngineUpgradeTooltip,onUpgradeClick:this.props.onUpgradeButtonClick,render:(e,i)=>a()(ne,{upsellEvents:e,upgradeLabel:i,permissionItem:t,onChange:e=>{this.props.onChange(e)},disabled:this.props.disabled})}),a()(L.Z,{placement:L.Z.Placement.Left,renderTooltip:this.renderAllowEditsTooltip,render:i=>m().createElement(x.Z,o()({onClick:this.handleToggleAllowEdits,style:this.getPublicAccessOptionStyle(),disabled:this.props.disabled},i),a()(O.Z,{style:this.getPublicAccessOptionLabelStyle(this.props.disabled)},void 0,a()(b.FormattedMessage,{defaultMessage:"Allow editing",id:"pagePermissionItem.allowEdits.setting"})),a()(D.Z,{on:"read_and_write"===t.role,onClick:this.handleToggleAllowEdits,disabled:this.props.disabled,isAndroid:e.isAndroid}))}),a()(L.Z,{placement:L.Z.Placement.Left,renderTooltip:this.renderAllowCommentsTooltip,render:t=>m().createElement(x.Z,o()({onClick:this.handleToggleAllowComments,style:this.getPublicAccessOptionStyle(),disabled:this.props.disabled},t),a()(O.Z,{style:this.getPublicAccessOptionLabelStyle(this.props.disabled)},void 0,a()(b.FormattedMessage,{defaultMessage:"Allow comments",id:"pagePermissionItem.allowComments.setting"})),a()(D.Z,{on:"comment_only"===this.role||"read_and_write"===this.role,onClick:this.handleToggleAllowComments,disabled:this.props.disabled,isAndroid:e.isAndroid}))})),a()(L.Z,{placement:L.Z.Placement.Left,renderTooltip:this.renderAllowDuplicateTooltip,render:i=>m().createElement(x.Z,o()({onClick:this.handleToggleDuplicate,disabled:this.props.disabled,style:this.getPublicAccessOptionStyle()},i),a()(O.Z,{style:this.getPublicAccessOptionLabelStyle(this.props.disabled)},void 0,a()(b.FormattedMessage,{defaultMessage:"Allow duplicate as template",id:"pagePermissionItem.allowDuplicateTemplate.setting"})),a()(D.Z,{on:!1!==t.allow_duplicate,onClick:this.handleToggleDuplicate,disabled:this.props.disabled,isAndroid:e.isAndroid}))}),a()(le.Z,{requireUpgradeToTier:!(0,T.f3)(this.environment)&&(0,T.M9)(this.environment),alwaysAllowClick:t.allow_search_engine_indexing,analyticsName:"allow_search_engine_indexing",onClick:this.handleToggleSearchEngine,onUpgradeClick:this.props.onUpgradeButtonClick,tooltipPlacement:L.Z.Placement.Left,renderTooltip:this.renderAllowSearchEngineTooltip,renderUpgradeTooltip:this.renderAllowSearchEngineUpgradeTooltip,render:(i,n)=>m().createElement(x.Z,o()({style:this.getPublicAccessOptionStyle(),disabled:this.props.disabled},i),a()(O.Z,{style:this.getPublicAccessOptionLabelStyle(this.props.disabled)},void 0,a()(b.FormattedMessage,{defaultMessage:"Search engine indexing",id:"pagePermissionItem.allowSearchEngines.setting"})," ",n),a()(D.Z,{on:Boolean(t.allow_search_engine_indexing),onClick:this.handleToggleSearchEngine,disabled:this.props.disabled||Boolean(n),isAndroid:e.isAndroid}))})):this.renderLinkOptionsButton())}}renderPageLinkButton(){const e=(0,k.Z)({store:this.props.currentBlockStore,preferPublicLink:!0,getSpaceDomain:()=>{var e;return null===(e=P.Z.getPublicSpaceData(this.environment,(0,v.CG)(this.props.currentBlockStore.getSpaceId())))||void 0===e?void 0:e.domain}});return a()("div",{style:{...this.getPublicAccessOptionStyle(),height:"auto"}},void 0,a()("div",{style:{flex:1}},void 0,a()("div",{style:{display:"flex",padding:"1px 0"}},void 0,a()(F.Z,{value:e,disabled:!0,style:{flex:1,borderTopRightRadius:0,borderBottomRightRadius:0,paddingRight:0}}),a()(B.Z,{onClick:()=>this.handleCopy(),style:{height:28,borderTopLeftRadius:0,borderBottomLeftRadius:0,borderLeft:"none"}},void 0,this.copiedLink.get()?a()(b.FormattedMessage,{id:"pageShareMenu.copiedLinkButton.label",defaultMessage:"✓ Copied"}):a()(b.FormattedMessage,{id:"pageShareMenu.copyMaybePublicLinkButton.label.web",defaultMessage:"Copy web link",description:"Button text for copying public link of the page"})))))}renderInheritedRecordTitle(){const e=this.props.store,t=e.table===y.iU?(0,k.Z)({store:e,fullyQualified:!1}):void 0,i=e.table===S.e0?()=>{e.table===S.e0&&(0,C.RF)(e.id)}:void 0,{device:n}=this.environment;return a()(O.Z,{isSmall:!0,style:{lineHeight:1.4}},void 0,a()(b.FormattedMessage,{defaultMessage:"Based on {linkBoxWithPageTitle}",description:"This text tells the user that this permission setting for the page is inherited from the parent page or team.",id:"pagePermissionItem.inheritedRecordPermissions.setting",values:{linkBoxWithPageTitle:a()(A.Z,{disabled:n.isMobile,underline:!n.isMobile,inline:!0,href:t,onClick:i},void 0,a()(R.Z,{store:e,style:{display:"inline"}}))}}))}permissionItemIsUserItem(e){const t=this.environment.currentUser.id;return"user_permission"===e.type&&e.user_id===t}isUserItem(){return this.props.format===de.User}get role(){const{permissionItem:e,isInherited:t,store:i,currentBlockStore:n}=this.props;if("content_only_editor"===e.role&&t){const t=n.getParentCollectionStore(),o=null==t?void 0:t.getParentBlockStore();return o&&o.table===i.table&&o.id===i.id?e.role:"read_and_write"}return e.role}get isPublicPermissionItem(){return f.$D(this.props.permissionItem)}isBotPermissionItem(){return f.FB(this.props.permissionItem)}getMenuItemStyle(e){const{WindowSizeStore:t}=this.environment;return{display:"flex",alignItems:"center",minHeight:52,paddingTop:8,paddingBottom:8,paddingLeft:t.getSafePaddingLeftCSS(14),paddingRight:t.getSafePaddingRightCSS(14)}}getPublicAccessOptionStyle(){const{device:e,WindowSizeStore:t}=this.environment;let i;return i=e.isMobile?36:30,{display:"flex",alignItems:"center",width:"100%",height:i,paddingTop:5,paddingBottom:5,paddingLeft:t.getSafePaddingLeftCSS(14),paddingRight:t.getSafePaddingRightCSS(14)}}getPublicAccessOptionLabelStyle(e){return{marginRight:"auto",opacity:e?.6:1}}}l()(ce,"Format",de),l()(ce,"iconSize",32);const ue=ce},36932:(e,t,i)=>{i.r(t),i.d(t,{PermissionsInviteBase:()=>H,default:()=>G});var n=i(97464),o=i.n(n),s=i(77094),a=i.n(s),r=i(77422),l=i.n(r),d=(i(33948),i(96486)),c=i.n(d),u=i(67294),m=i.n(u),p=i(83355),g=i(8848),h=i(94044),f=i(5366),v=i(50906),y=i(95209),S=i(21325),b=i(43250),M=i(60709),w=i(75472),C=i(65598),k=i(33665),T=i(23537),I=i(85834),Z=i(1903),P=i(29677),_=i(80270),x=i(78140),F=i(40721),A=i(72495),B=i(83182),E=i(7567),R=i(480),D=i(28350),L=i(67669),O=i(92012),N=i(25464),U=i(42922),W=i(58032);const V=function(e){const{store:t,permissionsInviteStore:i,handleUpgradeClick:n,handleInviteClick:s,isLarge:r}=e,l=(0,R.O7)(),[d]=(0,D.oR)(i),c=(0,D.VK)((()=>d.inviteTargets.some((e=>w.OA(e)))),[d]),u=(0,O.i)(t),p=(0,D.VK)((()=>{const e=d.inviteTargets,t=e.filter((e=>{let{type:t}=e;return"newUser"===t})).map((e=>{let{value:t}=e;return t.email})),i=e.filter((e=>{let{type:t}=e;return"existingUser"===t})).map((e=>{let{value:t}=e;return t.id}));return L.dA(l,[...t,...i])}),[l,d]),g=c?u:void 0;return a()(W.Z,{alignment:N.v.Center,disableTooltip:!(p||g),renderTooltip:()=>p?m().createElement(m().Fragment,null,a()("div",{},void 0,a()(f.FormattedMessage,{id:"inviteUserButton.modalTooltip.guestLimitLine1",defaultMessage:"Your plan allows up to 5 unique guests.",description:"Guest limit shown when users attempts to invite a guest from the invite user button."})),a()("div",{},void 0,a()(f.FormattedMessage,{id:"inviteUserButton.modalTooltip.guestLimitLine2",defaultMessage:"Upgrade to go unlimited.",description:"Upgrade message shown when users attempts to invite a guest from the invite user button."}))):g,render:e=>m().createElement(U.Z,o()({isLarge:r,style:{minWidth:h.UF},disabled:Boolean(g),onClick:p?n:s},e),a()(f.FormattedMessage,p?{id:"inviteUserModal.inviteButton.upgradeLabel",defaultMessage:"Upgrade"}:{id:"inviteUserModal.inviteButton.label",defaultMessage:"Invite"}))})};var z=i(24145),q=i(79813);class H extends p.Z{constructor(){super(...arguments),l()(this,"renderInShareMenu",this.createComputedStore((()=>Boolean(this.props.renderInShareMenu&&!this.environment.device.isMobile)))),l()(this,"inviteOrigin",this.createComputedStore((()=>this.props.store instanceof _.Z?this.renderInShareMenu.state?"page_share_modal":"page_permission_modal":"space_share_modal"))),l()(this,"defaultRoleForSpaceBot",this.createComputedStore((()=>"editor"))),l()(this,"defaultRoleForNonBot",this.createComputedStore((()=>{const{store:e,isSubscribed:t}=this.props;return w.xT({environment:this.environment,store:e,isSubscribed:t})}))),l()(this,"inputDebounce",void 0),l()(this,"storeTypes",{permissionsInviteStore:Z.Z,contextualInviteStore:I.ZP}),l()(this,"handleUpgradeClick",(()=>{y.Vu({environment:this.environment,upgradeButtonName:this.props.upgradeButtonName,onUpgradeButtonClick:this.props.onUpgradeButtonClick})})),l()(this,"handleModalDismiss",(async()=>{await y.kL({environment:this.environment,permissionsInviteStore:this.stores.permissionsInviteStore,from:"share_menu"})})),l()(this,"handleInputChange",(e=>{var t;null===(t=this.inputDebounce)||void 0===t||t.cancel(),this.inputDebounce=c().debounce((()=>{v.trackInviteTyped(this.environment,{...w.a_(this.environment,this.stores.permissionsInviteStore.state)})}),1e3),this.inputDebounce(),y.jC({event:e,permissionsInviteStore:this.stores.permissionsInviteStore})})),l()(this,"handleClickRemoveToken",(e=>{y.PV({targetToRemove:e,permissionsInviteStore:this.stores.permissionsInviteStore,defaultRoleForNonBot:this.defaultRoleForNonBot.state})}))}async willMount(){await S.bi(this.environment)}willUnmount(){var e;null===(e=this.inputDebounce)||void 0===e||e.flush()}renderComponent(){if(this.renderInShareMenu.state)return this.renderComponentInShareMenu();const e=this.renderHeader(),t=this.renderSearchRequest();return this.renderComponentOriginal(e,t)}renderHeader(){const{permissionsInviteStore:e}=this.stores,{device:t}=this.environment;return a()(z.Z,{permissionsInviteStore:e,store:this.props.store,handleClickRemoveToken:e=>{this.handleClickRemoveToken(e)},handleInputChange:e=>{this.handleInputChange(e)},handleInputSubmit:async()=>{await this.handleInviteInputSubmit()},origin:Boolean(this.renderInShareMenu.state)?"share_menu":"share_modal",defaultRoleForNonBot:this.defaultRoleForNonBot.state,isTeamsEnabled:(0,T.bq)(),right:!t.isMobile&&this.renderDesktopInputRightInner(),focus:"invitee"===e.state.inputFocus||"invitee-popup-closed"===e.state.inputFocus,handleFocus:()=>{t.isMobile||e.setState({...e.state,inputFocus:"invitee"})}})}renderSearchRequest(){const{permissionsInviteStore:e}=this.stores,t=(0,C.NZ)(this.props.store),i=(0,C.NZ)(this.props.store);return a()(q.Z,{permissionsInviteStore:e,store:this.props.store,defaultRoleForSpaceBot:this.defaultRoleForSpaceBot.state,shouldShowBots:t,shouldShowGroups:i,sectionRenderLimit:this.renderInShareMenu.state?5:10,membersOnly:this.props.membersOnly})}renderComponentOriginal(e,t){const{device:i}=this.environment;let n;return n=i.isMobile?{menuType:M.o.Modal,title:(0,C.Mm)(this.props.store)?a()(f.FormattedMessage,{id:"inviteUserModal.addMemberMenu.title",defaultMessage:"Add members"}):a()(f.FormattedMessage,{id:"inviteUserModal.invitePersonMenu.title",defaultMessage:"Invite a person"}),right:a()("div",{style:{color:g.ZP.blue}},void 0,a()(f.FormattedMessage,{id:"inviteUserModal.mobile.inviteButton.label",defaultMessage:"Invite"})),left:a()(F.CancelMenuText,{}),onClickLeft:this.handleModalDismiss,onClickRight:async()=>{await this.handleInviteClick()},header:e}:{menuType:M.o.Popup,width:480,height:"60vh",header:e,tokenInputHeader:!0,footer:this.renderHelpButton(),disableScroller:!1},m().createElement(x.Z,o()({},n,{className:b.FJ}),i.isMobile&&a()(A.Z,{title:a()(f.FormattedMessage,{id:"inviteUserModal.permissionLevel.title",defaultMessage:"Permission level"})},void 0,this.renderDesktopInputRightInnerSelect()),a()("div",{},void 0,t),i.isMobile&&this.renderHelpButton())}renderHelpButton(){return this.renderInShareMenu.state?null:a()(A.Z,{topBorder:!0,disableDesktopPadding:!0},void 0,a()(B.Z,{title:a()(f.FormattedMessage,{id:"inviteUserModal.helpButton.caption",defaultMessage:"Learn how to invite people and set permissions"}),href:(0,k.UY)("guides.invitePerson"),analyticsFrom:"invite_person"}))}renderDesktopInputRightInner(){return a()("div",{style:{marginLeft:h.p_,display:"flex",alignItems:"center"}},void 0,this.renderDesktopInputRightInnerSelect(),!this.renderInShareMenu.state&&this.renderDesktopInputRightInnerButton({isLarge:!0}))}renderDesktopInputRightInnerButton(e){const{isLarge:t}=e;return a()(V,{store:this.props.store,permissionsInviteStore:this.stores.permissionsInviteStore,handleUpgradeClick:()=>this.handleUpgradeClick(),handleInviteClick:()=>this.handleInviteClick(),disabled:this.props.disabled,isLarge:t})}renderDesktopInputRightInnerSelect(){const{device:e}=this.environment,{isSubscribed:t,store:i}=this.props,{permissionsInviteStore:n}=this.stores;if(n.state.isInviteTargetsEmpty||!(0,P.ow)(n.state))return a()(E.Z,{disabled:(0,C.Mm)(i)&&!i.canAdmin(),role:n.state.inviteRole,table:n.state.table,type:"user_permission",blockType:(0,C.NZ)(i)?i.getType():void 0,isSubscribed:t,isInvite:!0,onUpgradeButtonClick:this.props.onUpgradeButtonClick,upgradeButtonName:this.props.upgradeButtonName,buttonStyle:{display:"flex",whiteSpace:"nowrap",height:26,color:g.ZP.uiGray,...this.renderInShareMenu.state&&{marginTop:e.isMobile?4:n.state.isInviteTargetsEmpty?1:6,marginBottom:e.isMobile?4:n.state.isInviteTargetsEmpty?1:6,marginRight:0}},isMenuItem:e.isMobile,onChange:e=>{y.XC({environment:this.environment,newRole:e,permissionsInviteStore:this.stores.permissionsInviteStore})}})}renderComponentInShareMenu(){const e={menuType:M.o.Popup,header:a()("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"top",marginLeft:12,marginRight:12,gap:10}},void 0,this.renderHeader(),this.renderDesktopInputRightInnerButton({isLarge:!0})),footer:this.renderHelpButton(),disableScroller:!1};return a()("div",{style:{paddingTop:14,paddingBottom:14,paddingLeft:2,paddingRight:2}},void 0,m().createElement(x.Z,e,this.renderSearchRequest()))}async handleInviteInputSubmit(){await this.handleInviteClick()}async handleInviteClick(){await y.qg({environment:this.environment,store:this.props.store,permissionsInviteStore:this.stores.permissionsInviteStore,contextualInviteStore:this.stores.contextualInviteStore,onInviteClick:this.props.onInviteClick,onInviteComplete:this.props.onInviteComplete,inviteOrigin:this.inviteOrigin.state,intl:this.props.intl})}}const G=(0,f.injectIntl)(H)},7378:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Z});var n=i(77094),o=i.n(n),s=i(97464),a=i.n(s),r=i(77422),l=i.n(r),d=(i(33948),i(67294)),c=i.n(d),u=i(83355),m=i(41892),p=i(5366),g=i(21325),h=i(93678),f=i(75472),v=i(65598),y=i(21115),S=i(1903),b=i(78291),M=i(42922),w=i(9019),C=i(58032),k=i(36932),T=i(60442);class I extends u.Z{constructor(){super(...arguments),l()(this,"storeTypes",{permissionsInviteStore:S.Z}),l()(this,"renderOverlay",(()=>c().createElement(k.default,a()({},this.props,{permissionsInviteStore:this.stores.permissionsInviteStore})))),l()(this,"handleTrialClick",(()=>{h.y(this.environment,{from:this.props.upgradeButtonName,for:"team_free"}),this.props.onUpgradeButtonClick&&this.props.onUpgradeButtonClick()})),l()(this,"handleButtonClick",(()=>{(0,f.z5)({environment:this.environment,permissionsInviteStore:this.stores.permissionsInviteStore,store:this.props.store,renderInShareModal:!1,isSubscribed:this.props.isSubscribed})})),l()(this,"handleModalDismiss",(async()=>{const{permissionsInviteStore:e}=this.stores;await(0,f.Aw)({environment:this.environment,permissionsInviteStoreState:e.state,from:(0,v.Mm)(this.props.store)?"space_share_modal":"page_share_modal"})||e.reset()}))}async willMount(){await g.bi(this.environment)}renderComponent(){const{store:e}=this.props,{modalOpen:t}=this.stores.permissionsInviteStore.state;let i,n,s=!1;return e.canEditMembership()?e.canEditMembership()&&(0,v.Mm)(e)&&b.default.state.data&&!y.qF(this.environment)?(i=!1,s=!0,n=o()(T.Z,{imageURL:m.Z.images.tooltips.upsells.spaceReadAndWritePng,imageWidth:240,imageHeight:100,caption:o()(p.FormattedMessage,{defaultMessage:"Members are teammates you invite to your workspace. They can access and add pages for all members to see, or be added to pages with permissions for private collaboration.",id:"permissionsInvite.spaceAddMemberUpgradeTooltip.caption"}),title:o()(p.FormattedMessage,{defaultMessage:"Upgrade to add members",id:"permissionsInvite.spaceAddMemberUpgradeTooltip.title"})})):i=!0:(i=!1,n=(0,v.Mm)(e)?o()(p.FormattedMessage,{id:"inviteUserButton.tooltip.adminsOnlyMessage",defaultMessage:"Only admins can add members."}):o()(p.FormattedMessage,{id:"inviteUserButton.tooltip.fullAccessOnlyMessage",defaultMessage:"Only those with full access can add people."})),o()("div",{},void 0,(0,v.Mm)(e)?o()(w.Z,{open:t,onDismiss:this.handleModalDismiss,renderContent:this.renderOverlay,origin:o()(C.Z,{renderTooltip:()=>n,disableTooltip:i,render:e=>c().createElement(M.Z,a()({isLarge:!0,onClick:s?this.handleTrialClick:this.handleButtonClick,disabled:!i&&!s,style:{flex:this.props.shouldGrow?1:0,...this.props.buttonStyle}},e),o()(p.FormattedMessage,{id:"inviteUserButton.addMemberLabel",defaultMessage:"Add members"}))})}):o()(w.Z,{open:t,onDismiss:this.handleModalDismiss,renderContent:this.renderOverlay,origin:null}))}}const Z=(0,p.injectIntl)(I)},79627:(e,t,i)=>{i.r(t),i.d(t,{default:()=>z});var n=i(77094),o=i.n(n),s=i(77422),a=i.n(s),r=(i(33948),i(96486)),l=i.n(r),d=i(67294),c=i.n(d),u=i(83355),m=i(480),p=i(28350),g=i(24405),h=i(41892),f=i(8848),v=i(53397),y=i(89101),S=i(82990),b=i(5366),M=i(50906),w=i(80456),C=i(37181),k=i(36867),T=i(27832),I=i(4926),Z=i(54835),P=i(5188),_=i(49085);class x extends _.Z{getInitialState(){return{open:!1,step:"prompt"}}}const F=new x;var A=i(12768),B=i(65381),E=i(42922),R=i(7908),D=i(3386),L=i(91941),O=i(44532),N=i(42402),U=i(29551),W=i(63784);class V extends u.Z{constructor(){super(...arguments),a()(this,"hasSeenInitial",!1),a()(this,"renderMenu",(()=>o()("div",{style:this.getContainerStyle()},void 0,this.renderCancel(),o()(U.gq,{style:this.getInnerContainerStyle(),alignItems:"center",alignContent:"center"},void 0,this.renderStep())))),a()(this,"renderInitial",(()=>{const e=this.environment.currentUser.id;if(!F.state.open||!e)return;this.hasSeenInitial||((0,M.trackPersonaCollectionStep)(this.environment,{user_id:e,event:"initial"}),this.hasSeenInitial=!0);const{invalidField:t}=F.state;return o()("div",{style:{...this.getSlideUpStyle(),padding:8}},void 0,o()("img",{style:{width:40,height:32},src:h.Z.images.chatButtonSmallPng}),o()("div",{style:{fontSize:14,fontWeight:S.Z.fontWeight.semibold,paddingTop:0,paddingBottom:8}},void 0,o()(b.FormattedMessage,{id:"PersonaCollectionModal.initial.header",defaultMessage:"Tell us more about yourself",description:"Header for the initial modal"})),o()("div",{style:{fontSize:12,color:this.theme.mediumTextColor,width:270,margin:"0 auto"}},void 0,o()(b.FormattedMessage,{id:"PersonaCollectionModal.initial.caption",defaultMessage:"We would love to learn more about you so we can make our product better serve you",description:"Caption for the initial modal"})),o()("div",{style:{...this.getLabelStyle(),marginTop:10}},void 0,o()(b.FormattedMessage,{id:"PersonaCollectionModal.initial.roleLabel",defaultMessage:"What is your role?",description:"Question for the role form selection"})),o()(W.Z,{questionType:"role",title:o()(b.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.question.roleLabel",defaultMessage:"Role",description:"Label for role form"}),question:F.state.role,invalid:"role"===t,onSelect:e=>{F.state.open&&F.setState({...F.state,role:e,step:"initial"})}}),o()("div",{style:this.getLabelStyle()},void 0,o()(b.FormattedMessage,{id:"PersonaCollectionModal.initial.workLabel",defaultMessage:"What kind of work do you do?",description:"Title for work form"})),o()(W.Z,{questionType:"work",title:o()(b.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.question.workLabel",defaultMessage:"Work",description:"Label for work form"}),question:F.state.work,invalid:"work"===t,onSelect:e=>{F.state.open&&F.setState({...F.state,work:e,step:"initial"})}}),o()("div",{style:this.getLabelStyle()},void 0,o()(b.FormattedMessage,{id:"PersonaCollectionModal.initial.questionLabel",defaultMessage:"What are you planning to use Notion for?",description:"Title for use form"})),o()(W.Z,{questionType:"use",title:o()(b.FormattedMessage,{id:"PersonaCollectionModalQuestionSelect.question.useLabel",defaultMessage:"Use",description:"Label for use form"}),question:F.state.use,invalid:"use"===t,onSelect:e=>{F.state.open&&F.setState({...F.state,use:e,step:"initial"})}}),o()("div",{style:this.getLabelStyle()},void 0,o()(b.FormattedMessage,{id:"PersonaCollectionModal.initial.companySizeLabel",defaultMessage:"Company size",description:"Label for asking company size"})),o()(U.gq,{},void 0,this.getCompanySizeButtonData().map((e=>{let{type:t,message:i,style:n}=e;return o()(L.Z,{isLightGray:!0,isLarge:!0,style:{...this.getBaseButtonStyle(),...F.state.open&&F.state.companySize===t&&this.getSelectedButtonStyle(),...n},onClick:()=>{F.state.open&&F.setState({...F.state,companySize:t,step:"initial"})}},void 0,i)}))))})),a()(this,"renderCancel",(()=>o()(R.Z,{onClick:this.handleCancel,style:this.getCancelStyle(),hoveredStyle:{background:this.theme.buttonPressedBackground}},void 0,v.Z.closeSmall({width:14,fill:this.theme.mediumTextColor})))),a()(this,"renderThanks",(()=>{const e=this.environment.currentUser.id;if(e)return o()(H,{userId:e})})),a()(this,"renderPrompt",(()=>{const e=this.environment.currentUser.id;if(e)return o()(q,{userId:e})})),a()(this,"handleCancel",(()=>{const{currentUserSettingsStore:e}=T.default.state,t=this.environment.currentUser.id;e&&t&&((0,M.trackPersonaCollectionAction)(this.environment,{user_id:t,event:"cancel"}),w.createAndCommit({userAction:"PersonaCollectionModal.handleCancel",environment:this.environment,perform:t=>{(0,C.d2)({userSettingsStore:e,data:{seen_persona_collection:!0},transaction:t})}}),F.reset())}))}willMountOrUpdate(){var e;if(F.state.open)return;const t=this.environment,i=t.currentUser.id,n=(0,k.g)(i),{currentUserSettingsStore:o}=T.default.state;if(!o||t.device.isMobile)return;const s=o.getSettings();if(!s)return;const a=Boolean(s.seen_persona_collection||(null===(e=s.persona_version)||void 0===e?void 0:e.version)),r="on"===Z.default.getEligibleGroup({experimentId:"persona_collection",defaultGroup:"unassigned"});n>=3&&!a&&r&&!A.default.state.isOnboarding&&"closed"!==F.state.step&&!1===P.Z.state.open&&F.setState({...F.state,open:!0})}renderComponent(){return o()(O.GI,{keepFocus:!1,open:F.state.open,render:this.renderMenu,onDismiss:this.handleCancel,popupType:O.kQ.Popup,disableDarkOverlayBackground:!0,disableMouseCapture:!0})}renderStep(){if(!1===F.state.open)return;const{step:e}=F.state;return c().createElement(c().Fragment,null,o()(B.Z,{isVisible:"initial"===e,enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},render:()=>o()(D.Z,{capture:!0,onBackspace:l().identity,onLeft:l().identity,onRight:l().identity,onSelectAll:l().identity,onRedo:l().identity,onUndo:l().identity,onCut:l().identity,onCopy:l().identity,onPaste:l().identity,onKeypress:l().identity,onDelete:l().identity,onTab:l().identity},void 0,this.renderInitial())}),o()(B.Z,{isVisible:"prompt"===e,animationStyle:this.getAnimationStyle("prompt"===e),enterAnimationStyle:this.getEnterExitAnimationStyle(),exitAnimationStyle:this.getEnterExitAnimationStyle(),render:this.renderPrompt}),o()(B.Z,{isVisible:"thanks"===e,animationStyle:this.getAnimationStyle("thanks"===e),enterAnimationStyle:this.getEnterExitAnimationStyle(),exitAnimationStyle:this.getEnterExitAnimationStyle(),render:this.renderThanks}),o()(B.Z,{isVisible:"initial"===e,enterAnimationStyle:{opacity:1},exitAnimationStyle:{opacity:0},render:()=>o()(E.Z,{isLarge:!0,style:{marginTop:17,width:270,position:"absolute",bottom:20},onClick:()=>this.handleSubmitClick()},void 0,o()(b.FormattedMessage,{id:"PersonaCollectionModal.initial.sendLabel",defaultMessage:"Submit",description:"Button to submit survey results"}))}))}getInvalidField(){if(!F.state.open)return"closed";const{use:e,role:t,work:i,companySize:n}=F.state;return n?e?t?i?void 0:"work":"role":"use":"company_size"}getCompanySizeButtonData(){return[{type:"1_100",message:o()(b.FormattedMessage,{id:"PersonaCollectionModal.initial.1_100Label",defaultMessage:"1-100",description:"Button to select 1-100 employees"})},{type:"101_1000",message:o()(b.FormattedMessage,{id:"PersonaCollectionModal.initial.101_1000Label",defaultMessage:"101-1,000",description:"Button to select 101-1000 employees"}),style:{marginLeft:8,marginRight:8}},{type:"1001+",message:o()(b.FormattedMessage,{id:"PersonaCollectionModal.initial.1000PlusLabel",defaultMessage:"1,001+",description:"Button to select 1,001+ employees"})}]}handleSubmitClick(){const e=this.environment.currentUser.id;if(!F.state.open||!e)return;const t=this.getInvalidField();if(t)return void F.setState({...F.state,step:"initial",invalidField:t});(0,M.trackPersonaCollectionAction)(this.environment,{user_id:e,event:"submit"});const{currentUserSettingsStore:i}=T.default.state;if(i&&F.state.open){const e=F.state;(0,w.createAndCommit)({userAction:"PersonaCollectionModal.handleSubmitClick",environment:this.environment,perform:t=>{(0,C.d2)({userSettingsStore:i,data:{seen_persona_collection:!0,persona:e.work,team_role:e.role,type:e.companySize,use_case:e.use,source:"persona_collection",persona_version:{version:"V3",timestamp:(new Date).getTime()}},transaction:t})}})}F.setState({...F.state,invalidField:void 0,step:"thanks"}),l().delay((()=>{F.reset()}),6e3)}getContainerStyle(){return{background:this.theme.popoverBackground,borderRadius:5,boxShadow:this.theme.mediumBoxShadow,position:"fixed",bottom:65+I.Z.state,right:16+I.Z.state}}getBackgroundStyle(){return{backgroundColor:"transparent",pointerEvents:"none"}}getCancelStyle(){return{position:"absolute",top:"10px",right:"10px",background:this.theme.buttonHoveredBackground,borderRadius:"100%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",zIndex:10}}getInnerContainerStyle(){return{width:320,height:"prompt"===F.state.step||"thanks"===F.state.step?200:450,overflow:"hidden",position:"relative",right:"auto",padding:30,paddingTop:0,cursor:"default",textAlign:"center",justifyContent:"center"}}getLabelStyle(){return{marginTop:10,fontSize:12,color:this.theme.mediumTextColor,fontWeight:S.Z.fontWeight.medium,lineHeight:"135%",marginBottom:4,textAlign:"left"}}getAnimationStyle(e){return{opacity:e?1:0,scale:e?1:.96}}getEnterExitAnimationStyle(){return{opacity:0,scale:.96}}getBaseButtonStyle(){return{border:"1px solid #E7E6E5",flexGrow:1,justifyContent:"center"}}getSelectedButtonStyle(){return{color:f.ZP.blue,border:"1px solid ".concat(f.ZP.blue)}}getSlideUpStyle(){if(!F.state.open)return{};const{step:e}=F.state;return{position:"absolute",transition:"transform 200ms ease",transform:"initial"===e?"translateY(0px)":"translateY(-180px)"}}}const z=V;function q(e){const[t,i]=(0,p.oR)(F),n=(0,g.y)((e=>({promptHeaderStyle:{color:e.regularTextColor,fontWeight:S.Z.fontWeight.semibold,fontSize:14},promptTextStyle:{fontSize:12,color:e.mediumTextColor,width:270,margin:"0 auto"}})),[]),s=(0,m.O7)();return(0,d.useEffect)((()=>{(0,M.trackPersonaCollectionStep)(s,{user_id:e.userId,event:"prompt"})}),[s,e.userId]),o()("div",{style:{paddingTop:24}},void 0,o()("img",{style:{width:40,height:56,paddingTop:24},src:h.Z.images.chatButtonSmallPng}),o()("div",{style:n.promptHeaderStyle},void 0,o()(b.FormattedMessage,{id:"PersonaCollectionModal.prompt.header",defaultMessage:"Tell us more about yourself",description:"Title on survey modal"})),o()("div",{style:n.promptTextStyle},void 0,o()(b.FormattedMessage,{id:"PersonaCollectionModal.prompt.caption",defaultMessage:"We would love to learn more about you so we can make our product better serve you",description:"Explains rationale for survey modal"})),o()(E.Z,{isLarge:!0,style:{marginTop:6,width:260,bottom:20},onClick:()=>{!0===t.open&&i({...t,step:"initial"});const{currentUserSettingsStore:e}=T.default.state;e&&w.createAndCommit({userAction:"PersonaCollectionModal.PersonaCollectionPrompt",environment:s,perform:t=>{(0,C.d2)({userSettingsStore:e,data:{seen_persona_collection:!0},transaction:t})}})}},void 0,o()(b.FormattedMessage,{id:"PersonaCollectionModal.prompt.survey",defaultMessage:"Take the 20 second survey",description:"Button to prompt users to take a short survey"})),o()(L.Z,{isLightGray:!0,isLarge:!0,onClick:()=>{const{currentUserSettingsStore:t}=T.default.state;t&&e.userId&&(w.createAndCommit({userAction:"PersonaCollectionModal.PersonaCollectionPrompt",environment:s,perform:e=>{(0,C.d2)({userSettingsStore:t,data:{seen_persona_collection:!0},transaction:e})}}),(0,M.trackPersonaCollectionAction)(s,{user_id:e.userId,event:"skip"}),F.setState({open:!1,step:"closed"}))}},void 0,o()(b.FormattedMessage,{id:"PersonaCollectionModal.prompt.skipLabel",defaultMessage:"Skip",description:"Button to allow users to skip taking the survey and close out of the modal"})))}function H(e){const t=(0,g.y)((e=>({thanksHeaderStyle:{color:e.regularTextColor,fontWeight:S.Z.fontWeight.semibold,fontSize:14}})),[]),i=(0,m.O7)();return(0,d.useEffect)((()=>{(0,M.trackPersonaCollectionStep)(i,{user_id:e.userId,event:"thanks"})}),[i,e.userId]),o()("div",{},void 0,o()("img",{style:{width:208,height:89,paddingTop:30},src:h.Z.images.heroIllustrationPng}),o()("div",{style:t.thanksHeaderStyle},void 0,o()(b.FormattedMessage,{id:"PersonaCollectionModal.thanks.caption",defaultMessage:"Thank you! Discover new ways to use Notion in the <textlink>Template Gallery</textlink>",description:"Text on thanks modal",values:{textlink:function(){for(var t=arguments.length,n=new Array(t),s=0;s<t;s++)n[s]=arguments[s];return o()(N.Z,{disableUnderline:!0,disableHover:!0,href:y._j.templates,external:!0,style:{color:f.ZP.blue,fontSize:S.Z.fontSize.UIRegular.desktop,fontWeight:500},onClick:()=>{e.userId&&(0,M.trackPersonaCollectionAction)(i,{user_id:e.userId,event:"template_gallery"})}},void 0,n)}}})))}},26200:(e,t,i)=>{i.r(t),i.d(t,{default:()=>U});var n=i(97464),o=i.n(n),s=i(77094),a=i.n(s),r=i(77422),l=i.n(r),d=i(67294),c=i.n(d),u=i(83355),m=i(8848),p=i(53397),g=i(46562),h=i(5366);const f=(0,h.defineMessages)({phishing_or_spam:{id:"reportPage.reportReasons.phishing_or_spam",defaultMessage:"Phishing or spam"},inappropriate_content:{id:"reportPage.reportReasons.inappropriate_content",defaultMessage:"Inappropriate content"},other_content_policy_violation:{id:"reportPage.reportReasons.other_content_policy_violation",defaultMessage:"Other"}});var v=i(82990),y=i(54642),S=i(47307),b=i(360),M=i(28020),w=i(33929),C=i(60709),k=i(33665),T=i(88632),I=i(25399),Z=i(36488),P=i(74194),_=i(78140),x=i(28992),F=i(58189),A=i(63296),B=i(72495),E=i(92660),R=i(74523),D=i(14598),L=i(6202);const O=(0,h.defineMessages)({additionalInformationPlaceholder:{id:"reportPage.additionalInformation.placeholder",defaultMessage:"Add additional information (optional)"}});class N extends u.Z{constructor(e){super(e),l()(this,"handleCancel",(()=>{(0,b.q)()})),l()(this,"renderContent",(()=>{const{device:e}=this.environment;if(!T.Z.state.online)return this.renderOffline();const t=I.Z.state;return t.open?e.isMobile?this.renderMobileModal(t):this.renderDesktopModal(t):void 0})),l()(this,"onSubmit",(async()=>{const e=this.environment,t=I.Z.getState();if(!t.open)return;const{additionalInformation:i,reason:n}=t,o=(0,M.Fv)();if(!n||null==o||!o.id)return void S.showErrorMessage(a()(h.FormattedMessage,{defaultMessage:"Something went wrong.",id:"reportPageModal.somethingWentWrong.label"}));const s=await(r=(0,g.OP)(),(0,y.reportPage)(e,{reason:n,page:o,intercomVisitorId:r,additionalInformation:i}));var r;"failed"===s.type?S.showError(s):(I.Z.setState({open:!1}),S.showMessage({message:c().createElement(c().Fragment,null,a()("div",{style:{display:"flex",flexDirection:"column",alignItems:"center"}},void 0,p.Z.thanksShield({width:40}),a()("div",{style:{paddingTop:12,paddingBottom:8,fontSize:"large",textAlign:"center"}},void 0,a()(h.FormattedMessage,{id:"reportPageModal.thanksForReporting",defaultMessage:"Thanks for reporting this page, our team will take a look."}))))}))})),l()(this,"modalTitleStyle",{fontSize:16,marginBottom:12,fontWeight:v.Z.fontWeight.medium})}renderComponent(){return a()(E.Z,{onDismiss:this.handleCancel,render:this.renderContent,requireOnline:!0,modalStore:I.Z})}renderOptionButtons(e){const{reason:t}=e;return c().createElement(c().Fragment,null,a()(D.Z,{title:a()(h.FormattedMessage,{id:"reportPageModal.reportReasons.phishing_or_spam",defaultMessage:"Phishing or spam"}),isSelected:"phishing_or_spam"===t,onClick:()=>I.Z.setState({...e,reason:"phishing_or_spam"})},"phishing_or_spam"),a()(D.Z,{title:w.default.formatMessage(f.inappropriate_content),isSelected:"inappropriate_content"===t,onClick:()=>I.Z.setState({...e,reason:"inappropriate_content"})},"inappropriate_content"),a()(D.Z,{title:a()(h.FormattedMessage,{id:"reportPageModal.reportReasons.other_content_policy_violation",defaultMessage:"Other"}),isSelected:"other_content_policy_violation"===t,onClick:()=>I.Z.setState({...e,reason:"other_content_policy_violation"})},"other_content_policy_violation"))}renderMobileModal(e){if(!e.open)return;const{reason:t}=e,i={menuType:C.o.Modal,title:a()(h.FormattedMessage,{id:"reportPageModal.mobile.title",defaultMessage:"Report page"}),right:a()(h.FormattedMessage,{id:"reportPageModal.closeButton.label",defaultMessage:"Close"}),onClickRight:this.handleCancel};return c().createElement(_.Z,i,a()(F.Z,{type:F.i.Vertical,initialFocus:void 0,sections:[{key:"help",render:e=>{let{children:t,...i}=e;return c().createElement(B.Z,i,t)},items:[{key:"help",render:()=>a()(x.Z,{title:a()(R.Z,{title:a()(h.FormattedMessage,{id:"reportPage.helpButton.caption",defaultMessage:"Notion's content policy"}),href:(0,k.UY)("contentPolicy"),analyticsFrom:"report_page"}),right:c().createElement(c().Fragment,null),onClick:()=>{}}),action:()=>{}}]},{key:"reportOptions",render:e=>{let{children:t,...i}=e;return c().createElement(B.Z,i,t)},items:[{key:"options",render:()=>this.renderOptionButtons(e),action:()=>{}},{key:"additionalInfo",render:()=>t&&a()(P.Z,{textarea:!0,style:this.getTextAreaStyle(),focus:Boolean(e.reason),value:e.additionalInformation,placeholder:w.default.formatMessage(O.additionalInformationPlaceholder),onChange:t=>{I.Z.setState({...e,additionalInformation:t.target.value})}}),action:()=>{}}]},{key:"actions",render:e=>{let{children:t,...i}=e;return c().createElement(B.Z,o()({isSubmitButton:!0},i),t)},items:[{key:"submit",render:e=>{const{onClick:t,...i}=e;return c().createElement(L.Z,o()({},i,{disabled:!this.canSubmit(),title:a()("div",{style:{color:m.ZP.red}},void 0,a()(h.FormattedMessage,{id:"reportPageModal.reportButton.label",defaultMessage:"Report"})),onClick:t||this.onSubmit}))},action:this.onSubmit}]}]},"main list"))}canSubmit(){const{state:e}=I.Z;if(e.open){const{reason:t}=e;return void 0!==t}return!1}renderDesktopModal(e){if(!e.open)return;const{reason:t}=e;return a()(Z.Z,{capture:!0,allowUndo:!0,allowEsc:!0,allowTabUntab:!1,render:()=>a()("div",{style:this.getModalWrapStyle()},void 0,a()("div",{style:this.modalTitleStyle},void 0,a()(h.FormattedMessage,{id:"reportPageModal.title",defaultMessage:"Why are you reporting this page?"})),a()("div",{style:{paddingBottom:12}},void 0,a()(R.Z,{title:a()(h.FormattedMessage,{id:"reportPage.helpButton.caption",defaultMessage:"Notion's content policy"}),href:(0,k.UY)("contentPolicy"),analyticsFrom:"report_page"})),a()("div",{},void 0,this.renderOptionButtons(e)),t&&a()(P.Z,{textarea:!0,style:this.getTextAreaStyle(),focus:Boolean(e.reason),value:e.additionalInformation,placeholder:w.default.formatMessage(O.additionalInformationPlaceholder),onChange:t=>{I.Z.setState({...e,additionalInformation:t.target.value})}}),a()("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:18}},void 0,a()(A.Z,{isLarge:!0,onClick:this.handleCancel,style:{marginRight:12}},void 0,a()(h.FormattedMessage,{id:"reportPageModal.cancelButton.label",defaultMessage:"Cancel"})),a()(A.Z,{isRed:!0,isLarge:!0,onClick:this.onSubmit,disabled:!this.canSubmit(),disabledFeedback:!0},void 0,a()(h.FormattedMessage,{id:"reportPageModal.reportButton.label",defaultMessage:"Report"}))))})}renderOffline(){return a()("div",{style:this.getOfflineStyle()},void 0,a()(h.FormattedMessage,{defaultMessage:"Please go online to make a report.",id:"reportPageModal.offlineMessage.description"}))}getModalWrapStyle(){return{width:360,padding:24,fontSize:14}}getOfflineStyle(){return{...this.getModalWrapStyle(),color:this.theme.mediumTextColor}}getTextAreaStyle(){const{device:e}=this.environment;return{width:"100%",background:this.theme.popoverBackground,display:"block",padding:e.isMobile?16:"10px 12px",height:e.isMobile?150:130,marginTop:17,marginBottom:17,fontSize:e.isMobile?16:14}}}const U=N},30761:(e,t,i)=>{i.r(t),i.d(t,{default:()=>d});var n=i(77094),o=i.n(n),s=(i(67294),i(480)),a=i(24405),r=i(22346),l=i(62296);function d(e){const t=(0,s.Fy)(),i=(0,a.y)((e=>({modal:{width:t.isMobile?"auto":890,height:t.isMobile?"auto":606,borderRadius:8}})),[t.isMobile]);return o()(r.Z,{open:e.modalOpened,innerStyle:i.modal,onDismiss:e.onModalClose,render:()=>o()("div",{style:{height:"100%",display:"flex",flexDirection:"row",borderRadius:8,overflow:"hidden"}},void 0,o()(l.Z,{location:"sidebar-modal"}))})}},51913:(e,t,i)=>{i.r(t),i.d(t,{MembersTabTitle:()=>_t,PeopleRow:()=>Zt,SettingToggle:()=>xt,SidebarTeamModal:()=>Pt});var n=i(77094),o=i.n(n),s=(i(33948),i(96486)),a=i.n(s),r=i(67294),l=i.n(r),d=i(480),c=i(28350),u=i(24405),m=i(97880),p=i(82990),g=i(5366),h=i(50906),f=i(93678),v=i(43250),y=i(23537),S=i(92350),b=i(14404),M=i(27832),w=i(20431),C=i(20454),k=i(48690),T=i(3386),I=i(22346),Z=i(76798),P=i(18647),_=i(24006),x=i(58032),F=i(64369),A=i(29302),B=i(13490),E=i(66957),R=i(31430),D=i(58260),L=i(71397),O=i(38363),N=i(78122),U=i(97464),W=i.n(U),V=i(53397),z=i(77907),q=i(33052),H=i(42922),G=i(74194);function K(e){let{teamStore:t}=e;const i=(0,u.y)((e=>({container:{display:"flex",justifyContent:"space-between",alignItems:"center",position:"sticky",top:0,background:e.modalBackground,zIndex:10,paddingBottom:8},input:{boxShadow:e.inputBoxShadow,borderRadius:100,fontSize:12,width:"45%",maxWidth:260,marginRight:2},searchIcon:{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,fill:e.mediumIconColor}})),[]),n=(0,g.useIntl)(),[s,a]=(0,c.oR)(k.Z),[r,d,m]=(0,c.oR)(void 0,q.Z),p=(0,S.ef)(t),h=(0,S.vR)(t);return o()("div",{style:i.container},void 0,o()(z.LazyTeamPermissionsInviteWithModal,{store:t,permissionsInviteStore:m,origin:o()(x.Z,{placement:x.Z.Placement.Left,alignment:x.Z.Alignment.Start,textWrap:!0,renderTooltip:()=>h?o()("div",{style:{width:270}},void 0,o()(g.FormattedMessage,{id:"teamPermissionsInviteWithModal.addMembersToDefaultTeam.tooltip",defaultMessage:"You can’t add members because this is a default teamspace and is synced with all workspace members",description:"Message that tells the user that they cannot add members to this team since it is a default team."})):p?o()("div",{style:{width:150}},void 0,o()(g.FormattedMessage,{id:"teamPermissionsInviteWithModal.addMembers.tooltip",defaultMessage:"Add members and groups",description:"Message that tells the user that they can add members and groups via this button."})):o()("div",{style:{width:220}},void 0,o()(g.FormattedMessage,{id:"teamPermissionsInviteWithModal.addMembersNoPermissions.tooltip",defaultMessage:"You do not have permissions to add members to this teamspace",description:"Message that tells the user that they cannot add members to this team since they do not have permissions."})),render:e=>l().createElement(H.Z,W()({disabled:h||!p,isLarge:!0,onClick:()=>{d({...r,modalOpen:!0})}},e),o()(g.FormattedMessage,{id:"teamPermissionsInviteWithModal.openModal",defaultMessage:"Add members"}))})}),o()(G.Z,{placeholder:n.formatMessage({id:"teamPermissionsInviteWithModal.filterGroupsAndMembersInput.placeholder",defaultMessage:"Search for members or groups…",description:"Search input text shown in team settings for filtering groups and members in a team."}),style:i.input,value:s.memberFilterQuery,onChange:e=>{a({...s,memberFilterQuery:e.target.value,limitMembers:!0})},left:V.Z.searchThick(i.searchIcon),showClearButton:!0,format:G.Z.Format.Small}))}i(73210),i(85827);var j=i(31942),Y=i(59054),Q=i(27006),X=i(19889),J=i(64684),$=i(31299),ee=i(38755),te=i(62385),ie=i(75246),ne=i(67669),oe=i(86125),se=i(12793),ae=i(31278),re=i(25383),le=i(25735),de=i(23596),ce=i(47307),ue=i(80456),me=i(60709),pe=i(61766),ge=i(31194),he=i(52275),fe=i(31945),ve=i(61519),ye=i(78140),Se=i(58189),be=i(91941),Me=i(72495),we=i(29369),Ce=i(91718),ke=i(7567);function Te(e){const{teamStore:t,memberInfo:i,permissionItem:n,memberName:s,style:a,onMenuItemClicked:m,isPermissionOverridden:p}=e,h=(0,d.O7)(),f=(0,g.useIntl)(),v=(0,u.F)(),y=(0,r.useMemo)((()=>new pe.Z),[]),S=(0,u.y)((e=>({header:{display:"flex",flexDirection:"column",backgroundColor:e.sidebarSecondaryBackground,fontSize:12,color:e.mediumTextColor,alignItems:"flex-start",paddingTop:10,paddingLeft:12,paddingRight:12,paddingBottom:10},overrideTitle:{display:"flex",alignItems:"center",justifyContent:"space-between",height:28},overrideLabel:{paddingLeft:8,color:e.mediumTextColor}})),[]),b=(0,c.VK)((()=>t.getTeamPermission()),[t]),w=(0,c.VK)((()=>{if(null==t||!t.isDefined())return;const e=f.formatMessage({id:"teamMemberPermissionRoleSelect.member.permissionitem.description",defaultMessage:"You can't give less access than the teamspace default. Lower teamspace members‘ access to enable this option."}),i=o()(g.FormattedMessage,{id:"teamMemberPermissionRoleSelect.permissionItem.defaultTag",defaultMessage:"default"});function n(i){return(0,J.bk)({teamValue:{id:t.id,permissions:t.getPermissions()},permissionRole:i})?{isDisabled:!0,disabledMessage:e}:void 0}return["editor","read_and_write","comment_only","reader"].map((e=>({role:e,disabledInfo:n(e),tag:(null==b?void 0:b.role)===e?i:void 0})))}),[b,f,t]);const[{currentSpaceStore:C}]=(0,c.oR)(M.default),k=(0,c.VK)((()=>!("enterprise"===(null==C?void 0:C.getSubscriptionTier()))&&!p),[C,p]),T=o()("div",{style:S.overrideTitle},void 0,o()(g.FormattedMessage,{id:"TeamMemberOwnerSelect.permissionsOverride",defaultMessage:"Custom permissions",description:"A menu item for the user to click on and assign or see the custom role for a team member."}),k?o()(Ce.Z,{subscriptionTier:"enterprise",analyticsName:"team_member_permission_override",desktopStyle:{marginLeft:8,marginRight:12}}):o()(ke.Z,{role:"owner"===i.type?"none":n.role,table:we.e0,type:"user"===i.entity_type?"user_permission":"group_permission",upgradeButtonName:"user"===i.entity_type?"user_permission_item":"group_permission_item",buttonStyle:{marginRight:0,fontSize:12,color:v.mediumTextColor,visibility:p?void 0:"hidden"},availableRoleItems:w,header:o()(F.Z,{isSmall:!0,isSecondaryColor:!0,style:{fontWeight:600,marginLeft:16,marginTop:8}},void 0,o()(g.FormattedMessage,{id:"teamMemberPermissionRoleSelect.permissionOverride.menuHeader",defaultMessage:"Select custom role",description:"Header text for the customize permission options popup."})),onChange:e=>{"none"!==e&&(!function(e){ce.showDialog({message:o()(g.FormattedMessage,{id:"teamMemberPermissionSettings.permissionSwitcher.confirmation.message",defaultMessage:"Are you sure you want to change {name}'s role to {role}?",values:{name:s,role:(0,ne.r_)(e).toLowerCase()}}),description:o()(g.FormattedMessage,{id:"teamMemberPermissionSettings.permissionSwitcher.confirmation.description",defaultMessage:"This change won't apply to any restricted pages in the teamspace."}),showCancel:!0,keepFocus:!1,handleCancel:ce.dismissDialog,items:[{label:o()(g.FormattedMessage,{id:"teamMemberPermissionSettings.permissionSwitcher.accept",defaultMessage:"Change access"}),color:"red",onAccept:async()=>{const{serverCommitResult:n}=ue.createAndCommit({userAction:"TeamMemberPermissionRoleSelect.handleRoleSelect",environment:h,perform:n=>{O.jg({memberInfo:i,teamStore:t,transaction:n,environment:h,permissionRole:e})}});await n}}]})}(e),m&&m())},buttonPopupStore:y,placementToOrigin:ge.Iw.Right,alignmentToOrigin:ge.lU.End}));return o()(x.Z,{placement:x.Z.Placement.Left,textWrap:!0,renderTooltip:()=>o()(g.FormattedMessage,{id:"teamMemberPermissionRoleSelect.permissionOverride.buttonTooltip",defaultMessage:"Set a custom permission level for all pages in this teamspace",description:"Tooltip shown when hovering over the custom permissions button."}),render:e=>l().createElement(he.Z,W()({},e,{focused:!1,style:a,textWrapperStyle:{marginRight:0},disabled:k,onClick:()=>y.setState({open:!0}),title:T,icon:p?o()("div",{style:{marginTop:8}},void 0,V.Z.check({width:14})):void 0}))})}function Ie(e){let{teamStore:t,memberInfo:i,permissionItem:n,memberName:s,isPermissionOverridden:a,disabled:r}=e;const l=(0,c.qz)(void 0,pe.Z),[u,p]=(0,c.oR)(l),h=(0,d.O7)(),[{currentUserStore:f,currentSpaceStore:v}]=(0,c.oR)(M.default),y=(0,c.VK)((()=>{const e=null==f?void 0:f.userId;return"user"===i.entity_type&&i.user_id===e}),[null==f?void 0:f.userId,i]),S=()=>p({...u,open:!1}),b=async e=>{if(S(),"owner"===e){if("user"===i.entity_type){const{serverCommitResult:e}=ue.createAndCommit({userAction:"TeamMemberOwnerSelect.handleOwnerMenuItemClicked",environment:h,perform:e=>{O.W8({environment:h,userId:i.user_id,teamStore:t,transaction:e})}});await e}}else y?ce.showDialog({message:o()(g.FormattedMessage,{id:"teamMemberPermissionSettings.removeSelfTeamOwner.confirmation.message",defaultMessage:"Are you sure you want to remove yourself as a teamspace owner? You'll no longer be able to edit teamspace settings and permissions."}),showCancel:!0,keepFocus:!1,handleCancel:ce.dismissDialog,items:[{label:o()(g.FormattedMessage,{id:"teamMemberPermissionSettings.permissionSwitcher.accept",defaultMessage:"Change access"}),color:"red",onAccept:w}]}):await w()},w=async()=>{if("owner"===i.type&&"user"===i.entity_type){const{serverCommitResult:e}=ue.createAndCommit({userAction:"TeamMemberOwnerSelect.handleSetMemberAccept",environment:h,perform:e=>{O.mX({userId:i.user_id,teamStore:t,transaction:e,environment:h})}});await e}else if("member"===i.type){const{serverCommitResult:e}=ue.createAndCommit({userAction:"TeamMemberOwnerSelect.handleSetMemberAccept",environment:h,perform:e=>{O.X0({memberInfo:i,teamStore:t,transaction:e})}});await e}},C=async()=>{const{entity_type:e}=i;switch(S(),e){case"group":const n=(0,ee.getSpacePermissionGroup)({spaceStore:v,groupId:i.group_id});if(!n)throw new Error("Permission group not found in space.");O.mN({environment:h,teamStore:t,group:n});break;case"user":await O.WO({environment:h,teamStore:t,currentSpaceStore:v,userId:i.user_id,from:"team_settings_member_table"});break;default:(0,m.t1)(e)}};return o()(fe.Z,{buttonPopupStore:l,placementToOrigin:ge.Iw.Bottom,renderOrigin:e=>o()(Pe,{buttonPopupEvents:e,isPermissionOverridden:a,permissionItem:n,memberInfo:i,disabled:r}),render:()=>o()(Ze,{teamStore:t,isPermissionOverridden:a,memberInfo:i,permissionItem:n,memberName:s,onMenuItemClicked:b,onRemoveClicked:C,onSubMenuItemClicked:S}),popupType:fe.Z.PopupType.Popup})}function Ze(e){let{teamStore:t,isPermissionOverridden:i,memberInfo:n,permissionItem:s,memberName:r,onRemoveClicked:d,onMenuItemClicked:m,onSubMenuItemClicked:h}=e;const f=(0,c.VK)((()=>t.isDefault()),[t]),S=(0,c.VK)((()=>(0,y.Hu)({membership:t.getKeyStore("membership").getValue()})),[t]),b=(0,c.VK)((()=>1===t.getMembers().filter((e=>"owner"===e.type)).length),[t]),M=(0,u.y)((e=>{const t={paddingTop:5,paddingBottom:5},i={...t,width:280,alignItems:"flex-start"};return{actionMenu:{marginTop:-4},removeButton:{...t,color:e.errorText},menuItem:i,indentedMenuItem:{...i,paddingLeft:20},overrideLabel:{paddingLeft:10,color:e.mediumTextColor,fontSize:12,fontWeight:p.Z.fontWeight.regular}}}),[]),w=(e,t)=>{const n="member"===e&&"owner"===t.type&&b||"owner"===e&&"group"===t.entity_type,a="owner"===e&&"group"===t.entity_type||n;return{key:e,action:()=>m(e),render:r=>{const d=!i&&t.type===e;return o()(x.Z,{disableTooltip:!n,placement:x.Z.Placement.Right,textWrap:!0,renderTooltip:()=>"group"===t.entity_type?o()(g.FormattedMessage,{id:"TeamMemberOwnerSelect.memberItem.disableOwnerForGroupsTooltip",defaultMessage:"Groups can't be teamspace owners",description:"Tooltip shown when the option for upgrading someone to an owner is disabled because it is a group."}):o()(g.FormattedMessage,{id:"TeamMemberOwnerSelect.memberItem.disableWithOnlyOneOwnerTooltip",defaultMessage:"Add another teamspace owner to downgrade yourself to member",description:"Tooltip shown when the option for downgrading someone to a member is disabled because there is only one owner."}),render:t=>l().createElement("span",t,l().createElement(he.Z,W()({},r,{style:d?M.menuItem:M.indentedMenuItem,disabled:a,disabledFeedback:a,title:o()(_e,{isPermissionOverridden:i,type:e,permissionItem:s}),caption:Fe(e),shouldWrapCaption:!0,icon:d?V.Z.check({width:14}):void 0})))})}}},C=f&&"user"===n.entity_type,k=[{key:"teamRoles",items:a().compact([w("owner",n),w("member",n),Ae({onRemoveClicked:d,styles:M,isMemberInDefaultTeam:C}),..."owner"===n.type||S?[]:[{key:"divider",action:()=>{},render:()=>o()(ve.Z,{size:10})},{key:"permissions_override",action:()=>{},render:e=>l().createElement("span",e,o()(Te,{teamStore:t,memberInfo:n,permissionItem:s,memberName:r,onMenuItemClicked:h,isPermissionOverridden:i,style:i?M.menuItem:M.indentedMenuItem}))}]]),render:e=>l().createElement(Me.Z,W()({},e,{topBorder:0!==e.index}))}];return o()(ye.Z,{className:v.a6,menuType:me.o.Popup},void 0,o()(Se.Z,{type:Se.i.Vertical,initialFocus:void 0,sections:k}))}function Pe(e){let{buttonPopupEvents:t,disabled:i,isPermissionOverridden:n,permissionItem:s,memberInfo:a}=e;const r=(0,u.y)((e=>({label:{color:e.regularTextColor,fontSize:12.5,fontWeight:p.Z.fontWeight.regular},overrideLabel:{color:e.mediumTextColor,fontSize:12,fontWeight:p.Z.fontWeight.regular},chevron:{width:10,marginLeft:4,fill:e.lightIconColor}})),[]),d=function(e,t,i){if(t&&i)return function(e){switch(e){case"none":return o()(g.FormattedMessage,{id:"TeamMemberOwnerSelect.roleName.none",defaultMessage:"No access"});case"reader":return o()(g.FormattedMessage,{id:"TeamMemberOwnerSelect.roleName.reader",defaultMessage:"Can view"});case"comment_only":return o()(g.FormattedMessage,{id:"TeamMemberOwnerSelect.roleName.comment_only",defaultMessage:"Can comment"});case"content_only_editor":return o()(g.FormattedMessage,{id:"TeamMemberOwnerSelect.roleName.content_only_editor",defaultMessage:"Can edit content"});case"membership_admin":case"read_and_write":return o()(g.FormattedMessage,{id:"TeamMemberOwnerSelect.roleName.read_and_write",defaultMessage:"Can edit"});case"editor":return o()(g.FormattedMessage,{id:"TeamMemberOwnerSelect.roleName.editor",defaultMessage:"Full access"});default:(0,m.t1)(e)}}(i);return xe(e)}(a.type,n,s.role);return l().createElement(be.Z,W()({disabled:i},t),n&&o()("span",{style:r.overrideLabel},void 0,o()(g.FormattedMessage,{id:"TeamMemberOwnerSelect.roleName.custom",defaultMessage:"Custom",description:"Tells the user that this is a custom permission override."}),o()("span",{style:{marginLeft:5,marginRight:5}},void 0,"•")),o()("span",{style:r.label},void 0,d),!i&&V.Z.chevronDown(r.chevron))}function _e(e){let{isPermissionOverridden:t,permissionItem:i,type:n}=e;const s=xe(n);return o()("div",{},void 0,o()("span",{},void 0,s))}function xe(e){switch(e){case"owner":return o()(g.FormattedMessage,{id:"TeamMemberOwnerSelect.ownerLabel",defaultMessage:"Teamspace owner"});case"member":return o()(g.FormattedMessage,{id:"TeamMemberOwnerSelect.memberLabel",defaultMessage:"Teamspace member"});case"team_level_guest":return o()(g.FormattedMessage,{id:"TeamMemberOwnerSelect.guestLabel",defaultMessage:"Guest"});default:(0,m.t1)(e)}}function Fe(e){switch(e){case"owner":return o()(g.FormattedMessage,{id:"TeamMemberOwnerSelect.ownerCaption",defaultMessage:"Full access to teamspace pages and can edit teamspace settings"});case"member":return o()(g.FormattedMessage,{id:"TeamMemberOwnerSelect.memberCaption",defaultMessage:"Access to teamspace pages but cannot edit teamspace settings"});case"team_level_guest":return;default:(0,m.t1)(e)}}function Ae(e){let{styles:t,onRemoveClicked:i,isMemberInDefaultTeam:n}=e;const s=n?o()(g.FormattedMessage,{id:"TeamMemberOwnerSelect.remove.disabledTooltip.cannotRemoveFromDefault",defaultMessage:"Members cannot be removed from a default teamspace.",description:'Tooltip shown when hovering over the disabled "Remove" button, shown to indicate that members cannot be removed since the group is default .'}):void 0;return{key:"remove",action:i,render:e=>o()(x.Z,{disableTooltip:!s,placement:x.Z.Placement.Right,textWrap:!1,renderTooltip:()=>s,render:i=>l().createElement("span",i,l().createElement(he.Z,W()({},e,{style:{...t.removeButton,...t.indentedMenuItem},disabled:Boolean(s),disabledFeedback:!0,title:o()(g.FormattedMessage,{id:"TeamMemberOwnerSelect.remove",defaultMessage:"Remove"})})))})}}var Be=i(13380);function Ee(e){const{icon:t,label:i,name:n,tag:s,style:a}=e,r=(0,u.y)((e=>({container:{display:"flex",flexDirection:"row",alignItems:"center",gap:10,...a},labelContainer:{display:"flex",flexDirection:"column",...p.Z.textOverflowStyle},name:{minWidth:30},nameContainer:{display:"flex",flexDirection:"row",alignItems:"center"}})),[a]);return o()("div",{style:r.container},void 0,t,o()("div",{style:r.labelContainer},void 0,o()("div",{style:r.nameContainer},void 0,o()(Be.s,{style:r.name},void 0,n),s),o()(F.Z,{isSmall:!0,isSecondaryColor:!1,isMultiline:!0},void 0,o()(Be.s,{},void 0,i))))}function Re(e){const{iconComponent:t,label:i,name:n,permissionRoleSelectComponent:s,tag:a,tooltip:r,style:d}=e,c=(0,u.y)((e=>({permissionRow:{display:"flex",flexDirection:"row",lineHeight:1.2,fontSize:14,width:"100%",minHeight:52,justifyContent:"space-between",alignItems:"center",...d}})),[d]);return o()("div",{style:c.permissionRow},void 0,o()(Ee,{icon:t,name:n,tag:a,label:i,style:{minWidth:200,marginRight:6}}),o()(x.Z,{textWrap:!0,style:{width:210},disableTooltip:!r,placement:x.Z.Placement.Left,renderTooltip:()=>r,render:e=>l().createElement("span",e,s)}))}function De(e){const{type:t,store:i,permissionItem:n,memberInfo:s}=e,[{currentSpaceStore:a}]=(0,c.oR)(M.default),r=(0,g.useIntl)(),p=(0,c.VK)((()=>{switch(t){case"group":return"none";case"user":return null!=a&&a.isDefined()?(0,ne.su)({permissions:null==a?void 0:a.getPermissionItems()},e.memberInfo.user_id):"none";default:(0,m.t1)(t)}}),[a,t,e]),h=(0,S.ql)(i),f=(0,d.O7)(),v=(0,c.VK)((()=>{const e=f.currentUser.id,t=i.getSettingsStore().getValue();return!!(null!=a&&a.isDefined()&&i.isDefined()&&t&&e)&&(0,J.W9)({membership:i.getMembers(),settings:t},e,{permissions:a.getPermissionItems(),subscription_tier:a.getSubscriptionTier(),permission_groups:a.getPermissionGroups()})}),[f.currentUser.id,a,i]),y=(0,c.VK)((()=>{var e;return"owner"!==s.type&&n.role!==(null===(e=i.getTeamPermission())||void 0===e?void 0:e.role)}),[s.type,n.role,i]),{name:b,label:w,icon:C}=(0,c.VK)((()=>{switch(t){case"group":return function(e){var t;let{spaceId:i,permissionGroup:n}=e;const{name:s,user_ids:a,icon:r}=n,d=null!==(t=null==a?void 0:a.length)&&void 0!==t?t:0;return{name:null!=s?s:o()(g.FormattedMessage,{id:"teamPermissionSettings.unknownGroup",defaultMessage:"Unknown Group",description:"Shown in team members list in team settings when group name is not available."}),label:o()(x.Z,{placement:x.Z.Placement.Bottom,alignment:x.Z.Alignment.Start,disableTooltip:0===d,renderTooltip:()=>o()(le.Y,{group:n,limit:10,noMembersMessage:void 0}),render:e=>l().createElement("div",e,o()(g.FormattedMessage,{id:"teamPermissionSettings.group",defaultMessage:"Group",description:"Indicates a group of members"})," • ",o()(g.FormattedMessage,{id:"teamPermissionSettings.numberOfMembers",defaultMessage:"{groupSize, plural, one {{groupSize} member} other {{groupSize} members}}",description:"Shown in team members list in team settings underneath group name.",values:{groupSize:d}}))}),icon:r&&o()(ae.Z,{bucket:"public",disabled:!0,onChange:()=>{},isEmptyPage:!1,title:s,size:18,icon:r&&i?{icon:r,pointer:{table:ie.bx,id:i}}:void 0})}}({permissionGroup:e.permissionGroup,spaceId:null==a?void 0:a.id});case"user":return function(e){let{intl:t,userValue:i}=e;return{name:(0,X.Nz)(t,i),label:null==i?void 0:i.email,icon:o()(re.Z,{avatarShouldShowShadow:!0,userValue:i,size:de.Z.iconSize})}}({intl:r,userValue:e.userStore.getValue()});default:(0,m.t1)(t)}}),[t,e,r,null==a?void 0:a.id]),k=o()("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},void 0,o()(Ie,{teamStore:i,memberInfo:s,memberName:b,permissionItem:n,isPermissionOverridden:y,disabled:!h&&!v})),T=(0,u.y)((e=>({row:{minHeight:52},pill:{marginLeft:6,height:17}})),[]);return o()(Re,{style:T.row,tag:(0,Q.Bc)(p)?o()(oe.Z,{desktopStyle:T.pill,mobileStyle:T.pill,role:Le(p)}):"group"===t?o()("div",{style:T.pill},void 0,C):void 0,permissionRoleSelectComponent:k,iconComponent:"group"===t?o()(se.Z,{size:32}):C,name:b,label:w})}function Le(e){switch(e){case"editor":return"admin";case"membership_admin":return"membership_admin";default:(0,m.t1)(e)}}var Oe=i(64964);function Ne(e){let{teamStore:t,memberToAdd:i}=e;const n=(0,d.O7)(),s=(0,g.useIntl)(),a=(0,u.y)((()=>({container:{display:"flex",flexDirection:"row",lineHeight:1.2,fontSize:14,width:"100%",minHeight:52,justifyContent:"space-between",alignItems:"center"}})),[]),l=(0,r.useCallback)((e=>{Oe.oV({label:o()(g.FormattedMessage,{id:"SpecificTeamMemberToAddRow.team_invite_failure",defaultMessage:"Failed to add {user}",description:"Client side message shown when the team invite fails on the server side.",values:{user:e.name||e.email}})})}),[]),c=(0,r.useCallback)((async e=>{await(0,O.Uj)({environment:n,teamMemberInfos:[{type:"member",entity_type:"user",user_id:e.id}],teamStore:t,isSettingDefaultTeam:!1,createNewTeamFlowId:void 0})||l(e)}),[n,t,l]);return o()("div",{style:a.container},void 0,o()(Ee,{icon:o()(re.Z,{userValue:i,size:32}),name:(0,X.Nz)(s,i),label:i.email}),o()(be.Z,{isBlue:!0,onClick:async()=>{await c(i)},icon:V.Z.plus},void 0,o()(g.FormattedMessage,{id:"SpecificTeamMemberToAddRow.addMemberButton.text",description:"Button for add a member to the team.",defaultMessage:"Add"})))}function Ue(e){let{sortType:t,onChangeSortType:i}=e;const n=(0,u.y)((e=>({container:{width:"100%",display:"flex",justifyContent:"space-between",borderBottom:"1px solid ".concat(e.regularDividerColor)}})),[]),s=e=>e===t.column?t.sortedAscending?"ascending":"descending":"none",a=e=>{const n=e===t.column&&!t.sortedAscending;i({column:e,sortedAscending:n})};return l().createElement(l().Fragment,null,o()("div",{style:n.container},void 0,o()(We,{title:o()(g.FormattedMessage,{id:"TeamPermissionsListHeader.nameColumn",defaultMessage:"Name"}),sortedType:s("name"),onClick:()=>a("name")}),o()(We,{title:o()(g.FormattedMessage,{id:"TeamPermissionsListHeader.roleColumn",defaultMessage:"Role"}),sortedType:s("role"),onClick:()=>a("role")})))}function We(e){let{sortedType:t,title:i,onClick:n}=e;const s=(0,u.y)((e=>({button:{color:e.mediumTextColor,fontSize:12,padding:0},buttonHover:{background:"unset"},sortIcon:{width:14,height:14,marginRight:5,fill:e.mediumIconColor}})),[]);return o()(be.Z,{style:s.button,hoveredStyle:s.buttonHover,onClick:n},void 0,"ascending"===t&&V.Z.arrowUp(s.sortIcon),"descending"===t&&V.Z.arrowDown(s.sortIcon),i)}function Ve(e){var t,i;let{store:n}=e;const s=(0,d.O7)(),h=(0,u.y)((e=>({container:{display:"block",overflow:"hidden"},membersHeader:{marginBottom:8},noResult:{fontSize:p.Z.fontSize.UIRegular.desktop,color:e.mediumTextColor,marginTop:8},showMore:{marginBottom:24,width:"max-content"}})),[]),[f,v]=(0,r.useState)({column:"role",sortedAscending:!1}),[y]=(0,c.oR)(k.Z),b=(0,S.ef)(n),w=(0,c.VK)((()=>n.getMembers()),[n]),[{currentUserStore:T,currentSpaceStore:I}]=(0,c.oR)(M.default),{permissionRowInfos:Z,numNotShown:P}=(0,c.VK)((()=>{const e=function(e){let{permissionRowInfos:t,memberFilterQuery:i}=e;if(""===i)return t;return(0,j.ZP)(i,t,(e=>{var t;const{type:i}=e;switch(i){case"group":return null!==(t=e.permissionGroup.name)&&void 0!==t?t:"";case"user":const n=e.userStore.getValue();return n?(0,X.of)(n):"";default:(0,m.t1)(i)}}))}({permissionRowInfos:function(e){let{currentUserStore:t,currentSpaceStore:i,teamStore:n,members:o}=e;return a().compact(o.map((e=>{const{entity_type:o}=e;return"user"===o?function(e){let{currentUserStore:t,teamStore:i,member:n}=e;if(!t)return;const o=ze({teamStore:i,member:n}),s=C.Z.createChildStore(t,{table:X.KJ,id:n.user_id});return{type:"user",memberInfo:n,permissionItem:{type:"user_permission",user_id:n.user_id,role:o},userStore:s}}({currentUserStore:t,teamStore:n,member:e}):"group"===o?function(e){let{currentSpaceStore:t,teamStore:i,member:n}=e;const o=(0,ee.getSpacePermissionGroup)({spaceStore:t,groupId:n.group_id});if(!o)return;const s=ze({teamStore:i,member:n});return{type:"group",memberInfo:n,permissionItem:{type:"group_permission",group_id:o.id,role:s},permissionGroup:o}}({currentSpaceStore:i,teamStore:n,member:e}):void(0,m.t1)(o)})))}({currentUserStore:T,currentSpaceStore:I,teamStore:n,members:w}),memberFilterQuery:y.memberFilterQuery}),t=function(e){let{permissionRowInfos:t,sortType:i}=e;const{column:n,sortedAscending:o}=i,s={permissionRowInfos:t,sortedAscending:o};if("role"===n)return function(e){let{permissionRowInfos:t,sortedAscending:i}=e;const n=["owner","member","team_level_guest"],o=["group","user"];return[...t].sort(((e,t)=>{const i=e.memberInfo.entity_type,n=t.memberInfo.entity_type;return o.indexOf(i)-o.indexOf(n)})).sort(((e,t)=>{const o=e.memberInfo.type,s=t.memberInfo.type,a=n.indexOf(o)-n.indexOf(s);return i?-a:a}))}(s);if("name"===n)return function(e){let{permissionRowInfos:t,sortedAscending:i}=e;return[...t].sort(((e,t)=>{var n,o;const s=null!==(n=qe(e))&&void 0!==n?n:"",a=null!==(o=qe(t))&&void 0!==o?o:"";if(s===a)return 0;const r=s<a?-1:1;return i?-r:r}))}(s);(0,m.t1)(n)}({permissionRowInfos:e,sortType:f}),i=y.limitMembers?t.slice(0,50):t;return{permissionRowInfos:i,numNotShown:e.length-i.length}}),[I,T,w,n,f,y.memberFilterQuery,y.limitMembers]),[_]=(0,Y.r5)((async()=>{var e;if(!b||null===(e=y.memberFilterQuery)||void 0===e||!e.trim().length)return[];const t=await $.O$({environment:s,query:y.memberFilterQuery,membersOnly:!0}),i=Z.reduce(((e,t)=>{var i;return"user"===t.type&&null!==(i=t.memberInfo)&&void 0!==i&&i.user_id&&e.add(t.memberInfo.user_id),e}),new Set);return t.filter((e=>!Boolean(i.has(e.id)))).slice(0,5)}),[s,y.memberFilterQuery,Z,b]),x=Boolean(null===(t=y.memberFilterQuery)||void 0===t?void 0:t.trim().length),F=Z.length>0,A="resolved"===_.status&&(null===(i=_.value)||void 0===i?void 0:i.length)>0;return o()("div",{style:h.container},void 0,o()(He,{title:x?o()(g.FormattedMessage,{id:"TeamPermissionsList.search.inThisTeam",defaultMessage:"In this team",description:"Label for a list of users who are currently in the team"}):o()(Ue,{sortType:f,onChangeSortType:v}),rows:Z,renderRow:e=>l().createElement(De,W()({store:n},e))}),P>0&&o()(te.Z,{style:h.showMore,onClick:()=>{k.Z.setState({...y,limitMembers:!1})}},void 0,o()(g.FormattedMessage,{defaultMessage:"Show {numNotShown} more",id:"teamPermissionSettings.member.showMore",description:"Show more button when not all members can be shown at once. Clicking on it will show remaining members in the team.",values:{numNotShown:P}})),A&&o()(He,{title:o()(g.FormattedMessage,{id:"TeamPermissionsList.search.notInTeam",defaultMessage:"Not in team",description:"Label for a list of users who are currently not in the team"}),rows:_.value||[],renderRow:e=>o()(Ne,{teamStore:n,memberToAdd:e})}),!F&&!A&&o()("div",{style:h.noResult},void 0,o()(g.FormattedMessage,{id:"TeamPermissionsList.search.zeroState",defaultMessage:"No members found",description:"Label when no members are found matching the search query"})))}function ze(e){let{teamStore:t,member:i}=e;const n=t.getPermissions();if(!n)return"none";const o=function(e){let{permissions:t,member:i}=e;const n=null==t?void 0:t.find((e=>(0,Q.hV)(e)&&"group"===i.entity_type&&e.group_id===i.group_id||(0,Q.jg)(e)&&"user"===i.entity_type&&i.user_id===e.user_id));return null==n?void 0:n.role}({permissions:n,member:i});return o||(0,J.xC)({id:t.id,permissions:t.getPermissions()})}function qe(e){const{type:t}=e;if("user"===t){var i;const{userStore:t}=e;return null!==(i=t.getName())&&void 0!==i?i:t.getEmail()}if("group"===t){const{permissionGroup:t}=e;return t.name}(0,m.t1)(t)}function He(e){let{rows:t,renderRow:i,title:n}=e;const s=(0,u.y)((e=>({membersList:{flexGrow:1,flexShrink:1,display:"flex",flexDirection:"column",width:"100%",marginBottom:12},memberDivider:{borderBottom:"1px solid ".concat(e.regularDividerColor)}})),[]);return t.length?l().createElement(l().Fragment,null,n&&o()(F.Z,{isSmall:!0},void 0,n),o()("div",{style:s.membersList},void 0,t.map(((e,t)=>l().createElement(l().Fragment,null,t>0&&o()("div",{style:s.memberDivider}),i(e)))))):null}function Ge(e){let{teamStore:t}=e;const i=(0,u.y)((()=>({content:{display:"grid",gridAutoFlow:"row",rowGap:14}})),[]);return o()("div",{style:i.content},void 0,o()(K,{teamStore:t}),o()(Ve,{store:t}))}function Ke(e){let{teamStore:t}=e;return l().createElement(l().Fragment,null,o()(je,{teamStore:t}),o()(Ge,{teamStore:t}))}function je(e){let{teamStore:t}=e;const i=(0,d.O7)(),n=(0,u.y)((e=>({content:{width:"100%",display:"grid",gridAutoFlow:"row",rowGap:26},divider:{marginBottom:20},defaultTeamToggle:{marginTop:0,border:"1px solid ".concat(e.regularDividerColor),borderRadius:4,padding:"12px 0px 12px 16px",marginBottom:32},header:{marginBottom:12}})),[]),[{currentSpaceStore:s}]=(0,c.oR)(M.default),a=(0,S.ql)(t),{displayed:r,isTeamInviteOnly:m}=(0,c.VK)((()=>{var e;const i=t.getSettingsStore().getKeyStore("space_member_join_access").getValue(),n=null!==(e=null==s?void 0:s.canAdmin())&&void 0!==e&&e;return{displayed:a&&n,isTeamInviteOnly:"invite_only"===i}}),[t,s,a]),p=(0,c.VK)((()=>{var e;return null!==(e=t.isDefault())&&void 0!==e&&e}),[t]);return r?l().createElement(l().Fragment,null,o()(xt,{on:p,disabled:m,onChange:async()=>{s&&await async function(e,t,i){const n=!t.isDefault();if(!(await(0,N.HV)(n)))return;await(0,O.MH)({teamStore:t,spaceStore:i,environment:e,isDefault:n,createNewTeamFlowId:void 0,from:"sidebar_team_modal"})}(i,t,s)},title:o()(g.FormattedMessage,{id:"teamSettings.defaultTeam.title",defaultMessage:"Make default teamspace",description:"Shown as a title for a toggle in teamspace settings that indicates whether the teamspace should be synced with the entire workspace."}),caption:o()(g.FormattedMessage,{id:"teamSettings.defaultTeam.subtitle",defaultMessage:"Automatically add all workspace members to this teamspace",description:"Shown as a sub-title for a toggle in teamspace settings that indicates whether the teamspace should be synced with the entire workspace."}),tooltip:m&&o()(g.FormattedMessage,{id:"teamSettingsGeneral.setting.isDefaultTeam.tooltipInviteOnlyTeam",defaultMessage:"Make this an open teamspace to allow this setting",description:"Tooltip text shown when hovering over default teamspace toggle for a teamspace that is closed or private."}),style:n.defaultTeamToggle,shouldTriggerUpsell:!1})):null}i(7406);var Ye=i(26825);const Qe=["none","reader","comment_only","read_and_write","editor"],Xe=["reader","comment_only","read_and_write","editor"],Je=["editor"];function $e(e){var t;const i=function(e){var t,i,n,o;let{teamId:s,permissions:a}=e;const r=null!==(t=null===(i=a.find((e=>(0,Q.ix)(e))))||void 0===i?void 0:i.role)&&void 0!==t?t:"none",l=null!==(n=null===(o=a.find((e=>(0,Q.zU)(e)&&e.team_id===s)))||void 0===o?void 0:o.role)&&void 0!==n?n:r;return{spacePermission:{type:"space_permission",role:r},teamMemberPermission:{type:"explicit_team_permission",team_id:s,role:l},teamOwnerPermission:{type:"explicit_team_owner_permission",team_id:s,role:"editor"}}}({teamId:e.id,permissions:null!==(t=e.permissions)&&void 0!==t?t:[]}),{spacePermission:n,teamMemberPermission:o}=i,s={visibility:["team_members","space_members"],space_member_join_access:["invite_only","self_join"],invite_access:["team_members","team_owners"]},a={spacePermission:tt({roles:Qe,currentRole:o.role}),teamMemberPermission:et({roles:Xe,currentRole:n.role}),teamOwnerPermission:Je},{visibility:r,space_member_join_access:l}=e.settings;return"team_members"===r&&(s.space_member_join_access=["invite_only"],a.spacePermission=["none"]),"self_join"===l&&(s.visibility=["space_members"],s.invite_access=["team_members"],a.spacePermission=a.spacePermission.filter((e=>"none"!==e))),e.is_default&&(a.teamMemberPermission=[o.role],a.spacePermission=[o.role]),{settingsOptions:s,permissionItemRoleOptions:a,currentTeamPermissionItems:i}}function et(e){let{roles:t,currentRole:i}=e;return t.filter((e=>(0,Ye.IF)(e,i)))}function tt(e){let{roles:t,currentRole:i}=e;return t.filter((e=>(0,Ye.SL)(e,i)))}var it=i(98742),nt=i(25464),ot=i(86275),st=i(7908);function at(e){let{teamStore:t,accessLevel:i,disabled:n,onChange:s}=e;const a=(0,S.vR)(t),r=(0,ot.U)({isCreateTeam:!1,teamStore:t,isDefault:a,onChange:s});return o()(rt,{allOptionsDisabled:n,currentOption:i,options:r})}function rt(e){let{currentOption:t,options:i,allOptionsDisabled:n}=e;const s=(0,u.y)((e=>({root:{display:"flex",flexDirection:"row",alignItems:"center",width:"100%",background:e.buttonHoveredBackground,borderRadius:6,padding:3},buttonContainer:{display:"flex",flexGrow:1},option:{flexGrow:1,display:"flex",flexDirection:"column",textAlign:"center",borderRadius:5,padding:"6px 14px 8px"},currentOption:{boxShadow:"0px 2px 3px rgba(0, 0, 0, 0.1)",background:e.modalBackground},optionTitleAndIconContainer:{display:"flex",flexDirection:"row",alignItems:"center"},optionIconContainer:{flexShrink:0,marginRight:4},optionIcon:{fill:e.mediumIconColor},optionTitle:{fontSize:13,color:e.mediumTextColor,fontWeight:400},currentOptionTitle:{color:e.regularTextColor,fontWeight:500},optionCaption:{fontSize:12,color:e.mediumTextColor,lineHeight:1.2,textAlign:"left"},checkIcon:{width:9,margin:"0 auto"},divider:{height:30,alignSelf:"center"}})),[]);return o()("div",{style:s.root},void 0,i.map(((e,a)=>{var r;const d=e.key===t,c=a===i.length-1,u=(null===(r=i[a+1])||void 0===r?void 0:r.key)===t,m=!d&&!c&&!u;return o()("div",{style:s.buttonContainer},void 0,o()(x.Z,{textWrap:!0,disableTooltip:!e.tooltip,placement:x.Z.Placement.Bottom,renderTooltip:()=>e.tooltip,render:t=>l().createElement(st.Z,W()({style:{...s.option,...d&&s.currentOption},onClick:d?void 0:e.onSelect,disabled:n||e.disabled,ignoreLocalHoverState:d},t),o()("div",{style:s.optionTitleAndIconContainer},void 0,o()("div",{style:s.optionIconContainer},void 0,e.icon({...s.optionIcon,...d&&{fill:e.iconColor}})),o()("div",{style:{...s.optionTitle,...d&&s.currentOptionTitle}},void 0,e.title)),o()("div",{style:s.optionCaption},void 0,e.caption))}),m&&o()(ve.Z,{vertical:!0,size:1,style:s.divider}))})))}var lt=i(51923),dt=i(93686);function ct(e){const{teamStore:t,numTeamMembers:i}=e,n=(0,d.O7)(),s=(0,u.F)(),a=(0,g.useIntl)(),r=(0,c.VK)((()=>t.getTeamPermission()),[t]),l=(0,S.TE)(t),m=(0,c.VK)((()=>{var e;const i=null===(e=t.getPermissions())||void 0===e?void 0:e.find((e=>"space_permission"===e.type)),n=a.formatMessage({id:"teamPermissionsSettings.teamspace.disabledPermissionitem.description",defaultMessage:"Teamspace members can't have lower permissions than workspace members",description:"Tooltip explaining why you can't set a teamspace permission to something lower."});function o(e){return i&&e!==i.role&&(0,Ye.nl)(e,i.role)===i.role&&!t.isDefault()?{isDisabled:!0,disabledMessage:n}:void 0}return[{role:"editor",disabledInfo:o("editor")},{role:"read_and_write",disabledInfo:o("read_and_write")},{role:"comment_only",disabledInfo:o("comment_only")},{role:"reader",disabledInfo:o("reader")}]}),[a,t]),p=r&&o()(ke.Z,{role:r.role,table:we.e0,type:(0,Q.zU)(r)?"explicit_team_permission":"team_permission",upgradeButtonName:"team_permission_item",disabled:l,buttonStyle:{fontSize:12.5,marginRight:0,color:s.mediumTextColor},availableRoleItems:m,onChange:e=>{ue.createAndCommit({userAction:"TeamMembersPermissionRow.permissionComponent",environment:n,perform:i=>{(0,O.xI)({environment:n,teamStore:t,newRole:e,transaction:i})}})}}),{teamName:h}=(0,c.VK)((()=>({teamName:t.getName()})),[t]),f=o()(dt.p,{disabled:!0,store:t,size:de.Z.iconSize});return o()(Re,{permissionRoleSelectComponent:p,iconComponent:f,name:ut(h),label:o()(g.FormattedMessage,{id:"TeamMembersPermissionRow.teamspacePermissionItem.description",defaultMessage:"{num, plural, one {{num} person} other {{num} people}}",description:"Caption showing how many members are in this teamspace.",values:{num:i}})})}function ut(e){return o()(g.FormattedMessage,e?{defaultMessage:"Teamspace members",id:"TeamMembersTopSection.permissionItem.defaultAccessTeamSpaceName",description:"Title for teamspace member permission",values:{teamName:e}}:{defaultMessage:"Teamspace members",id:"TeamMembersTopSection.permissionItem.defaultAccessWithoutTeamspaceName",description:"Title for teamspace member permission when teamspace name is not available."})}var mt=i(62512);function pt(e){const{teamStore:t,teamOwnerIds:i}=e,n=(0,u.F)(),s=(0,c.VK)((()=>t.getName()),[t]),a=(0,c.VK)((()=>t.getTeamOwnerPermission()),[t]),[{currentUserStore:r}]=(0,c.oR)(M.default),l=(0,c.VK)((()=>r?i.map((e=>C.Z.createChildStore(r,{table:X.KJ,id:e}))):[]),[r,i]);return o()(Re,{tooltip:o()(g.FormattedMessage,{id:"TeamOwnersPermissionRow.teamspaceOwnersRowTooltip",defaultMessage:"Teamspace owners have full access to teamspace pages by default",description:"Tooltip explaining why you can't modify teamspace owners' team role."}),permissionRoleSelectComponent:o()(ke.Z,{role:"editor",table:we.e0,type:a&&(0,Q.LW)(a)?"explicit_team_owner_permission":"team_owner_permission",upgradeButtonName:"team_owner_permission_item",disabled:!0,buttonStyle:{fontSize:12.5,color:n.mediumTextColor,marginRight:0},availableRoleItems:[]}),iconComponent:o()(mt.n,{teamStore:t,ownerStores:l}),name:gt(s),label:o()(g.FormattedMessage,{id:"TeamOwnersPermissionRow.teamspacePermissionItem.description",defaultMessage:"{num, plural, one {{num} person} other {{num} people}}",description:"Caption showing how many owners are in this teamspace.",values:{num:i.length}})})}function gt(e){return o()(g.FormattedMessage,e?{defaultMessage:"Teamspace owners",id:"TeamOwnersPermissionRow.permissionItem.teamspaceOwnersAccessToggleName",description:"Title for teamspace owner permission",values:{teamName:e}}:{defaultMessage:"Teamspace owners",id:"TeamOwnersPermissionRow.permissionItem.teamspaceOwnersAccessToggleNameWithoutTeamName",description:"Title for teamspace owner permission when teamspace name is not available."})}var ht=i(49469),ft=i(76464);function vt(e){const{teamStore:t}=e,i=(0,d.O7)(),[{currentSpaceStore:n}]=(0,c.oR)(M.default),{iconComponent:s,spaceName:a}=(0,c.VK)((()=>{if(!n)return{iconComponent:void 0,spaceName:void 0};const e=(0,ee.getSpaceName)(i,n);return{iconComponent:o()(dt.p,{disabled:!0,store:n,size:de.Z.iconSize}),spaceName:e}}),[n,i]),r=(0,c.VK)((()=>{if(null==n||!n.isDefined())return;return(0,ee.getSpacePermissionItems)(n).filter((e=>(0,Q.J5)((0,Q.cY)(e)))).length}),[n]);return o()(Re,{permissionRoleSelectComponent:o()("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center"}},void 0,o()(St,{teamStore:t})),iconComponent:s,name:yt(a),label:o()(g.FormattedMessage,{id:"teamPermissionSettings.openSpacePermissionItem.description",defaultMessage:"{num, plural, one {{num} person} other {{num} people}}",values:{num:r}})})}function yt(e){return o()(g.FormattedMessage,e?{defaultMessage:"Everyone else in {spaceName}",id:"TeamMembersTopSection.permissionItem.defaultAccessSpaceName",values:{spaceName:e}}:{defaultMessage:"Everyone else in the workspace",id:"TeamMembersTopSection.permissionItem.defaultAccessWithoutSpaceName"})}function St(e){const{teamStore:t}=e,i=(0,d.O7)(),n=(0,u.F)(),s=(0,c.VK)((()=>t.getSpacePermission()||{type:"space_permission",role:"none"}),[t]),r=(0,S.TE)(t),m=(0,c.VK)((()=>{const e=t.getSettingsStore().getValue();if(e)return $e({id:t.id,permissions:t.getPermissions(),settings:e,is_default:t.isDefault()})}),[t],{useDeepEqual:!0});if(!m)return null;const p=m.permissionItemRoleOptions.spacePermission;if(1===p.length&&"none"===p[0])return o()(x.Z,{renderTooltip:()=>o()(g.FormattedMessage,{id:"teamPermissionsSettings.privateTeam.noAccessTooltip",description:"Permission tooltip showing that when a team is private, pages cannot be shared with the workspace.",defaultMessage:"Private teamspaces can only be accessed or joined by invitation"}),render:e=>l().createElement("div",W()({style:{display:"flex",alignItems:"center",maxWidth:170}},e),V.Z.lockedFilled({width:14,height:14,fill:n.timelineRed,marginRight:4}),o()("div",{style:{fontSize:12.5,color:n.timelineRed,marginRight:8}},void 0,o()(g.FormattedMessage,{id:"teamPermissionsSettings.privateTeam.noAccessLabel",description:"Permission label showing that for private teams, non-team members will have no access to the team.",defaultMessage:"No access • Invite only"})))});{const e=a().sortBy(p,(e=>-Q.xm[e])).map((e=>({role:e})));return o()(ke.Z,{role:s.role,table:we.e0,type:"space_permission",upgradeButtonName:"space_permission_item",disabled:r||1===p.length,buttonStyle:{fontSize:12.5,marginRight:0,color:n.mediumTextColor},availableRoleItems:e,onChange:e=>{const n={...s,role:e};ue.createAndCommit({userAction:"TeamSpacePermissionRow.permissionComponent",environment:i,perform:e=>{ft.ep({environment:i,store:t,permissionItems:[n],transaction:e})}})}})}}function bt(e){let{teamStore:t}=e;const i=(0,c.VK)((()=>t.getTeamAccessLevel()),[t]),n=(0,d.O7)(),s=(0,c.VK)((()=>(0,J.XO)({membership:t.getMembers()})),[t]),a=(0,c.VK)((()=>{var e,i;return null!==(e=null===(i=t.getTeamPermission())||void 0===i?void 0:i.role)&&void 0!==e?e:"none"}),[t]),m=(0,S.KR)(t),h=(0,c.VK)((()=>t.getValue()),[t]),f=(0,r.useCallback)((e=>{O.Ju({environment:n,accessLevel:e,store:t,teamName:null==h?void 0:h.name,from:"sidebar_team_modal"})}),[n,t,h]),v=(0,r.useCallback)((e=>{(0,ue.createAndCommit)({userAction:"team.setInviteAccess",environment:n,perform:i=>{O.$x({environment:n,store:t,update:{invite_access:e},transaction:i})}})}),[n,t]),y=(0,r.useCallback)((e=>{(0,ue.createAndCommit)({userAction:"teamsHelpers.changeTeamSetting",environment:n,perform:i=>{O.$x({environment:n,store:t,update:{disable_team_page_edits:e},transaction:i})}})}),[n,t]),b=(0,S.ql)(t),M=(0,S.TE)(t),w=(0,u.y)((e=>({header:{marginBottom:12},permissionsWrap:{paddingBottom:12,borderBottom:"1px solid ".concat(e.regularDividerColor),marginBottom:22},switcherWrap:{marginTop:14,marginBottom:12},teamPageAccessHeader:{fontSize:12,fontWeight:p.Z.fontWeight.medium}})),[]),C=(0,c.VK)((()=>{const e=t.getSettingsStore().getValue();if(e)return $e({id:t.id,permissions:t.getPermissions(),settings:e,is_default:t.isDefault()})}),[t]),k=(0,c.VK)((()=>t.isDefault()),[t]);if(!h||!C)return null;const T=!b||1===C.settingsOptions.invite_access.length;return l().createElement(l().Fragment,null,o()(ht.z,{style:w.header,title:o()(g.FormattedMessage,{id:"TeamSettingsPermissions.pagePermissions.title",defaultMessage:"Permissions",description:"Team permissions menu."})}),o()("div",{style:w.permissionsWrap},void 0,o()("div",{style:w.switcherWrap},void 0,o()(at,{teamStore:t,accessLevel:i,onChange:f,disabled:M})),function(e){let{teamStore:t,teamOwnerIds:i,numTeamMembers:n,isDefault:s}=e;return[o()(pt,{teamStore:t,teamOwnerIds:i}),o()(ct,{teamStore:t,numTeamMembers:n}),!s&&o()(vt,{teamStore:t})]}({teamStore:t,teamOwnerIds:s,numTeamMembers:m,isDefault:k})),o()(Mt,{title:o()(g.FormattedMessage,{id:"TeamSettingsPermissions.whoCanInviteTeamMembers.title",defaultMessage:"Who can invite teamspace members",description:"Decide who in the teamspace can invite other members"}),caption:o()(g.FormattedMessage,{id:"TeamSettingsPermissions.whoCanInviteTeamMembers.caption",defaultMessage:"Who can add people to the teamspace",description:"Rephrasing the setting to show that people can add teamspace members"}),disabled:T,optionTooltip:T&&b&&o()(g.FormattedMessage,{id:"TeamSettingsPermissions.whoCanInviteTeamMembersDisabled.caption",defaultMessage:"Change access level to Closed or Private to restrict who can invite teamspace members",description:"Tells the user that they need to change teamspace permissions to Closed or Private to change this setting of who can invite teamspace members."}),currentOption:h.settings.invite_access,allOptions:[{option:"team_members",label:o()(g.FormattedMessage,{id:"TeamSettingsPermissions.whoCanInviteTeamspaceMembers.teamMembersAndOwners.title",defaultMessage:"Any teamspace member",description:"Any teamspace member can invite others."}),action:()=>v("team_members")},{option:"team_owners",label:o()(g.FormattedMessage,{id:"TeamSettingsPermissions.whoCanInviteTeamMembers.teamOwners.title",defaultMessage:"Only teamspace owners",description:"Only teamspace owners can invite others."}),action:()=>v("team_owners")}]}),(0,Q.J5)(a)?o()(Mt,{title:l().createElement(l().Fragment,null,o()(g.FormattedMessage,{id:"TeamSettingsPermissions.whoCanEditTeamPages.title",defaultMessage:"Who can edit teamspace sidebar",description:"Decide who in the team can edit the teamspace sidebar section"})),caption:o()(g.FormattedMessage,{id:"TeamSettingsPermissions.whoCanEditTeamPages.caption",defaultMessage:"Adding, removing, or re-ordering sidebar pages",description:"Actions possible when the teamspace edit pages setting is enabled"}),disabled:M,currentOption:Boolean(h.settings.disable_team_page_edits),allOptions:[{option:!1,label:o()(g.FormattedMessage,{id:"TeamSettingsPermissions.whoCanEditTeamPages.teamMembersAndOwners.title",defaultMessage:"Any teamspace member",description:"Any teamspace member can edit teamspace sidebar pages."}),action:()=>y(!1)},{option:!0,label:o()(g.FormattedMessage,{id:"TeamSettingsPermissions.whoCanEditTeamPages.teamOwners.title",defaultMessage:"Only teamspace owners",description:"Only team owners can edit teamspace sidebar pages."}),action:()=>y(!0)}]}):o()(Mt,{title:o()(g.FormattedMessage,{id:"TeamSettingsPermissions.whoCanEditTeamPages.title",defaultMessage:"Who can edit teamspace sidebar",description:"Decide who in the team can edit the teamspace sidebar section"}),caption:o()(g.FormattedMessage,{id:"TeamSettingsPermissions.whoCanEditTeamPages.caption",defaultMessage:"Adding, removing, or re-ordering sidebar pages",description:"Actions possible when the teamspace edit pages setting is enabled"}),disabled:!0,currentOption:!0,allOptions:[{option:!0,label:o()(g.FormattedMessage,{id:"TeamSettingsPermissions.whoCanEditTeamPages.teamOwners.title",defaultMessage:"Only teamspace owners",description:"Only team owners can edit teamspace sidebar pages."}),action:()=>{}}],optionTooltip:o()(g.FormattedMessage,{id:"TeamSettingsPermissions.settingSelect.whoCanEditTeamPages.teamMemberPermissionTooltip",defaultMessage:"Change member permissions to Can edit or Full access to allow teamspace members to edit the sidebar",description:"Tooltip telling user why they can't change this option."})}),o()(lt.Z,{helpCenterLocation:"settingsAndPermissions",analyticsFrom:"teams_learn_more_team_settings_permissions",message:o()(g.FormattedMessage,{id:"teamSettingsPermissions.learnMore",defaultMessage:"Learn about teamspace permissions",description:"Link text that shows in the permissions tab of the teamspaces settings modal. When the user clicks the link, they are taken to a reference with more information about teamspaces security and permissions."})}))}function Mt(e){const{title:t,caption:i,currentOption:n,allOptions:s,disabled:a,optionTooltip:r}=e,c=(0,d.Fy)(),m=(0,u.y)((e=>({root:{display:"flex",alignItems:"center",width:"100%",marginBottom:20},title:{fontSize:14,marginRight:8,flexGrow:1},divider:{marginTop:14,marginBottom:14},chevron:{width:10,marginLeft:4,fill:e.lightIconColor},buttonStyle:{fontSize:12.5,color:e.mediumTextColor},tooltipWidth:{width:300}})),[]),p=s.find((e=>e.option===n));return p?l().createElement(l().Fragment,null,o()("div",{style:m.root},void 0,o()("div",{style:m.title},void 0,t,i&&o()(F.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:1,width:"95%"}},void 0,i)),o()(x.Z,{style:m.tooltipWidth,placement:nt.u.Top,alignment:x.Z.Alignment.Start,textWrap:!0,disableTooltip:!r,renderTooltip:()=>r,render:e=>l().createElement(fe.Z,W()({},e,{disablePopup:a,popupType:c.isMobile?fe.Z.PopupType.SlideUp:fe.Z.PopupType.Popup,alignmentToOrigin:fe.Z.Alignment.End,renderOrigin:t=>l().createElement(be.Z,W()({style:m.buttonStyle,disabled:a},(0,it.Z)(e,t)),p.label,!a&&V.Z.chevronDown(m.chevron)),render:e=>{let t;t=c.isMobile?{menuType:me.o.ActionSheet}:{menuType:me.o.Popup,minWidth:150};const i=[{key:"options",render:e=>l().createElement(Me.Z,e),items:s.map((t=>({key:t.option.toString(),render:e=>l().createElement(he.Z,W()({},e,{title:t.label,caption:t.caption,checkState:n===t.option})),action:()=>{t.action(),e.close()}})))}];return l().createElement(ye.Z,t,o()(Se.Z,{type:Se.i.Vertical,initialFocus:void 0,sections:i}))}}))}))):null}var wt=i(6638),Ct=i(74136);function kt(e){return r.createElement(Ct.Z,e,o()(g.FormattedMessage,{id:"sidebarTeamModalTab.unownedBadge",defaultMessage:"Unowned",description:"Unowned badge to indicate that this team is an unowned team, i.e. a team with no owners."}))}function Tt(e){const[t]=(0,c.oR)(k.Z),{teamStore:i}=e;if(!t.open)return null;switch(t.tab){case k.a.General:return o()(L.E,{teamStore:i});case k.a.Members:return o()(Ke,{teamStore:i});case k.a.Permissions:return o()(bt,{teamStore:i});case k.a.Security:return o()(wt.c,{teamStore:i});default:(0,m.t1)(t.tab)}}function It(e){const{userId:t,currentSpaceStore:i}=e,n=(0,c.VK)((()=>C.Z.createChildStore(i,{table:"notion_user",id:t,spaceId:i.id}).getValue()),[i,t]);return n?o()(A.Z,{avatarShouldShowShadow:!0,userValue:n,style:{paddingRight:6,minHeight:34,lineHeight:1.2,fontSize:14,width:"100%"},avatarSize:24}):null}function Zt(e){const{userIds:t,label:i,hasMarginTop:n}=e,[{currentSpaceStore:s}]=(0,c.oR)(M.default);return s?l().createElement(l().Fragment,null,o()(B.Z,{hasMarginTop:n},void 0,i),t.map((e=>o()(It,{userId:e,currentSpaceStore:s})))):null}function Pt(){const e=(0,d.O7)(),[t,i]=(0,c.oR)(k.Z),[{currentSpaceStore:n,currentSpaceViewStore:s}]=(0,c.oR)(M.default),r=(0,d.Fy)(),l=(0,u.y)((e=>({modal:{width:r.isMobile?"auto":630,height:r.isMobile?"auto":640,maxWidth:"calc(100vw - 100px)",maxHeight:"calc(100vh - 100px)",borderRadius:5},modalWrap:{userSelect:"none",WebkitUserSelect:"none",height:"100%"},innerWrap:{width:"100%",height:"100%",display:"flex",flexDirection:"column",paddingTop:20},header:{display:"flex",alignItems:"center",flexGrow:0,flexShrink:0,margin:"0px 36px"},tabBar:{display:"flex",width:void 0,flexGrow:0,flexShrink:0,margin:"0px 36px 20px"},scroller:{flexGrow:1},contentWrap:{margin:"0px 36px"},lockIcon:{width:16,marginLeft:6,marginBottom:1,fill:e.mediumIconColor},icon:{marginRight:8,fontWeight:p.Z.fontWeight.medium},unownedPill:{marginLeft:6,height:17},unownedPillInner:{display:"flex",height:"100%",alignItems:"center",color:e.regularTextColor,fontWeight:p.Z.fontWeight.regular,textTransform:"unset",fontSize:11}})),[r.isMobile]),f=(0,c.VK)((()=>{const e=t.selectedTeamId;if(!n||!e)return;return w.Z.createChildStore(n,{table:"team",id:e,spaceId:null==n?void 0:n.id})}),[n,t]),b=(0,c.VK)((()=>null==f?void 0:f.getSettingsStore().getValue()),[f]),C=(0,S.ql)(f);if(!n||!s||!f)return null;const{open:_}=t,x=[k.a.General,k.a.Members,k.a.Permissions,k.a.Security];return o()(I.Z,{open:_,innerStyle:l.modal,onDismiss:()=>{k.Z.reset(),k.Z.reset()},render:()=>t.open?o()("div",{className:v.Nf,style:{height:"100%"}},void 0,o()("div",{style:l.modalWrap},void 0,o()(T.Z,{capture:!0,onBackspace:a().identity,onLeft:a().identity,onRight:a().identity,onSelectAll:a().identity,onRedo:a().identity,onUndo:a().identity,onCut:a().identity,onCopy:a().identity,onPaste:a().identity,onKeypress:a().identity,onDelete:a().identity,onTab:a().identity},void 0,o()("div",{style:l.innerWrap},void 0,o()("div",{style:l.header},void 0,o()(dt.p,{disabled:!0,store:f,size:24,style:l.icon}),o()(Z.Z,{store:f,style:{fontSize:16,fontWeight:p.Z.fontWeight.semibold}}),(0,y.C2)(b)&&o()(D.Z,{iconStyle:l.lockIcon}),(0,y.Hu)({membership:f.getKeyStore("membership").getValue()})&&o()("div",{style:{gap:5,display:"flex"}},void 0,o()(kt,{desktopStyle:l.unownedPill,mobileStyle:l.unownedPill,innerStyle:l.unownedPillInner})),o()("div",{style:{flexGrow:1}}),o()(R.M,{teamStore:f,onLeavingTeam:()=>k.Z.reset(),from:"sidebar_team_modal",navigateToTeamHomeOnJoin:!1})),o()(E.Z,{tabs:x.map((e=>function(e,t){switch(e){case k.a.General:return o()(g.FormattedMessage,{id:"sidebarTeamModalTab.option.general",defaultMessage:"General",description:"General settings for a team"});case k.a.Members:return o()(_t,{teamStore:t});case k.a.Permissions:return o()(g.FormattedMessage,{id:"sidebarTeamModalTab.option.permissions",defaultMessage:"Permissions",description:"Permissions-related settings for a team"});case k.a.Security:return o()(g.FormattedMessage,{id:"sidebarTeamModalTab.option.security",defaultMessage:"Security",description:"Security settings for a team"});default:(0,m.t1)(e)}}(e,f))),selectedIndex:t.open?x.indexOf(t.tab):1,onChange:n=>{t.open&&(h.trackTeamSettingsTabClick(e,{store:f,tab_old_value:t.tab,tab_new_value:x[n]}),i({...t,tab:x[n]}))},tabStyle:{marginLeft:-8},style:l.tabBar,tabTitleStyle:{marginLeft:8,marginRight:8}}),o()(P.Z,{type:P.Z.OverflowType.Y,style:l.scroller},void 0,o()("div",{style:l.contentWrap},void 0,o()(Tt,{currentSpaceStore:n,teamStore:f,userIsTeamOwner:C}))))))):null})}function _t(e){let{teamStore:t}=e;const i=(0,c.VK)((()=>{var e,i;return null!==(e=null==t||null===(i=t.getMembers())||void 0===i?void 0:i.length)&&void 0!==e?e:0}),[t]),n=(0,u.F)();return l().createElement(l().Fragment,null,o()(g.FormattedMessage,{id:"sidebarTeamModalTab.option.members",defaultMessage:"Members",description:"Members list for a team with a member count next to it."}),o()("span",{},void 0," "),o()("div",{style:{color:n.lightTextColor}},void 0,i))}function xt(e){let{title:t,caption:i,secondCaption:n,on:s,disabled:a,tooltip:r,style:c,onChange:m,shouldTriggerUpsell:p}=e;const g=(0,d.O7)(),h=(0,b.Z)(),v=(0,u.y)((()=>({root:{display:"flex",alignItems:"center",width:"100%",marginTop:16,marginBottom:16,cursor:p?"pointer":void 0,...c},title:{fontSize:14,marginRight:8,flexGrow:1},switcherWrap:{marginTop:5,marginRight:18}})),[c,p]);return l().createElement(l().Fragment,null,o()("div",{style:v.root,onClick:()=>{if(p)return(0,f.y)(g,{from:"team_security_settings",for:h,dontOpenPlansOnCancel:!0})}},void 0,o()("div",{style:v.title},void 0,t,o()(F.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"95%"}},void 0,i),n&&o()(F.Z,{isSmall:!0},void 0,n)),o()("div",{style:v.switcherWrap},void 0,o()(x.Z,{disableTooltip:!r,renderTooltip:()=>r,render:e=>l().createElement("div",e,o()(_.Z,{on:s,disabled:a,onClick:m}))}))))}},41205:(e,t,i)=>{i.r(t),i.d(t,{default:()=>F});var n=i(77094),o=i.n(n),s=i(77422),a=i.n(s),r=(i(33948),i(67294)),l=i.n(r),d=i(83355),c=i(5366),u=i(21325),m=i(27832),p=i(35875),g=i(42922),h=i(22346),f=i(63296),v=i(97464),y=i.n(v),S=i(8848),b=i(53397),M=i(24684),w=i(82990),C=i(95477),k=i(21115),T=i(92083),I=i(27242),Z=i(58032);class P extends d.Z{renderComponent(){return l().createElement(l().Fragment,null,b.Z.notionLogoStroked({width:34,height:34,marginBottom:18}),o()("div",{style:{...this.getPrimaryTextStyle(),marginBottom:6}},void 0,this.getPlanTitle()),o()("div",{style:this.getSecondaryTextStyle()},void 0,this.getOneLiner()),this.renderPriceAndTerms(),this.renderBlockLimit(),this.renderPlanFeatures(),this.renderLearnMore())}renderBlockLimit(){const{planInfo:e}=this.props;if("team_free"===e.subscriptionTier)return l().createElement(l().Fragment,null,o()("div",{style:{fontWeight:w.Z.fontWeight.semibold,fontSize:24}},void 0,o()(c.FormattedMessage,{id:"spaceSubscriptionUpgradePlanFeatures.blockLimit.title",defaultMessage:"Free"})),o()("div",{style:this.getSecondaryTextStyle()},void 0,o()(c.FormattedMessage,{id:"spaceSubscriptionUpgradePlanFeatures.blockLimit.description",defaultMessage:"For the first 1,000 blocks"}),o()(Z.Z,{renderTooltip:()=>o()(c.FormattedMessage,{id:"spaceSubscriptionUpgradePlanFeatures.blockLimit.tooltip",defaultMessage:"Blocks are pieces of content you add to a page, like a paragraph or to-do item.{br}Some features on the Team Plan are not available on the Team Trial.",values:{br:o()("br",{})}}),placement:Z.Z.Placement.Top,render:e=>l().createElement("span",e,b.Z.help({marginLeft:6,width:14,fill:S.ZP.mediumIconColor,verticalAlign:"middle",display:"inline-block"}))})))}renderPriceAndTerms(){const{planInfo:e,intl:t}=this.props;if("team_free"!==e.subscriptionTier)return l().createElement(l().Fragment,null,o()("div",{style:this.getPrimaryTextStyle()},void 0,o()(c.FormattedMessage,{id:"subscriptionUpgradeDetails.price",defaultMessage:"{price}",description:"Price is already formatted, e.g. $10",values:{price:(0,k._B)({subscriptionTier:e.subscriptionTier,billingInterval:e.billingInterval,intl:t})}})),o()("div",{style:this.getSecondaryTextStyle()},void 0,this.getFormattedTerm()))}getFormattedTerm(){const{planInfo:e,intl:t}=this.props,i=(0,M.MZ)(C.Z,t),n={personal:i.terms.pro,team:i.terms.team,enterprise:i.terms.enterprise}[e.subscriptionTier];return{per_month:o()(c.FormattedMessage,{id:"subscriptionUpgradeDetails.perMonthPricing.label",defaultMessage:"per month",description:"Appears after the price per month for a given plan, e.g. $10 per month"}),per_member_per_month:o()(c.FormattedMessage,{id:"subscriptionUpgradeDetails.perUserPerMonthPricing.label",defaultMessage:"per member, per month",description:"Appears after the price per member, per month for a given plan, e.g. $10 per member, per month"})}[n]}renderPlanFeatures(){const{planInfo:e}=this.props;return l().createElement(l().Fragment,null,o()(Z.Z,{delayThreshold:0,placement:Z.Z.Placement.Left,renderTooltip:()=>this.renderPreviousPlanTierFeatures(),render:e=>l().createElement("span",y()({},e,{style:{cursor:"help",fontSize:14,borderBottom:"1px dotted ".concat(this.theme.lightTextColor)}}),o()(c.FormattedMessage,{id:"subscriptionUpgradeDetails.features",defaultMessage:"<span>Everything in {planName},</span> plus:",description:"Shown when comparing plan tier features in upgrade modal; 'planName' will be Personal, Team Trial, or Team",values:{span:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()("span",{style:{paddingBottom:1}},void 0,t)},planName:this.getPreviousPlanName()}}))}),this.getFeaturesByPlanKey(e.subscriptionTier).map(((t,i)=>o()("div",{style:{display:"flex",alignItems:"center",padding:"4px 0px",fontSize:14}},"".concat(e.subscriptionTier,"-feature-").concat(i),b.Z.thinCheck({width:14,height:14,marginRight:5,color:this.theme.lightTextColor}),t.label,t.isComingSoon&&o()("div",{style:{background:this.theme.buttonHoveredBackground,fontSize:10,fontWeight:500,letterSpacing:"0.015em",color:this.theme.mediumTextColor,display:"inline",textTransform:"uppercase",padding:"2px 4px",marginLeft:6,borderRadius:3,whiteSpace:"nowrap"}},void 0,M.Mn)))))}renderPreviousPlanTierFeatures(){const e=this.getTierBelowKey();return this.getFeaturesByPlanKey(e).map(((t,i)=>o()("div",{style:{display:"flex",alignItems:"center",padding:"4px 0px",fontSize:14}},"".concat(e,"-feature-").concat(i),b.Z.thinCheck({width:14,height:14,marginRight:5,color:this.theme.regularInvertedTextColor}),t.label)))}renderLearnMore(){return o()("div",{style:{fontWeight:w.Z.fontWeight.regular,fontSize:14,marginBottom:16,color:this.theme.mediumTextColor,textDecoration:"underline",marginTop:8,cursor:"pointer"},onClick:()=>{I.Z.reset(),p.Z.reset(),T.Z.setState({open:!0,currentTab:"plans",defaultSubtab:void 0})}},void 0,o()(c.FormattedMessage,{id:"subscriptionUpgradeDetails.learnMore",defaultMessage:"Learn more"}))}getPlanTitle(){const{planInfo:e}=this.props;return{personal:o()(c.FormattedMessage,{id:"subscriptionUpgradeDetails.title.personal",defaultMessage:"Upgrade to Personal Pro"}),team:o()(c.FormattedMessage,{id:"subscriptionUpgradeDetails.title.team",defaultMessage:"Upgrade to Team"}),enterprise:o()(c.FormattedMessage,{id:"subscriptionUpgradeDetails.title.enterprise",defaultMessage:"Upgrade to Enterprise"}),team_free:o()(c.FormattedMessage,{id:"subscriptionUpgradeDetails.title.teamFree",defaultMessage:"Upgrade to Team Trial"})}[e.subscriptionTier]}getOneLiner(){const{planInfo:e}=this.props;switch(e.subscriptionTier){case"personal":return o()(c.FormattedMessage,{id:"subscriptionUpgradeDetails.oneLiner.personal",defaultMessage:"For power users who want to do even more."});case"team":case"team_free":return o()(c.FormattedMessage,{id:"subscriptionUpgradeDetails.oneLiner.team",defaultMessage:"For teams to write, plan, and work together in one spot."});case"enterprise":return o()(c.FormattedMessage,{id:"subscriptionUpgradeDetails.oneLiner.enterprise",defaultMessage:"Controls and support to run your company."})}}getPreviousPlanName(){return{personal:o()(c.FormattedMessage,{id:"subscriptionUpgradeDetails.planName.personal",defaultMessage:"Pro"}),personal_free:o()(c.FormattedMessage,{id:"subscriptionUpgradeDetails.planName.free",defaultMessage:"Personal"}),team_free:o()(c.FormattedMessage,{id:"subscriptionUpgradeDetails.planName.teamTrial",defaultMessage:"Team Trial"}),team:o()(c.FormattedMessage,{id:"subscriptionUpgradeDetails.planName.team",defaultMessage:"Team"})}[this.getTierBelowKey()]}getTierBelowKey(){const{planInfo:e}=this.props;return{personal:"personal_free",team:"team_free",team_free:"personal",enterprise:"team"}[e.subscriptionTier]}getFeaturesByPlanKey(e){const t=(0,M.Cq)();return{personal_free:[t.unlimitedBlocks,t.shareWithLimitedGuests,t.syncAcrossDevices],personal:[t.unlimitedFileUploads,t.unlimitedGuests,t.versionHistory,t.contentApi],team_free:[t.unlimitedTeamMembers,t.collaborativeWorkspace,t.adminTools],team:[t.unlimitedBlocks,t.unlimitedFileUploads,t.versionHistory,t.advancedPermissions],enterprise:[t.sso,t.scimApi,t.advancedSecurity,t.dedicatedManager,t.customContract]}[e]}getPrimaryTextStyle(){return{fontWeight:w.Z.fontWeight.bold,fontSize:22,lineHeight:1.1,marginBottom:2}}getSecondaryTextStyle(){return{fontWeight:w.Z.fontWeight.regular,fontSize:14,lineHeight:1.4,marginBottom:22,color:this.theme.mediumTextColor}}}const _=(0,c.injectIntl)(P);class x extends d.Z{constructor(){super(...arguments),a()(this,"storeTypes",{}),a()(this,"renderModal",(()=>o()("div",{style:this.getModalStyle()},void 0,o()(_,{planInfo:{subscriptionTier:"team_free"}}),o()("div",{style:this.getButtonContainerStyle()},void 0,o()(f.Z,{isLarge:!0,style:{marginLeft:"auto",marginRight:12},onClick:this.handleModalClose},void 0,o()(c.FormattedMessage,{id:"spacePermissionSettingsTrialModal.cancel.label",defaultMessage:"Cancel"})),o()(g.Z,{onClick:this.handleTrialAccept,isLarge:!0},void 0,o()(c.FormattedMessage,{id:"spacePermissionSettingsTrialModal.tryItFree.label",defaultMessage:"Try it free"})))))),a()(this,"handleTrialAccept",(async()=>{const{currentSpaceStore:e}=m.default.state;e&&(await u.EO({environment:this.environment,spaceStore:e,planType:"team",from:"space_permission_settings_trial_modal"}),this.handleModalClose())})),a()(this,"handleModalClose",(()=>{p.Z.setState({...p.Z.state,open:!1})}))}renderComponent(){return o()(h.Z,{open:p.Z.state.open,render:this.renderModal,onDismiss:this.handleModalClose})}getButtonContainerStyle(){return{display:"flex",marginTop:40}}getModalStyle(){return{background:this.theme.popoverBackground,borderRadius:3,width:349,padding:24}}}const F=x},85055:(e,t,i)=>{i.r(t),i.d(t,{default:()=>am});var n=i(77094),o=i.n(n),s=i(97464),a=i.n(s),r=i(77422),l=i.n(r),d=(i(33948),i(96486)),c=i.n(d),u=i(67294),m=i.n(u),p=i(83355),g=i(8848),h=i(53397),f=i(90965),v=i(82990),y=i(5366),S=i(48298),b=i(7512),M=i(50906),w=i(54642),C=i(47307),k=i(26111),T=i(21115),I=i(49085);class Z extends I.Z{getInitialState(){return{status:"unconfigured",emailDomains:[],domainVerifications:[],spaceIds:[],createAccount:!1,useMetadataUrl:!1}}}const P=Z;async function _(e){const{environment:t,spaceId:i,store:n}=e,o=T.CM(t);if(o&&"enterprise"!==o)return n.reset(),{};const s=await w.getSamlConfigForSpace(t,{spaceId:i});if("failed"===s.type)C.showError(s);else if(s.data&&s.data.samlConfig){const e={...s.data.samlConfig,useMetadataUrl:Boolean(s.data.samlConfig.idpMetadataUrl)};return n.setState(e),s.data}return n.reset(),{}}var x=i(29974),F=i(27832),A=i(80456);function B(e,t,i){A.applyOperation({store:e,operation:{pointer:e.pointer,path:["settings"],command:"update",args:{...e.getSettings(),...i}},transaction:t})}function E(e){var t;const{currentSpaceViewStore:i}=F.default.state;if(!i)return;const n=null===(t=i.getSettings())||void 0===t?void 0:t.enterprise_settings_prompt;n&&"dismissed"!==n.status&&A.createAndCommit({userAction:"spaceViewActions.incrementMembersPromptSettings",environment:e,perform:e=>{B(i,e,{enterprise_settings_prompt:{status:"dismissed"}})}})}function R(e){var t;const{currentSpaceViewStore:i}=F.default.state;if(!i)return;const n=null===(t=i.getSettings())||void 0===t?void 0:t.domain_claim_settings_prompt;n&&"dismissed"!==n.status&&A.createAndCommit({userAction:"spaceViewActions.incrementdomainClaimSettings",environment:e,perform:e=>{B(i,e,{domain_claim_settings_prompt:{status:"dismissed"}})}})}var D=i(21325),L=i(37181),O=i(28020),N=i(43250),U=i(4708),W=i(67669),V=i(33665),z=i(23537),q=(i(60285),i(2072)),H=i(97880);function G(e){switch(e.actionName){case"page_viewed":case"page_created":case"page_deleted":case"page_restored":case"page_exported":case"page_moved":case"page_permission_updated":case"page_shared_to_web":case"file_uploaded":case"file_downloaded":case"private_content_transferred":return e.target.page;case"member_invited":case"member_joined":case"member_role_updated":case"member_removed":case"guest_removed":case"workspace_name_changed":case"workspace_icon_changed":case"workspace_domain_changed":case"allowed_email_domain_added":case"allowed_email_domain_removed":case"workspace_exported":case"workspace_integration_restriction_changed":case"public_page_cleared":case"public_page_set":case"scim_token_generated":case"scim_token_revoked":case"saml_toggled":case"saml_enforce_toggled":case"automatic_account_creation_toggled":case"workspace_creation_set_for_email_domain":case"login":case"logout":case"password_set":case"password_cleared":case"password_changed":case"email_changed":case"preferred_name_changed":case"picture_changed":case"user_deleted":case"allowed_support_access":case"revoked_support_access":case"invite_link_toggled":case"invite_link_reset":case"page_access_requests_toggled":case"public_page_sharing_toggled":case"workspace_sidebar_editing_toggled":case"disable_guests_toggled":case"pages_to_other_workspaces_toggled":case"export_toggled":case"idp_metadata_url_updated":case"idp_metadata_xml_updated":case"idp_metadata_xml_removed":case"member_added_to_group":case"member_removed_from_group":case"space_transfer_status_changed":case"space_claim_and_upgrade_status_changed":case"membership_requests_toggled":case"membership_request_resolved":case"team_created":case"team_archived":case"team_restored":case"team_default_toggled":case"team_public_page_sharing_toggled":case"team_export_toggled":case"team_sidebar_editing_toggled":case"team_name_changed":case"team_description_changed":case"team_icon_changed":case"team_creation_admins_setting_toggled":case"team_guests_toggled":case"member_added_to_team":case"group_added_to_team":case"member_removed_from_team":case"group_removed_from_team":case"member_joined_team":case"member_left_team":case"member_team_role_updated":case"team_member_default_permission_updated":case"team_workspace_default_permission_updated":case"team_privacy_type_changed":case"team_invite_access_changed":case"teams_enabled_for_space":return;default:(0,H.t1)(e)}}let K;!function(e){e.CreatedNewest="CreatedNewest",e.CreatedOldest="CreatedOldest"}(K||(K={}));var j=i(32918);function Y(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.sF;const n={type:"date",start_date:e.start_date};return q.OQ.toMomentRange(n).start.locale(t.locale).format(i)}function Q(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.c_;return q.OQ.dateTimeToMoment(e).locale(t.locale).format(i)}function X(e,t){let i=arguments.length>2&&void 0!==arguments[2]?arguments[2]:j.YF;return q.OQ.dateTimeToMoment(e).locale(t.locale).format(i)}function J(e){return e.starting&&e.ending?{starting:{type:"date",start_date:e.starting.start_date},ending:{type:"date",start_date:e.ending.start_date}}:e.starting?{starting:{type:"date",start_date:e.starting.start_date}}:e.ending?{ending:{type:"date",start_date:e.ending.start_date}}:{}}function $(e){if(e)return{type:"date",start_date:e.start_date}}function ee(e){return"".concat(e.actorType,":").concat(e.actorId)}function te(e){const t=e.split(":");if(2===t.length)return"bot"===t[0]?{actorId:t[1],actorType:"bot"}:"notion_user"===t[0]?{actorId:t[1],actorType:"notion_user"}:void 0}class ie extends I.Z{getInitialState(){return{pageNum:1,pageSize:10,timeRange:{},actors:[],actions:[],sortOrder:K.CreatedNewest}}}const ne=new ie,oe=e=>{const{timeRange:t,actors:i,actions:n,sortOrder:o}=e,s=new URLSearchParams;return t.starting&&s.append("starting","".concat(q.OQ.toUnixMs(t.starting))),t.ending&&s.append("ending","".concat(q.OQ.toUnixMs(t.ending))),(null==i?void 0:i.length)>0&&s.append("actors",i.map(ee).join(",")),(null==n?void 0:n.length)>0&&s.append("actions",n.join(",")),s.append("sort","".concat(o||K.CreatedNewest)),s.toString()};class se extends I.Z{getInitialState(){return{cachedResponses:{}}}getCursor(e,t,i){if(i<=1||this.state.spaceId!==e)return;const n=oe(t);if(this.state.filterStr!==n)return;const o=this.state.cachedResponses[i-1];return"success"===o.status?null==o?void 0:o.nextCursor:void 0}startLoading(e,t){this.updateResultHelper(e,t,{status:"loading"})}updateLoadedResult(e,t,i){this.updateResultHelper(e,t,{...i,status:"success",loadedAt:Date.now()})}updateError(e,t){this.updateResultHelper(e,t,{status:"error"})}updateResultHelper(e,t,i){const n=oe(t);1!==t.pageNum&&this.state.spaceId===e&&this.state.filterStr===n?this.setState({spaceId:e,filterStr:n,cachedResponses:{...this.state.cachedResponses,[t.pageNum]:{...i}}}):this.setState({spaceId:e,filterStr:n,cachedResponses:{[t.pageNum||1]:{...i}}})}}const ae=new se;var re=i(54835),le=i(53680);class de extends I.Z{getInitialState(){return{displaySummary:!0,openDropdown:!1,query:""}}}const ce=new de;class ue extends I.Z{getInitialState(){return{name:"",domain:"",domainState:"current-space",emailDomains:[],publicHomePage:void 0}}getValueForSpace(e){const t=e.getPublicContentDomain(),i=e.getPublicHomePage();if(e.isDefined())return{name:e.getName()||"",domain:t||"",emailDomains:e.getKeyStore("email_domains").getValue()||[],domainState:"current-space",publicHomePage:i}}}const me=ue;class pe extends I.Z{getInitialState(){return{emailDomains:[],spaceCreation:"admins_only"}}async updateValueForSpace(e){const{environment:t,spaceId:i,store:n}=e;if(!("on"===re.default.getEligibleGroup({experimentId:"domain_claim",defaultGroup:"unassigned"})))return;const o=await(0,w.getEmailDomainsForSpace)(t,{spaceId:i});if("failed"===o.type)return void(0,C.showError)(o);const{data:s}=o,a=Object.keys(s);return 0!==a.length?n.setState({emailDomains:a,spaceCreation:s[a[0]].spaceCreationEnum}):n.setState(this.getInitialState()),n.state}}const ge=pe;class he extends I.Z{getInitialState(){return{uploadingProfilePhoto:!1,givenName:"",familyName:"",name:"",startDayOfWeek:(0,q.aN)()}}getValueForUser(e,t){const i=e.getValue();if(i){const{profile_photo:e,name:n}=i,o=t.getSettings();return{uploadingProfilePhoto:!1,profilePhoto:e,name:n||"",startDayOfWeek:void 0===(null==o?void 0:o.start_day_of_week)?(0,q.aN)():null==o?void 0:o.start_day_of_week}}}}const fe=he;var ve=i(92083),ye=i(78291),Se=i(98905),be=i(480),Me=i(28350),we=i(77420),Ce=i(19889),ke=i(31299),Te=i(33929);class Ie extends I.Z{getInitialState(){return{spaceId:void 0,allUserIds:new Set,allBotIds:new Set,removedUserIds:new Set,removedBotIds:new Set}}isUserOrBotRemoved(e){return Boolean(e&&(this.state.removedUserIds.has(e)||this.state.removedBotIds.has(e)))}}const Ze=new Ie,Pe=(0,y.defineMessages)({loadCurrentAuditLogError:{id:"auditlog.error.loadCurrentAuditLogError",defaultMessage:"Failed to load audit logs",description:"The error message when audit log cannot be loaded from the server"}}),_e=async e=>{const{environment:t,spaceId:i}=e,n=await w.getHistoricalAuditLogUsers(t,{spaceId:i});return"success"!==n.type?[]:n.data.results};var xe=i(70630),Fe=i(60709);class Ae extends I.Z{getInitialState(){return{open:!1}}}const Be=new Ae;var Ee=i(42922),Re=i(52275),De=i(78140),Le=i(58189),Oe=i(44532),Ne=i(72495),Ue=i(58032);const We=(0,y.defineMessages)({30:{id:"auditLogCSV.menu.30days",defaultMessage:"Last 30 days",description:"An audit log menu item giving the user an option to download the last 30 days worth of audit logs in CSV format"},60:{id:"auditLogCSV.menu.60days",defaultMessage:"Last 60 days",description:"An audit log menu item giving the user an option to download the last 60 days worth of audit logs in CSV format"},90:{id:"auditLogCSV.menu.90days",defaultMessage:"Last 90 days",description:"An audit log menu item giving the user an option to download the last 90 days worth of audit logs in CSV format"},365:{id:"auditLogCSV.menu.365days",defaultMessage:"Last 1 year",description:"An audit log menu item giving the user an option to download the last 1 year worth of audit logs in CSV format"},Export:{id:"auditLogCSV.menu.export",defaultMessage:"Export",description:"An audit log button giving the user an option to export and download audit logs in CSV format"}});class Ve extends p.Z{constructor(){super(...arguments),l()(this,"renderCSVMenu",(()=>{const e=[this.getCSVMenuItem(30),this.getCSVMenuItem(60),this.getCSVMenuItem(90),this.getCSVMenuItemWithConfirmation(365)];return o()(De.Z,{menuType:Fe.o.Popup},void 0,o()(Le.Z,{type:Le.i.Vertical,sections:[{key:"results",render:e=>m().createElement(Ne.Z,e),items:e}],initialFocus:0}))})),l()(this,"getCSVMenuItem",(e=>({key:e,render:()=>o()(Re.Z,{focused:!1,title:Te.default.formatMessage(We[e]),onClick:()=>{this.handleDismiss(),ze(this.environment,e)}}),action:()=>{}}))),l()(this,"getCSVMenuItemWithConfirmation",(e=>({key:e,render:()=>o()(Re.Z,{focused:!1,title:Te.default.formatMessage(We[e]),onClick:()=>{C.showDialog({message:o()(y.FormattedMessage,{id:"auditLogCSV.menu.365days.prompt",defaultMessage:"Are you sure you want to export a one year CSV? You can't repeat this action while this is processing in the background.",description:"An audit log menu confirmation dialog that confirms if the user wants to download the last 1 years worth of audit logs in CSV format and that they cannot repeat the action while processing is happening in the background."}),showCancel:!0,keepFocus:!0,items:[{label:o()(y.FormattedMessage,{id:"AuditLogCSV.exportConfirmationDialog.label",defaultMessage:"Export",description:"Label for button that when clicked will export a CSV for the current workspace."}),color:"blue",onAccept:()=>{this.handleDismiss(),ze(this.environment,e)}}]})}}),action:()=>{}}))),l()(this,"handleDismiss",(()=>{Be.setState({open:!1})})),l()(this,"popOpenOptions",(e=>{Be.setState({open:e})}))}renderComponent(){const e=Be.state;return o()(Oe.ZP,{popupType:Oe.ZP.PopupType.Popup,open:e.open,placementToOrigin:Oe.ZP.Placement.Bottom,alignmentToOrigin:Oe.ZP.Alignment.End,originGap:4,disableMouseCapture:!0,disableContentScroll:!0,keepFocus:!1,render:this.renderCSVMenu,onDismiss:this.handleDismiss,enableOutsideClickDismiss:!0,origin:o()(Ue.Z,{renderTooltip:()=>o()(y.FormattedMessage,{id:"auditLogCSV.popup.tooltip",defaultMessage:"Click for options to export the Audit Log in CSV form",description:"Message that shows options for the user to export audit log to CSV."}),render:t=>m().createElement(Ee.Z,a()({isLarge:!0,onClick:()=>this.popOpenOptions(!e.open)},t),Te.default.formatMessage(We.Export))})})}}const ze=(e,t)=>{const{currentSpaceStore:i}=F.default.state;i&&xe.PN(e,{spaceId:i.id,exportOptions:{duration:t}})},qe=(0,y.injectIntl)(Ve);var He=i(80084),Ge=i(76150),Ke=i(13854),je=i(41558),Ye=i(55811),Qe=i(31945),Xe=i(3386),Je=i(91941),$e=i(67950),et=i(40721),tt=i(86825),it=i(46945),nt=i(85114);const ot="Invalid date",st="Invalid range";class at extends I.Z{getInitialState(){return{dateEdited:!1,timeEdited:!1,temporaryValue:{date:void 0,time:void 0},error:void 0}}}const rt=at;var lt=i(74194);class dt extends p.Z{constructor(){super(...arguments),l()(this,"storeTypes",{store:rt}),l()(this,"renderInput",(()=>{const{device:e}=this.environment,{store:t,hideClearButton:i,focus:n,showTime:s,placeholder:r,...l}=this.props,d=e.isMobile?"date":"text",c=e.isMobile?"time":"text",u=lt.Z.Format.Transparent,p=e.isMobile?void 0:n;return o()("div",{style:{display:"flex",alignItems:"center",borderRadius:3,lineHeight:2,background:this.theme.inputBackground,paddingLeft:8,paddingRight:8,flexBasis:"50%",...this.getInputStyles().inputOuterStyle}},void 0,m().createElement(lt.Z,a()({},l,{type:d,format:u,placeholder:r,focus:"date"===p,onFocus:this.handleDateFocus,onChange:this.handleDateChange,onSubmit:e=>this.handleSubmit(e,"date"),onBlur:this.handleBlur,value:this.getDateInputValue(),size:1,style:{fontSize:e.isMobile?16:14},showClearButton:!s&&this.showClearButton(),onClearButtonClick:this.handleClear})),s&&m().createElement(m().Fragment,null,o()("div",{style:{height:14,width:1,background:this.theme.regularDividerColor,marginLeft:6,marginRight:12,flexShrink:0}}),m().createElement(lt.Z,a()({},l,{placeholder:Te.default.formatMessage(ut.timePlaceholder),type:c,format:u,focus:"time"===p,onFocus:this.handleTimeFocus,onChange:this.handleTimeChange,onSubmit:e=>this.handleSubmit(e,"time"),onBlur:this.handleBlur,value:this.getTimeInputValue(),size:1,style:{fontSize:e.isMobile?16:14},showClearButton:this.showClearButton(),onClearButtonClick:this.handleClear}))))})),l()(this,"handleDateFocus",(e=>{const{onDateFocus:t}=this.props,{store:i}=this.stores;i.setState({...i.state,dateEdited:!1}),t&&t(e)})),l()(this,"handleTimeFocus",(e=>{const{onTimeFocus:t}=this.props,{store:i}=this.stores;i.setState({...i.state,timeEdited:!1}),t&&t(e)})),l()(this,"handleClear",(()=>{const{onClear:e,onUpdate:t}=this.props,{store:i}=this.stores;i.setState({...i.state,dateEdited:!0,timeEdited:!0,temporaryValue:{date:void 0,time:void 0},error:void 0});const n=this.validateCurrent();n&&t(n),i.setState({...i.state,dateEdited:!1,timeEdited:!1}),e&&e()})),l()(this,"handleDateChange",(e=>{const{device:t}=this.environment,{store:i}=this.stores;i.setState({...i.state,dateEdited:!0,temporaryValue:{...i.state.temporaryValue,date:e.target.value||""}}),t.isAndroid&&this.handleBlur()})),l()(this,"handleTimeChange",(e=>{const{device:t}=this.environment,{store:i}=this.stores;i.setState({...i.state,timeEdited:!0,temporaryValue:{...i.state.temporaryValue,time:e.target.value||""}}),t.isAndroid&&this.handleBlur()})),l()(this,"handleSubmit",((e,t)=>{var i,n;const{onUpdate:o,onSubmit:s,showTime:a}=this.props,{store:r}=this.stores;let l;(!a||"date"===t&&null!==(i=this.props.value)&&void 0!==i&&i.start_time||"time"===t&&null!==(n=this.props.value)&&void 0!==n&&n.start_date)&&(l=this.validateCurrent(),l&&(o(l),l.error?r.setState({...r.state,dateEdited:!1,error:l.error}):r.reset())),s&&s(e,l)})),l()(this,"handleBlur",(e=>{const{onUpdate:t,onBlur:i}=this.props,{store:n}=this.stores,o=this.validateCurrent();o?(t(o),o.error?n.setState({...n.state,dateEdited:!1,timeEdited:!1,error:o.error}):n.reset()):n.setState({...n.state,dateEdited:!1,timeEdited:!1}),e&&i&&i(e)})),l()(this,"styles",{menuItem:{marginBottom:this.environment.device.isMobile?1:12},inputWrapper:{borderRadius:3,height:28,paddingRight:this.showClearButton()?6:0,position:"relative"},inputEditRegion:{width:this.showClearButton()?"calc(100% - 14px)":"100%"},inputEditRegionMobile:{padding:"2px 6px",position:"relative"},tooltipOriginGap:-8})}didUpdate(e){const{store:t}=this.stores;c().isEqual(e.value,this.props.value)||t.reset()}renderComponent(){const e=this.styles,t=this.getError();return t?o()(Ue.Z,{renderTooltip:()=>t,forceVisibleState:!0,placement:Ue.Z.Placement.Left,render:this.renderInput,originGap:e.tooltipOriginGap}):this.renderInput()}getDateInputValue(){const{device:e}=this.environment,{value:t,dateFormat:i,intl:n}=this.props,{store:o}=this.stores;return e.isMobile?t?Y(t,n):"":o.state.temporaryValue.date?o.state.temporaryValue.date:o.state.dateEdited?o.state.temporaryValue.date||"":t?Y(t,n,i):""}getTimeInputValue(){const{device:e}=this.environment,{value:t,timeFormat:i,intl:n}=this.props,{store:o}=this.stores;return e.isMobile?t?Q(t,n):"":o.state.temporaryValue.time?o.state.temporaryValue.time:o.state.timeEdited?o.state.temporaryValue.time||"":t?Q(t,n,i):""}getError(){const{store:e}=this.stores,{intl:t}=this.props;if(e.state.error)switch(e.state.error){case ot:return t.formatMessage({id:"dateInputError.invalidDateError.tooltip",defaultMessage:"Invalid date"});case st:return t.formatMessage({id:"dateInputError.invalidDateRangeError.tooltip",defaultMessage:"Invalid range"});default:(0,H.t1)(e.state.error)}}validateCurrent(){const{validate:e}=this.props,t=this.parseCurrentDateTimeValue();if(t)return e?e(t):t}parseCurrentDateTimeValue(){const{store:e}=this.stores,{value:t,showTime:i,isEndingDate:n}=this.props;if(!e.state.dateEdited&&!e.state.timeEdited)return;if(!e.state.temporaryValue.date&&!e.state.temporaryValue.time)return{value:void 0};const o=(0,nt.uy)(e.state.temporaryValue.date||"",this.props.intl);if(o){let e="";return e=i?(null==t?void 0:t.start_time)||"00:00":n?"23:59":"00:00",{value:{type:"datetime",start_date:o,time_zone:(null==t?void 0:t.time_zone)||q.x7,start_time:e}}}const s=(0,nt.wk)(e.state.temporaryValue.time||"",this.props.intl);return(null!=t&&t.start_date||o)&&s?{value:{type:"datetime",start_date:(null==t?void 0:t.start_date)||o,start_time:s,time_zone:(null==t?void 0:t.time_zone)||q.x7}}:{error:ot}}showClearButton(){const{device:e}=this.environment,{hideClearButton:t}=this.props;return!!e.isMobile||!t}getInputStyles(){const{device:e}=this.environment,{inputStyle:t,inputOuterStyle:i,style:n}=this.props,o=this.styles;return{style:{...o.menuItem,...n},inputOuterStyle:{...o.inputWrapper,...i,...this.getInputBorders()},inputStyle:{...o.inputEditRegion,...e.isMobile&&o.inputEditRegionMobile,...t}}}getInputBorders(){const{disabled:e,focus:t}=this.props,i=this.getThemeColors(),n=this.getError();if(!e)return n?i.inputError:t?i.inputFocused:i.inputDefault}getThemeColors(){return{inputDefault:{background:this.theme.inputBackground,boxShadow:this.theme.inputBoxShadow},inputFocused:{boxShadow:this.theme.outlineBlueInputBoxShadow},inputError:{boxShadow:this.theme.outlineRedInputBoxShadow},placeholder:{color:this.theme.lightTextColor}}}}const ct=(0,y.injectIntl)(dt),ut=(0,y.defineMessages)({startingDateMessage:{defaultMessage:"Starting",id:"auditLog.dateTimeRangeMenu.startingDatePlaceholder",description:"Placeholder for the starting date in audit log date filter."},endingDateMessage:{defaultMessage:"Ending",id:"auditLog.dateTimeRangeMenu.endingDatePlaceholder",description:"Placeholder for the ending date in audit log date filter."},timePlaceholder:{defaultMessage:"12:00 AM",id:"auditLog.dateTimeRangeMenu.timePlaceholderInNumber",description:"Placeholder for the time input in audit log. 12 is the hour, 00 is the minutes, and AM/PM is morning vs afternoon."}});class mt extends p.Z{constructor(){super(...arguments),l()(this,"storeTypes",{store:Ke.ZP,dayRangeStore:je.Z}),l()(this,"renderInputs",(()=>{const{device:e,WindowSizeStore:t}=this.environment,{value:i,disabled:n}=this.props,{store:s}=this.stores,a=s.getFocus();let r="date";a!==Ge.Hv.StartTime&&a!==Ge.Hv.EndTime||(r="time");const l=this.getRangeBounds();return o()("div",{style:{paddingTop:e.isMobile?16:12,paddingBottom:e.isMobile?16:8,paddingLeft:e.isMobile?t.getSafePaddingLeftCSS(16):14,paddingRight:e.isMobile?t.getSafePaddingRightCSS(16):14,display:s.state.showTime?"block":"flex",...e.isMobile&&{boxShadow:"\n\t\t\t\t\t\t\t0 1px 0 ".concat(this.theme.regularDividerColor,"\n\t\t\t\t\t\t"),position:"relative",zIndex:2},background:e.isMobile?this.theme.popoverBackground:void 0}},void 0,o()(ct,{disabled:n,placeholder:Te.default.formatMessage(ut.startingDateMessage),focus:a===Ge.Hv.StartDate||a===Ge.Hv.StartTime?r:void 0,value:i.starting,validate:this.validateStart,onUpdate:this.handleUpdateStart,onDateFocus:()=>this.handleDateFocus(Ge.Hv.StartDate),onTimeFocus:()=>this.handleTimeFocus(Ge.Hv.StartTime),onSubmit:(e,t)=>this.handleStartSubmit(e,t,a),inputElementAttributes:{max:l.latestValidStarting},showTime:s.state.showTime}),o()("div",{style:{width:12,height:8}}),o()(ct,{disabled:n,placeholder:Te.default.formatMessage(ut.endingDateMessage),focus:a===Ge.Hv.EndDate||a===Ge.Hv.EndTime?r:void 0,value:i.ending,validate:this.validateEnd,onUpdate:this.handleUpdateEnd,onDateFocus:()=>this.handleDateFocus(Ge.Hv.EndDate),onTimeFocus:()=>this.handleTimeFocus(Ge.Hv.EndTime),onSubmit:(e,t)=>this.handleEndSubmit(e,t,a),inputElementAttributes:{min:l.earliestValidEnding},showTime:s.state.showTime}))})),l()(this,"renderCalendar",(()=>{const{device:e}=this.environment,{value:t,onUpdate:i}=this.props,{store:n,dayRangeStore:s}=this.stores,a=this.styles,r=this.getThemeColors(),l={...a.pickerSection,...e.isMobile&&a.pickerSectionMobile,...e.isMobile&&r.pickerSectionMobile};return o()(Ne.Z,{},void 0,o()("div",{style:l},void 0,o()(it.Z,{value:J(t),dateTimeStore:n,store:s,onUpdate:e=>{if(e.error)return;const n=function(e,t){let i={starting:void 0,ending:void 0};var n,o,s,a;if(t.starting&&t.ending)i={starting:{type:"datetime",start_time:"",start_date:t.starting.start_date,time_zone:""},ending:{type:"datetime",start_time:"",start_date:t.ending.start_date,time_zone:""}},null!==(n=e.starting)&&void 0!==n&&n.start_time&&null!==(o=e.starting)&&void 0!==o&&o.time_zone&&(i.starting={...i.starting,start_time:e.starting.start_time,time_zone:e.starting.time_zone}),null!==(s=e.ending)&&void 0!==s&&s.start_time&&null!==(a=e.ending)&&void 0!==a&&a.time_zone?i.ending={...i.ending,start_time:e.ending.start_time,time_zone:e.ending.time_zone}:i={starting:{...i.starting,start_time:"00:00",time_zone:q.x7},ending:{...i.ending,start_time:"23:59",time_zone:q.x7}};else if(t.starting){var r,l;i=null!==(r=e.starting)&&void 0!==r&&r.start_time&&null!==(l=e.starting)&&void 0!==l&&l.time_zone?{starting:{type:"datetime",start_date:t.starting.start_date,start_time:e.starting.start_time,time_zone:e.starting.time_zone},ending:e.ending}:{starting:{type:"datetime",start_date:t.starting.start_date,start_time:"00:00",time_zone:q.x7},ending:e.ending}}else if(t.ending){var d,c;i=null!==(d=e.ending)&&void 0!==d&&d.start_time&&null!==(c=e.ending)&&void 0!==c&&c.time_zone?{ending:{type:"datetime",start_date:t.ending.start_date,start_time:e.ending.start_time,time_zone:e.ending.time_zone},starting:e.starting}:{ending:{type:"datetime",start_date:t.ending.start_date,start_time:"23:59",time_zone:q.x7},starting:e.starting}}else i={starting:e.starting,ending:e.ending};return i}(t,e.value);return i({error:e.error,value:n})},validate:this.validateDateRangeField})))})),l()(this,"handleDateFocus",(e=>{const{store:t,dayRangeStore:i}=this.stores;t.setState({...t.state,focus:e});const n=Ke.QJ[e];i.setState({...i.state,focus:n})})),l()(this,"handleTimeFocus",(e=>{const{store:t}=this.stores;t.setState({...t.state,focus:e})})),l()(this,"handleUpdateStart",(e=>{const{onUpdate:t}=this.props;e.error||t({value:{...this.props.value,starting:e.value}})})),l()(this,"handleUpdateEnd",(e=>{const{onUpdate:t}=this.props;e.error||t({value:{...this.props.value,ending:e.value}})})),l()(this,"handleStartSubmit",((e,t,i)=>{const{store:n,dayRangeStore:o}=this.stores;t&&t.error||(i===Ge.Hv.StartDate&&n.state.showTime?n.setState({...n.state,focus:Ge.Hv.StartTime}):(n.setState({...n.state,focus:Ge.Hv.EndDate}),o.setState({...o.state,focus:"ending"})))})),l()(this,"handleEndSubmit",((e,t,i)=>{const{store:n}=this.stores;t&&t.error||i===Ge.Hv.EndDate&&n.state.showTime&&n.setState({...n.state,focus:Ge.Hv.EndTime})})),l()(this,"validateStart",(e=>{const t=this.validateField("starting",e);return t.error?t:{value:t.value.starting}})),l()(this,"validateEnd",(e=>{const t=this.validateField("ending",e);return t.error?t:{value:t.value.ending}})),l()(this,"validateField",((e,t)=>{const{value:i}=this.props;return t.error?t:this.validateRange({...i,[e]:t.value})})),l()(this,"validateRange",(e=>{if(e.starting&&e.ending){const t=q.OQ.dateTimeToMoment(e.starting);return q.OQ.dateTimeToMoment(e.ending).isSameOrAfter(t)?{value:e}:{error:$e.B.INVALID_RANGE}}return{value:e}})),l()(this,"getMenuProps",(()=>{const{device:e}=this.environment,{onDismiss:t,title:i}=this.props;if(e.isMobile){return{menuType:Fe.o.Modal,title:i,right:o()(et.DoneMenuText,{}),onClickRight:t,header:this.renderInputs()}}return{menuType:Fe.o.Popup,onClickOutside:t,footer:this.props.footer}})),l()(this,"validateDateRangeField",((e,t)=>{const{value:i}=this.props;if(t.error)return t;const n=J(i);return this.validateDateRange({...n,[e]:t.value})})),l()(this,"validateDateRange",(e=>{if(e.starting&&e.ending){const t=q.OQ.toMoment(e.starting);return q.OQ.toMoment(e.ending).isSameOrAfter(t)?{value:e}:{error:$e.B.INVALID_RANGE}}return{value:e}})),l()(this,"styles",{pickerSection:{paddingLeft:16,paddingRight:16},pickerSectionMobile:{paddingTop:16,paddingBottom:8},sidebar:{paddingTop:12,paddingBottom:24,overflowY:"auto",overflowX:"hidden",flex:"0 0 220px",backgroundColor:this.theme.sidebarSecondaryBackground,borderLeft:"1px solid ".concat(this.theme.regularDividerColor),maxWidth:"fit-content"},menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4,color:this.theme.mediumTextColor}})}didMount(){const{store:e}=this.stores;void 0!==this.props.showTime&&e.setState({...e.state,showTime:this.props.showTime})}renderComponent(){const{device:e}=this.environment;return m().createElement(De.Z,this.getMenuProps(),o()("div",{style:{display:"flex",flexDirection:"row"}},void 0,o()("div",{},void 0,!e.isMobile&&this.renderInputs(),this.renderCalendar()),this.renderSidebar()))}renderSidebar(){const{store:e}=this.stores,{onUpdate:t,value:i}=this.props;return o()("aside",{style:this.styles.sidebar},void 0,o()(tt.Z,{title:o()(y.FormattedMessage,{id:"auditlogDateFilter.timeToggle",defaultMessage:"Use time",description:"Toggle to show or not show time in audit log date filter."}),on:e.state.showTime,onClick:()=>{if(e.toggleShowTime(),e.state.showTime){const e=i;e.starting&&(e.starting.start_time="00:00"),e.ending&&(e.ending.start_time="23:59"),t({value:e})}},focused:!1}),o()(Re.Z,{focused:!1,title:o()(y.FormattedMessage,{id:"auditlogDateFilter.quickFilters.today",defaultMessage:"Today"}),onClick:()=>{const e=Date.now(),t=q.CQ(e);this.setStoresTemporaryValue({starting:{...t,start_time:"00:00"},ending:t})},style:this.styles.menuItem}),o()(Re.Z,{focused:!1,title:o()(y.FormattedMessage,{id:"auditlogDateFilter.quickFilters.yesterday",defaultMessage:"Yesterday"}),onClick:()=>{const e=q.Cv();this.setStoresTemporaryValue({starting:{type:"datetime",start_date:e.start_date,start_time:"00:00",time_zone:q.x7},ending:{type:"datetime",start_date:e.start_date,start_time:"23:59",time_zone:q.x7}})},style:this.styles.menuItem}),o()(Re.Z,{focused:!1,title:o()(y.FormattedMessage,{id:"auditlogDateFilter.quickFilters.lastWeek",defaultMessage:"Last 7 days"}),onClick:()=>{const e=q.Oo(),t=q.CQ(Date.now());this.setStoresTemporaryValue({starting:{type:"datetime",start_date:e.start_date,start_time:"00:00",time_zone:q.x7},ending:t})},style:this.styles.menuItem}),o()(Re.Z,{focused:!1,title:o()(y.FormattedMessage,{id:"auditlogDateFilter.quickFilters.lastMonth",defaultMessage:"Last 30 days"}),onClick:()=>{const e=q.dj(),t=q.CQ(Date.now());this.setStoresTemporaryValue({starting:{type:"datetime",start_date:e.start_date,start_time:"00:00",time_zone:q.x7},ending:t})},style:this.styles.menuItem}))}setStoresTemporaryValue(e){const{store:t,dayRangeStore:i}=this.stores;t.setState({...t.state,temporaryDateRange:e}),i.setState({...i.state,displayMonth:e.starting||e.ending?q.OQ.dateTimeToMoment(e.starting||e.ending):void 0,temporaryDateRange:{starting:$(e.starting),ending:$(e.ending)}})}getRangeBounds(){const{value:e,intl:t}=this.props;return{earliestValidEnding:e.starting&&X(e.starting,t,j.M8),latestValidStarting:e.ending&&X(e.ending,t,j.M8)}}getThemeColors(){return{pickerSectionMobile:{background:this.theme.popoverBackground,boxShadow:"0 1px 0 ".concat(this.theme.regularDividerColor),marginBottom:1}}}}const pt=(0,y.injectIntl)(mt);var gt=i(255),ht=i(98707),ft=i(75689),vt=i(91642);class yt extends p.Z{constructor(){super(...arguments),l()(this,"storeTypes",{store:Ke.ZP,dayRangeStore:je.Z}),l()(this,"renderActiveButtonOrigin",(()=>{const{value:e,dateFormat:t,disabled:i,focused:n,intl:s}=this.props,a=this.styles,r=this.getThemeColors(),l={...a.menuItem,...r.activeMenuItem},d=He._Q(e,s,t),c=o()(gt.Z,{onClick:this.handleClear,disabled:i});return o()(Re.Z,{focused:n,disabled:i,icon:h.Z.calendar(a.iconActiveDesktop),title:d,right:c,isTokenTitle:!0,alignIconTop:!0,onClick:this.handleOriginActivate,desktopTitleStyle:a.menuItemTitleDesktop,desktopIconStyle:a.iconActiveDesktopWrapper,style:l})})),l()(this,"renderInactiveButtonOrigin",(()=>{const{title:e,icon:t,disabled:i,focused:n,mode:s}=this.props,a=this.styles,r=this.getThemeColors(),l={...a.menuItem,...r.buttonMenuItem,...s===ht.Z.Mode.Pill?{width:"fit-content",border:"solid 1px",paddingLeft:0,paddingRight:0,borderRadius:20,fontSize:12}:{}};return o()(Re.Z,{focused:n,disabled:i,icon:t(a.icon),title:e,onClick:this.handleOriginActivate,style:l})})),l()(this,"renderPillButtonOrigin",(()=>{const{value:e}=this.props,t=o()(y.FormattedMessage,{id:"searchDateFilter.shortTitle",defaultMessage:"Date"});return o()(Ye.u,{on:Boolean(e.starting||e.ending),icon:h.Z.calendar({width:16,marginRight:6,fill:"currentColor"}),title:o()("span",{},void 0,t),onClick:this.handleOriginActivate})})),l()(this,"renderPopupContents",(()=>{const{title:e,showButtons:t,sidebar:i}=this.props,{store:n,dayRangeStore:s}=this.stores;return m().createElement(m().Fragment,null,o()(pt,{title:e,value:this.getCurrentValue(),onUpdate:this.updateTemporary,store:n,dayRangeStore:s,onDismiss:this.handleMenuClose,footer:"footer"===t&&this.renderFooter(),sidebar:i}),"side"===t&&o()("div",{style:{display:"flex",justifyContent:"space-between",width:"100%",padding:"0px 10px"}},void 0,o()(Je.Z,{isGray:!0,style:{marginLeft:"auto",marginRight:8},onClick:this.handleMenuClose},void 0,o()(y.FormattedMessage,{defaultMessage:"Cancel",id:"searchDateFilter.cancelButton.label"})),o()(Ee.Z,{onClick:()=>this.props.onChange(this.stores.store.state.temporaryDateRange)},void 0,o()(y.FormattedMessage,{defaultMessage:"Accept",id:"searchDateFilter.acceptButton.label"}))))})),l()(this,"renderFooter",(()=>{const{store:e,dayRangeStore:t}=this.stores;return o()(Ne.Z,{topBorder:!0,style:{padding:"8px 8px 2px 8px",justifyContent:"space-between",display:"flex"}},void 0,o()(Je.Z,{onClick:()=>{e.clearTemporaryDateRange(),t.clearTemporaryDateRange(),this.props.onChange({starting:void 0,ending:void 0})}},void 0,o()(y.FormattedMessage,{id:"searchDateFilter.clearButton",defaultMessage:"Clear"})),o()(Ee.Z,{onClick:e=>{this.props.onChange(this.stores.store.state.temporaryDateRange),this.handleMenuClose(e)}},void 0,o()(y.FormattedMessage,{id:"searchDateFilter.applyButton",defaultMessage:"Apply"})))})),l()(this,"handleOriginActivate",(()=>{const{disabled:e}=this.props,{store:t,dayRangeStore:i}=this.stores;e||(t.setState({...t.state,isOpen:!0,focus:Ge.Hv.StartDate}),i.setState({...i.state,isOpen:!0,focus:"starting"}))})),l()(this,"handleMenuClose",(e=>{const{onChange:t,onMenuDismiss:i,showButtons:n}=this.props,{store:o,dayRangeStore:s}=this.stores,{temporaryDateRange:a}=o.state;He.zD(e)||(n||t(a),o.setState({...o.state,isOpen:!1,temporaryDateRange:{starting:void 0,ending:void 0}}),s.setState({...s.state,isOpen:!1,temporaryDateRange:{starting:void 0,ending:void 0}}),i&&i())})),l()(this,"handleClear",(()=>{const{onChange:e}=this.props;e({starting:void 0,ending:void 0})})),l()(this,"handleMenuListKey",(e=>{e.preventDefault&&e.preventDefault()})),l()(this,"updateTemporary",(e=>{const{store:t,dayRangeStore:i}=this.stores;if(e.error)return;const n={starting:$(e.value.starting),ending:$(e.value.ending)};return i.setState({...i.state,temporaryDateRange:{...i.state.temporaryDateRange,...n}}),t.setState({...t.state,temporaryDateRange:{...t.state.temporaryDateRange,...e.value}})})),l()(this,"styles",{menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},icon:{height:16,width:16,marginRight:6},iconActiveDesktop:{height:14,width:14,fill:"currentColor",alignSelf:"flex-start",marginTop:2,marginRight:2},iconActiveDesktopWrapper:{marginTop:0},iconActiveMobile:{height:14,width:14,fill:"currentColor",marginTop:1,marginRight:6},popup:{paddingTop:0,paddingBottom:8},popupWithSidebar:{display:"flex"},menuItemTitleDesktop:{width:"100%"},summary:{display:"inline-flex"}})}didMount(){this.updateTemporary({value:this.props.value})}renderComponent(){const{device:e}=this.environment,{mode:t}=this.props;return e.isMobile?this.renderMobile(t):this.renderDesktop(t)}renderDesktop(e){const{title:t,sidebar:i}=this.props,{store:n}=this.stores,s=this.styles,a=e===ht.z.Section,r=a?t:void 0,l=(()=>e===ht.Z.Mode.Section?this.renderActiveButtonOrigin():e===ht.Z.Mode.Button?this.renderInactiveButtonOrigin():e===ht.Z.Mode.Pill?this.renderPillButtonOrigin():void(0,H.t1)(e))();return o()(vt.Z,{title:r,marginAfter:a},void 0,o()(Xe.Z,{capture:n.state.isOpen,onUp:this.handleMenuListKey,onDown:this.handleMenuListKey,onEnter:this.handleMenuListKey},void 0,o()(Oe.ZP,{popupType:this.getPopupType(),open:n.state.isOpen,origin:l,render:this.renderPopupContents,onDismiss:this.handleMenuClose,placementToOrigin:Oe.ZP.Placement.Bottom,alignmentToOrigin:Oe.ZP.Alignment.Start,style:i?s.popupWithSidebar:s.popup})))}renderMobile(e){const{store:t}=this.stores,i=e===ht.z.Section?this.renderMobileFilterSummary():this.renderMobileButtonOrigin();return o()(Oe.ZP,{popupType:Oe.ZP.PopupType.SlideUp,open:t.state.isOpen,origin:i,render:this.renderPopupContents,onDismiss:this.handleMenuClose,preventScaleTransition:!0})}renderMobileButtonOrigin(){const{icon:e,title:t,disabled:i}=this.props,n=this.styles;return o()(Re.Z,{disabled:i,focused:!1,icon:e(n.icon),title:t,onClick:this.handleOriginActivate})}renderMobileFilterSummary(){const{title:e,value:t,dateFormat:i,disabled:n,intl:s}=this.props,a=this.styles,r=o()("div",{style:a.summary},void 0,h.Z.calendar(a.iconActiveMobile),He._Q(t,s,i));return o()(ft.Z,{disabled:n,onClick:this.handleOriginActivate,onClickClear:this.handleClear,label:e,title:r})}getCurrentValue(){const{value:e}=this.props,{store:t}=this.stores,{temporaryDateRange:i}=t.state;return{...e,...i}}getPopupType(){const{device:e}=this.environment;return e.isMobile?Qe.Z.PopupType.SlideUp:Qe.Z.PopupType.Popup}getThemeColors(){return{buttonMenuItem:{color:this.theme.mediumTextColor},activeMenuItem:{color:this.theme.regularTextColor}}}}const St=(0,y.injectIntl)(yt);var bt=i(49065),Mt=i(20454),wt=i(74136),Ct=i(97680);class kt extends I.Z{getInitialState(){return{tempSelections:new Set([])}}setTempSelections(e){this.setState({tempSelections:new Set(e)})}}class Tt extends p.Z{constructor(){super(...arguments),l()(this,"storeTypes",{localStore:kt}),l()(this,"renderResultMenuItem",((e,t)=>{const{intl:i,auditLogHistoricalUserStore:n}=this.props,{localStore:s}=this.stores,r=this.getActorValue(e);return m().createElement(Ct.Z,a()({},t,{key:e,user:r,useEmailAsTooltip:!0,checkState:s.state.tempSelections.has(e),userTitle:o()("div",{style:{display:"flex",gap:4}},void 0,(0,Ce.Nz)(i,r),n.isUserOrBotRemoved(null==r?void 0:r.id)&&o()(wt.Z,{},void 0,o()(y.FormattedMessage,{id:"auditlogActorFilter.removed_user",defaultMessage:"Removed",description:"Describes a user who had access to the workspace, but no longer has it now"})))}))})),l()(this,"performRequest",(async e=>{let{query:t,current:i}=e;const{allUserIds:n,allBotIds:o}=this.props.auditLogHistoricalUserStore.getState(),s=await ke.ri({environment:this.environment,query:t,userIds:[...n],botIds:[...o]}),a=[...s.users.map((e=>"notion_user:".concat(e.id))),...s.bots.map((e=>"bot:".concat(e.id)))];if(t.length>0)return a.slice(0,100);const r=this.props.selectedActors.map(ee),l=new Set(r),d=a.filter((e=>!l.has(e)));return[...r,...d].slice(0,Math.max(r.length,100))})),l()(this,"getActorValue",(e=>{const t=te(e);if(t)return"notion_user"===t.actorType?this.createUserValue(t.actorId):this.createBotValue(t.actorId)})),l()(this,"createUserValue",(e=>Mt.Z.createChildStore(this.props.parentStore,{table:Ce.KJ,id:e}).getValue())),l()(this,"createBotValue",(e=>(0,bt.Kv)(this.props.parentStore,{table:we.cZ,id:e}).getValue()))}didMount(){this.updateTempSelectionFromProps()}renderComponent(){const{selectedActors:e,intl:t}=this.props,{localStore:i}=this.stores,n=o()(y.FormattedMessage,{id:"auditlogActorFilter.title",defaultMessage:"User",description:"The title of the actor filter in the pill mode"});return o()(ht.Z,{mode:ht.z.Pill,title:n,icon:h.Z.person,iconStyles:{marginRight:2},items:Array.from(i.state.tempSelections),hasItemsSelected:(null==e?void 0:e.length)>0,onChange:e=>{i.setTempSelections(e)},renderFooter:!0,allowApplyBatchSelection:!0,keepInputOnItemConfirm:!0,onMenuDismiss:e=>{"applyButton"!==e?this.updateTempSelectionFromProps():this.updateOnChangeToParent()},labelText:{title:n,tokenInputPlaceholder:t.formatMessage({defaultMessage:"Search user...",id:"auditlogActorFilter.searchActor.placeholder",description:"The placeholder in the input for search an actor in audit log filter"}),resultSectionTitle:t.formatMessage({defaultMessage:"Select users",id:"auditlogActorFilter.searchActor.resultsTitle",description:"The text shown above the list of all selectable actors in audit log filter"}),componentDebugName:"SearchActorFilter"},performRequest:this.performRequest,renderResultMenuItem:this.renderResultMenuItem,renderToken:()=>null,renderFilter:()=>null,renderItemForSummary:()=>null,addItemLabel:null,focused:!1})}updateOnChangeToParent(){const{onChange:e}=this.props,{localStore:t}=this.stores;e(Array.from(t.state.tempSelections).map(te).filter((e=>Boolean(e))))}updateTempSelectionFromProps(){const{selectedActors:e}=this.props,{localStore:t}=this.stores,i=e.map(ee);t.setTempSelections(i)}}const It=(0,y.injectIntl)(Tt);var Zt=i(39336);const Pt="YYYY/MM/DD hh:mm A",_t=(0,y.defineMessages)({page_viewed:{id:"auditlogEventFilter.actionName.page_viewed",defaultMessage:"Page viewed",description:"An audit log that describe a user viewed a page"},page_created:{id:"auditlogEventFilter.actionName.page_created",defaultMessage:"Page created",description:"An audit log that describe a user created a page"},page_deleted:{id:"auditlogEventFilter.actionName.page_deleted",defaultMessage:"Page deleted",description:"An audit log that describe a user deleted a page"},page_restored:{id:"auditlogEventFilter.actionName.page_restored",defaultMessage:"Page restored",description:"An audit log that describe a user restored a deleted page"},page_exported:{id:"auditlogEventFilter.actionName.page_exported",defaultMessage:"Page exported",description:"An audit log that describe a user exported a page"},page_moved:{id:"auditlogEventFilter.actionName.page_moved",defaultMessage:"Page moved",description:"An audit log that describe a user moved a page"},page_permission_updated:{id:"auditlogEventFilter.actionName.page_permission_updated",defaultMessage:"Page permission updated",description:"An audit log that describe a page's permission has been changed. It means members, guests, bots, teams can be added, removed, or changed role for this page"},page_shared_to_web:{id:"auditlogEventFilter.actionName.page_shared_to_web",defaultMessage:"Page shared to web",description:"An audit log that describe a page is now shared with public. It means everyone on the internet have access this page."},password_set:{id:"auditlogEventFilter.actionName.password_set",defaultMessage:"Password set",description:"An audit log that describe a user set their password"},password_cleared:{id:"auditlogEventFilter.actionName.password_cleared",defaultMessage:"Password cleared",description:"An audit log that describe a user cleared their password"},password_changed:{id:"auditlogEventFilter.actionName.password_changed",defaultMessage:"Password changed",description:"An audit log that describe a user changed their password"},login:{id:"auditlogEventFilter.actionName.login",defaultMessage:"Login",description:"An audit log that describe a user logs in"},logout:{id:"auditlogEventFilter.actionName.logout",defaultMessage:"Logout",description:"An audit log that describe a user logs out"},member_invited:{id:"auditlogEventFilter.actionName.member_invited",defaultMessage:"Member invited",description:"An audit log that describe a user is invited to the workspace"},member_joined:{id:"auditlogEventFilter.actionName.member_joined",defaultMessage:"Member joined",description:"An audit log that describe a member has joined the workspace"},member_role_updated:{id:"auditlogEventFilter.actionName.member_role_updated",defaultMessage:"Member role updated",description:"An audit log that describe a member is updated with a role"},member_removed:{id:"auditlogEventFilter.actionName.member_removed",defaultMessage:"Member removed",description:"An audit log that describe a member is removed access from the space"},guest_removed:{id:"auditlogEventFilter.actionName.guest_removed",defaultMessage:"Guest removed",description:"An audit log that describe a guest is removed access from the space"},user_deleted:{id:"auditlogEventFilter.actionName.user_deleted",defaultMessage:"User deleted",description:"An audit log that describe a user is deleted"},email_changed:{id:"auditlogEventFilter.actionName.email_changed",defaultMessage:"Email changed",description:"An audit log that describe a user changed their email"},preferred_name_changed:{id:"auditlogEventFilter.actionName.preferred_name_changed",defaultMessage:"Name changed",description:"An audit log that describe a user changed their preferred name"},picture_changed:{id:"auditlogEventFilter.actionName.picture_changed",defaultMessage:"Picture changed",description:"An audit log that describe a user changed their picture"},file_uploaded:{id:"auditlogEventFilter.actionName.file_uploaded",defaultMessage:"File uploaded",description:"An audit log that describe a file is uploaded by a user"},file_downloaded:{id:"auditlogEventFilter.actionName.file_downloaded",defaultMessage:"File downloaded",description:"An audit log that describe a file is downloaded by a user"},invite_link_toggled:{id:"auditlogEventFilter.actionName.invite_link_toggled",defaultMessage:"Invite link toggled",description:"An audit log that shows that the workspace's invite link feature was enabled"},workspace_name_changed:{id:"auditlogEventFilter.actionNames.workspace_name_changed",defaultMessage:"Name changed",description:"An audit log that describes a change of the workspace name"},workspace_integration_restriction_changed:{id:"auditlogEventFilter.actionNames.workspace_integration_restriction_changed",defaultMessage:"Integration installation toggled",description:"An audit log that describes a change of the workspace integration restriction"},invite_link_reset:{id:"auditlogEventFilter.actionNames.invite_link_reset",defaultMessage:"Invite link reset",description:"An audit log filter that describes the invite link getting reset"},public_page_sharing_toggled:{id:"auditlogEventFilter.actionNames.public_page_sharing_toggled",defaultMessage:"Public page sharing toggled",description:"An audit log filter describing public page sharing toggled"},workspace_sidebar_editing_toggled:{id:"auditlogEventFilter.actionNames.workspace_sidebar_editing_toggled",defaultMessage:"Workspace sidebar editing toggled",description:"An audit log filter describing workspace sidebar editing toggled"},disable_guests_toggled:{id:"auditlogEventFilter.actionNames.disable_guests_toggled",defaultMessage:"Disable guests toggled",description:"An audit log filter describing disable guests toggled"},pages_to_other_workspaces_toggled:{id:"auditlogEventFilter.actionNames.pages_to_other_workspaces_toggled",defaultMessage:"Pages to other workspaces toggled",description:"An audit log filter describing pages to other workspaces toggled"},export_toggled:{id:"auditlogEventFilter.actionNames.export_toggled",defaultMessage:"Export toggled",description:"An audit log filter describing workspace export toggled"},page_access_requests_toggled:{id:"auditlogEventFilter.actionNames.page_access_requests_toggled",defaultMessage:"Page access requests toggled",description:"An audit log filter describing page access requests in workspace toggled"},workspace_exported:{id:"auditlogEventFilter.actionNames.workspace_exported",defaultMessage:"Content exported",description:"An audit log that describes an export of all the workspace contents, e.g. in PDF form"},workspace_icon_changed:{id:"auditlogEventFilter.actionNames.workspace_icon_changed",defaultMessage:"Icon changed",description:"An audit log that describes a change of the workspace icon"},allowed_email_domain_added:{id:"auditlogEventFilter.actionNames.allowed_email_domain_added",defaultMessage:"Added allowed email domain",description:"An audit log that describes the adding of an allowed_email_domain to a workspace"},allowed_email_domain_removed:{id:"auditlogEventFilter.actionNames.allowed_email_domain_removed",defaultMessage:"Removed allowed email domain",description:"An audit log that describes the removing of an allowed_email_domain to a workspace"},workspace_domain_changed:{id:"auditlogEventFilter.actionNames.workspace_domain_changed",defaultMessage:"Domain changed",description:"An audit log that describes a change of the workspace domain"},public_page_cleared:{id:"auditlogEventFilter.actionNames.public_page_cleared",defaultMessage:"Public home page link cleared",description:"An audit log that describes the clearing of a public home page for a workspace"},public_page_set:{id:"auditlogEventFilter.actionNames.public_page_set",defaultMessage:"Public home page set",description:"An audit log that describes the setting of a public home page for a workspace"},scim_token_generated:{id:"auditlogEventFilter.actionNames.scim_token_generated",defaultMessage:"SCIM token generated",description:"An audit log that describes the generating of a SCIM token for a workspace"},scim_token_revoked:{id:"auditlogEventFilter.actionNames.scim_token_revoked",defaultMessage:"SCIM token revoked",description:"An audit log that describes the revoking of the SCIM token for a workspace"},idp_metadata_url_updated:{id:"auditlogEventFilter.actionNames.idp_metadata_url_updated",defaultMessage:"IDP metadata URL updated",description:"An audit log filter that describes IDP metadata URL update"},idp_metadata_xml_updated:{id:"auditlogEventFilter.actionNames.idp_metadata_xml_updated",defaultMessage:"IDP metadata XML updated",description:"An audit log filter that describes IDP metadata XML update"},idp_metadata_xml_removed:{id:"auditlogEventFilter.actionNames.idp_metadata_xml_removed",defaultMessage:"IDP metadata XML removed",description:"An audit log filter that describes IDP metadata XML removed"},saml_toggled:{id:"auditlogEventFilter.actionNames.saml_toggled",defaultMessage:"SAML enabling toggled",description:"An audit log filter that describes the toggling of SAML enabling for a workspace"},saml_enforce_toggled:{id:"auditlogEventFilter.actionNames.saml_enforce_toggled",defaultMessage:"SAML enforcing toggled",description:"An audit log that describes the toggling of enforcing of SAML for a workspace"},automatic_account_creation_toggled:{id:"auditlogEventFilter.actionNames.automatic_account_creation_toggled",defaultMessage:"Auto-create accounts on sign-in toggled",description:"An audit log that describes the toggling of enabling of automatic creation of accounts on sign-in"},workspace_creation_set_for_email_domain:{id:"auditlogEventFilter.actionNames.workspace_creation_set_for_email_domain",defaultMessage:"Workspace creation setting updated",description:"An audit log that describes the setting of whether users under the domain can create a workspace."},member_added_to_group:{id:"auditlogEventFilter.actionNames.member_added_to_group",defaultMessage:"Member added to group",description:"An audit log that describes when a member is added to a group"},member_removed_from_group:{id:"auditlogEventFilter.actionNames.member_removed_from_group",defaultMessage:"Member removed from group",description:"An audit log that describes when a member is removed from a group"},space_transfer_status_changed:{id:"auditlogEventFilter.actionNames.space_transfer_status_changed",defaultMessage:"Workspace transfer status change",description:"An audit log event describing a space transfer status change."},space_claim_and_upgrade_status_changed:{id:"auditlogEventFilter.actionNames.space_claim_and_upgrade_status_changed",defaultMessage:"Workspace claim status change",description:"An audit log event describing a workspace claim and upgrade status change."},allowed_support_access:{id:"auditlogEventFilter.actionNames.allowed_support_access",defaultMessage:"Granted support access",description:"An audit log that describes the enabling of support access"},revoked_support_access:{id:"auditlogEventFilter.actionNames.revoked_support_access",defaultMessage:"Revoked support access",description:"An audit log that describes the disabling of support access"},membership_requests_toggled:{id:"auditlogEventFilter.actionNames.membership_requests_toggled",defaultMessage:"Membership requests toggled",description:"An audit log that describes the disabling of support access"},membership_request_resolved:{id:"auditlogEventFilter.actionNames.membership_request_resolved",defaultMessage:"Membership request resolved",description:"An audit log that describes the resolution of a membership request"},team_created:{id:"auditlogEventFilter.actionNames.team_created",defaultMessage:"Teamspace created",description:"An audit log that describes that a teamspace was created."},team_archived:{id:"auditlogEventFilter.actionNames.team_archived",defaultMessage:"Teamspace archived",description:"An audit log that describes that a teamspace was archived."},team_restored:{id:"auditlogEventFilter.actionNames.team_restored",defaultMessage:"Teamspace restored",description:"An audit log that describes that a teamspace was restored."},team_default_toggled:{id:"auditlogEventFilter.actionNames.team_default_toggled",defaultMessage:"Teamspace default toggled",description:"An audit log that describes that a teamspace's default status was toggled."},team_privacy_type_changed:{id:"auditlogEventFilter.actionNames.team_privacy_type_changed",defaultMessage:"Teamspace privacy type changed",description:"An audit log event that describes that the privacy type for a teamspace was updated."},team_invite_access_changed:{id:"auditlogEventFilter.actionNames.team_invite_access_changed",defaultMessage:"Teamspace invite access changed",description:"An audit log event that describes that who can invite teamspace members for a teamspace was updated."},team_public_page_sharing_toggled:{id:"auditlogEventFilter.actionNames.team_public_page_sharing_toggled",defaultMessage:"Teamspace public page sharing toggled",description:"An audit log that describes that public page sharing was toggled for a teamspace."},team_export_toggled:{id:"auditlogEventFilter.actionNames.team_export_toggled",defaultMessage:"Teamspace export toggled",description:"An audit log that describes that the ability to export a teamspace was toggled."},team_sidebar_editing_toggled:{id:"auditlogEventFilter.actionNames.team_sidebar_editing_toggled",defaultMessage:"Teamspace sidebar editing toggled",description:"An audit log that describes that the ability to edit a teamspace's sidebar was toggled."},team_guests_toggled:{id:"auditlogEventFilter.actionNames.team_guests_toggled",defaultMessage:"Teamspace disable guests toggled",description:"An audit log that describes that the ability to edit a teamspace's sidebar was toggled."},team_name_changed:{id:"auditlogEventFilter.actionNames.team_name_changed",defaultMessage:"Teamspace name changed",description:"An audit log that describes that a teamspace's name was changed."},team_description_changed:{id:"auditlogEventFilter.actionNames.team_description_changed",defaultMessage:"Teamspace description changed",description:"An audit log that describes that a teamspace's description was changed."},team_icon_changed:{id:"auditlogEventFilter.actionNames.team_icon_changed",defaultMessage:"Teamspace icon changed",description:"An audit log that describes that a teamspace's icon was changed."},team_creation_admins_setting_toggled:{id:"auditlogEventFilter.actionNames.team_creation_admins_setting_toggled",defaultMessage:"Teamspace creation limiting to admins changed",description:"An audit log that describes that the setting to limit teamspace creation to admins was changed."},member_added_to_team:{id:"auditlogEventFilter.actionNames.member_added_to_team",defaultMessage:"Member added to teamspace",description:"An audit log that describes that a user was added to a teamspace."},member_removed_from_team:{id:"auditlogEventFilter.actionNames.member_removed_from_team",defaultMessage:"Member removed from teamspace",description:"An audit log that describes that a user was removed from the teamspace."},group_added_to_team:{id:"auditlogEventFilter.actionNames.group_added_to_team",defaultMessage:"Group added to teamspace",description:"An audit log that describes that a group was added to a teamspace."},group_removed_from_team:{id:"auditlogEventFilter.actionNames.group_removed_from_team",defaultMessage:"Group removed from teamspace",description:"An audit log that describes that a group was removed from the teamspace."},member_left_team:{id:"auditlogEventFilter.actionNames.member_left_team",defaultMessage:"Member left teamspace",description:"An audit log that describes that a user left a teamspace."},member_joined_team:{id:"auditlogEventFilter.actionNames.member_joined_team",defaultMessage:"Member joined teamspace",description:"An audit log that describes that a user joined a teamspace."},member_team_role_updated:{id:"auditlogEventFilter.actionNames.member_team_role_updated",defaultMessage:"Member role updated for teamspace",description:"An audit log that describe a user's role in a teamspace was updated."},team_member_default_permission_updated:{id:"auditlogEventFilter.actionNames.team_member_default_permission_updated",defaultMessage:"Teamspace Members default permission updated",description:"An audit log that describes that the default permissions of members of a teamspace were updated."},team_workspace_default_permission_updated:{id:"auditlogEventFilter.actionNames.team_workspace_default_permission_updated",defaultMessage:"Workspace default permission updated for teamspace",description:"An audit log that describes that the default permissions for everyone else in the workspace for a teamspace were updated."},teams_enabled_for_space:{id:"auditlogEventFilter.actionNames.teams_enabled_for_space",defaultMessage:"Workspace updated to enable teamspaces",description:"An audit log that describes that the workspace was updated to enable teamspaces."},private_content_transferred:{id:"auditLogEventFilter.actionNames.private_content_transferred",defaultMessage:"Private content transferred",description:"Event name for private content transferred audit log event"}}),xt=(0,y.defineMessages)({adminLabel:{id:"auditLogSpaceRoleMessages.admin",defaultMessage:"admin",description:"A user in an audit log entry who has admin access"},workspaceOwnerLabel:{id:"auditLogSpaceRoleMessages.workspaceOwner",defaultMessage:"workspace owner",description:"A user in an audit log entry who has workspace owner access"},membershipAdminLabel:{id:"auditLogSpaceRoleMessages.membershipAdmin",defaultMessage:"membership admin",description:"A user in an audit log entry who is a membership admin (controls membership for space & groups)."},memberLabel:{id:"auditLogSpaceRoleMessages.member",defaultMessage:"member",description:"A user in an audit log entry who has member access"},guestLabel:{id:"auditLogSpaceRoleMessages.guest",defaultMessage:"guest",description:"A user in an audit log entry who has guest access"},noAccessLabel:{id:"auditLogSpaceRoleMessages.noAccess",defaultMessage:"no access",description:"A user in an audit log entry who has no access"}}),Ft=(0,y.defineMessages)({private:{id:"auditLogColumnEvent.tooltip.pageAudience.private",defaultMessage:"private",description:"Audience descriptor for private pages"},shared_internally:{id:"auditLogColumnEvent.tooltip.pageAudience.sharedInternally",defaultMessage:"shared internally",description:"Audience descriptor for pages that are shared within a workspace"},shared_externally:{id:"auditLogColumnEvent.tooltip.pageAudience.sharedExternally",defaultMessage:"shared externally",description:"Audience descriptor for pages that are shared outside a workspace"},shared_to_web:{id:"auditLogColumnEvent.tooltip.pageAudience.sharedToWeb",defaultMessage:"shared to web",description:"Audience descriptor for pages that are shared to web"}}),At=(0,y.defineMessages)({missing:{defaultMessage:"MISSING",id:"auditLogSettings.copiedText.missingField",description:"Shown in the copied text/CSV for audit log in the case of a missing/unavailable field"},notApplicable:{defaultMessage:"N/A",id:"auditLogSettings.copiedText.notApplicable",description:"Means 'not applicable', shown in audit log CSV for values that shouldn't be populated for an audit log."}}),Bt=["name","email","status","activityType","activity","audience","dateAndTime","platform","ipAddress","city","state","country","pageId"];(0,y.defineMessages)({name:{id:"exportAuditLog.header.name",defaultMessage:"Name",description:"The column header denoting that this column's contents show the name of an audit log event."},email:{id:"exportAuditLog.header.email",defaultMessage:"Email",description:"The column header denoting that this column's contents show the email of an audit log event's actor."},status:{id:"exportAuditLog.header.status",defaultMessage:"Status",description:"The column header denoting that this column's contents show the guest/member/admin status of an audit log event's actor"},activityType:{id:"exportAuditLog.header.activityType",defaultMessage:"Activity Type",description:"The column header denoting that this column's contents show the type of activity of an audit log event"},activity:{id:"exportAuditLog.header.activity",defaultMessage:"Activity",description:"The column header denoting that this column's contents show the activity contents of an audit log event"},dateAndTime:{id:"exportAuditLog.header.dateAndTime",defaultMessage:"Date and Time (UTC)",description:"The column header denoting that this column's contents show the date and time in UTC time for an audit log event"},platform:{id:"exportAuditLog.header.platform",defaultMessage:"Platform",description:"The column header denoting that this column's contents show the date and time of an audit log event"},ipAddress:{id:"exportAuditLog.header.ipAddress",defaultMessage:"IP Address",description:"The column header denoting that this column's contents show the IP address an audit log event took place in"},city:{id:"exportAuditLog.header.city",defaultMessage:"City",description:"The column header denoting that this column's contents show the city an audit log event took place in"},state:{id:"exportAuditLog.header.state",defaultMessage:"State",description:"The column header denoting that this column's contents show the state an audit log event took place in"},country:{id:"exportAuditLog.header.country",defaultMessage:"Country",description:"The column header denoting that this column's contents show the country an audit log event took place in"},audience:{id:"exportAuditLog.header.audience",defaultMessage:"Audience",description:"Column header for audit log CSV labelling the audience of the event"},pageId:{id:"exportAuditLog.header.pageId",defaultMessage:"Page Id",description:"Column header for audit log CSV labelling the page ID."}});function Et(e,t,i){var n;return e.actor.actorId===Ce.s$.id||e.actor.actorId===Ce.el.id?t.formatMessage({defaultMessage:"notion_admin",id:"auditLogPaginatedTable.copiedText.notionAdmin",description:"Shown in the copied text for a Notion Admin user"}):"notion_user"===e.actor.actorType?t.formatMessage(function(e,t){if(!e)return xt.noAccessLabel;switch(e){case"admin":return t?xt.workspaceOwnerLabel:xt.adminLabel;case"membership_admin":return xt.membershipAdminLabel;case"member":return xt.memberLabel;case"guest":return xt.guestLabel;case"no_access":return xt.noAccessLabel;default:(0,H.t1)(e)}}(null===(n=e.actor.meta)||void 0===n?void 0:n.spaceRole,i)):t.formatMessage({defaultMessage:"N/A",id:"auditLogPaginatedTable.copiedText.noRole",description:"Shown in the copied text for a bot, who has no role. Means not applicable"})}function Rt(e,t){var i,n,o,s,a,r,l,d,c,u,m,p,g,h,f,v,y,S;return null!==(i=e.actor.meta)&&void 0!==i&&i.countryCode?null!==(n=e.actor)&&void 0!==n&&null!==(o=n.meta)&&void 0!==o&&o.city?"US"===(null===(s=e.actor.meta)||void 0===s?void 0:s.countryCode)&&null!==(a=e.actor)&&void 0!==a&&null!==(r=a.meta)&&void 0!==r&&r.state?t.formatMessage({description:"city, state and country metadata for audit log",defaultMessage:"{city}, {state}, {countryCode}",id:"auditLogSettings.metadata.cityStateAndCountry"},{city:null===(g=e.actor)||void 0===g||null===(h=g.meta)||void 0===h?void 0:h.city,state:null===(f=e.actor)||void 0===f||null===(v=f.meta)||void 0===v?void 0:v.state,countryCode:null===(y=e.actor)||void 0===y||null===(S=y.meta)||void 0===S?void 0:S.countryCode}):t.formatMessage({description:"city and country metadata for audit log",defaultMessage:"{city}, {countryCode}",id:"auditLogSettings.metadata.cityAndCountry"},{city:null===(l=e.actor)||void 0===l||null===(d=l.meta)||void 0===d?void 0:d.city,countryCode:null===(c=e.actor)||void 0===c||null===(u=c.meta)||void 0===u?void 0:u.countryCode}):null===(m=e.actor)||void 0===m||null===(p=m.meta)||void 0===p?void 0:p.countryCode:""}function Dt(e){const{auditLogEntry:t,intl:i,dateTimezone:n,getAuditLogEventText:o,shouldShowWorkspaceOwner:s,shouldShowPrivateNames:a}=e,r=[],l=i.formatMessage(At.missing);return Bt.forEach((e=>{var d,c,u,m,p;switch(e){case"name":r.push(t.actor.name||l);break;case"email":r.push(function(e,t){return"notion_user"===e.actor.actorType?e.actor.email:t.formatMessage({defaultMessage:"N/A",id:"auditLogPaginatedTable.copiedText.noEmail",description:"Shown in the copied text for a bot, who has no email address. Means not applicable"})}(t,i)||l);break;case"status":r.push(Et(t,i,s)||l);break;case"activityType":r.push(_t[t.actionName]?i.formatMessage(_t[t.actionName]):l);break;case"activity":r.push(o(t)||l);break;case"dateAndTime":r.push((0,Zt.default)(t.serverTimestamp).tz(n).format(Pt)||l);break;case"platform":r.push((null===(d=t.actor.meta)||void 0===d?void 0:d.platform)||l);break;case"ipAddress":r.push((null===(c=t.actor.meta)||void 0===c?void 0:c.ipAddress)||l);break;case"city":r.push((null===(u=t.actor.meta)||void 0===u?void 0:u.city)||l);break;case"state":r.push((null===(m=t.actor.meta)||void 0===m?void 0:m.state)||l);break;case"country":r.push((null===(p=t.actor.meta)||void 0===p?void 0:p.countryCode)||l);break;case"audience":if(!a)break;const g=function(e){var t;return null!==(t=Lt(e))&&void 0!==t?t:e.intl.formatMessage(At.notApplicable)}({auditLogEntry:t,intl:i});a&&r.push(g||l);break;case"pageId":if(!a)break;const h=G(t);h?r.push(h.id):r.push(i.formatMessage(At.notApplicable));break;default:(0,H.t1)(e)}})),r.join(",")}function Lt(e){var t;const{auditLogEntry:i,intl:n}=e,o=G(i);return null!=o&&null!==(t=o.meta)&&void 0!==t&&t.pageAudience?n.formatMessage(Ft[o.meta.pageAudience]):null}let Ot,Nt;!function(e){e.Page="Page",e.Workspace="Workspace",e.Team="Team",e.Account="Account"}(Ot||(Ot={})),function(e){e.All="All",e.Partial="Partial",e.None="None"}(Nt||(Nt={}));class Ut extends I.Z{getInitialState(){return{categorySelections:{[Ot.Page]:Nt.All,[Ot.Workspace]:Nt.All,[Ot.Team]:Nt.All,[Ot.Account]:Nt.All},actionSelections:{page_viewed:!0,page_created:!0,page_deleted:!0,page_restored:!0,page_exported:!0,page_moved:!0,page_permission_updated:!0,page_shared_to_web:!0,private_content_transferred:!0,password_set:!0,password_cleared:!0,password_changed:!0,login:!0,logout:!0,member_invited:!0,member_role_updated:!0,member_removed:!0,guest_removed:!0,email_changed:!0,user_deleted:!0,member_joined:!0,preferred_name_changed:!0,picture_changed:!0,workspace_name_changed:!0,workspace_icon_changed:!0,allowed_email_domain_added:!0,allowed_email_domain_removed:!0,workspace_domain_changed:!0,workspace_exported:!0,public_page_cleared:!0,public_page_set:!0,scim_token_generated:!0,scim_token_revoked:!0,saml_toggled:!0,saml_enforce_toggled:!0,automatic_account_creation_toggled:!0,workspace_creation_set_for_email_domain:!0,member_added_to_group:!0,member_removed_from_group:!0,space_transfer_status_changed:!0,space_claim_and_upgrade_status_changed:!0,file_uploaded:!0,file_downloaded:!0,invite_link_toggled:!0,invite_link_reset:!0,page_access_requests_toggled:!0,public_page_sharing_toggled:!0,workspace_sidebar_editing_toggled:!0,disable_guests_toggled:!0,pages_to_other_workspaces_toggled:!0,export_toggled:!0,workspace_integration_restriction_changed:!0,idp_metadata_url_updated:!0,idp_metadata_xml_updated:!0,idp_metadata_xml_removed:!0,allowed_support_access:!0,revoked_support_access:!0,membership_requests_toggled:!0,membership_request_resolved:!0,team_created:!0,team_archived:!0,team_restored:!0,team_default_toggled:!0,team_public_page_sharing_toggled:!0,team_guests_toggled:!0,team_export_toggled:!0,team_sidebar_editing_toggled:!0,team_name_changed:!0,team_description_changed:!0,team_icon_changed:!0,team_creation_admins_setting_toggled:!0,member_added_to_team:!0,group_added_to_team:!0,member_removed_from_team:!0,group_removed_from_team:!0,member_left_team:!0,member_joined_team:!0,member_team_role_updated:!0,team_member_default_permission_updated:!0,team_workspace_default_permission_updated:!0,team_privacy_type_changed:!0,team_invite_access_changed:!0,teams_enabled_for_space:!0},isMenuOpen:!1,renderOrder:[{category:Ot.Page,orderedActions:["page_viewed","page_created","page_deleted","page_restored","page_exported","page_moved","page_permission_updated","page_shared_to_web","file_uploaded","file_downloaded"]},{category:Ot.Workspace,orderedActions:["member_invited","member_joined","member_role_updated","member_removed","guest_removed","invite_link_toggled","workspace_name_changed","invite_link_reset","page_access_requests_toggled","public_page_sharing_toggled","workspace_sidebar_editing_toggled","disable_guests_toggled","pages_to_other_workspaces_toggled","export_toggled","workspace_icon_changed","allowed_email_domain_added","allowed_email_domain_removed","workspace_domain_changed","workspace_exported","workspace_integration_restriction_changed","public_page_cleared","public_page_set","scim_token_generated","scim_token_revoked","idp_metadata_url_updated","idp_metadata_xml_updated","idp_metadata_xml_removed","saml_toggled","saml_enforce_toggled","automatic_account_creation_toggled","workspace_creation_set_for_email_domain","member_added_to_group","member_removed_from_group","space_transfer_status_changed","space_claim_and_upgrade_status_changed","membership_requests_toggled","membership_request_resolved"]},{category:Ot.Account,orderedActions:["login","logout","password_set","password_cleared","password_changed","email_changed","preferred_name_changed","picture_changed","user_deleted","allowed_support_access","revoked_support_access"]},{category:Ot.Team,orderedActions:["team_created","team_archived","team_restored","team_privacy_type_changed","team_default_toggled","team_public_page_sharing_toggled","team_export_toggled","team_sidebar_editing_toggled","team_guests_toggled","team_invite_access_changed","team_name_changed","team_description_changed","team_icon_changed","team_creation_admins_setting_toggled","member_added_to_team","group_added_to_team","member_removed_from_team","group_removed_from_team","member_joined_team","member_left_team","member_team_role_updated","team_member_default_permission_updated","team_workspace_default_permission_updated"]}]}}getAllActionNames(){return(0,H.Yd)(this.state.actionSelections)}getSelectedActionNames(){return this.getAllActionNames().filter((e=>this.state.actionSelections[e]))}hasActionNameSelected(){const e=this.getAllActionNames(),t=this.getSelectedActionNames();return t.length>0&&t.length!==e.length}toggleCategorySelection(e){const t=e.category,i=this.state.categorySelections[t],n=i===Nt.None||i===Nt.Partial?Nt.All:Nt.None,o=n===Nt.All,s={...this.state.actionSelections},a=this.state.renderOrder.find((e=>e.category===t));a&&(a.orderedActions.forEach((e=>{s[e]=o})),this.setState({...this.state,actionSelections:s,categorySelections:{...this.state.categorySelections,[a.category]:n}}))}toggleActionNameSelection(e,t){const i=this.state.actionSelections[e],n={...this.state.actionSelections,[e]:!i},o=t.orderedActions.filter((e=>n[e])).length,s=0===o?Nt.None:o===t.orderedActions.length?Nt.All:Nt.Partial;this.setState({...this.state,actionSelections:n,categorySelections:{...this.state.categorySelections,[t.category]:s}})}clearAllSelections(){const e=this.getBulkUpdateNextActionSelectionState((0,H.Yd)(this.state.actionSelections),!1),t=this.getBulkUpdateNextCategorySelectionState((0,H.Yd)(this.state.categorySelections),Nt.None);this.setState({...this.state,actionSelections:e,categorySelections:t})}getBulkUpdateNextCategorySelectionState(e,t){const i={...this.state.categorySelections};return e.forEach((e=>{i[e]=t})),i}getBulkUpdateNextActionSelectionState(e,t){const i={...this.state.actionSelections};return e.forEach((e=>{i[e]=t})),i}}var Wt=i(29798),Vt=i(97758);class zt extends p.Z{constructor(){super(...arguments),l()(this,"storeTypes",{componentStore:Ut,lastSelectionStore:Ut,menuListStore:Wt.Z}),l()(this,"renderMenu",(()=>{const{componentStore:e,menuListStore:t}=this.stores,i=[];e.state.renderOrder.forEach((e=>{(e.category!==Ot.Team||(0,z.bq)())&&(i.push(this.renderCategoryMenu(e)),e.orderedActions.forEach((t=>{i.push(this.renderActionNameMenu(t,e))})))}));const n={key:"results",items:i,render:e=>m().createElement(Ne.Z,a()({},e,{title:null,loading:!1}))};return m().createElement(m().Fragment,null,o()(De.Z,{menuType:Fe.o.Popup,header:null,maxHeight:356},void 0,o()(Le.Z,{type:Le.i.Vertical,store:t,initialFocus:0,sections:[n]})),o()(Ne.Z,{topBorder:!0,style:{padding:"8px 8px 2px 8px",justifyContent:"space-between",display:"flex"}},void 0,o()(Je.Z,{onClick:()=>{this.handleClear()}},void 0,o()(y.FormattedMessage,{id:"auditlogEventFilter.clearButton",defaultMessage:"Clear"})),o()(Ee.Z,{onClick:()=>{this.handleApply()}},void 0,o()(y.FormattedMessage,{id:"auditlogEventFilter.applyButton",defaultMessage:"Apply"}))))})),l()(this,"renderPillButtonOrigin",(e=>{const{componentStore:t}=this.stores,i=t.hasActionNameSelected();return o()(Ye.u,{on:i,icon:h.Z.bot({width:16,marginRight:6,fill:"currentColor"}),title:o()("span",{},void 0,e),onClick:()=>{this.setMenuOpen(!0)}})})),l()(this,"setMenuOpen",(e=>{const{componentStore:t}=this.stores;t.setState({...t.state,isMenuOpen:e})})),l()(this,"styles",{menu:{width:250,maxHeight:"40vh"},menuItem:{width:"fit-content",border:"solid 1px",borderColor:this.theme.outlineButtonBorder,paddingLeft:0,paddingRight:0,borderRadius:20,fontSize:12},icon:{height:14,width:14,fill:"currentColor"},popup:{paddingTop:8,paddingBottom:8}})}renderComponent(){const{componentStore:e}=this.stores,t=this.styles,i=o()(y.FormattedMessage,{id:"auditlogEventFilter.title",defaultMessage:"Event",description:"The title of the event filter in the pill mode"}),n=this.renderPillButtonOrigin(i);return o()(vt.Z,{marginAfter:!1},void 0,o()(Oe.ZP,{popupType:Oe.ZP.PopupType.Popup,placementToOrigin:Oe.ZP.Placement.Bottom,alignmentToOrigin:Oe.ZP.Alignment.Start,open:e.state.isMenuOpen,render:this.renderMenu,onDismiss:()=>{this.handleMenuCloseFromOutside()},keepFocus:!0,origin:n,preventScaleTransition:!0,style:t.popup}))}renderCategoryMenu(e){const{intl:t}=this.props,{componentStore:i}=this.stores,n=e.category,s=()=>{i.toggleCategorySelection(e)};return{key:n,action:s,render:e=>m().createElement(Re.Z,a()({},e,{icon:o()(Vt.Z,{checked:i.state.categorySelections[n]===Nt.All,size:16,onClick:s}),focused:!1,title:t.formatMessage(qt[n]),className:"notranslate"}))}}renderActionNameMenu(e,t){const{intl:i}=this.props,{componentStore:n}=this.stores,s=()=>{n.toggleActionNameSelection(e,t)};return{key:e,action:s,render:t=>m().createElement(Re.Z,a()({},t,{icon:o()(Vt.Z,{checked:n.state.actionSelections[e],size:16,onClick:s}),focused:!1,title:i.formatMessage(_t[e]),className:"notranslate",style:{paddingLeft:20}}))}}handleMenuCloseFromOutside(){const{componentStore:e,lastSelectionStore:t}=this.stores;e.setState({...e.state,actionSelections:{...t.state.actionSelections},categorySelections:{...t.state.categorySelections}}),this.setMenuOpen(!1)}handleClear(){const{componentStore:e}=this.stores;e.clearAllSelections()}handleApply(){const{onChange:e}=this.props,{componentStore:t,lastSelectionStore:i}=this.stores,n=t.getAllActionNames(),o=t.getSelectedActionNames();e(n.length===o.length?[]:o),0===o.length&&t.reset(),i.setState({...i.state,actionSelections:{...t.state.actionSelections},categorySelections:{...t.state.categorySelections}}),this.setMenuOpen(!1)}}const qt=(0,y.defineMessages)({[Ot.Page]:{id:"auditlogEventFilter.categoryName.page",defaultMessage:"Page",description:"audit log action category - page"},[Ot.Workspace]:{id:"auditlogEventFilter.categoryName.workspace",defaultMessage:"Workspace",description:"audit log action category - workspace"},[Ot.Team]:{id:"auditlogEventFilter.categoryName.team",defaultMessage:"Teamspace",description:"audit log action category - Teamspace"},[Ot.Account]:{id:"auditlogEventFilter.categoryName.account",defaultMessage:"Account",description:"audit log action category - account"}}),Ht=(0,y.injectIntl)(zt);const Gt=(0,y.injectIntl)((function(e){const{spaceStore:t}=e,[i,n]=(0,Me.oR)(ne),[s,a,r]=(0,Me.oR)(Ze);return o()("div",{style:{display:"flex",flexDirection:"row",gap:4}},void 0,o()(St,{mode:ht.z.Pill,focused:!1,title:o()(y.FormattedMessage,{id:"auditlogDateFilter.title",defaultMessage:"Date"}),icon:h.Z.calendar,value:i.timeRange,showButtons:"footer",onChange:e=>{n({...i,timeRange:e,pageNum:1})}}),o()(It,{parentStore:t,auditLogHistoricalUserStore:r,selectedActors:i.actors,onChange:e=>{n({...i,actors:e,pageNum:1})}}),o()(Ht,{parentStore:t,selectedEvents:i.actions,onChange:e=>{n({...i,actions:e,pageNum:1})}}))}));var Kt=i(95477),jt=i(63296),Yt=i(23189);function Qt(){return o()(Yt.Z,{large:!0,style:{marginBottom:0,paddingBottom:0,fontSize:16,fontWeight:v.Z.fontWeight.medium,display:"flex",justifyContent:"space-between"}},void 0,o()("div",{style:{gap:8,display:"flex"}},void 0,o()(y.FormattedMessage,{id:"auditlog.title",defaultMessage:"Audit log"})),o()(Xt,{}))}function Xt(){const e=(0,be.O7)();return Kt.Z.isLocalhost||"development"===Kt.Z.env?o()(jt.Z,{style:{marginLeft:10},isSmall:!0,onClick:()=>{(0,k.navigateToExternalURL)({environment:e,url:"https://dev.notion.so/notion/Audit-Log-Dev-feedback-e9048c4e7d544369b0b8413ec20f02cf",targetSelf:!0})}},void 0,"🎁 Feedback is a gift!"):null}var Jt=i(70765);const $t=function(){return o()("div",{style:{}},void 0,o()(Jt.h,{paragraphs:[{lineHeight:45,lineMargin:20,sectionWidths:[100],repeat:1,sectionMargin:15},{lineHeight:40,lineMargin:5,sectionWidths:[100],repeat:8,sectionMargin:10}]}))};var ei=i(24405),ti=i(25186),ii=i(31689),ni=i(7908),oi=i(64369),si=i(40235),ai=i(21752);function ri(e){const{auditLogEntry:t,actorStore:i,id:n}=e,s=(0,Me.VK)((()=>i.getValue()),[i]),a=(0,u.createRef)();if(s){const e=i.pointer.table;if(e===Ce.KJ){var r;const e=s,i=t.actor,l=i.name||(null==e?void 0:e.name),d=i.email||(null==e?void 0:e.email),c=null===(r=i.meta)||void 0===r?void 0:r.spaceRole,u="member"===c||"no_access"===c?void 0:c;return o()(Ue.Z,{disableTooltip:li(a.current),renderTooltip:()=>m().createElement(m().Fragment,null,o()("div",{},void 0,l),o()("div",{},void 0,d)),placement:Ue.Z.Placement.Bottom,render:t=>m().createElement("div",t,o()(ai.Z,{id:n,userValue:{...e,name:l,email:d},spaceRole:u}))})}if(e===we.cZ){const e=s,i=t.actor.name||e.name,r=t.actor.actorId;return o()(Ue.Z,{disableTooltip:li(a.current),renderTooltip:()=>m().createElement(m().Fragment,null,o()("div",{},void 0,i),o()("div",{},void 0,r)),placement:Ue.Z.Placement.Bottom,render:e=>m().createElement("div",e,o()(ai.Z,{id:n,userValue:{id:t.actor.actorId,version:1,email:r,name:i}}))})}}return o()(ai.Z,{id:n,userValue:{id:t.actor.actorId,name:t.actor.name,version:1,email:""}})}function li(e){return!!e&&(e.scrollHeight>e.clientHeight||e.scrollWidth>e.clientWidth)}var di=i(25464);function ci(e){const{auditLogEntry:t,id:i}=e;return o()(Ue.Z,{renderTooltip:()=>o()("div",{style:{display:"flex",flexDirection:"column",fontVariantNumeric:"tabular-nums"}},void 0,o()("div",{},void 0,(0,Zt.default)(t.serverTimestamp).tz(q.x7).format("z: ".concat(Pt))),o()("div",{},void 0,o()(y.FormattedMessage,{id:"auditLogSettings.timeTooltip.utcTime",defaultMessage:"UTC: {time}",description:"Tooltip for UTC time on hover in the audit log.",values:{time:(0,Zt.default)(t.serverTimestamp).tz("UTC").format(Pt)}}))),render:e=>o()("div",{id:i},void 0,m().createElement(oi.Z,a()({isSecondaryColor:!0},e),(0,Zt.default)(t.serverTimestamp).format(Pt))),placement:di.u.Bottom})}var ui=i(65917),mi=i(26825),pi=i(21202),gi=i(19639),hi=i(75246),fi=i(29369);function vi(e){var t;return Si(null===(t=e.meta)||void 0===t?void 0:t.permissionLevel)}function yi(e){var t;return"space_members"!==(null===(t=e.meta)||void 0===t?void 0:t.permissionLevel)}function Si(e){return"workspace"!==e}const bi=(0,y.defineMessages)({picture_changed:{id:"auditlog.actionNames.eventColumn.picture_changed",defaultMessage:"Changed profile picture",description:"Changed picture event for audit log"},password_cleared:{id:"auditlog.actionNames.eventColumn.password_cleared",defaultMessage:"Cleared login password",description:"Password cleared event for audit log"},password_set:{id:"auditlog.actionNames.eventColumn.password_set",defaultMessage:"Created a login password",description:"Password set event for audit log"},password_changed:{id:"auditlog.actionNames.eventColumn.password_changed",defaultMessage:"Changed login password",description:"Password change event for audit log"},logout:{id:"auditlog.actionNames.eventColumn.logout",defaultMessage:"Logged out",description:"Logout picture event for audit log"},user_deleted:{id:"auditlog.actionNames.eventColumn.user_deleted",defaultMessage:"User was deleted",description:"User deleted event for audit log"},member_joined:{id:"auditlog.actionNames.eventColumn.member_joined",defaultMessage:"Joined the workspace",description:"Member joined event for audit log"},file_uploaded:{id:"auditlog.actionNames.eventColumn.file_uploaded",defaultMessage:"Uploaded a file",description:"File uploaded event for audit log"},invite_link_reset:{id:"auditlog.actionNames.eventColumn.invite_link_reset",defaultMessage:"Reset invite link",description:"Reset invite link for workspace"},workspace_exported:{id:"auditlog.actionNames.eventColumn.workspace_exported",defaultMessage:"Exported all workspace content",description:"An audit log that describes an export of all the workspace contents, e.g. in PDF form"},workspace_icon_changed:{id:"auditlog.actionNames.eventColumn.workspace_icon_changed",defaultMessage:"Changed workspace icon",description:"An audit log that describes a change of the workspace icon"},public_page_cleared:{id:"auditlogEventFilter.actionNames.public_page_cleared",defaultMessage:"Public home page link cleared",description:"An audit log that describes the clearing of a public home page for a workspace"},scim_token_generated:{id:"auditlog.actionNames.scim_token_generated",defaultMessage:"Generated API SCIM token",description:"An audit log that describes the generating of a SCIM token for a workspace"},scim_token_revoked:{id:"auditlog.actionNames.scim_token_revoked",defaultMessage:"Revoked API SCIM token",description:"An audit log that describes the revoking of the SCIM token for a workspace"},page_access_requests_toggled:{id:"auditlog.actionNames.eventColumn.page_access_requests_toggled",defaultMessage:"page access requests from non-members",description:"Used to track page access requests toggle from settings in audit log, will either have the word 'Enabled' or 'Disabled' in front"},public_page_sharing_toggled:{id:"auditlog.actionNames.eventColumn.public_page_sharing_toggled",defaultMessage:"members sharing pages publicly",description:"Used to track page sharing toggle from settings in audit log, will either have the word 'Enabled' or 'Disabled' in front"},workspace_sidebar_editing_toggled:{id:"auditlog.actionNames.eventColumn.workspace_sidebar_editing_toggled",defaultMessage:"members changing the Workspace section",description:"Used to track members changing Workspace settings toggle in audit log, will either have the word 'Enabled' or 'Disabled' in front"},disable_guests_toggled:{id:"auditlog.actionNames.eventColumn.disable_guests_toggled",defaultMessage:"guests",description:"Used to track toggling guests in a workspace in audit log, will either have the word 'Enabled' or 'Disabled' in front"},pages_to_other_workspaces_toggled:{id:"auditlog.actionNames.eventColumn.pages_to_other_workspaces_toggled",defaultMessage:"moving or duplicating pages to other workspaces",description:"Used to track toggling moving pages to other workspaces in audit log, will either have the word 'Enabled' or 'Disabled' in front"},export_toggled:{id:"auditlog.actionNames.eventColumn.export_toggled",defaultMessage:"export",description:"Used to track toggling export for a workspace in audit log, will either have the word 'Enabled' or 'Disabled' in front"},idp_metadata_xml_updated:{id:"auditlog.actionNames.eventColumn.idp_metadata_xml_updated",defaultMessage:"Updated IDP metadata XML",description:"An audit log that describes IDP metadata XML getting updated"},idp_metadata_xml_removed:{id:"auditlog.actionNames.eventColumn.idp_metadata_xml_removed",defaultMessage:"Removed IDP metadata XML",description:"An audit log that describes IDP metadata XML getting removed"},saml_enabled:{id:"auditlog.actionNames.saml_enabled",defaultMessage:"Enabled SAML",description:"An audit log that describes the enabling of SAML for a workspace"},saml_disabled:{id:"auditlog.actionNames.saml_disabled",defaultMessage:"Disabled SAML",description:"An audit log that describes the disabling of SAML for a workspace"},saml_enforced:{id:"auditlog.actionNames.saml_enforced",defaultMessage:"Enabled enforcing SAML",description:"An audit log that describes the enforcing of SAML for a workspace"},saml_unenforced:{id:"auditlog.actionNames.saml_unenforced",defaultMessage:"Disabled enforcing SAML",description:"An audit log that describes the disabling of SAML enforcing for a workspace"},automatic_account_creation_enabled:{id:"auditlog.actionNames.automatic_account_creation_enabled",defaultMessage:"Enabled automatically creating accounts on sign-in",description:"An audit log that describes the enabling of automatically creating accounts on sign-in"},automatic_account_creation_disabled:{id:"auditlog.actionNames.automatic_account_creation_disabled",defaultMessage:"Disabled automatically creating accounts on sign-in",description:"An audit log that describes the disabling of automatically creating accounts on sign-in"},a_private_page:{defaultMessage:"a private page",id:"auditlog.actionNames.eventColumn.private_page",description:"An audit log that describes a page action performed on a page that is private"},an_untitled_page:{defaultMessage:"an untitled page",id:"auditlog.actionNames.eventColumn.untitled_page",description:"An audit log that describes a page action performed on a page that is untitled"},thisWorkspace:{defaultMessage:"this workspace",id:"auditlog.actionNames.eventColumn.thisWorkspace",description:"The word is used in an audit log that describes a page action performed to the current workspace"},otherWorkspace:{defaultMessage:"another workspace",id:"auditlog.actionNames.eventColumn.otherWorkspace",description:"The word is used in an audit log that describes a page action performed to another workspace"},workspaceLevel:{defaultMessage:"the workspace level",id:"auditlog.actionNames.eventColumn.workspaceLevel",description:"The word is used in an audit log that describes a page action performed to a page at the workspace level"},private:{defaultMessage:"private",id:"auditlog.actionNames.eventColumn.private",description:"The word is used in an audit log that describes a page action performed to a private page"},a_file:{defaultMessage:"a file",id:"auditlog.actionNames.eventColumn.a_file",description:"The word is used in an audit log that describes a file users uploaded or downloaded"},a_file_with_extension:{defaultMessage:"a {extension} file",id:"auditlog.actionNames.eventColumn.a_file_with_extension",description:"The word is used in an audit log that describes a file with a particular extension users uploaded or downloaded"},team:{defaultMessage:"teamspace",id:"auditlog.actionNames.eventColumn.team",description:"The word to denote a teamspace in audit log."},for_a_private_team:{defaultMessage:"for a private teamspace",id:"auditlog.actionNames.eventColumn.for_private_team",description:"An audit log that describes a action performed for a teamspace that is private"},a_private_team:{defaultMessage:"a private teamspace",id:"auditlog.actionNames.eventColumn.private_team",description:"An audit log that describes a action performed on a teamspace that is private"},a_team_and_page:{defaultMessage:"a teamspace and page",id:"auditlog.actionNames.eventColumn.team_and_page",description:"A phrase to denote a teamspace and page in audit log (e.g. under which a child page resides)."},team_member:{defaultMessage:"teamspace member",id:"auditlog.actionNames.eventColumn.team_member",description:"A phrase to denote a teamspace member."},team_owner:{defaultMessage:"teamspace owner",id:"auditlog.actionNames.eventColumn.team_owner",description:"A phrase to denote a teamspace owner."},team_level_guest:{defaultMessage:"teamspace guest",id:"auditlog.actionNames.eventColumn.team_level_guest",description:"A phrase to denote a teamspace guest."},group:{defaultMessage:"group",id:"auditlog.actionNames.eventColumn.group",description:"The word to denote a group in audit log."},user:{defaultMessage:"user",id:"auditLogEntry.user.noName",description:"Placeholder used in audit log entry when a user neither has a name nor an email address."}});function Mi(e,t){return"user"in t.target&&t.target.user?wi(e,t.target.user):"bot"in t.target&&t.target.bot?t.target.bot.name?"“".concat(t.target.bot.name,"“"):"bot":"group"in t.target&&t.target.group?t.target.group.name?"“".concat(t.target.group.name,"“"):"group":void 0}function wi(e,t){return t?t.name&&t.email?"“".concat(t.name,"“ (").concat(t.email,")"):t.name?"“".concat(t.name,"“"):t.email?"“".concat(t.email,"“"):e.formatMessage(bi.user):e.formatMessage(bi.user)}const Ci=(0,y.defineMessages)({equallyRestrictive:{defaultMessage:". This is the same as the current workspace setting",id:"auditlog.actionNames.eventColumn.team_guests_toggled.team_space_equal",description:"An audit log suffix that describes that a team's guest settings were the same as the workspace's"},moreRestrictive:{defaultMessage:". This is more restrictive than the current workspace setting",id:"auditlog.actionNames.eventColumn.team_guests_toggled.team_space_more_restrictive",description:"An audit log suffix that describes that a team's guest settings were more restrictive than the workspace's"},lessRestrictive:{defaultMessage:". This is less restrictive than the current workspace setting",id:"auditlog.actionNames.eventColumn.team_guests_toggled.team_space_less_restrictive",description:"An audit log suffix that describes that a team's guest settings were less restrictive than the workspace's"}});function ki(e,t){if(void 0!==e&&void 0!==t)return e===t?m().createElement(y.FormattedMessage,Ci.equallyRestrictive):!e&&t?m().createElement(y.FormattedMessage,Ci.moreRestrictive):e&&!t?m().createElement(y.FormattedMessage,Ci.lessRestrictive):void 0}function Ti(e){return e.name?"“".concat(e.name,"“ group"):m().createElement(y.FormattedMessage,bi.group)}function Ii(e,t){return!t&&yi(e.target.team)?m().createElement(y.FormattedMessage,bi.for_a_private_team):e.changes.name.oldValue&&e.changes.name.newValue?o()(y.FormattedMessage,{defaultMessage:"from “{oldTeamName}“ to “{newTeamName}“",id:"auditlog.actionNames.eventColumn.from_old_team_name_to_new_team_name",description:"An audit log that describes that a team's name change.",values:{oldTeamName:e.changes.name.oldValue,newTeamName:e.changes.name.newValue}}):!e.changes.name.oldValue&&e.changes.name.newValue?o()(y.FormattedMessage,{defaultMessage:"from some teamspace name to “{newTeamName}“",id:"auditlog.actionNames.eventColumn.from_unknown_team_name_to_new_team_name",description:"An audit log that describes that a teamspace's name change from an unknown old name.",values:{newTeamName:e.changes.name.newValue}}):o()(y.FormattedMessage,{defaultMessage:"for {teamName}",id:"auditlog.actionNames.eventColumn.for_team_name",description:"An audit log that describes that a team's name.",values:{teamName:Zi(e,t)}})}function Zi(e,t){return"team"in e.target?Pi(e.target.team,t):m().createElement(y.FormattedMessage,bi.team)}function Pi(e,t){return!t&&yi(e)?m().createElement(y.FormattedMessage,bi.a_private_team):e.name?"“".concat(e.name,"“ teamspace"):m().createElement(y.FormattedMessage,bi.team)}function _i(e){if(e)switch(e){case"owner":return m().createElement(y.FormattedMessage,bi.team_owner);case"member":return m().createElement(y.FormattedMessage,bi.team_member);case"team_level_guest":return m().createElement(y.FormattedMessage,bi.team_level_guest)}return m().createElement(y.FormattedMessage,bi.team_member)}function xi(e){return m().createElement(y.FormattedMessage,function(e){if(!e)return mi.mq.noAccessLabel;switch(e){case"editor":return mi.mq.fullAccessLabel;case"membership_admin":case"read_and_write":return mi.mq.canEditLabel;case"content_only_editor":return mi.mq.canEditContentLabel;case"reader":return mi.mq.canReadLabel;case"comment_only":return mi.mq.canCommentLabel;case"none":return mi.mq.noAccessLabel;default:(0,H.t1)(e)}}(e))}function Fi(e){var t,i,n,o;return{oldRole:m().createElement(y.FormattedMessage,Ai(null===(t=e.changes)||void 0===t||null===(i=t.permission)||void 0===i?void 0:i.oldValue)),newRole:m().createElement(y.FormattedMessage,Ai(null===(n=e.changes)||void 0===n||null===(o=n.permission)||void 0===o?void 0:o.newValue))}}const Ai=e=>{if(!e)return mi.mq.noAccessLabel;switch(e){case"editor":return mi.mq.adminLabel;case"membership_admin":return mi.mq.membershipAdminLabel;case"read_and_write":return mi.mq.memberLabel;default:return mi.mq.noAccessLabel}};function Bi(e,t){return!t&&vi(e.target.page)?m().createElement(y.FormattedMessage,bi.a_private_page):e.target.page.title?"“".concat(e.target.page.title,"“"):m().createElement(y.FormattedMessage,bi.an_untitled_page)}function Ei(e){var t,i,n,o,s,a;return null!==(t=e.target)&&void 0!==t&&null!==(i=t.page)&&void 0!==i&&null!==(n=i.meta)&&void 0!==n&&n.parent&&"title"in(null===(o=e.target)||void 0===o||null===(s=o.page)||void 0===s||null===(a=s.meta)||void 0===a?void 0:a.parent)?"“".concat(e.target.page.meta.parent.title,"“"):m().createElement(y.FormattedMessage,bi.an_untitled_page)}function Ri(e){var t;return null!==(t=e.actor.meta)&&void 0!==t&&t.platform?o()(y.FormattedMessage,{defaultMessage:"on {platform}",id:"auditlog.actionNames.eventColumn.logged_in_platform",description:"An audit log phrase that describes what platform a user logged in on (e.g. desktop)",values:{platform:e.actor.meta.platform}}):""}function Di(e){return e.changes.name.oldValue?o()(y.FormattedMessage,{defaultMessage:"from “{oldDomain}“",id:"auditlog.actionNames.eventColumn.old_domain",description:"An audit log phrase that describes what the old domain for a workspace was before it changed.",values:{oldDomain:e.changes.name.oldValue}}):""}function Li(e,t,i){var n,s;return"block"===e.table?!i&&yi(t)&&Si(null===(n=e.meta)||void 0===n?void 0:n.permissionLevel)?o()(y.FormattedMessage,{defaultMessage:"a private teamspace page",id:"auditlog.actionNames.eventColumn.under_private_team_and_private_parent_page",description:"An audit log phrase that describes a page being under a private page in a private team.",values:{teamName:Pi(t,i),parentPage:Oi(e)}}):!i&&Si(null===(s=e.meta)||void 0===s?void 0:s.permissionLevel)?o()(y.FormattedMessage,{defaultMessage:"a private page in {teamName}",id:"auditlog.actionNames.eventColumn.under_private_page_in_team",description:"An audit log phrase that describes a page being under a private page in a team.",values:{teamName:Pi(t,i)}}):o()(y.FormattedMessage,{defaultMessage:"{teamName} page {parentPage}",id:"auditlog.actionNames.eventColumn.team_parent_page",description:"An audit log phrase that describes what parent page and teamspace a page is under.",values:{teamName:Pi(t,i),parentPage:Oi(e)}}):"team"===e.table?Pi(t,i):void 0}function Oi(e){return"title"in e?"“".concat(e.title,"“"):m().createElement(y.FormattedMessage,bi.an_untitled_page)}function Ni(e,t,i){var n;return i?"space"===i.table?i.id!==e?m().createElement(y.FormattedMessage,bi.otherWorkspace):Si(i.permissionLevel)?t?m().createElement(y.FormattedMessage,bi.private):m().createElement(y.FormattedMessage,bi.a_private_page):m().createElement(y.FormattedMessage,bi.thisWorkspace):"team"===i.table?Pi(i,t):!t&&Si(null===(n=i.meta)||void 0===n?void 0:n.permissionLevel)?m().createElement(y.FormattedMessage,bi.a_private_page):i.title?"“".concat(i.title,"“"):void 0:m().createElement(y.FormattedMessage,bi.an_untitled_page)}const Ui=(0,y.defineMessages)({open:{defaultMessage:"Open",id:"auditlog.actionNames.eventColumn.team_privacy_types.open",description:"An audit log phrase that describes an open team"},closed:{defaultMessage:"Closed",id:"auditlog.actionNames.eventColumn.team_privacy_types.closed",description:"An audit log phrase that describes a closed team"},private:{defaultMessage:"Private",id:"auditlog.actionNames.eventColumn.team_privacy_types.private",description:"An audit log phrase that describes a private team"},unknown:{defaultMessage:"an unknown privacy state",id:"auditlog.actionNames.eventColumn.team_privacy_types.unknown",description:"An audit log phrase that describes a team with an unknown privacy state"}});function Wi(e){return e?m().createElement(y.FormattedMessage,Ui[e]):m().createElement(y.FormattedMessage,Ui.unknown)}function Vi(e){return e.changes.enabled.newValue?o()(y.FormattedMessage,{defaultMessage:"Disabled",id:"auditlog.actionNames.eventColumn.membership_requests_toggled.disabled",description:"An audit log that describes that the membership requests setting was disabled."}):o()(y.FormattedMessage,{defaultMessage:"Enabled",id:"auditlog.actionNames.eventColumn.membership_requests_toggled.enabled",description:"An audit log that describes that the membership requests setting was enabled."})}function zi(e){return"approved"===e.changes.requestStatus.newValue?o()(y.FormattedMessage,{defaultMessage:"Approved",id:"auditlog.actionNames.eventColumn.membership_request_resolved.approved",description:"An audit log that describes that a membership request was approved."}):o()(y.FormattedMessage,{defaultMessage:"Declined",id:"auditlog.actionNames.eventColumn.membership_request_resolved.declined",description:"An audit log that describes that a membership request was declined."})}const qi=(0,y.defineMessages)({team_members:{defaultMessage:"any teamspace member",id:"auditlog.actionNames.eventColumn.team_access_level_types.team_members",description:"An audit log phrase that any teamspace members can invite teamspace members"},team_owners:{defaultMessage:"only teamspace owners",id:"auditlog.actionNames.eventColumn.team_access_level_types.team_owners",description:"An audit log phrase that only teamspace owners can invite teamspace members"},unknown:{defaultMessage:"unknown",id:"auditlog.actionNames.eventColumn.team_access_level_types.unknown",description:"An audit log phrase that describes a team state where who can invite team members is unknown"}});function Hi(e,t,i,n){var s,a,r,l,d,c,u,p,g,h,f,v,S,b,M,w,C,k,T,I,Z,P,_,x,F,A,B;switch(e.actionName){case"page_viewed":return o()(y.FormattedMessage,{defaultMessage:"Viewed {pageName}",id:"auditlog.actionNames.eventColumn.page_viewed_under",description:"An audit log that describes a viewed page",values:{pageName:Bi(e,n)}});case"page_deleted":return e.target.page.meta.permanentDeletion?o()(y.FormattedMessage,{defaultMessage:"Permanently deleted {pageName}",id:"auditlog.actionNames.eventColumn.page_permanently_deleted",description:"Permanently deleted page event for audit log",values:{pageName:Bi(e,n)}}):o()(y.FormattedMessage,{defaultMessage:"Deleted {pageName}",id:"auditlog.actionNames.eventColumn.page_deleted",description:"Deleted page event for audit log",values:{pageName:Bi(e,n)}});case"page_restored":return o()(y.FormattedMessage,{defaultMessage:"Restored {pageName}",id:"auditlog.actionNames.eventColumn.page_restored",description:"Restored page event for audit log",values:{pageName:Bi(e,n)}});case"page_exported":return o()(y.FormattedMessage,{defaultMessage:"Exported {pageName}",id:"auditlog.actionNames.eventColumn.page_exported",description:"Exported page event for audit log",values:{pageName:Bi(e,n)}});case"page_moved":{var E,R,D;const t=null===(E=e.changes)||void 0===E?void 0:E.team,i=e.changes.parent.oldValue,s=e.changes.parent.newValue;if(null!=t&&t.oldValue&&null!=t&&t.newValue&&i&&s&&("block"===i.table||"block"===s.table))return o()(y.FormattedMessage,{defaultMessage:"Moved {pageName} from {oldTeamAndPage} to {newTeamAndPage}",id:"auditlog.actionNames.eventColumn.page_moved_team",description:"Moved page event for audit log in the context of a team",values:{pageName:Bi(e,n),oldTeamAndPage:Li(i,null==t?void 0:t.oldValue,n),newTeamAndPage:Li(s,null==t?void 0:t.newValue,n)}});let a=Ni(e.spaceId,n,e.changes.parent.oldValue),r=Ni(e.spaceId,n,e.changes.parent.newValue);return"space"===(null===(R=e.changes.parent.oldValue)||void 0===R?void 0:R.table)&&"space"===(null===(D=e.changes.parent.newValue)||void 0===D?void 0:D.table)&&e.changes.parent.oldValue.id===e.changes.parent.newValue.id&&(Si(e.changes.parent.oldValue.permissionLevel)||Si(e.changes.parent.newValue.permissionLevel))&&(a=Si(e.changes.parent.oldValue.permissionLevel)?m().createElement(y.FormattedMessage,bi.private):m().createElement(y.FormattedMessage,bi.workspaceLevel),r=Si(e.changes.parent.newValue.permissionLevel)?m().createElement(y.FormattedMessage,bi.private):m().createElement(y.FormattedMessage,bi.workspaceLevel)),o()(y.FormattedMessage,{defaultMessage:"Moved {pageName} from {oldParentName} to {newParentName}",id:"auditlog.actionNames.eventColumn.page_moved",description:"Moved page event for audit log",values:{pageName:Bi(e,n),oldParentName:a,newParentName:r}})}case"page_permission_updated":return function(e,t,i){var n,s,a,r,l;const d="bot"in t.target,c="space"in t.target,u="team"in t.target,m="group"in t.target,p="user"in t.target&&"guest"===(null===(n=t.target.user.meta)||void 0===n?void 0:n.spaceRole);var g,h,f,v;if(d)return o()(y.FormattedMessage,{defaultMessage:"Updated permissions of {pageName} for bot {botName} from {oldRole} to {newRole}",id:"auditlog.actionNames.eventColumn.page_permissions_updated_workspace_bot",description:"An audit log that describe a page's permission has been changed for bots. It means bots can be added, removed, or changed role for this page",values:{botName:Mi(e,t),oldRole:xi(null===(g=t.changes)||void 0===g||null===(h=g.permission)||void 0===h?void 0:h.oldValue),newRole:xi(null===(f=t.changes)||void 0===f||null===(v=f.permission)||void 0===v?void 0:v.newValue),pageName:Bi(t,i)}});var S,b,M,w,C,k,T,I,Z,P,_,x;if(c)return o()(y.FormattedMessage,{defaultMessage:"Updated permissions of {pageName} for everyone in the workspace from {oldRole} to {newRole}",id:"auditlog.actionNames.eventColumn.page_permissions_updated_workspace_space",description:"An audit log that describe a page's permission has been changed for everyone in the workspace. It means the permission can be added, removed, or changed role for this page",values:{oldRole:xi(null===(S=t.changes)||void 0===S||null===(b=S.permission)||void 0===b?void 0:b.oldValue),newRole:xi(null===(M=t.changes)||void 0===M||null===(w=M.permission)||void 0===w?void 0:w.newValue),pageName:Bi(t,i)}});if(u)return o()(y.FormattedMessage,{defaultMessage:"Updated permissions of {pageName} for {teamName} from {oldRole} to {newRole}",id:"auditlog.actionNames.eventColumn.page_permissions_updated_team",description:"An audit log that describe a page's permission has been changed for a team.",values:{oldRole:xi(null===(C=t.changes)||void 0===C||null===(k=C.permission)||void 0===k?void 0:k.oldValue),newRole:xi(null===(T=t.changes)||void 0===T||null===(I=T.permission)||void 0===I?void 0:I.newValue),pageName:Bi(t,i),teamName:Zi(t,i)}});if(p)return o()(y.FormattedMessage,{defaultMessage:"Updated permissions of {pageName} for guest {guestNameAndEmail} from {oldRole} to {newRole}",id:"auditlog.actionNames.eventColumn.page_permissions_updated_workspace_guest",description:"An audit log that describe a page's permission has been changed for guests. It means guests can be added, removed, or changed role for this page",values:{guestNameAndEmail:Mi(e,t),oldRole:xi(null===(Z=t.changes)||void 0===Z||null===(P=Z.permission)||void 0===P?void 0:P.oldValue),newRole:xi(null===(_=t.changes)||void 0===_||null===(x=_.permission)||void 0===x?void 0:x.newValue),pageName:Bi(t,i)}});if(m){var F,A,B,E;return o()(y.FormattedMessage,{defaultMessage:"Updated permissions of {pageName} for group {groupName} from {oldRole} to {newRole}",id:"auditlog.actionNames.eventColumn.page_permissions_updated_workspace_group",description:"An audit log that describe a page's permission has been changed for a group. It means a group has been added, removed, or changed permission roles for this page",values:{groupName:Mi(e,t),oldRole:xi(null===(F=t.changes)||void 0===F||null===(A=F.permission)||void 0===A?void 0:A.oldValue),newRole:xi(null===(B=t.changes)||void 0===B||null===(E=B.permission)||void 0===E?void 0:E.newValue),pageName:Bi(t,i)}})}return o()(y.FormattedMessage,{defaultMessage:"Updated permissions of {pageName} for {memberNameAndEmail} from {oldRole} to {newRole}",id:"auditlog.actionNames.eventColumn.page_permissions_updated_workspace_default",description:"An audit log that describe a page's permission has been changed for members. It means members can be added, removed, or changed role for this page",values:{memberNameAndEmail:Mi(e,t),oldRole:xi(null===(s=t.changes)||void 0===s||null===(a=s.permission)||void 0===a?void 0:a.oldValue),newRole:xi(null===(r=t.changes)||void 0===r||null===(l=r.permission)||void 0===l?void 0:l.newValue),pageName:Bi(t,i)}})}(i,e,n);case"page_created":const V=G(e);if(null!=V&&null!==(s=V.meta)&&void 0!==s&&s.parent){var L,O,N,U,W;if(V.meta.parent.table===hi.bx)return!n&&"private"===(null===(N=V.meta)||void 0===N?void 0:N.permissionLevel)||"private"===(null===(U=V.meta)||void 0===U?void 0:U.pageAudience)?o()(y.FormattedMessage,{defaultMessage:"Created a private page",description:"Created private page event for audit log",id:"auditlog.actionNames.eventColumn.page_created_private"}):o()(y.FormattedMessage,{defaultMessage:"Created a page in the workspace",description:"Created page event for audit log",id:"auditlog.actionNames.eventColumn.page_created_workspace"});if((null===(L=V.meta)||void 0===L?void 0:L.parent.table)===fi.e0)return o()(y.FormattedMessage,{defaultMessage:"Created a page under {teamName}",description:"Created page under a team event for audit log",id:"auditlog.actionNames.eventColumn.page_created_team",values:{teamName:Pi(V.meta.parent,n)}});if((null===(O=V.meta)||void 0===O?void 0:O.parent.table)===pi.iU)return n||"private"!==(null===(W=V.meta)||void 0===W?void 0:W.permissionLevel)?o()(y.FormattedMessage,{defaultMessage:"Created a page under {parentPageName}",description:"Created page event for audit log",id:"auditlog.actionNames.eventColumn.page_created_under",values:{parentPageName:Ei(e)}}):o()(y.FormattedMessage,{defaultMessage:"Created a private page",description:"Created private page event for audit log",id:"auditlog.actionNames.eventColumn.page_created_private"})}return o()(y.FormattedMessage,{defaultMessage:"Created a page",description:"Created page (audit log)",id:"auditlog.actionNames.eventColumn.page_created_general"});case"page_shared_to_web":return function(e,t){if(void 0===e.changes.permission.newValue||"none"===e.changes.permission.newValue)return o()(y.FormattedMessage,{defaultMessage:"Disabled sharing {pageName} to web",id:"auditlog.actionNames.eventColumn.page_shared_to_web.disabled",description:"An audit log that describe a page has been disabled for sharing to web. It means everyone on the Internet will not have access to the page.",values:{pageName:Bi(e,t)}});return o()(y.FormattedMessage,{defaultMessage:"Enabled sharing {pageName} to web",id:"auditlog.actionNames.eventColumn.page_shared_to_web.enabled",description:"An audit log that describe a page has been enabled for sharing to web. It means everyone on the Internet will have access to the page.",values:{pageName:Bi(e,t)}})}(e,n);case"login":return null!==(a=e.actor.meta)&&void 0!==a&&a.countryCode?o()(y.FormattedMessage,{id:"auditLog.actionNames.eventColumn.loginWithCityStateAndCountry",defaultMessage:"Logged in {platform} in {geolocation}",description:"Login event for audit log with additional metadata (platform is device i.e. web, mobile, city/country name)",values:{platform:Ri(e),geolocation:Rt(e,i)}}):o()(y.FormattedMessage,{id:"auditLog.actionNames.eventColumn.loginWithPlatform",defaultMessage:"Logged in {platform}",description:"Login event for audit log with additional metadata (platform is device i.e. web, mobile, city/country name)",values:{platform:Ri(e)}});case"allowed_support_access":return o()(y.FormattedMessage,{defaultMessage:"Granted support access for {name} until {date}",id:"auditlog.actionNames.allowed_support_access",description:"An audit log that describes the enabling of support access",values:{date:i.formatDate(e.changes.expiresAt),name:e.target.user.name}});case"revoked_support_access":return o()(y.FormattedMessage,{defaultMessage:"Revoked support access for {name}",id:"auditlog.actionNames.revoked_support_access",description:"An audit log that describes the disabling of support access",values:{name:e.target.user.name}});case"preferred_name_changed":return function(e){const t=e.changes.name.oldValue,i=e.changes.name.newValue;if(t&&i)return o()(y.FormattedMessage,{defaultMessage:'Changed name from "{oldValue}" to "{newValue}"',id:"auditlog.actionNames.eventColumn.preferred_name_changed",description:"An audit log that describes a change of a user's preferred name between two values",values:{oldValue:t,newValue:i}});if(!t&&i)return o()(y.FormattedMessage,{defaultMessage:'Set name to "{newValue}"',id:"auditlog.actionNames.eventColumn.preferred_name_changed_to_value",description:"An audit log that describes a change of a user's preferred name to a new value",values:{newValue:i}});if(t&&!i)return o()(y.FormattedMessage,{defaultMessage:'Removed name "{oldValue}"',id:"auditlog.actionNames.eventColumn.preferred_name_changed_from_value",description:"An audit log that describes a change of a user's preferred name from the old value",values:{oldValue:t}});return o()(y.FormattedMessage,{defaultMessage:"Name was changed",id:"auditlog.actionNames.eventColumn.preferred_name_changed_generic",description:"An audit log that describes a change of a user's preferred name"})}(e);case"email_changed":return o()(y.FormattedMessage,{defaultMessage:"Changed email from {oldEmail} to {newEmail}",id:"auditlog.actionNames.eventColumn.email_changed",description:"Email changed event for audit log",values:{oldEmail:e.changes.email.oldValue,newEmail:e.changes.email.newValue}});case"member_invited":{const t=Fi(e);return o()(y.FormattedMessage,{defaultMessage:"Invited {memberNameAndEmail} to the workspace as {newRole}",id:"auditlog.actionNames.eventColumn.member_invited",description:"An audit log that describe a user is invited to the workspace",values:{memberNameAndEmail:Mi(i,e),newRole:t.newRole}})}case"member_role_updated":{const t=Fi(e);return o()(y.FormattedMessage,{defaultMessage:"Updated {memberNameAndEmail} from {oldRole} to {newRole}",id:"auditlog.actionNames.eventColumn.member_role_updated",description:"An audit log that describe a member is updated with a role",values:{memberNameAndEmail:Mi(i,e),oldRole:t.oldRole,newRole:t.newRole}})}case"member_removed":return e.actor.actorId===e.target.user.id?o()(y.FormattedMessage,{defaultMessage:"Left the workspace",id:"auditlog.actionNames.eventColumn.member_left",description:"An audit log that describes when a member leaves the workspace"}):o()(y.FormattedMessage,{defaultMessage:"Removed {memberNameAndEmail} from the workspace",id:"auditlog.actionNames.eventColumn.member_removed",description:"An audit log that describe a member is removed access from the space",values:{memberNameAndEmail:Mi(i,e)}});case"guest_removed":return o()(y.FormattedMessage,{defaultMessage:"Removed guest {guestNameAndEmail} from the workspace",id:"auditlog.actionNames.eventColumn.guest_removed",description:"An audit log that describe a guest is removed access from the space",values:{guestNameAndEmail:Mi(i,e)}});case"file_uploaded":return o()(y.FormattedMessage,{defaultMessage:"Uploaded a file to {pageName}",id:"auditlog.actionNames.eventColumn.file_uploaded_public",description:"Uploaded a file to a non-private page event for audit log",values:{pageName:Bi(e,n)}});case"file_downloaded":return function(e,t){return o()(y.FormattedMessage,{defaultMessage:"Downloaded {fileName} from {pageName}",id:"auditlog.actionNames.eventColumn.file_downloaded",description:"An audit log that describes a user has downloaded a file from a page",values:{fileName:Gi(e,t),pageName:Bi(e,t)}})}(e,n);case"invite_link_toggled":return e.changes.enabled.newValue?o()(y.FormattedMessage,{id:"auditlog.actionNames.eventColumn.inviteLink.enabled",defaultMessage:"Enabled invite link",description:"Audit log for invite link enabled"}):o()(y.FormattedMessage,{id:"auditlog.actionNames.eventColumn.inviteLink.disabled",defaultMessage:"Disabled invite link",description:"Audit log for invite link disabled"});case"public_page_sharing_toggled":case"workspace_sidebar_editing_toggled":case"disable_guests_toggled":case"pages_to_other_workspaces_toggled":case"export_toggled":case"page_access_requests_toggled":return e.changes.enabled.newValue?o()(y.FormattedMessage,{id:"auditlog.actionNames.eventColumn.toggleEvent.disabled",defaultMessage:"Disabled {workspaceSetting}",description:"Audit log event for disabling a workspace setting",values:{workspaceSetting:i.formatMessage(bi[e.actionName])}}):o()(y.FormattedMessage,{id:"auditlog.actionNames.eventColumn.toggleEvent.enabled",defaultMessage:"Enabled {workspaceSetting}",description:"Audit log event for enabling a workspace setting",values:{workspaceSetting:i.formatMessage(bi[e.actionName])}});case"workspace_name_changed":return o()(y.FormattedMessage,{defaultMessage:"Changed workspace name from “{oldValue}“ to “{newValue}“",id:"auditlog.actionNames.eventColumn.workspace_name_changed",description:"An audit log that describes a change of the workspace name",values:{oldValue:e.changes.name.oldValue,newValue:e.changes.name.newValue}});case"workspace_domain_changed":return o()(y.FormattedMessage,{defaultMessage:"Changed workspace domain {oldValue} to “{newValue}“",id:"auditlog.actionNames.eventColumn.workspace_domain_changed",description:"An audit log that describes a change of the workspace domain",values:{oldValue:Di(e),newValue:e.changes.name.newValue}});case"workspace_integration_restriction_changed":return function(e){const t=void 0,{oldValue:i,newValue:n}=e.changes.integration_restrictions;if(n===t)return o()(y.FormattedMessage,{defaultMessage:"Enabled members installing integrations",id:"auditlog.actionNames.eventColumn.workspace_integration_restriction_changed.no_restrictions",description:"An audit log that describes a user has removed the workspace integration restrictions, which means workspace members can install any integration."});if(i===t&&"approved_only"===n)return o()(y.FormattedMessage,{defaultMessage:"Disabled members installing integrations",id:"auditlog.actionNames.eventColumn.workspace_integration_restriction_changed.approved_only",description:"An audit log that describes a user has turned on the workspace integration restrictions, which means workspace members can only install integrations pre-approved by an admin."});if("approved_or_built_by_notion"===i&&"approved_only"===n)return o()(y.FormattedMessage,{defaultMessage:"Disabled auto approval for built-by-Notion integrations",id:"auditlog.actionNames.eventColumn.workspace_integration_restriction_changed.disabled_built_by_notion.from_approved_or_built_by_notion",description:"An audit log that describes a user has turned off auto approval for built-by-Notion integrations."});if("approved_only"===i&&"approved_or_built_by_notion"===n)return o()(y.FormattedMessage,{defaultMessage:"Enabled auto approval for built-by-Notion integrations",id:"auditlog.actionNames.eventColumn.workspace_integration_restriction_changed.enabled_built_by_notion",description:"An audit log that describes a user has turned on auto approval for built-by-Notion integrations."});return o()(y.FormattedMessage,{defaultMessage:"Changed workspace integration restriction",id:"auditlog.actionNames.eventColumn.workspace_integration_restriction_changed.fallback_message",description:"An audit log that describes workspace integration restrictions is changed."})}(e);case"allowed_email_domain_added":return o()(y.FormattedMessage,{defaultMessage:"Added “{addedValue}“ into allowable email domains",id:"auditlog.actionNames.eventColumn.allowed_email_domain_added",description:"An audit log that describes the adding of an allowed email domain to a workspace",values:{addedValue:e.changes.domain}});case"allowed_email_domain_removed":return o()(y.FormattedMessage,{defaultMessage:"Removed “{removedValue}“ from allowable email domains",id:"auditlog.actionNames.eventColumn.allowed_email_domain_removed",description:"An audit log that describes the removing of an allowed email domain to a workspace",values:{removedValue:e.changes.domain}});case"public_page_set":return e.changes.name.oldValue?o()(y.FormattedMessage,{defaultMessage:"Changed public home page from “{oldPage}“ to “{newPage}“",id:"auditlog.actionNames.eventColumn.public_page_changed",description:"An audit log that describes the changing of a public home page for a workspace",values:{oldPage:e.changes.name.oldValue,newPage:e.changes.name.newValue}}):o()(y.FormattedMessage,{defaultMessage:"Set “{newPage}“ as public home page",id:"auditlog.actionNames.eventColumn.public_page_set",description:"An audit log that describes the setting of a public home page for a workspace",values:{newPage:e.changes.name.newValue}});case"idp_metadata_url_updated":return e.changes.url.oldValue?o()(y.FormattedMessage,{defaultMessage:'Changed IDP metadata URL from "{oldValue}" to "{newValue}"',id:"auditlog.actionNames.eventColumn.idp_metadata_url_updated",description:"An audit log that describes when an IDP metadata URL is updated",values:{oldValue:e.changes.url.oldValue,newValue:e.changes.url.newValue}}):o()(y.FormattedMessage,{defaultMessage:'Set IDP metadata URL to "{newValue}"',id:"auditlog.actionNames.eventColumn.idp_metadata_url_set",description:"An audit log that describes when an IDP metadata URL is first set",values:{newValue:e.changes.url.newValue}});case"saml_toggled":return e.changes.enabled.newValue?m().createElement(y.FormattedMessage,bi.saml_enabled):m().createElement(y.FormattedMessage,bi.saml_disabled);case"saml_enforce_toggled":return e.changes.enabled.newValue?m().createElement(y.FormattedMessage,bi.saml_enforced):m().createElement(y.FormattedMessage,bi.saml_unenforced);case"automatic_account_creation_toggled":return e.changes.enabled.newValue?m().createElement(y.FormattedMessage,bi.automatic_account_creation_enabled):m().createElement(y.FormattedMessage,bi.automatic_account_creation_disabled);case"workspace_creation_set_for_email_domain":return function(e,t){const{oldValue:i,newValue:n}=e.changes.workspace_creation;if(!i&&!n)return o()(y.FormattedMessage,{defaultMessage:"Changed workspace creation setting",id:"auditlog.actionNames.eventColumn.workspace_creation_set_for_email_domain.fallback_message",description:"An audit log that describes changes for the workspace creation prevention setting without indicating the old or new values."});const s=e.changes.workspace_creation.oldValue?t.formatMessage({id:"auditLogEntry.changes.workspaceCreation.beforeSetting",defaultMessage:" from {prevWorkspaceCreationSetting}",description:"Description of previous workspace creation setting"},{prevWorkspaceCreationSetting:(0,gi.nJ)(e.changes.workspace_creation.oldValue,t)}):"",a=e.changes.workspace_creation.newValue?t.formatMessage({id:"auditLogEntry.changes.workspaceCreation.afterSetting",defaultMessage:" to {afterWorkspaceCreationSetting}",description:"Description of current workspace creation setting"},{afterWorkspaceCreationSetting:(0,gi.nJ)(e.changes.workspace_creation.newValue,t)}):"";return o()(y.FormattedMessage,{defaultMessage:"Changed workspace creation setting{before}{after}.",id:"auditlog.actionNames.eventColumn.workspace_creation_set_for_email_domain",description:"An audit log that describes changes for the workspace creation prevention setting providing the old and new values.",values:{before:s,after:a}})}(e,i);case"member_added_to_group":return o()(y.FormattedMessage,{defaultMessage:"Added {memberNameAndEmail} to {groupName}",id:"auditlog.actionNames.eventColumn.member_added_to_group",description:"An audit log that describes that a user was added to a group.",values:{memberNameAndEmail:Mi(i,e),groupName:Ti(e.target.group)}});case"member_removed_from_group":return o()(y.FormattedMessage,{defaultMessage:"Removed {memberNameAndEmail} from {groupName}",id:"auditlog.actionNames.eventColumn.member_removed_from_group",description:"An audit log that describes that a user was removed from a group.",values:{memberNameAndEmail:Mi(i,e),groupName:Ti(e.target.group)}});case"space_transfer_status_changed":return function(e,t){const{oldValue:i,newValue:n}=e.changes.spaceTransferStatus,s=e.target.space.name?t.formatMessage({id:"auditLogEntry.changes.space_transfer_status_changed.space_name",defaultMessage:" for {spaceName}",description:"Description of the workspace that had a space transfer status change"},{spaceName:e.target.space.name}):"";if(!i&&!n)return o()(y.FormattedMessage,{defaultMessage:"Workspace transfer status changed{spaceNameMessage}",id:"auditlog.actionNames.eventColumn.space_transfer_status_changed.fallback_message",description:"An audit log that describes changes for space transfer status without indicating the old or new values.",values:{spaceNameMessage:s}});if(!n)return o()(y.FormattedMessage,{defaultMessage:"Workspace transfer request cleared{spaceNameMessage} from prior status of {oldStatus}",id:"auditlog.actionNames.eventColumn.space_transfer_status_cleared",description:"An audit log that describes the space transfer requested being removed.",values:{spaceNameMessage:s,oldStatus:i}});return o()(y.FormattedMessage,{defaultMessage:"{newStatus, select, requested {Workspace transfer request initiated{spaceNameMessage}.} started {Workspace transfer started{spaceNameMessage}} completed {Workspace transfer completed{spaceNameMessage}} other {Workspace transfer status change to {newStatus}{spaceNameMessage}}}",id:"auditlog.actionNames.eventColumn.space_transfer_status_changed.newStatus",description:"An audit log that describes the space transfer requested being removed.",values:{spaceNameMessage:s,newStatus:n}})}(e,i);case"space_claim_and_upgrade_status_changed":return function(e){const{oldValue:t,newValue:i}=e.changes.claimAndUpgradeStatus,n=o()(y.FormattedMessage,{defaultMessage:"Status changed for workspace claim of {workspaceName}",id:"auditlog.actionNames.eventColumn.space_claim_upgrade_status_changed.fallback_message",description:"An audit log that describes changes for space claim and upgrade status without indicating the old or new values.",values:{workspaceName:e.target.space.name}});if(!t&&!i)return n;if(!i&&"completed"!==t)return o()(y.FormattedMessage,{defaultMessage:"Pending workspace claim for {workspaceName} has been cleared from {oldStatus}",id:"auditlog.actionNames.eventColumn.space_claim_upgrade_status_cleared",description:"An audit log that describes the space claim and upgrade request being removed.",values:{workspaceName:e.target.space.name,oldStatus:t}});if("completed"===i)return o()(y.FormattedMessage,{defaultMessage:"{workspaceName} has been claimed and upgraded to the Enterprise plan",id:"auditlog.actionNames.eventColumn.space_claim_upgrade_status_completed",description:"An audit log that describes the space claim and upgrade request being completed.",values:{workspaceName:e.target.space.name}});if("requested"===i)return o()(y.FormattedMessage,{defaultMessage:"Request to claim and upgrade {workspaceName} has been sent.",id:"auditlog.actionNames.eventColumn.space_claim_upgrade_requested",description:"An audit log that describes the space claim and upgrade request being initiated.",values:{workspaceName:e.target.space.name}});return n}(e);case"membership_requests_toggled":return o()(y.FormattedMessage,{defaultMessage:"{enabled} allowing members to request adding new members",id:"auditlog.actionNames.eventColumn.membership_requests_toggled",description:"An audit log that describes that the membership requests setting was toggled.",values:{enabled:Vi(e)}});case"membership_request_resolved":return o()(y.FormattedMessage,{defaultMessage:"{status} request to add {email} to the workspace as a member",id:"auditlog.actionNames.eventColumn.membership_request_resolved",description:"An audit log that describes that a membership request was resolved.",values:{status:zi(e),email:Mi(i,e)}});case"team_created":return o()(y.FormattedMessage,{defaultMessage:"Created {teamName}",id:"auditlog.actionNames.eventColumn.team_created",description:"An audit log that describes that a team was created.",values:{teamName:Zi(e,n)}});case"team_archived":return o()(y.FormattedMessage,{defaultMessage:"Archived {teamName}",id:"auditlog.actionNames.eventColumn.team_archived",description:"An audit log that describes that a team was archived.",values:{teamName:Zi(e,n)}});case"team_restored":return o()(y.FormattedMessage,{defaultMessage:"Restored {teamName}",id:"auditlog.actionNames.eventColumn.team_restored",description:"An audit log that describes that a team was restored.",values:{teamName:Zi(e,n)}});case"team_default_toggled":return e.changes.enabled.newValue?o()(y.FormattedMessage,{defaultMessage:"Added {teamName} to the default teamspace list. Workspace members will automatically be added to the teamspace",id:"auditlog.actionNames.eventColumn.team_default_enabled",description:"An audit log that describes that a teamspace was set to be default which enabled all workspace members to be automatically added to this teamspace.",values:{teamName:Zi(e,n)}}):o()(y.FormattedMessage,{defaultMessage:"Removed {teamName} from the default teamspace list. Workspace members will no longer be automatically added to the teamspace",id:"auditlog.actionNames.eventColumn.team_default_disabled",description:"An audit log that describes that a teamspace was removed from being default which disables all workspace members from being automatically added to this teamspace.",values:{teamName:Zi(e,n)}});case"team_public_page_sharing_toggled":return e.changes.enabled.newValue?m().createElement(m().Fragment,null,o()(y.FormattedMessage,{defaultMessage:"Disabled members sharing pages under {teamName} publicly",id:"auditlog.actionNames.eventColumn.team_public_page_sharing_disabled",description:"An audit log that describes that public page sharing was switched off for a team",values:{teamName:Zi(e,n)}}),ki(null!==(r=null===(l=e.meta)||void 0===l?void 0:l.spacePublicPageSharingDisabled)&&void 0!==r?r:null==e?void 0:e.spacePublicPageSharingDisabled,e.changes.enabled.newValue)):m().createElement(m().Fragment,null,o()(y.FormattedMessage,{defaultMessage:"Enabled members sharing pages under {teamName} publicly",id:"auditlog.actionNames.eventColumn.team_public_page_sharing_enabled",description:"An audit log that describes that public page sharing was switched on for a team",values:{teamName:Zi(e,n)}}),ki(null!==(d=null===(c=e.meta)||void 0===c?void 0:c.spacePublicPageSharingDisabled)&&void 0!==d?d:null==e?void 0:e.spacePublicPageSharingDisabled,e.changes.enabled.newValue));case"team_export_toggled":return e.changes.enabled.newValue?m().createElement(m().Fragment,null,o()(y.FormattedMessage,{defaultMessage:"Disabled export for {teamName}",id:"auditlog.actionNames.eventColumn.team_export_disabled",description:"An audit log that describes that exports were disabled for a team",values:{teamName:Zi(e,n)}}),ki(null!==(u=null===(p=e.meta)||void 0===p?void 0:p.spaceExportDisabled)&&void 0!==u?u:null==e?void 0:e.spaceExportDisabled,e.changes.enabled.newValue)):m().createElement(m().Fragment,null,o()(y.FormattedMessage,{defaultMessage:"Enabled export for {teamName}",id:"auditlog.actionNames.eventColumn.team_export_enabled",description:"An audit log that describes that exports were enabled for a team",values:{teamName:Zi(e,n)}}),ki(null!==(g=null===(h=e.meta)||void 0===h?void 0:h.spaceExportDisabled)&&void 0!==g?g:null==e?void 0:e.spaceExportDisabled,e.changes.enabled.newValue));case"team_sidebar_editing_toggled":return e.changes.enabled.newValue?o()(y.FormattedMessage,{defaultMessage:"Disabled members changing the sidebar section for {teamName}",id:"auditlog.actionNames.eventColumn.team_sidebar_editing_disabled",description:"An audit log that describes that changing the sidebar section was disabled for a team",values:{teamName:Zi(e,n)}}):o()(y.FormattedMessage,{defaultMessage:"Enabled members changing the sidebar section for {teamName}",id:"auditlog.actionNames.eventColumn.team_sidebar_editing_enabled",description:"An audit log that describes that changing the sidebar section was enabled for a team",values:{teamName:Zi(e,n)}});case"team_creation_admins_setting_toggled":return e.changes.enabled.newValue?o()(y.FormattedMessage,{defaultMessage:"Disabled members creating teamspaces",id:"auditlog.actionNames.eventColumn.team_creation_admins_setting_disabled",description:"An audit log that describes that the ability for everyone in the workspace to create a team was disabled",values:{teamName:Zi(e,n)}}):o()(y.FormattedMessage,{defaultMessage:"Enabled members creating teamspaces",id:"auditlog.actionNames.eventColumn.team_creation_admins_setting_enabled",description:"An audit log that describes that the ability for everyone in the workspace to create a team was enabled",values:{teamName:Zi(e,n)}});case"team_guests_toggled":return e.changes.enabled.newValue?m().createElement(m().Fragment,null,o()(y.FormattedMessage,{defaultMessage:"Disabled guests for {teamName}",id:"auditlog.actionNames.eventColumn.team_guests_toggled_disabled",description:"An audit log that describes that the ability for everyone in the workspace to create a team was disabled",values:{teamName:Zi(e,n)}}),ki(null!==(f=null===(v=e.meta)||void 0===v?void 0:v.spaceDisableGuests)&&void 0!==f?f:e.spaceDisableGuests,e.changes.enabled.newValue)):m().createElement(m().Fragment,null,o()(y.FormattedMessage,{defaultMessage:"Enabled guests for {teamName}",id:"auditlog.actionNames.eventColumn.team_guests_toggled_enabled",description:"An audit log that describes that the ability for everyone in the workspace to create a team was enabled",values:{teamName:Zi(e,n)}}),ki(null!==(S=null===(b=e.meta)||void 0===b?void 0:b.spaceDisableGuests)&&void 0!==S?S:e.spaceDisableGuests,e.changes.enabled.newValue));case"team_name_changed":return o()(y.FormattedMessage,{defaultMessage:"Changed teamspace name {oldTeamNameToNewTeamName}",id:"auditlog.actionNames.eventColumn.team_name_changed",description:"An audit log that describes that a team name was changed.",values:{oldTeamNameToNewTeamName:Ii(e,n)}});case"team_description_changed":return o()(y.FormattedMessage,{defaultMessage:"Changed description of {teamName}",id:"auditlog.actionNames.eventColumn.team_description_changed",description:"An audit log that describes that a team description was changed.",values:{teamName:Zi(e,n)}});case"team_icon_changed":return o()(y.FormattedMessage,{defaultMessage:"Changed icon of {teamName}",id:"auditlog.actionNames.eventColumn.team_icon_changed",description:"An audit log that describes that a team icon was changed.",values:{teamName:Zi(e,n)}});case"member_added_to_team":return o()(y.FormattedMessage,{defaultMessage:"Invited {memberNameAndEmail} to {teamName} as {teamRole}",id:"auditlog.actionNames.eventColumn.member_added_to_team",description:"An audit log that describes that a user was added to a team.",values:{memberNameAndEmail:Mi(i,e),teamName:Zi(e,n),teamRole:_i(e.changes.teamRole.newValue)}});case"group_added_to_team":return o()(y.FormattedMessage,{defaultMessage:"Invited {groupName} to {teamName} as teamspace member",id:"auditlog.actionNames.eventColumn.group_added_to_team",description:"An audit log that describes that a group was added to a teamspace.",values:{groupName:Ti(e.target.group),teamName:Zi(e,n)}});case"member_removed_from_team":return o()(y.FormattedMessage,{defaultMessage:"Removed {memberNameAndEmail} from {teamName}",id:"auditlog.actionNames.eventColumn.member_removed_from_team",description:"An audit log that describes that a user was removed from a team.",values:{memberNameAndEmail:Mi(i,e),teamName:Zi(e,n)}});case"group_removed_from_team":return o()(y.FormattedMessage,{defaultMessage:"Removed {groupName} from {teamName}",id:"auditlog.actionNames.eventColumn.group_removed_from_team",description:"An audit log that describes that a group was removed from a team.",values:{groupName:Ti(e.target.group),teamName:Zi(e,n)}});case"member_joined_team":return o()(y.FormattedMessage,{defaultMessage:"Joined {teamName} as {teamRole}",id:"auditlog.actionNames.eventColumn.member_joined_team",description:"An audit log that describes that a user joined a team.",values:{teamName:Zi(e,n),teamRole:_i(e.changes.teamRole.newValue)}});case"member_left_team":return o()(y.FormattedMessage,{defaultMessage:"Left {teamName}",id:"auditlog.actionNames.eventColumn.member_left_team",description:"An audit log that describes that a user left a team.",values:{teamName:Zi(e,n)}});case"member_team_role_updated":return o()(y.FormattedMessage,{defaultMessage:"Updated {memberNameAndEmail} from {oldTeamRole} to {newTeamRole} in {teamName}",id:"auditlog.actionNames.eventColumn.member_team_role_updated",description:"An audit log that describe a user's role in a team was updated.",values:{memberNameAndEmail:Mi(i,e),oldTeamRole:_i(e.changes.teamRole.oldValue),newTeamRole:_i(e.changes.teamRole.newValue),teamName:Zi(e,n)}});case"team_member_default_permission_updated":return o()(y.FormattedMessage,{defaultMessage:"Updated default page permissions for teamspace members in {teamName} from {oldRole} to {newRole}",id:"auditlog.actionNames.eventColumn.team_member_default_permission_updated",description:"An audit log event that describes default page permissions for teamspace members in a teamspace were updated.",values:{teamName:Zi(e,n),oldRole:xi(null===(M=e.changes)||void 0===M||null===(w=M.permission)||void 0===w?void 0:w.oldValue),newRole:xi(null===(C=e.changes)||void 0===C||null===(k=C.permission)||void 0===k?void 0:k.newValue)}});case"team_workspace_default_permission_updated":return o()(y.FormattedMessage,{defaultMessage:"Updated default page permissions for everyone else in the workspace for {teamName} from {oldRole} to {newRole}",id:"auditlog.actionNames.eventColumn.team_workspace_default_permission_updated",description:"An audit log event that describes that page permissions for a team were updated for the workspace.",values:{teamName:Zi(e,n),oldRole:xi(null===(T=e.changes)||void 0===T||null===(I=T.permission)||void 0===I?void 0:I.oldValue),newRole:xi(null===(Z=e.changes)||void 0===Z||null===(P=Z.permission)||void 0===P?void 0:P.newValue)}});case"team_privacy_type_changed":return o()(y.FormattedMessage,{defaultMessage:"Changed the teamspace privacy type for {teamName} from {oldType} to {newType}",id:"auditlog.actionNames.eventColumn.team_privacy_type_changed",description:"An audit log event that describes that the privacy type for a teamspace was updated.",values:{teamName:Zi(e,n),oldType:Wi(null===(_=e.changes)||void 0===_?void 0:_.teamAccessLevel.oldValue),newType:Wi(null===(x=e.changes)||void 0===x?void 0:x.teamAccessLevel.newValue)}});case"team_invite_access_changed":return o()(y.FormattedMessage,{defaultMessage:"Changed who can invite teamspace members to {newType} for {teamName}",id:"auditlog.actionNames.eventColumn.team_invite_access_changed",description:"An audit log event that describes that the privacy type for a teamspace was updated.",values:{teamName:Zi(e,n),newType:(B=null===(F=e.changes)||void 0===F||null===(A=F.teamInviteAccess)||void 0===A?void 0:A.newValue,B?m().createElement(y.FormattedMessage,qi[B]):m().createElement(y.FormattedMessage,qi.unknown))}});case"private_content_transferred":return o()(y.FormattedMessage,{defaultMessage:"Transferred private content from {fromUserName} to {toUserName}",id:"auditLog.actionNames.eventColumn.private_content_transferred",description:"An audit log event describing when private page content is transferred from one user to another",values:{fromUserName:wi(i,e.changes.userPermission.oldValue),toUserName:wi(i,e.changes.userPermission.newValue)}});case"workspace_exported":case"workspace_icon_changed":case"public_page_cleared":case"logout":case"password_changed":case"password_cleared":case"password_set":case"picture_changed":case"revoked_support_access":case"user_deleted":case"member_joined":case"invite_link_toggled":case"scim_token_generated":case"scim_token_revoked":case"invite_link_reset":case"idp_metadata_xml_removed":case"idp_metadata_xml_updated":case"teams_enabled_for_space":return m().createElement(y.FormattedMessage,bi[e.actionName]);default:if("local"!==t)return ui.log({level:"error",from:"auditLogEvent",type:"AuditLogEvent",data:{miscDataToConvertToString:{data:e}}}),m().createElement(m().Fragment,null);(0,H.t1)(e)}}function Gi(e,t){const{name:i,extension:n}=e.target.file;return!(!t&&vi(e.target.page))&&i?"“".concat(i,"“"):n?m().createElement(y.FormattedMessage,a()({},bi.a_file_with_extension,{values:{extension:n}})):m().createElement(y.FormattedMessage,bi.a_file)}function Ki(e){const{auditLogEntry:t,id:i}=e,[n,s]=(0,u.useState)(""),r=(0,y.useIntl)();return(0,u.useEffect)((()=>{const e=document.getElementById(i);s((null==e?void 0:e.textContent)||"")}),[i]),o()(Ue.Z,{style:{whiteSpace:"normal"},delayThreshold:80,renderTooltip:()=>o()(Yi,{text:n,auditLogEntry:t}),placement:Ue.Z.Placement.Bottom,render:e=>m().createElement("div",a()({},e,{style:{fontSize:14,...v.Z.textOverflowStyle},id:i}),o()(ji,{auditLogEntry:t,env:Kt.Z.env,intl:r}))})}function ji(e){const{auditLogEntry:t,env:i,intl:n}=e;return Hi(t,i,n,(0,Me.VK)((()=>"on"===re.default.getGroup("show_private_names_in_audit_log")),[]))}function Yi(e){var t,i;const{auditLogEntry:n,text:s}=e,a=(0,y.useIntl)(),r=(0,Me.VK)((()=>"on"===re.default.getGroup("show_private_names_in_audit_log")),[]),l=Lt({auditLogEntry:n,intl:a});return o()("div",{},void 0,s,(null===(t=n.actor.meta)||void 0===t?void 0:t.ipAddress)&&o()("div",{},void 0,o()(y.FormattedMessage,{description:"User's IP address in audit log",defaultMessage:"IP address: {ip}",values:{ip:null===(i=n.actor.meta)||void 0===i?void 0:i.ipAddress},id:"auditLogSettings.metadata.ipAddress"})),o()("div",{},void 0,Rt(n,a)),r&&l&&o()(y.FormattedMessage,{id:"auditLogColumnEvent.tooltip.audienceMessage",description:"Message in tooltip describing audience for permission change events",defaultMessage:"Page audience: {audience}",values:{audience:l}}))}function Qi(e){const{children:t,disabled:i,onClick:n}=e;return o()(Je.Z,{onClick:n,disabled:i,style:{justifyContent:"center",marginLeft:6},isBlue:!i,isLightGray:i},void 0,t)}function Xi(e){const{sortOrder:t}=e,i={width:10,height:10,marginRight:4,fill:"currentColor"};return t===K.CreatedOldest?h.Z.arrowDownSmall({...i,transform:"rotate(180deg)"}):h.Z.arrowDownSmall(i)}function Ji(e){const{auditLogEntry:t,ids:i,shouldShowPrivateNames:n}=e,s=(0,y.useIntl)(),r=(0,be.O7)(),l=(0,ei.F)(),d=(0,ei.y)((e=>({button:{display:"flex",alignItems:"center",justifyContent:"center",width:32,height:28,borderRadius:3}})),[]),c=(0,ii.u)();return o()(Ue.Z,{delayThreshold:80,placement:Ue.Z.Placement.Bottom,render:e=>m().createElement(ni.Z,a()({style:d.button,onClick:()=>{var e;(0,ti.RD)({environment:r,stringValue:Dt({auditLogEntry:t,intl:s,dateTimezone:q.x7,getAuditLogEventText:(e=i.eventColumnId,t=>{var i;return null===(i=document.getElementById(e))||void 0===i?void 0:i.textContent}),shouldShowWorkspaceOwner:c,shouldShowPrivateNames:n}),copiedMessage:ti.tq.copiedToClipboard})}},e),h.Z.copy({width:16,height:16,fill:l.mediumIconColor})),renderTooltip:()=>o()(y.FormattedMessage,{id:"AuditLogSettings.copyAuditLogEvent",description:"Tooltip that shows up when you hover over the copy button for copying a row",defaultMessage:"Copy row"})})}const $i=(0,y.injectIntl)((function(e){const{searchResponse:t,spaceStore:i}=e,n=i.id,[s,r]=(0,Me.oR)(ne),l=t.results||[],d=t.hasMoreResults,c=Boolean(l.length),u=null==l?void 0:l.map((e=>({auditLogEntry:e,actorStore:(0,bt.Kv)(i,{id:e.actor.actorId,table:e.actor.actorType,spaceId:n})}))),p=e=>{const t={...s,pageNum:e};r(t)},g=(0,Me.VK)((()=>"on"===re.default.getGroup("show_private_names_in_audit_log")),[]);return m().createElement(m().Fragment,null,o()(si.Z,{tableStyle:{tableLayout:"fixed"},cellStyle:{wordWrap:"break-word",paddingTop:6,paddingBottom:6},columns:[{key:"user",header:o()(y.FormattedMessage,{id:"auditlog.logTable.userColumn.header",defaultMessage:"User"}),style:{width:"30%",paddingLeft:35}},{key:"event",header:o()(y.FormattedMessage,{id:"auditlog.logTable.eventColumn.header",defaultMessage:"Event"}),style:{width:"40%"}},{key:"Date",header:o()(ni.Z,{disabled:!1,ignoreLocalHoverState:!0,onClick:()=>{const e=s.sortOrder===K.CreatedOldest?K.CreatedNewest:K.CreatedOldest;r({...s,sortOrder:e,pageNum:1})},style:{display:"flex",alignItems:"center"}},void 0,o()(Xi,{sortOrder:s.sortOrder}),o()(y.FormattedMessage,{id:"auditlog.logTable.dateColumn.header",defaultMessage:"Date"})),style:{width:"25%"}},{key:"otherActions",header:o()("span",{}),style:{width:"5%"}}],rows:u.map(((e,t)=>{const i="actor-".concat(e.auditLogEntry.actionName,"-").concat(t),n="event-".concat(e.auditLogEntry.actionName,"-").concat(t),s="datetime-".concat(e.auditLogEntry.actionName,"-").concat(t);return{key:t.toString(),columns:[m().createElement(ri,a()({},e,{id:i})),o()(Ki,{auditLogEntry:e.auditLogEntry,id:n}),o()(ci,{auditLogEntry:e.auditLogEntry,id:s}),o()(Ji,{auditLogEntry:e.auditLogEntry,ids:{actorColumnId:i,eventColumnId:n,dateTimeColumnId:s},shouldShowPrivateNames:g})]}}))}),c?o()("div",{style:{display:"flex",justifyContent:"flex-end",marginTop:10}},void 0,o()(Qi,{onClick:()=>{p(s.pageNum-1)},disabled:1===s.pageNum},void 0,o()(y.FormattedMessage,{id:"auditlog.logTable.previousPage",defaultMessage:"Previous"})),o()(Qi,{disabled:!d,onClick:()=>{p(s.pageNum+1)}},void 0,o()(y.FormattedMessage,{id:"auditlog.logTable.nextPage",defaultMessage:"Next"}))):o()("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",minHeight:"40vh",flexDirection:"column"}},void 0,o()("div",{},void 0,o()(oi.Z,{isSecondaryColor:!0,style:{fontWeight:500}},void 0,o()(y.FormattedMessage,{id:"auditlog.logTable.noResults",defaultMessage:"No results"}))),o()(oi.Z,{isSecondaryColor:!0},void 0,o()(y.FormattedMessage,{id:"auditlog.logTable.noResultsHelpText",defaultMessage:"Try different filters. Logs may take some time to show up."}))))}));const en=(0,y.injectIntl)((function(e){const{spaceStore:t}=e,i=(0,be.O7)(),n=null==t?void 0:t.id,[s]=(0,Me.oR)(ae),[a]=(0,Me.oR)(ne),r=oe(a)!==s.filterStr?void 0:s.cachedResponses[a.pageNum];return(0,u.useEffect)((()=>{n&&(async e=>{var t,i;const{environment:n,spaceId:o}=e,s=ne.getState();ae.startLoading(o,s);const{sortOrder:a,pageSize:r,pageNum:l}=s,d={spaceId:o,limit:r,cursor:ae.getCursor(o,s,l),filters:{timeRange:{starting:s.timeRange.starting?q.OQ.toUnixMs(s.timeRange.starting):void 0,ending:s.timeRange.ending?q.OQ.toUnixMs(s.timeRange.ending):void 0},...(null===(t=s.actors)||void 0===t?void 0:t.length)>0?{actors:s.actors}:void 0,...(null===(i=s.actions)||void 0===i?void 0:i.length)>0?{actions:s.actions}:void 0},sort:a||K.CreatedNewest},c=await w.searchAuditLog(n,d);"success"!==c.type?(ae.updateError(o,s),C.showErrorMessage(Te.default.formatMessage(Pe.loadCurrentAuditLogError))):ae.updateLoadedResult(o,s,c.data)})({environment:i,spaceId:n})}),[i,n,a]),(0,u.useEffect)((()=>{(async e=>{const{environment:t,spaceId:i}=e;if(Ze.getState().spaceId!==i&&Ze.reset(),!i)return;const[n,o]=await Promise.all([ke.Te({environment:t,membersOnly:!1}),_e({environment:t,spaceId:i})]),s={spaceId:i,allUserIds:new Set,allBotIds:new Set,removedUserIds:new Set,removedBotIds:new Set};n.userIds.forEach((e=>{s.allUserIds.add(e)})),n.botIds.forEach((e=>{s.allBotIds.add(e)})),o.forEach((e=>{e.actorType!==Ce.KJ||s.allUserIds.has(e.actorId)?e.actorType!==we.cZ||s.allBotIds.has(e.actorId)||(s.allBotIds.add(e.actorId),s.removedBotIds.add(e.actorId)):(s.allUserIds.add(e.actorId),s.removedUserIds.add(e.actorId))})),Ze.setState(s)})({environment:i,spaceId:n})}),[i,n]),m().createElement(m().Fragment,null,o()(Qt,{}),o()("div",{style:{justifyContent:"space-between",display:"flex",paddingTop:12,paddingBottom:12}},void 0,o()(Gt,{spaceStore:t}),o()(qe,{})),"loading"===(null==r?void 0:r.status)&&o()($t,{}),"success"===(null==r?void 0:r.status)&&o()($i,{searchResponse:r,spaceStore:t}))}));var tn=i(26255),nn=i(76463),on=i(72087),sn=(i(85827),i(74181)),an=i(9953),rn=i(4615),ln=i(9844),dn=i(51878),cn=i(88632),un=i(28992),mn=i(31278),pn=i(77137),gn=i(78948);function hn(e){const{query:t}=e,i=(0,be.O7)(),n=(0,Me.VK)((()=>F.default.state.currentSpaceStore),[]),s=(0,Me.VK)((()=>null==n?void 0:n.getBotSettingsStore().getValue()),[n]),r="approved_or_built_by_notion"===(null==s?void 0:s.integration_restrictions),l=(0,Me.VK)((()=>null!=s&&s.integration_approval_statuses?Object.keys(s.integration_approval_statuses):[]),[s]),d=(0,Me.VK)((()=>Object.values(dn.iK).map((e=>{let{id:t}=e;const i=null==n?void 0:n.getRecordValue({id:t,table:ln.K2});if("published"===(null==i?void 0:i.status))return t})).filter(H.$K)),[n]),c=(0,Me.VK)((()=>d.filter((e=>!l.includes(e))).slice(0,5)),[l,d]);return o()(De.Z,{menuType:Fe.o.Popup,width:255,header:vn(t,c,r)},void 0,o()(pn.Z,{request:t,performRequest:e=>async function(e){const{query:t,environment:i,spaceId:n,approvedIntegrationIds:o,popularIntegrationIds:s,autoApproveBuiltByNotion:a}=e;if(!cn.Z.state.online||!n)return[];if((0,rn.e)(t)||(0,rn.qn)(t))return[t];if(""===t&&!a)return s;const r=await w.searchIntegrations(i,{query:t});if("success"===r.type){const e=r.data.integrationIds.filter((e=>!o.includes(e))),t=Kt.Z.env;if(!a){return e.sort(((e,i)=>(0,dn.BP)({integrationId:e,env:t})===(0,dn.BP)({integrationId:i,env:t})?0:(0,dn.BP)({integrationId:e,env:t})?-1:1)).slice(0,5)}return e.filter((e=>!(0,dn.BP)({integrationId:e,env:t}))).slice(0,5)}if("failed"===r.type)throw r.error;return(0,H.t1)(r)}({query:e,environment:i,spaceId:null==n?void 0:n.id,approvedIntegrationIds:l,popularIntegrationIds:c,autoApproveBuiltByNotion:r}),debounce:ke.vp,render:(r,d,c)=>{if(!d||!c)return o()(Ne.Z,{},void 0,o()(gn.Z,{}));const u=sn.ns.filter((e=>t&&e.name.toLowerCase().includes(t.toLowerCase())&&!l.includes(e.id))),p=[];if(0===d.length&&0===u.length)p.push({key:"no_results",render:()=>o()(oi.Z,{isSmall:!0,style:{marginLeft:8}},void 0,o()(y.FormattedMessage,{id:"adminIntegrationSettings.search.label.noResults",defaultMessage:"No results"})),action:()=>{}});else{const t=d.map((t=>{const r={table:ln.K2,id:t},l=null==n?void 0:n.getRecordValue(r);if(l)return{key:"".concat(t),render:e=>m().createElement(Re.Z,a()({},e,{title:o()(oi.Z,{style:{fontWeight:v.Z.fontWeight.semibold}},void 0,l.name),icon:l.info.icon&&o()(mn.Z,{disabled:!0,icon:{pointer:r,icon:l.info.icon},isEmptyPage:!1,size:20}),style:l.info.icon?{paddingBottom:12}:{paddingLeft:30,paddingBottom:12},shouldWrapCaption:!0,caption:o()(yn,{tagline:null==l?void 0:l.info.tagline,isNotionIntegration:(0,dn.BP)({integrationId:l.id,env:Kt.Z.env})}),className:"notranslate"})),action:()=>{e.closeDropdown(),fn({environment:i,currentSpaceStore:n,botSettings:s,integrationId:t})}}})).filter(H.$K),r=u.map((t=>({key:"".concat(t.id),render:e=>m().createElement(Re.Z,a()({},e,{title:o()(oi.Z,{style:{fontWeight:v.Z.fontWeight.semibold}},void 0,t.name),icon:o()("img",{src:t.info.icon,style:{height:20}}),caption:t.info.tagline,style:{paddingBottom:12},shouldWrapCaption:!0,className:"notranslate"})),action:()=>{e.closeDropdown(),fn({environment:i,currentSpaceStore:n,botSettings:s,integrationId:t.id})}}))).filter(H.$K);p.push(...t,...r)}return o()(Le.Z,{type:Le.i.Vertical,initialFocus:0,sections:[{key:"results",render:e=>m().createElement(Ne.Z,e),items:p}]})}}))}function fn(e){const{environment:t,currentSpaceStore:i,botSettings:n,integrationId:o}=e;if(i){const e={...null==n?void 0:n.integration_approval_statuses,[o]:{type:"integration",status:"approved"}};(0,A.createAndCommit)({userAction:"AdminIntegrationSettingsSearchResults.handleIntegrationSelection",environment:t,perform:t=>{(0,an.sW)({store:i,data:{bot_settings:{...n,integration_approval_statuses:e}},transaction:t})}})}}const vn=(e,t,i)=>!e&&!i&&t.length>0&&o()(un.Z,{title:o()(oi.Z,{isSmall:!0,style:{marginTop:4,fontWeight:v.Z.fontWeight.medium}},void 0,o()(y.FormattedMessage,{defaultMessage:"Popular integrations",id:"adminIntegrationSettings.search.title.popularIntegrations"}))}),yn=e=>{const{tagline:t,isNotionIntegration:i}=e,n=(0,ei.F)(),s=i?{}:{maxHeight:48,overflow:"scroll"};return t?o()("div",{style:s},void 0,t,i&&o()("div",{style:{display:"flex",alignItems:"center",marginTop:8}},void 0,o()(y.FormattedMessage,{defaultMessage:"Developed by Notion",id:"adminIntegrationSettings.search.subtitle.notionBuilt"}),h.Z.integrationSecurity({marginLeft:3,width:12,height:12,fill:n.invoiceGreen}))):null},Sn=(0,y.defineMessages)({searchInputPlaceholder:{id:"adminConnectionsSettings.search.input.placeholder",defaultMessage:"Add by name or integration ID",description:"Placeholder text for 'Add approved connection' search bar"}});function bn(){const e=(0,be.O7)(),t=(0,ei.F)(),[i,n]=(0,u.useState)(!0),[s,a]=(0,u.useState)(!1),[r,l]=(0,u.useState)(""),d=m().createRef();return i?o()(ni.Z,{style:{display:"flex",alignItems:"center",height:28,fontWeight:v.Z.fontWeight.medium,fontSize:v.Z.fontSize.UIRegular.desktop,color:g.ZP.blue,padding:"0px 6px"},onClick:()=>{var e;n(!1),null===(e=d.current)||void 0===e||e.focusInput()}},void 0,o()(y.FormattedMessage,{id:"adminConnectionsSettings.search.button.label",defaultMessage:"{plusIcon} Add approved connection",description:"Text for button to open dropdown menu for selecting and adding a new connection to the approved list",values:{plusIcon:h.Z.plus({fill:g.ZP.blue,width:14,height:14,flexGrow:0,flexShrink:0})}})):o()(Oe.ZP,{alignmentToOrigin:Oe.ZP.Alignment.Start,keepFocus:e.device.isPhone,onDismiss:()=>{var e;null===(e=d.current)||void 0===e||e.handleBlur(),n(!0),a(!1)},origin:m().createElement(lt.Z,{type:"text",style:{width:255},left:h.Z.plus({fill:t.lightIconColor,width:14,height:14,marginRight:8,flexGrow:0,flexShrink:0}),ref:d,value:r,onFocus:()=>{a(!0)},placeholder:Te.default.formatMessage(Sn.searchInputPlaceholder),onChange:e=>l(e.target.value)}),open:s,popupType:Oe.ZP.PopupType.Popup,style:{width:255},render:()=>o()(hn,{query:r,closeDropdown:()=>a(!1)})})}var Mn=i(88594),wn=i(38755),Cn=i(31942),kn=i(24736),Tn=i(82276),In=i(68894),Zn=i(22346),Pn=i(29302);function _n(e){const{integrationId:t,integrationTable:i,isLegacy:n,disableDisconnectUser:s,disableDisconnectAll:r,disableDisallow:l,botIds:d}=e,[{currentSpaceStore:c}]=(0,Me.oR)(F.default),p=(0,be.Fy)(),g=(0,be.O7)(),h=(0,y.useIntl)(),[v,S]=(0,u.useState)(void 0),[b,M]=(0,u.useState)(!1),[w,C]=(0,u.useState)(!1),[k,T]=(0,u.useState)(!1),[I,Z]=(0,u.useState)(void 0),P=(0,Me.VK)((()=>c&&i?(0,bt.Kv)(c,{table:i,id:t}):void 0),[c,t,i]),_=(0,Me.VK)((()=>{if(n){const e=sn.ns.find((e=>e.id===t));return{name:null==e?void 0:e.name,url:(0,V.UY)("guides.connectedApps")}}if(c&&i){const n=c.getRecordValue({table:i,id:t});if(i===ln.K2&&!(0,dn.BP)({integrationId:t,env:Kt.Z.env})){var e,o;const t=n;return{name:null==n?void 0:n.name,url:null==t||null===(e=t.info)||void 0===e?void 0:e.website_url,email:null==t||null===(o=t.info)||void 0===o?void 0:o.email}}return{name:null==n?void 0:n.name}}}),[c,t,i,n]),x=(0,Me.VK)((()=>d&&!s?d.map((e=>c&&P?(0,bt.Kv)(P,{table:we.cZ,id:e,spaceId:c.id}):void 0)):[]),[c,d,P,s]).filter(H.$K),B=(0,Me.VK)((()=>x.map((e=>e.getKeyStore("alive").getValue()?e.getValue():void 0)).filter(H.$K)),[x]),E=(0,Me.VK)((()=>{if(c&&B&&!s){return B.map((e=>e.created_by_id)).map((e=>c.getRecordValue({table:Ce.KJ,id:e}))).filter(H.$K)}return[]}),[B,c,s]),R=(0,Me.VK)((()=>null==c?void 0:c.getBotSettingsStore().getValue()),[c]),D=null==B?void 0:B.reduce(((e,t)=>{const i=E.find((e=>e.id===t.created_by_id));return e[t.id]={user:i,bot:t},e}),{}),L=v?(0,Cn.ZP)(v,Object.entries(D),(e=>{let[,{user:t}]=e;return(0,Ce.of)(t)})):Object.entries(D),O=!s&&(null==d?void 0:d.length)&&o()(Ne.Z,{isInput:!0,style:{padding:8}},void 0,o()(In.ZP,{textWrapperStyle:{margin:0},focus:!p.isMobile||void 0,focusAfterAnimation:!0,value:v||"",onChange:e=>S(e.target.value),placeholder:h.formatMessage({id:"integrationInstallerFilter.userSearch.placeholder",defaultMessage:"Filter by user"})})),N=L.length?[{key:"disconnect user section",render:e=>m().createElement(Ne.Z,e),items:Fn({users:L,disableDisconnectUser:s,showDisplayModal:()=>C(!0),setSelectedUser:Z,intl:h})}]:[],U=(null==_?void 0:_.url)||(null==_?void 0:_.email),W=Boolean(null==d?void 0:d.length)||(0,f.CJ)(R)&&!l,z=m().createElement(m().Fragment,null,U&&o()(Ne.Z,{topBorder:Boolean(L.length)},"app-links",(null==_?void 0:_.url)&&o()(Bn,{environment:g,developerWebsite:_.url}),(null==_?void 0:_.email)&&o()(En,{environment:g,developerEmail:_.email})),W&&o()(Ne.Z,{topBorder:Boolean(L.length||U)},void 0,Boolean(null==d?void 0:d.length)&&o()(Rn,{showDisplayModal:()=>T(!0)}),(0,f.CJ)(R)&&!l&&o()(Dn,{showDisplayModal:()=>M(!0)})));return(U||W)&&_?o()(Qe.Z,{popupType:p.isMobile?Qe.Z.PopupType.SlideUp:Qe.Z.PopupType.Popup,renderOrigin:e=>m().createElement(kn.Z,a()({},e,{isMobile:p.isMobile,style:{marginLeft:8,marginRight:8}})),render:()=>m().createElement(m().Fragment,null,o()(De.Z,{menuType:p.isMobile?Fe.o.ActionSheet:Fe.o.Popup,header:!s&&O,footer:z,width:230},void 0,o()(Le.Z,{type:Le.i.Vertical,sections:N,initialFocus:void 0})),o()(Zn.Z,{open:!s&&w,onDismiss:()=>{C(!1)},disableAnimation:!0,render:()=>o()(Ln,{title:o()(Vn,{integrationName:_.name}),caption:o()(zn,{integrationName:_.name,userName:null==I?void 0:I.userName}),type:"disconnect",handleCancel:()=>{C(!1),Z(void 0)},handleConfirmation:async()=>{I&&(await xn({botIds:[I.botId],environment:g}),Z(void 0)),C(!1)}})}),o()(Zn.Z,{open:!r&&k,onDismiss:()=>{T(!1)},disableAnimation:!0,render:()=>o()(Ln,{title:o()(Un,{integrationName:_.name}),caption:o()(Wn,{integrationName:_.name}),type:"disconnect",handleCancel:()=>T(!1),handleConfirmation:async()=>{await xn({botIds:d,environment:g}),T(!1)}})}),o()(Zn.Z,{open:!l&&b,onDismiss:()=>{M(!1)},disableAnimation:!0,render:()=>o()(Ln,{title:o()(On,{integrationName:_.name}),caption:o()(Nn,{integrationName:_.name,disableDisconnectAll:r}),type:"disapprove",handleCancel:()=>M(!1),handleConfirmation:async()=>{!function(e){const{currentSpaceStore:t,environment:i,integrationId:n}=e;t&&(0,A.createAndCommit)({userAction:"AdminIntegrationSettingsActionMenu.handleDisapproveIntegration",environment:i,perform:e=>{(0,A.applyOperation)({store:t,operation:{pointer:t.pointer,path:["bot_settings","integration_approval_statuses"],command:"update",args:{[n]:null}},transaction:e})}})}({currentSpaceStore:c,environment:g,integrationId:t}),r||await xn({botIds:d,environment:g}),M(!1)}})}))}):null}async function xn(e){let{botIds:t,environment:i}=e;t&&await Promise.all(t.map((e=>(0,nn.P0)({environment:i,botId:e,onSuccess:()=>{M.trackDeveloperIntegrationsDisconnectClick(i,{type:"public"})}}))))}function Fn(e){const{intl:t,disableDisconnectUser:i,users:n,showDisplayModal:s,setSelectedUser:a}=e;return i?[]:n.map((e=>{let[i,{user:n,bot:r}]=e;return{key:n.id,render:e=>o()(An,{buttonMenuProps:e,user:n,botCapabilities:r.capabilities,selectAction:()=>{s(),a({botId:i,userName:(0,Ce.Nz)(t,n)})}}),action:()=>{s(),a({botId:i,userName:(0,Ce.Nz)(t,n)})}}}))}function An(e){const{buttonMenuProps:t,user:i,botCapabilities:n,selectAction:s}=e,r=(0,be.Fy)(),[l,d]=(0,u.useState)(!1);return o()(Oe.ZP,{popupType:r.isMobile?Qe.Z.PopupType.SlideUp:Qe.Z.PopupType.Popup,placementToOrigin:Qe.Z.Placement.Right,open:l,onDismiss:()=>d(!1),origin:m().createElement(Re.Z,a()({},t,{title:o()("div",{style:{display:"flex",alignContent:"center",justifyContent:"space-between"}},void 0,o()(Pn.Z,{userValue:i,avatarSize:18,inline:!0,avatarShouldShowShadow:!0,style:{flexShrink:1}})),textWrapperStyle:{marginLeft:12,marginRight:12},focused:!1,onClick:()=>d(!0)})),render:()=>o()(De.Z,{width:240,menuType:r.isMobile?Fe.o.ActionSheet:Fe.o.Popup,header:o()("div",{style:{padding:2,marginTop:4,marginBottom:4}},void 0,o()(Tn.T,{role:n,renderUserCapabilities:!0}))},void 0,o()(Le.Z,{type:Le.i.Vertical,sections:[{key:"integration capabilities",render:e=>m().createElement(Ne.Z,a()({},e,{topBorder:!0})),items:[{key:"remove",render:e=>m().createElement(Re.Z,a()({},e,{focused:!1,title:o()("div",{style:{color:g.ZP.red}},void 0,o()(y.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.revokeUserAccess.label",defaultMessage:"Disconnect user"}))})),action:s}]}],initialFocus:void 0}))})}function Bn(e){let{environment:t,developerWebsite:i}=e;return o()(Re.Z,{onClick:()=>{(0,k.navigateToExternalURL)({environment:t,url:i}),M.trackDeveloperIntegrationsVisitDeveloperWebsiteClick(t,{href:i,from:"integration-settings"})},title:o()(y.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.visitDeveloperWebsite.label",defaultMessage:"Visit developer website"}),shouldWrapCaption:!0,focused:!1,textWrapperStyle:{marginLeft:12,marginRight:12}})}function En(e){let{environment:t,developerEmail:i}=e;return o()(Re.Z,{onClick:()=>{(0,k.navigateToExternalURL)({environment:t,url:"mailto:".concat(i)}),M.trackDeveloperIntegrationsContactDeveloperClick(t,{from:"integration-settings"})},title:o()(y.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.contactDeveloperSupport.label",defaultMessage:"Contact support",description:"Label for a button that users can click to contact customer support for an integration that's been added to their workspace"}),shouldWrapCaption:!0,focused:!1,textWrapperStyle:{marginLeft:12,marginRight:12}})}function Rn(e){let{showDisplayModal:t}=e;return o()(Re.Z,{onClick:t,title:o()(y.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectAll.label",defaultMessage:"Disconnect all users"}),shouldWrapCaption:!0,focused:!1,textWrapperStyle:{marginLeft:12,marginRight:12,color:g.ZP.red}})}function Dn(e){let{showDisplayModal:t}=e;return o()(Re.Z,{onClick:t,title:o()(y.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.label",defaultMessage:"Remove from approved list"}),focused:!1,textWrapperStyle:{marginLeft:12,marginRight:12,color:g.ZP.red}})}function Ln(e){let{title:t,caption:i,handleConfirmation:n,handleCancel:s,type:a}=e;return o()("div",{style:{padding:20,width:333}},void 0,o()(oi.Z,{isMultiline:!0,style:{marginBottom:8,fontWeight:v.Z.fontWeight.semibold}},void 0,t),o()(oi.Z,{isMultiline:!0,isSecondaryColor:!0,style:{marginBottom:8}},void 0,i),o()("div",{style:{display:"flex",marginTop:12}},void 0,o()(jt.Z,{style:{width:140,marginRight:9},isLarge:!0,onClick:s},void 0,o()(oi.Z,{},void 0,o()(y.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.button.cancel",defaultMessage:"Cancel"}))),o()(jt.Z,{style:{width:140},isLarge:!0,onClick:n,backgroundColor:g.ZP.red},void 0,o()(oi.Z,{style:{color:g.ZP.white}},void 0,"disconnect"===a&&o()(y.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.button.disconnect",defaultMessage:"Disconnect"}),"disapprove"===a&&o()(y.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.button.remove",defaultMessage:"Remove"})))))}function On(e){let{integrationName:t}=e;return o()(y.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.title",defaultMessage:"Remove {integrationName} from approved integrations",values:{integrationName:t}})}function Nn(e){let{integrationName:t,disableDisconnectAll:i}=e;return o()(y.FormattedMessage,i?{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.caption",defaultMessage:"Prevent members from installing {integrationName}.",values:{integrationName:t}}:{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApprovalAndDisconnectAll.caption",defaultMessage:"Revoke access for {integrationName} for all users in this workspace and prevent members from installing {integrationName}.",values:{integrationName:t}})}function Un(e){let{integrationName:t}=e;return o()(y.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectAll.modal.label",defaultMessage:"Disconnect {integrationName} for all users in workspace",values:{integrationName:t}})}function Wn(e){let{integrationName:t}=e;return o()(y.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectAll.modal.caption",defaultMessage:"Revoke access for {integrationName} for all users in this workspace.",values:{integrationName:t}})}function Vn(e){let{integrationName:t}=e;return o()(y.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectUser.modal.label",defaultMessage:"Disconnect {integrationName}?",values:{integrationName:t}})}function zn(e){let{integrationName:t,userName:i}=e;return o()(y.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectUser.modal.caption",defaultMessage:"Revoke access for {integrationName} for {userName}",values:{integrationName:t,userName:i}})}var qn=i(68785),Hn=i(25383),Gn=i(15070),Kn=i(59054),jn=i(61766);function Yn(e){const{botId:t}=e,[,,i]=(0,Me.oR)(void 0,jn.Z),n=(0,be.Fy)(),s=(0,be.O7)(),[{currentSpaceStore:r}]=(0,Me.oR)(F.default),[l,d]=(0,u.useState)(!1),c=(0,Me.VK)((()=>r?(0,bt.Kv)(r,{table:we.cZ,id:t,spaceId:r.id}):void 0),[t,r]),p=(0,Me.VK)((()=>null==c?void 0:c.getValue()),[c]),h=(0,Me.VK)((()=>(0,Gn.Mh)(p)),[p]),[{value:f}]=(0,Kn.r5)((async()=>{if(c){return await(0,nn.VG)({environment:s,botId:null==c?void 0:c.id})}}),[s,c]);if(!c)return null;let S;return S=n.isMobile?{menuType:Fe.o.ActionSheet}:{menuType:Fe.o.Popup},o()(Qe.Z,{popupType:n.isMobile?Qe.Z.PopupType.SlideUp:Qe.Z.PopupType.Popup,buttonPopupStore:i,renderOrigin:e=>m().createElement(kn.Z,a()({isMobile:n.isMobile},e,{style:{marginLeft:8,marginRight:8}})),render:()=>m().createElement(m().Fragment,null,m().createElement(De.Z,S,o()(Le.Z,{type:Le.i.Vertical,sections:[{key:"integration options",render:e=>m().createElement(Ne.Z,e),items:[...Qn({environment:s,botToken:f}),{key:"delete",action:()=>d(!0),render:e=>m().createElement(Re.Z,a()({title:o()(y.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectIntegrationButton.label",defaultMessage:"Disconnect {integrationName}",values:{integrationName:(0,Gn.Mh)(p)}}),style:{color:g.ZP.red}},e))}]}],initialFocus:void 0})),o()(Zn.Z,{open:l,onDismiss:()=>{d(!1)},disableAnimation:!0,render:()=>o()("div",{style:{padding:20,width:333}},void 0,o()(oi.Z,{isMultiline:!0,style:{marginBottom:8,fontWeight:v.Z.fontWeight.semibold}},void 0,o()(y.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegration.modal.label.title",defaultMessage:"Disconnect {integrationName} in workspace",values:{integrationName:h}})),o()(oi.Z,{isMultiline:!0,isSecondaryColor:!0,style:{marginBottom:8}},void 0,o()(y.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegration.modal.label.caption",defaultMessage:"Revoke access for {integrationName} in workspace",values:{integrationName:h}})),o()("div",{style:{display:"flex",marginTop:12}},void 0,o()(jt.Z,{style:{width:140,marginRight:9},isLarge:!0,onClick:()=>d(!1)},void 0,o()(oi.Z,{},void 0,o()(y.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.removeIntegrationApproval.modal.button.cancel",defaultMessage:"Cancel"}))),o()(jt.Z,{style:{width:140},isLarge:!0,onClick:async()=>{d(!1),await nn.P0({environment:s,botId:c.id,onSuccess:()=>{M.trackDeveloperIntegrationsDisconnectClick(s,{type:"internal"})}})},backgroundColor:g.ZP.red},void 0,o()(oi.Z,{style:{color:g.ZP.white}},void 0,o()(y.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.disconnectIntegration..modal.button.disconnect",defaultMessage:"Disconnect"})))))}))})}function Qn(e){const{botToken:t,environment:i}=e;return t?[{key:"copy bot token",action:()=>{(0,ti.RD)({environment:i,stringValue:t,copiedMessage:ti.tq.copiedLinkToClipboard}),M.trackDeveloperIntegrationsCopySecret(i,{from:"integration-settings",table:we.cZ})},render:e=>m().createElement(Re.Z,a()({title:o()(y.FormattedMessage,{id:"spaceIntegrationSettings.actionMenu.copyInternalIntegrationTokenButton.label",defaultMessage:"Copy internal integration token"})},e))}]:[]}const Xn={internal:o()(y.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.internal",defaultMessage:"INTERNAL",description:"This label indicates that an integration is internal to the workspace, as opposed to public."}),databaseSync:o()(y.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.sync",defaultMessage:"SYNC",description:"This label indicates that the integration type is database sync."}),linkPreview:o()(y.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.preview",defaultMessage:"LINK PREVIEW",description:"This label indicates that the integration type is link preview."}),importer:o()(y.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.pillLabel.importer",defaultMessage:"IMPORTER",description:"This label indicates that the integration type is a first-party / legacy importers."})};function Jn(e){const{integrationIdToBotIds:t,internalIntegrationIds:i,integrationIdToUsers:n}=e,[{currentSpaceStore:s}]=(0,Me.oR)(F.default),a=(0,ei.F)(),r=(0,Me.VK)((()=>null==s?void 0:s.getBotSettingsStore().getValue()),[s]),l=(0,Me.VK)((()=>"approved_or_built_by_notion"===(null==r?void 0:r.integration_restrictions)),[r]),d=(0,Me.VK)((()=>Boolean(null==r?void 0:r.integration_restrictions)),[r]),c=(0,Me.VK)((()=>null!=r&&r.integration_approval_statuses?Object.keys(r.integration_approval_statuses):[]),[r]),u=c.filter((e=>!Object.keys(t).includes(e)&&!sn.T2.includes(e))),p=(0,Me.VK)((()=>null==s?void 0:s.id),[s]),g=t?Object.entries(t).map((e=>{let[t,i]=e;return $n({integrationPointer:{table:ln.K2,id:t},users:n[t],botIds:i,autoApproveBuiltByNotion:l})})):[],h=p?i.map((e=>$n({integrationPointer:{table:we.cZ,id:e,spaceId:p},users:n[e],botIds:[e]}))):[],v=d?u.map((e=>$n({integrationPointer:{table:ln.K2,id:e},users:[],botIds:[],autoApproveBuiltByNotion:l}))):[],S=sn.ns.filter((e=>!(0,f.CJ)(r)||c.includes(e.id))).map((e=>function(e){const{legacyIntegration:t}=e,{id:i,name:n,info:s}=t;return{key:i,columns:[o()("div",{style:{display:"flex",alignItems:"center",maxWidth:300}},0,o()("img",{src:s.icon,style:{height:28}}),o()("div",{style:{minWidth:0,marginLeft:15}},void 0,o()("div",{style:{display:"flex"}},void 0,o()(oi.Z,{},void 0,n)),o()(oi.Z,{isSmall:!0,style:{display:"flex"}},void 0,o()(y.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.legacy",defaultMessage:"Notion Connected App"})))),o()(oo,{renderedUsers:void 0,displayUsers:!1},1),o()("div",{},2,o()(_n,{integrationId:i,isLegacy:!0,disableDisconnectAll:!0,disableDisconnectUser:!0}))]}}({botSettings:r,legacyIntegration:e}))),b=g.length+h.length+v.length+S.length;return m().createElement(m().Fragment,null,o()(si.Z,{columns:[{key:"integration",header:o()(y.FormattedMessage,{id:"spaceConnectionsSettings.connectionsTable.connectionsColumn.title",defaultMessage:"Connection",description:"Table header for column that lists names of workspace connections"}),style:{width:"40%"}},{key:"added_by",header:o()(y.FormattedMessage,{id:"spaceConnectionsSettings.connectionsTable.creationInfoColumn.title",defaultMessage:"Users and access",description:"Table header for column that lists members who have access to a connection"})},{key:"more",header:void 0,style:{width:"5%"}}],rows:[...g,...h,...v,...S]}),0===b?o()("div",{style:{height:120,width:"100%",fontSize:12,color:a.lightTextColor,display:"flex",alignItems:"center",justifyContent:"center",borderBottom:"1px solid ".concat(a.lightDividerColor)}},void 0,o()(y.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.emptyTable.message",defaultMessage:"No integration installed"})):void 0)}function $n(e){const{integrationPointer:t,users:i,botIds:n,autoApproveBuiltByNotion:s}=e;if(t.table===ln.K2){const e=t.id,a=(0,dn.BP)({integrationId:e,env:Kt.Z.env});return{key:e,columns:[o()(eo,{integrationTable:ln.K2,integrationId:e},"integration-title"),o()(oo,{renderedUsers:i,displayUsers:!a},"integration-installer-info"),o()(_n,{integrationId:e,integrationTable:ln.K2,botIds:n,disableDisconnectUser:a||void 0,disableDisallow:a&&s},"admin-integration-settings-menu")]}}if(t.table===we.cZ)return{key:t.id,columns:[o()(eo,{integrationTable:we.cZ,integrationId:t.id},"integration-title"),o()(oo,{renderedUsers:i,displayUsers:!1},"integration-installer-info"),o()(Yn,{botId:t.id},"integration-settings-menu")]};(0,H.t1)(t)}function eo(e){const{integrationId:t,integrationTable:i}=e,[{currentSpaceStore:n}]=(0,Me.oR)(F.default),s=(0,be.O7)(),a=(0,Me.VK)((()=>(0,Mn.fe)(s)),[s]),r=(0,Me.VK)((()=>{if(n)return n.getRecordValue({table:i,id:t})}),[n,t,i]);if(!r)return o()(qn.Z,{});let l;const d=[];let c;if(i===we.cZ){const e=r;e.icon&&(l={pointer:{table:i,id:t},icon:e.icon}),d.push("internal"),c=o()(to,{botId:e.id})}else if(i===ln.K2){const e=r;e.info.icon&&(l={pointer:{table:i,id:t},icon:e.info.icon}),(0,sn.mo)(e)&&(d.push("linkPreview"),(0,sn.zc)(e)&&a&&d.push("databaseSync")),c=o()(io,{integrationId:e.id})}else(0,H.t1)(i);return o()("div",{style:{display:"flex",alignItems:"center",maxWidth:300}},void 0,o()(mn.Z,{disabled:!0,icon:l,title:r.name,isEmptyPage:!1,size:28,isLarge:!0,useInvertedColors:!0}),o()("div",{style:{minWidth:0,marginLeft:15}},void 0,o()("div",{style:{display:"flex",marginRight:16}},void 0,o()(oi.Z,{},void 0,r.name),d.map((e=>e&&o()(wt.Z,{desktopStyle:{marginLeft:4}},void 0,Xn[e])))),c))}const to=e=>{let{botId:t}=e;const[{currentSpaceStore:i}]=(0,Me.oR)(F.default),n=(0,y.useIntl)(),s=(0,Me.VK)((()=>null==i?void 0:i.getRecordValue({table:we.cZ,id:t})),[i,t]),a=(0,Me.VK)((()=>{if(i&&s)return i.getRecordValue({table:s.created_by_table,id:s.created_by_id})}),[i,s]);if(a){const e=(0,Ce.Nz)(n,a);return o()(oi.Z,{className:"notranslate",isSmall:!0},void 0,e)}return o()(no,{})},io=e=>{let{integrationId:t}=e;const[{currentSpaceStore:i}]=(0,Me.oR)(F.default),n=(0,ei.F)(),s=(0,Me.VK)((()=>{const e=null==i?void 0:i.getRecordValue({table:ln.K2,id:t});return null==e?void 0:e.info.developer_name}),[i,t]);return(0,dn.BP)({integrationId:t,env:Kt.Z.env})?o()(oi.Z,{isSmall:!0,style:{display:"flex",alignItems:"center"}},void 0,o()(y.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.notion",defaultMessage:"Notion {icon}",values:{icon:o()(Ue.Z,{renderTooltip:()=>o()("div",{},void 0,o()(y.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfo.notion.tooltip",defaultMessage:"Developed by Notion"})),placement:Ue.Z.Placement.Right,render:e=>m().createElement("div",e,h.Z.integrationSecurity({width:12,height:12,fill:n.invoiceGreen}))})}})):s?o()(oi.Z,{className:"notranslate",isSmall:!0},void 0,s):o()(no,{})},no=()=>o()(oi.Z,{isSmall:!0},void 0,o()(y.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.label.unknownDeveloper",defaultMessage:"Unknown developer",description:"The placeholder name of an integration developer if not provided"}));function oo(e){const{renderedUsers:t,displayUsers:i}=e,[{currentSpaceStore:n}]=(0,Me.oR)(F.default),s=(0,y.useIntl)(),a=(0,be.O7)(),r=(0,Me.VK)((()=>{if(n)return(0,wn.getSpaceName)(a,n)}),[a,n]);if(t&&0===(null==t?void 0:t.length))return o()(oi.Z,{isSecondaryColor:!0,style:{display:"flex",alignItems:"center"}},void 0,o()(y.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.noUsers",defaultMessage:"No users"}));if(!i||!t)return o()(oi.Z,{style:{display:"flex",alignItems:"center"}},void 0,o()(y.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.anyone",defaultMessage:"Anyone in {spaceName}",values:{spaceName:o()(oi.Z,{style:{fontWeight:v.Z.fontWeight.medium}},void 0,r)}}));const l=(0,Ce.Nz)(s,t[0]);return o()("div",{style:{display:"flex",alignItems:"center"}},void 0,o()(Hn.Z,{userValue:t[0],avatarShouldShowShadow:!0,style:{marginRight:8},size:28}),o()(oi.Z,{},void 0,o()(y.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.installerInfoColumn.listOfUsers",defaultMessage:"{remainingCount, plural, =0 {{firstUser}} one {{firstUser} +{remainingCount}} other {{firstUser} +{remainingCount}}}",values:{firstUser:l,remainingCount:t.length-1}})))}var so=i(61519),ao=i(42402),ro=i(55422);function lo(e){const t=(0,be.O7)(),{isMobile:i}=t.device,{externalBotIds:n,guestBotIds:s}=e,[{currentSpaceStore:a}]=(0,Me.oR)(F.default),r=(0,Me.VK)((()=>a?[...s,...n].map((e=>{const t=(0,bt.Kv)(a,{table:we.cZ,id:e,spaceId:a.id});return null!=t&&t.getKeyStore("alive").getValue()?t.getValue():void 0})).filter(H.$K):[]),[a,s,n]),l=(0,Me.VK)((()=>function(e){return e.reduce(((e,t)=>(t.integration_id&&(e[t.integration_id]=t.integration_id in e?[...e[t.integration_id],t.id]:[t.id]),e)),{})}([...r])),[r]),d=(0,Me.VK)((()=>function(e){return e.filter((e=>!e.integration_id)).map((e=>e.id))}(r)),[r]),c=(0,Me.VK)((()=>function(e,t){if(!t)return{};return e.reduce(((e,i)=>{const n=t.getRecordValue({table:Ce.KJ,id:i.created_by_id});return i.integration_id?e[i.integration_id]=i.integration_id in e?[...e[i.integration_id],n]:[n]:e[i.id]=[n],e}),{})}(r,a)),[r,a]),u=(0,Me.VK)((()=>null==a?void 0:a.getBotSettingsStore().getValue()),[a]),p=Object.keys(l).length+d.length,g=(0,Me.VK)((()=>null!=u&&u.integration_approval_statuses?Object.keys(u.integration_approval_statuses).length+d.length:d.length),[u,d]);return m().createElement(m().Fragment,null,o()(co,{}),(null==u?void 0:u.integration_restrictions)&&o()("div",{style:{marginTop:"19px"}},void 0,o()(uo,{})),o()(so.Z,{size:i?32:18,isHidden:!i}),Boolean(null==u?void 0:u.integration_restrictions)?o()("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"19px"}},void 0,o()(oi.Z,{style:{fontWeight:v.Z.fontWeight.medium,display:"flex",alignItems:"center",height:28}},void 0,o()(y.FormattedMessage,{id:"adminConnectionsSettings.table.allowIntegrations.title",defaultMessage:"Approved connections{numberOfIntegrations}",description:"Title for table that displays admin-approved workspace connections",values:{numberOfIntegrations:0!==g&&o()(oi.Z,{isSecondaryColor:!0,style:{marginLeft:6}},void 0,g)}})),o()(bn,{})):o()(oi.Z,{style:{fontWeight:v.Z.fontWeight.medium,display:"flex",height:28,alignItems:"center",marginBottom:"19px"}},void 0,o()(y.FormattedMessage,{id:"adminConnectionsSettings.table.default.title",defaultMessage:"All connections{numberOfIntegrations}",description:"Title for table that shows all connections installed on workspace",values:{numberOfIntegrations:0!==p&&o()(oi.Z,{isSecondaryColor:!0,style:{marginLeft:6}},void 0,p+sn.T2.length)}})),o()(Jn,{integrationIdToBotIds:l,internalIntegrationIds:d,integrationIdToUsers:c}))}const co=()=>{const e=(0,be.O7)(),[{currentSpaceStore:t}]=(0,Me.oR)(F.default),{isMobile:i}=e.device,n=(0,Me.VK)((()=>"enterprise"===T.CM(e)),[e]),s=(0,Me.VK)((()=>null==t?void 0:t.getBotSettingsStore().getValue()),[t]),a=(0,ii.u)();return o()(ro.Z,{isMobile:i,title:o()(y.FormattedMessage,{id:"adminConnectionsSettings.requireApprovalSetting.title",defaultMessage:"Restrict members from adding connections",description:"Section header for restriction settings related to user-installed workspace connections"}),caption:(0,f.CJ)(s)?o()(y.FormattedMessage,a?{id:"adminConnectionsSettings.requireApprovalSetting.allowList.workspaceOwner.caption",defaultMessage:"Workspace members can only install connections pre-approved by workspace owners.",description:"Caption for menu option that restricts member-installed connections to those on workspace owners put on allow list"}:{id:"adminConnectionsSettings.requireApprovalSetting.allowList.caption",defaultMessage:"Workspace members can only install connections pre-approved by admins.",description:"Caption for menu option that restricts member-installed connections to those on an allow list"}):o()(y.FormattedMessage,{id:"adminConnectionsSettings.requireApprovalSetting.off.caption",defaultMessage:"Workspace members can install any new connection.",description:"Caption for restriction settings related to user-installed workspace connections"}),upsellOptions:{shouldUpsell:!n,subscriptionTier:"enterprise",analyticsName:"integration_settings"},type:"dropdown",currentOption:(0,f.CJ)(s)?"allow_list":"any_integrations",options:[{key:"any_integrations",label:o()(y.FormattedMessage,{id:"adminIntegrationSettings.integrationRestrictions.off.title",defaultMessage:"No restrictions",description:"Title for menu option in workspace connections settings that removes member restrictions on installing connections"}),caption:o()(y.FormattedMessage,{id:"adminConnectionsSettings.connectionRestrictions.off.caption",defaultMessage:"Workspace members can install any connection.",description:"Caption for menu option in workspace connections settings that removes member restrictions on installing connections"})},{key:"allow_list",label:o()(y.FormattedMessage,{id:"adminIntegrationSettings.integrationRestrictions.allowList.title",defaultMessage:"Only from approved list",description:"Title for menu option in workspace connections settings for restricting which connections users may install"}),caption:o()(y.FormattedMessage,{id:"adminConnectionsSettings.connectionRestrictions.allowList.caption",defaultMessage:"Workspace members can only install connections pre-approved by an admin.",description:"Caption in workspace connections settings for restricting which connections users may install"})}],onSelectOption:i=>{!function(e){const{environment:t,currentSpaceStore:i,botSettings:n,setting:o}=e;if(i){if("allow_list"===o&&(0,f.CJ)(n))return;const e="allow_list"===o?"approved_only":void 0;A.createAndCommit({userAction:"AdminIntegrationSettings.handleIntegrationRestrictionSelect",environment:t,perform:t=>{an.sW({store:i,data:{bot_settings:{...n,integration_restrictions:e}},transaction:t})}})}}({environment:e,currentSpaceStore:t,botSettings:s,setting:i})},info:[{key:"learn_more",label:o()(y.FormattedMessage,{id:"adminConnectionsSettings.connectionRestrictions.info.title",defaultMessage:"Admins can always install and approve new connections.",description:"Information about admin permissions for workspace connections"})}]})};const uo=()=>{const e=(0,be.O7)(),t=(0,ei.F)(),[{currentSpaceStore:i}]=(0,Me.oR)(F.default),{isMobile:n}=e.device,s=(0,Me.VK)((()=>"enterprise"===T.CM(e)),[e]),a=(0,Me.VK)((()=>null==i?void 0:i.getBotSettingsStore().getValue()),[i]);return o()(ro.Z,{isMobile:n,title:o()(y.FormattedMessage,{id:"adminConnectionsSettings.autoApproveBuiltByNotion.title",description:"This message is for the option to auto approve connections that are built by Notion.",defaultMessage:"Auto-approve <builtbynotion>Built by Notion</builtbynotion> connections",values:{builtbynotion:function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return o()("span",{style:{color:t.invoiceGreen}},void 0,h.Z.integrationSecurity({width:14,display:"inline",verticalAlign:"text-bottom",marginRight:2}),i)}}}),caption:o()(y.FormattedMessage,{defaultMessage:"Toggle this on to approve all workspace members to install connections <helpcenterlink>built by Notion</helpcenterlink>.",id:"adminConnectionsSettings.autoApproveBuiltByNotion.caption",description:"Caption for toggle UI in workspace connections settings",values:{helpcenterlink:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()(ao.Z,{href:(0,V.UY)("guides.enterpriseIntegrationSettings")},void 0,t)}}}),upsellOptions:{shouldUpsell:!s,subscriptionTier:"enterprise",analyticsName:"integration_settings"},type:"toggle",isOn:"approved_or_built_by_notion"===(null==a?void 0:a.integration_restrictions),onToggle:()=>function(e){const{environment:t,currentSpaceStore:i,botSettings:n}=e;if(i){const e="approved_or_built_by_notion"===(null==n?void 0:n.integration_restrictions)?"approved_only":"approved_or_built_by_notion";A.createAndCommit({userAction:"AdminIntegrationSettings.handleAutoApproveBuiltByNotionToggle",environment:t,perform:t=>{an.sW({store:i,data:{bot_settings:{...n,integration_restrictions:e}},transaction:t})}})}}({environment:e,currentSpaceStore:i,botSettings:a})})};var mo=i(70578),po=i(59649),go=i(30381),ho=i.n(go),fo=i(39111);function vo(e){const{botIds:t}=e,i=(0,y.useIntl)(),[{currentSpaceStore:n}]=(0,Me.oR)(F.default),s=(0,ei.F)(),a=(0,Me.VK)((()=>n?t.map((e=>function(e,t){const{currentSpaceStore:i}=F.default.state,n=e.getValue();if(!n||!n.alive||!i||!e.canAdmin()&&!i.canAdmin())return;const s=null==i?void 0:i.getRecordValue({table:Ce.KJ,id:n.created_by_id}),a=(0,Ce.Nz)(t,{name:null==s?void 0:s.name}),r=ho()(n.created_at,"x").format("LLL"),l=!n.integration_id;return{key:n.id,columns:[o()("div",{style:{maxWidth:300,display:"flex"}},void 0,o()(fo.Z,{botValue:n,avatarSize:24,style:{marginRight:6}}),l&&o()(wt.Z,{},void 0,o()(y.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.row.internalIntegrationLabel",defaultMessage:"Internal",description:"This label indicates that an integration is internal, as opposed to public."}))),o()(y.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.creationInfoColumn.contents",defaultMessage:"{installerName} on {installedTime}",values:{installerName:a,installedTime:r},description:"Text describing who added an integration to a workspace and when. For example: 'Johnny Appleseed on May 13, 2021'"}),o()(Yn,{botId:n.id})]}}((0,bt.Kv)(n,{table:we.cZ,id:e,spaceId:n.id}),i))).filter(H.$K):[]),[n,t,i]);return m().createElement(m().Fragment,null,o()("div",{style:{marginBottom:"19px",display:"flex",alignItems:"center"}},void 0,o()(oi.Z,{style:{fontWeight:v.Z.fontWeight.medium}},void 0,o()(y.FormattedMessage,{id:"memberIntegrationSettings.table.default.title",defaultMessage:"All integrations",description:"Title for the member view of the integrations table"})),o()(oi.Z,{isSecondaryColor:!0,style:{marginLeft:6}},void 0,a.length)),o()(si.Z,{columns:[{key:"integration",header:o()(y.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.integrationColumn.title",defaultMessage:"Integration"}),style:{width:"40%"}},{key:"added_by",header:o()(y.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.creationInfoColumnMember.title",defaultMessage:"Added by",description:"Title for integrations table added by column for member view"})},{key:"more",header:void 0}],rows:a}),0===a.length?o()("div",{style:{height:120,width:"100%",fontSize:12,color:s.lightTextColor,display:"flex",alignItems:"center",justifyContent:"center",borderBottom:"1px solid ".concat(s.lightDividerColor)}},void 0,o()(y.FormattedMessage,{id:"spaceIntegrationSettings.integrationTable.emptyMessage",defaultMessage:"No integration installed"})):void 0)}var yo=i(27386);class So extends p.Z{constructor(){super(...arguments),l()(this,"storeTypes",{requestStore:on.Z}),l()(this,"renderResult",((e,t,i)=>{const{currentSpaceStore:n}=F.default.state;if(n)return o()(po.Z,{loaded:i,spinnerSize:16,showSpinnerTimeout:600},void 0,e&&o()("div",{},void 0,o()(y.FormattedMessage,{id:"spaceIntegrationSettings.error",defaultMessage:"Something went wrong…"})),t&&(n.canAdmin()?o()(lo,{guestBotIds:t.guestBotIds,externalBotIds:t.externalBotIds}):o()(vo,{botIds:t.guestBotIds})),o()("div",{style:{marginTop:16,marginBottom:32,display:"grid",gridTemplateColumns:"1fr",gap:4}},void 0,o()(mo.Z,{})))})),l()(this,"fetchBotsInSpace",(async e=>{let{spaceId:t}=e;const i=await(0,nn.Yw)({environment:this.environment,table:hi.bx,id:t,type:"guest"}),n=await(0,nn.Yw)({environment:this.environment,table:hi.bx,id:t,type:"external"});return{guestBotIds:i.botIds,externalBotIds:n.botIds}}))}renderComponent(){const{device:e}=this.environment;return o()(yo.Z,{},void 0,o()(Yt.Z,{large:!e.isMobile||void 0,divider:e.isMobile?void 0:"full",style:{paddingBottom:12}},void 0,o()(y.FormattedMessage,{id:"spaceConnectionsSettings.title",defaultMessage:"Connections",description:"Page title for workspace connections settings tab"})),this.renderRequest())}renderRequest(){const{spaceStore:e,userStore:t}=this.props;return o()(pn.Z,{requestStore:this.stores.requestStore,request:{spaceId:e.id,userId:t.id},performRequest:this.fetchBotsInSpace,render:this.renderResult})}}const bo=(0,y.injectIntl)(So);var Mo=i(36488),wo=i(56940);i(41817);function Co(e){let{title:t,description:i,onDismiss:n,icon:s,primaryAction:a,secondaryAction:r}=e;const l=(0,ei.y)((e=>({container:{position:"relative",width:"100%",padding:16},multiIconsRow:{display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between",marginBottom:12},singleIconRow:{position:"absolute",top:10,right:16},dismissButton:{marginTop:-7,marginRight:-7},title:{fontWeight:v.Z.fontWeight.medium,fontSize:v.Z.fontSize.UIRegular.desktop,lineHeight:1.2,color:e.darkTextColor,marginBottom:8},description:{fontWeight:v.Z.fontWeight.regular,fontSize:v.Z.fontSize.UISmall.desktop,color:e.lightTextColor},primaryActionButton:{width:"100%",margin:"12px auto 0"},secondaryActionButton:{width:"100%",margin:"8px auto 0",justifyContent:"center",fontWeight:v.Z.fontWeight.regular,fontSize:v.Z.fontSize.UISmall.desktop,color:e.lightTextColor},secondaryActionIcon:{width:12,height:12,marginRight:4},icon:{width:14,height:14,color:e.regularIconColor}})),[]);return o()("div",{style:l.container},void 0,s?o()("div",{style:l.multiIconsRow},void 0,o()("div",{},void 0,s),o()(Je.Z,{isSmall:!0,style:l.dismissButton,onClick:n},void 0,h.Z.closeSmall(l.icon))):o()("div",{style:l.singleIconRow},void 0,o()(Je.Z,{isSmall:!0,style:l.dismissButton,onClick:n},void 0,h.Z.closeSmall(l.icon))),o()(oi.Z,{style:l.title,isMultiline:!0},void 0,t),o()(oi.Z,{style:l.description,isMultiline:!0,isSmall:!0},void 0,i),a?o()(Ee.Z,{isLarge:!0,style:l.primaryActionButton,onClick:e=>a.onClick(e)},void 0,a.text):null,r?o()(Je.Z,{style:l.secondaryActionButton,onClick:e=>r.onClick(e)},void 0,r.icon?r.icon(l.secondaryActionIcon):null,r.text):null)}function ko(e){const t=(0,be.O7)(),i=(0,Me.VK)((()=>re.default.checkGate("domain_claim_view")),[]);return(0,u.useEffect)((()=>{const{currentSpaceStore:e}=F.default.state;i&&"enterprise"===(null==e?void 0:e.getSubscriptionTier())&&function(e){var t;const{currentSpaceViewStore:i}=F.default.state;if(!i)return;const n=null===(t=i.getSettings())||void 0===t?void 0:t.domain_claim_settings_prompt;if(!n||"dismissed"===n.status||"hidden"===n.status)return;const o={...n,num_times_shown:n.num_times_shown+1};o.num_times_shown>3&&(o.status="hidden"),A.createAndCommit({userAction:"spaceViewActions.incrementdomainClaimSettings",environment:e,perform:e=>{B(i,e,{domain_claim_settings_prompt:o})}})}(t)}),[t,i]),m().createElement(m().Fragment,null,o()(so.Z,{size:0}),o()(Co,{icon:h.Z.settingsIdentityProvisioning({width:16}),title:o()(y.FormattedMessage,{id:"enterpriseDomainClaimSettingsPrompt.title",defaultMessage:"New domain management settings",description:"Title message that shows for enterprise plans describing the new access level"}),description:o()(y.FormattedMessage,{id:"enterpriseDomainClaimSettingsPrompt.caption",defaultMessage:"Workspace owners can now view and manage workspaces created by users with your verified domains.",description:"Caption message for the domain claim prompt that shows to enterprise workspace owners."}),onDismiss:()=>R(t),primaryAction:{text:o()(y.FormattedMessage,{id:"enterpriseDomainClaimSettingsPrompt.cta",defaultMessage:"Browse workspaces",description:"Text on button CTA that redirects to the settings domain management tab when clicked"}),onClick:i=>(R(t),e.navigateToDomainManagement(i))},secondaryAction:{icon:e=>h.Z.help(e),text:o()(y.FormattedMessage,{id:"enterpriseDomainClaimSettingsPrompt.learnMore.button",defaultMessage:"Learn more",description:"Button shown in the domain claim setting prompt to enterprise users that links to the help center."}),onClick:()=>{const e=(0,V.UY)("guides.domainManagement");k.navigateToExternalURL({environment:t,url:e})}}}))}function To(e){const t=(0,be.O7)();return(0,u.useEffect)((()=>{const{currentSpaceStore:e}=F.default.state;"enterprise"===(null==e?void 0:e.getSubscriptionTier())&&function(e){var t;const{currentSpaceViewStore:i}=F.default.state;if(!i)return;const n=null===(t=i.getSettings())||void 0===t?void 0:t.enterprise_settings_prompt;if(!n||"dismissed"===n.status||"hidden"===n.status)return;const o={...n,num_times_shown:n.num_times_shown+1};o.num_times_shown>3&&(o.status="hidden"),A.createAndCommit({userAction:"spaceViewActions.incrementMembersPromptSettings",environment:e,perform:e=>{B(i,e,{enterprise_settings_prompt:o})}})}(t)}),[t]),m().createElement(m().Fragment,null,o()(so.Z,{size:0}),o()(Co,{icon:h.Z.person({width:16}),title:o()(y.FormattedMessage,{id:"enterpriseMembersSettingsPrompt.title",defaultMessage:"A new admin access level for member management",description:"Title message that shows for enterprise plans describing the new access level"}),description:o()(y.FormattedMessage,{id:"enterpriseMembersSettingsPrompt.caption",defaultMessage:"Membership admins can add and remove people to the workspace and groups. They cannot access other admin settings.",description:"Caption message for the members prompt that shows to enterprise workspace owners."}),onDismiss:()=>E(t),primaryAction:{text:o()(y.FormattedMessage,{id:"enterpriseMembersSettingsPrompt.cta",defaultMessage:"Manage members",description:"Text on button CTA that redirects to the settings members tab when clicked"}),onClick:i=>(E(t),e.onMembersTabClick(i))},secondaryAction:{icon:e=>h.Z.help(e),text:o()(y.FormattedMessage,{id:"enterpriseMembersSettingsPrompt.learnMore.button",defaultMessage:"Learn more",description:"Button shown in the members setting prompt to enterprise users that links to the help center."}),onClick:()=>{const e=(0,V.UY)("guides.enterpriseAdmins");k.navigateToExternalURL({environment:t,url:e})}}}))}var Io=i(79603),Zo=i(7406);function Po(e){let{spaceStore:t,emailDomains:i,allowedSubscriptionTiers:n}=e;const o=(0,be.O7)(),[s,a]=(0,u.useState)(i),[r,l]=(0,u.useState)({spaces:[],nextEarliestCreatedAt:Date.now(),numPagesLoaded:0,hasNextPage:!1,loading:!1,error:void 0,retryCount:0}),d=(0,Me.VK)((()=>re.default.checkGate("domain_claim_view")),[]);(0,u.useEffect)((()=>{c().isEqual(s,i)||a(i)}),[s,i]);const m=(0,u.useCallback)((async e=>{if(0===s.length)return[];if(d&&r.nextEarliestCreatedAt&&!r.loading&&!(e&&r.numPagesLoaded>0||r.retryCount>=5&&r.error)){l((e=>({...e,loading:!0})));try{const{spaces:e,earliestCreatedAt:i,hasMoreSpaces:a}=await async function(e,t,i,n,o){const s=await w.getSpacesCreatedByUserWithDomains(e,{spaceId:t,emailDomains:i,spacesLimit:10,allowedSubscriptionTiers:o,spaceCreatedTimeUpperBound:n});if("failed"===s.type)throw s.error;return{spaces:s.data.results.map((e=>({id:e.id,name:e.spaceName,icon:e.spaceIcon,createdAt:e.spaceCreatedTime,memberCount:e.memberCount,subscriptionTier:e.subscriptionTier,creatorEmailDomain:e.spaceCreatedByDomain,creator:e.spaceCreator,admins:e.admins,spaceRequest:e.spaceRequest,isDelinquent:e.isDelinquent,isActorInSpace:e.isActorInSpace}))).filter((e=>"personal"===e.subscriptionTier||"personal_free"===e.subscriptionTier||"team"===e.subscriptionTier||"team_free"===e.subscriptionTier)),earliestCreatedAt:s.data.hasMoreSpaces?s.data.earliestCreatedAt:void 0,hasMoreSpaces:s.data.hasMoreSpaces}}(o,t.id,s,r.nextEarliestCreatedAt-1,n);l((t=>{const n=[...t.spaces],o=new Set(t.spaces.map((e=>e.id)));for(const i of e)o.has(i.id)||n.push(i);return{spaces:n,nextEarliestCreatedAt:i,numPagesLoaded:t.numPagesLoaded+1,hasNextPage:a,loading:!1,error:void 0,retryCount:0}}))}catch(i){const e=(0,Zo.tg)(i);l((t=>({...t,loading:!1,error:e,retryCount:t.retryCount+1})))}}}),[o,n,t,s,d,r.nextEarliestCreatedAt,r.numPagesLoaded,r.loading,r.error,r.retryCount]);const p=(0,u.useCallback)((async()=>{await m(!1)}),[m]),g=(0,u.useCallback)((async()=>{await m(!0)}),[m]);return{claimableWorkspaces:r.spaces,loading:r.loading,error:r.error,hasNextPage:r.hasNextPage,loadFirstPage:g,loadNextPage:p,setSpaceRequest:function(e,t){l((i=>{const n=i.spaces.map((i=>i.id===e?{...i,spaceRequest:t}:i));return{...i,spaces:n}}))},removeClaimableWorkspace:function(e){l((t=>{const i=t.spaces.filter((t=>t.id!==e));return{...t,spaces:i}}))}}}const _o=["personal","personal_free"],xo=["team","team_free"],Fo="settings-page",Ao="workspaces-page";let Bo;!function(e){e[e.Personal=0]="Personal",e[e.Team=1]="Team"}(Bo||(Bo={}));const Eo=(0,u.createContext)(null),Ro=e=>{let{spaceStore:t,samlConfigStore:i,domainSettingsStore:n,children:s}=e;const a=(0,be.O7)(),[r,l]=(0,u.useState)(Fo),[d,c]=(0,u.useState)(Bo.Personal),m=(0,Me.VK)((()=>i.state.emailDomains),[i]),{loading:p,error:g,loaded:h}=function(e){let{spaceStore:t,samlConfigStore:i,domainSettingsStore:n}=e;const o=(0,be.O7)(),[{status:s,error:a}]=(0,Kn.r5)((async()=>{var e;const s=await _({environment:o,spaceId:t.id,store:i}),a=null===(e=s.samlConfig)||void 0===e?void 0:e.id;return a?{samlResponse:s,domainResponse:await n.updateValueForSpace({environment:o,spaceId:a,store:n})}:{samlResponse:s,domainResponse:void 0}}),[o,i,t,n]);return{loading:"pending"===s,loaded:"resolved"===s,error:a}}({spaceStore:t,samlConfigStore:i,domainSettingsStore:n}),{loading:f,error:v,claimableWorkspaces:y,setSpaceRequest:S,removeClaimableWorkspace:b,hasNextPage:C,loadNextPage:k,loadFirstPage:T}=Po({spaceStore:t,emailDomains:m,allowedSubscriptionTiers:_o}),{loading:I,error:Z,claimableWorkspaces:P,setSpaceRequest:x,removeClaimableWorkspace:F,hasNextPage:A,loadNextPage:B,loadFirstPage:E}=Po({spaceStore:t,emailDomains:m,allowedSubscriptionTiers:xo}),[R,D,L,O,N,U,W,V]=d===Bo.Personal?[f,v,y,S,b,C,k,T]:[I,Z,P,x,F,A,B,E],{loading:z,error:q,domainVerifications:H}=function(e){let{spaceStore:t}=e;const i=(0,be.O7)(),[n,o]=(0,u.useState)([]),[{status:s,error:a}]=(0,Kn.r5)((async()=>{const e=await w.getDomainVerificationCodesForSpace(i,{spaceId:t.id,verifiedOnly:!0});"success"===e.type?o(e.data.domainVerifications):o([])}),[i,t]);return{loading:"pending"===s,domainVerifications:"resolved"===s?n:[],error:a}}({spaceStore:t,emailDomains:m});(0,u.useEffect)((()=>{V()}),[V]);const G={page:r,navigateTo:function(e){l(e),"workspaces-page"===e&&M.trackClaimableSpacesViewed(a,{verifiedDomains:m,tab:d===Bo.Personal?"single":"multi"})},loadingSaml:p,loadingSpaces:R,loadingVerifications:z,errorSaml:g,errorClaimableSpaces:D,errorVerifications:q,loadedSaml:h,domainVerifications:H,claimableWorkspaces:L,setSpaceRequest:O,removeClaimableWorkspace:N,hasMoreClaimableWorkspaces:U,loadMoreClaimableWorkspaces:W,tab:d,setSelectedTab:function(e){c(e),"workspaces-page"===r&&M.trackClaimableSpacesViewed(a,{verifiedDomains:m,tab:e===Bo.Personal?"single":"multi"})}};return o()(Eo.Provider,{value:G},void 0,s)};function Do(e){let{environment:t,samlConfigStore:i}=e;const n=i.state.emailDomains.length>0,o=T.CM(t);return n||("business"===o||"enterprise"===o)}var Lo=i(81236);async function Oo(e){let{onRequest:t,onSuccess:i}=e;const n=await t();switch(n.type){case"success":i&&await i(n);break;case"failed":C.showErrorMessage(n.error.message);break;default:(0,H.t1)(n)}}function No(e){let{spaceStore:t,samlConfigStore:i,domainSettingsStore:n}=e;const o=(0,be.O7)(),s=(0,Me.VK)((()=>i.state.emailDomains),[i]),a=(0,Me.VK)((()=>"disabled"!==i.state.status&&"unconfigured"!==i.state.status),[i]),r=(0,Me.VK)((()=>Do({environment:o,samlConfigStore:i})),[i,o]),l=(0,Me.VK)((()=>r&&(!i.state.id||i.state.id===t.id)),[r,i,t]),d=(0,Me.VK)((()=>n.state.emailDomains.length>0&&"enterprise"===T.CM(o)),[n,o]),c=(0,Me.VK)((()=>s.length>0),[s]),m=(0,u.useCallback)((async()=>{if(i.state.emailDomains.length>0)return Oo({onRequest:()=>w.updateWorkspaceCreationForEmailDomains(o,{emailDomains:i.state.emailDomains,workspaceCreationEnum:n.state.spaceCreation,spaceId:t.id}),onSuccess:()=>{n.setState({...n.state,emailDomains:i.state.emailDomains})}})}),[o,t,n,i]),p=(0,Me.VK)((()=>r&&"enterprise"===T.CM(o)),[r,o]);return{verifiedDomains:s,isSamlStatusEnabled:a,isSamlAvailable:r,isSamlEditable:l,isDomainSettingsAvailable:d,isClaimWorkspacesAvailable:p,canSaveWorkspaceCreationSetting:c,saveWorkspaceCreationSetting:m}}function Uo(e){let{title:t,byline:i,settingItem:n}=e;const s=(0,ei.y)((e=>({settingContainer:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%"},settingLeft:{width:"60%"},settingTitle:{fontWeight:v.Z.fontWeight.regular},settingByline:{marginBottom:4}})),[]);return o()("div",{style:s.settingContainer},void 0,o()("div",{style:s.settingLeft},void 0,o()(Yt.Z,{smallMarginBottom:!0,style:s.settingTitle},void 0,t),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:s.settingByline},void 0,i)),n)}var Wo=i(93678),Vo=i(91718);function zo(e){let{title:t,byline:i,targetTier:n}=e;const s=(0,be.O7)(),a=(0,u.useCallback)((()=>Wo.y(s,{from:"space_saml",for:n})),[s,n]);return m().createElement(m().Fragment,null,o()(Yt.Z,{smallMarginBottom:!0,style:{fontWeight:v.Z.fontWeight.regular,display:"flex",alignItems:"center"}},void 0,o()("span",{style:{marginRight:8}},void 0,t),o()(Vo.Z,{subscriptionTier:n,analyticsName:"space_saml",onClick:a})),o()(oi.Z,{isSmall:!0,isMultiline:!0},void 0,i))}const qo={browseWorkspaces:o()(y.FormattedMessage,{defaultMessage:"Browse workspaces",id:"identityAndProvisioning.claimWorkspaces.button",description:"Message explaining that there are some workspaces that the user can claim."}),noWorkspaces:o()(y.FormattedMessage,{defaultMessage:"No workspaces",id:"identityAndProvisioning.claimWorkspaces.buttonEmpty",description:"Message explaining that there are no workspaces to claim."}),loadingError:o()(y.FormattedMessage,{defaultMessage:"Error loading workspaces.",id:"identityAndProvisioning.claimWorkspaces.errorByline",description:"Message explaining that there there was an error loading claimable workspaces."})};function Ho(e){let{loading:t,promptUpgrade:i,claimableWorkspaces:n,loadingError:s}=e;const{navigateTo:r}=(0,u.useContext)(Eo),l=0===n.length||t,d=0===n.length&&!t,c=o()(y.FormattedMessage,{id:"identityAndProvisioning.claimWorkspaces.title",defaultMessage:"Claim workspaces",description:"Title for this section's content being about claiming domains."}),p=o()(y.FormattedMessage,{id:"identityAndProvisioning.claimWorkspaces.message",defaultMessage:"Claim workspaces created by users with a verified domain or require owners to use an external domain.",description:"Byline talking about how workspaces created with a verified domain can be claimed."}),g=(0,ei.y)((e=>({settingContainer:{margin:"18px 0"},buttonAndErrorContainer:{display:"flex",flexDirection:"column",maxWidth:280},button:{opacity:l?.5:1,minWidth:160},settingErrorByline:{color:e.errorText,marginTop:8,fontSize:13}})),[l]);if(!(0,Me.VK)((()=>re.default.checkGate("domain_claim_view")),[]))return null;if(i)return o()(zo,{title:c,byline:p,targetTier:"enterprise"});let h;return h=t?o()(qn.Z,{}):n.length>0?qo.browseWorkspaces:qo.noWorkspaces,o()("div",{style:g.settingContainer},void 0,o()(Uo,{title:c,byline:p,settingItem:o()("div",{style:g.buttonAndErrorContainer},void 0,o()(Ue.Z,{placement:Ue.Z.Placement.Top,alignment:Ue.Z.Alignment.End,render:e=>m().createElement(jt.Z,a()({disabled:l,isLarge:!0,style:g.button,onClick:()=>r(Ao)},e),h),disableTooltip:!d,renderTooltip:()=>o()(y.FormattedMessage,{id:"identityAndProvisioning.claimWorkspaces.tooltip",defaultMessage:"There are no available workspaces to claim",description:"Tooltip explaining that the button is disabled because there are no workspaces to claim."})}),s?o()(oi.Z,{isSmall:!0,isMultiline:!0,style:g.settingErrorByline},void 0,qo.loadingError):null)}))}var Go=i(14404),Ko=i(52507),jo=i(51490);function Yo(e){let{spaceStore:t,samlConfigStore:i,promptUpgrade:n,disabled:s,saveWorkspaceCreationSetting:a}=e;const r=(0,be.O7)(),l=(0,Me.qz)(void 0,Ko.ZP),d=(0,ei.y)((()=>({flex:{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",margin:"18px 0px"},button:{opacity:s?.5:1}})),[s]),c=o()(y.FormattedMessage,{id:"identityAndProvisioning.emailDomainsSection.title",defaultMessage:"Verified domains",description:"Title describing how the content in this section is for verified email domains."}),m=o()(y.FormattedMessage,{id:"identityAndProvisioning.emailDomainsSection.byline",defaultMessage:"Verify ownership of an email domain to access advanced security features including single-sign on.",description:"Caption explaining what it means to verify a domain."}),p=(0,Me.VK)((()=>i.state.emailDomains.map(jo.f4)),[i]),g=(0,Me.VK)((()=>i.state.domainVerifications.sort(((e,t)=>e.createdAt-t.createdAt)).map(jo.UV)),[i]),h=[...p.filter((e=>!g.some((t=>t.domain===e.domain)))),...g],f=(0,u.useCallback)((async()=>{await _({environment:r,spaceId:t.id,store:i})}),[r,t,i]),S=(0,u.useCallback)((async e=>{switch(e.type){case"verified":return Oo({onRequest:()=>w.setSamlConfig(r,{spaceId:t.id,removedEmailDomains:[e.domain]}),onSuccess:()=>f()});case"unverified":case"invalid":return Oo({onRequest:()=>w.deleteDomainVerificationCode(r,{id:e.id}),onSuccess:()=>f()})}}),[r,t,f]),b=(0,u.useCallback)((()=>Oo({onRequest:()=>w.setSamlConfig(r,{spaceId:t.id}),onSuccess:()=>f()})),[r,f,t]),M=(0,u.useCallback)((async()=>{await f(),await a()}),[a,f]),C=(0,Go.Z)();return n?o()(zo,{title:c,byline:m,targetTier:C}):o()(jo.ZP,{disabled:s,domains:h,onRemoveDomain:S,domainVerificationStore:l,verificationType:"saml_config",verificationTargetId:t.id,refreshDomains:M,onClickAddDomain:b,renderOverrideAddDomainButton:e=>o()("div",{style:d.flex},void 0,o()("div",{},void 0,o()(Yt.Z,{smallMarginBottom:!0,style:{fontWeight:v.Z.fontWeight.medium}},void 0,c),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:{marginBottom:4}},void 0,m)),o()("div",{},void 0,o()(jt.Z,{disabled:s,isLarge:!0,style:d.button,onClick:e},void 0,o()(y.FormattedMessage,{defaultMessage:"Add domain",id:"securitySAMLSettings.emailDomainsSection.addDomain",description:"Button for adding a new domain verification record."}))))})}var Qo=i(61794);function Xo(e){let{domainSettingsStore:t,samlConfigStore:i,disabled:n,verifiedDomains:s,tooltip:r,saveWorkspaceCreationSetting:l}=e;const d=(0,be.O7)(),c=(0,ei.y)((()=>({settingContainer:{margin:"18px 0"}})),[]),p=(0,Me.VK)((()=>{const e=i.state.id;if(!e)return;return new Qo.Z(d,{table:hi.bx,id:e}).getName()}),[d,i]),g=(0,Me.VK)((()=>"on"===re.default.getEligibleGroup({experimentId:"domain_claim",defaultGroup:"unassigned"})),[]),h=(0,u.useCallback)((async e=>{t.setState({...t.state,spaceCreation:e}),await l(),M.trackWorkspaceCreationSettingUpdate(d,{workspace_creation:e})}),[t,l,d]),f=(0,Me.VK)((()=>s.length>0?t.state.spaceCreation:"admins_only"),[t,s]),v=(0,ii.u)();if(!g)return null;const S=o()(y.FormattedMessage,v?{id:"domainSettings.workspaceCreation.workspaceOwnersOnly.titleWithSpaceName",defaultMessage:"{primaryWorkspaceName} workspace owners",description:"Dropdown option to restrict workspace creation to workspace owners",values:{primaryWorkspaceName:p}}:{id:"domainSettings.workspaceCreation.admins_only.titleWithSpaceName",defaultMessage:"{primaryWorkspaceName} admins",description:"Dropdown option to restrict workspace creation to admins",values:{primaryWorkspaceName:p}}),b=o()(y.FormattedMessage,v?{id:"domainSettings.workspaceCreation.workspaceOwnersOnly.title",defaultMessage:"Only workspace owners",description:"Dropdown option to restrict workspace creation to workspace owners"}:{id:"domainSettings.workspaceCreation.admins_only.title",defaultMessage:"Only admins",description:"Dropdown option to restrict workspace creation to admins"});return o()(Ue.Z,{placement:Ue.Z.Placement.Top,alignment:Ue.Z.Alignment.End,render:e=>m().createElement("div",a()({},e,{style:c.settingContainer}),o()(ro.Z,{isMobile:d.device.isMobile,disabled:n,title:o()(y.FormattedMessage,{id:"domainSettings.workspaceCreation.title",defaultMessage:"Workspace creation",description:"Title of workspace creation dropdown"}),caption:o()(y.FormattedMessage,{id:"domainSettings.workspaceCreation.byline",defaultMessage:"Customize who can create new workspaces.",description:"Caption of workspace creation dropdown"}),type:"dropdown",currentOption:f,options:[{key:"unrestricted",label:o()(y.FormattedMessage,{id:"domainSettings.workspaceCreation.unrestricted.title",defaultMessage:"Anyone",description:"Dropdown option to remove restrictions on workspace creation"}),caption:o()(y.FormattedMessage,{id:"domainSettings.workspaceCreation.unrestricted.caption",defaultMessage:"Any user can create new workspaces.",description:"Caption providing more detail for how any users can create a new space with this setting"})},{key:"admins_only",label:p?S:b,caption:o()(y.FormattedMessage,v?{id:"domainSettings.workspaceCreation.workspaceOwnersOnly.captionWithSpaceName",defaultMessage:"Only workspace owners of this workspace can create new workspaces.",description:"Caption providing more detail for how only workspace owners can create a new space with this setting"}:{id:"domainSettings.workspaceCreation.admin_only.captionWithSpaceName",defaultMessage:"Only admins of this workspace can create new workspaces.",description:"Caption providing more detail for how only admins can create a new space with this setting"})}],onSelectOption:h})),disableTooltip:!r,renderTooltip:()=>r})}function Jo(e){let{spaceStore:t,samlConfigStore:i,domainSettingsStore:n}=e;const{verifiedDomains:s,isSamlAvailable:a,saveWorkspaceCreationSetting:r,isSamlEditable:l,isDomainSettingsAvailable:d,canSaveWorkspaceCreationSetting:c,isClaimWorkspacesAvailable:p}=No({spaceStore:t,samlConfigStore:i,domainSettingsStore:n}),g=(0,Me.VK)((()=>re.default.checkGate("domain_claim_view")),[]),{loadingSpaces:h,claimableWorkspaces:f,errorClaimableSpaces:v}=(0,u.useContext)(Eo),S=d&&l;return m().createElement(m().Fragment,null,o()(Yo,{disabled:!l,promptUpgrade:!a,spaceStore:t,samlConfigStore:i,saveWorkspaceCreationSetting:r}),o()(Xo,{disabled:!S||!c,verifiedDomains:s,samlConfigStore:i,domainSettingsStore:n,tooltip:0===s.length?o()(y.FormattedMessage,{id:"domainSettings.workspaceCreation.disabledTooltip",defaultMessage:"There must be at least one verified domain to configure the workspace creation setting.",description:"Tooltip explaining that the workspace creation setting is disabled if there are no verified domains."}):void 0,saveWorkspaceCreationSetting:r}),g&&o()(Ho,{claimableWorkspaces:f,promptUpgrade:!p,loading:h,loadingError:Boolean(v)}))}var $o=i(74523),es=i(24006);function ts(e){let{title:t,byline:i,isOn:n,onToggle:s,disabled:a,tooltipForDisabled:r}=e;function l(){a||s()}return o()(Ue.Z,{placement:Ue.Z.Placement.Top,alignment:Ue.Z.Alignment.End,disableTooltip:!r||!a,renderTooltip:()=>r,render:e=>m().createElement("div",e,o()(Uo,{title:t,byline:i,settingItem:o()(es.Z,{on:n,disabled:a,onClick:l})}))})}function is(e){let{spaceStore:t,samlConfigStore:i}=e;const n=(0,be.O7)();return{updateSamlIdpUrl:(0,u.useCallback)((async e=>{let o=!1;return await Oo({onRequest:()=>w.setSamlConfig(n,{spaceId:t.id,idpMetadataUrl:e}),onSuccess:()=>{o=!0,i.setState({...i.state,useMetadataUrl:!0,idpMetadataUrl:e,idpMetadata:void 0})}}),o}),[i,t,n]),updateSamlIdpXml:(0,u.useCallback)((async e=>{let o=!1;return await Oo({onRequest:()=>w.setSamlConfig(n,{spaceId:t.id,idpMetadata:e}),onSuccess:()=>{o=!0,i.setState({...i.state,useMetadataUrl:!1,idpMetadataUrl:void 0,idpMetadata:e})}}),o}),[i,t,n]),updateStatus:(0,u.useCallback)((e=>Oo({onRequest:()=>w.setSamlConfig(n,{spaceId:t.id,status:e}),onSuccess:()=>{i.setState({...i.state,status:e})}})),[i,t,n]),updateCreateAccount:(0,u.useCallback)((e=>Oo({onRequest:()=>w.setSamlConfig(n,{spaceId:t.id,createAccount:e}),onSuccess:()=>{i.setState({...i.state,createAccount:e})}})),[i,t,n])}}function ns(e){let{spaceStore:t,samlConfigStore:i,disabled:n}=e;const{updateCreateAccount:s}=is({samlConfigStore:i,spaceStore:t}),a=(0,ei.y)((()=>({settingContainer:{margin:"18px 0"}})),[]),r=(0,Me.VK)((()=>i.state.createAccount),[i]);return o()("div",{style:a.settingContainer},void 0,o()(ts,{title:o()(y.FormattedMessage,{id:"identityAndProvisioning.createAccount.title",defaultMessage:"Automatic account creation",description:"Title describing how this setting is for automatically creating accounts on sign in."}),byline:o()(y.FormattedMessage,{id:"identityAndProvisioning.createAccount.byline",defaultMessage:"Automatically create Notion accounts for new users who log in via SAML SSO.",description:"Byline further describing how this setting is for automatically creating accounts on sign in."}),isOn:r,onToggle:async function(){await s(!i.state.createAccount)},disabled:n}))}function os(e){let{spaceStore:t,samlConfigStore:i,disabled:n}=e;const s=(0,be.O7)(),{updateStatus:a}=is({samlConfigStore:i,spaceStore:t}),r=(0,ei.y)((()=>({settingContainer:{margin:"18px 0"}})),[]),l=(0,Me.VK)((()=>"enforced"===i.state.status?"enforced":"not_enforced"),[i]);return o()("div",{style:r.settingContainer},void 0,o()(ro.Z,{isMobile:s.device.isMobile,disabled:n,title:o()(y.FormattedMessage,{id:"identityAndProvisioning.accountAuth.title",defaultMessage:"Login method",description:"Title of authentication dropdown"}),caption:o()(y.FormattedMessage,{id:"identityAndProvisioning.accountAuth.byline",defaultMessage:"Customize how users access SAML SSO-enabled workspaces.",description:"Caption of authentication creation dropdown"}),type:"dropdown",currentOption:l,options:[{key:"enforced",label:o()(y.FormattedMessage,{id:"identityAndProvisioning.accountAuth.option.enforced",defaultMessage:"Only SAML SSO",description:"Dropdown option to enforce SSO on log in."})},{key:"not_enforced",label:o()(y.FormattedMessage,{id:"identityAndProvisioning.accountAuth.option.notEnforced",defaultMessage:"Any method",description:"Dropdown option to not enforce SSO on log in. Users can log in using SSO or another log method, for example, username/password."})}],onSelectOption:async function(){"enforced"===i.state.status?await a("configured"):await a("enforced")}}))}var ss=i(13991),as=i(5228),rs=i(83328);function ls(e){let{isOpen:t,...i}=e;const n=(0,Me.VK)((()=>({active:i.samlConfigStore.state.useMetadataUrl?"url":"xml",url:i.samlConfigStore.state.idpMetadataUrl||"",xml:i.samlConfigStore.state.idpMetadata||""})),[i.samlConfigStore]);return o()(Zn.Z,{open:t,onDismiss:i.onClose,render:()=>m().createElement(ds,a()({},i,{initialConfiguration:n}))})}function ds(e){let{onSaveChanges:t,initialConfiguration:i,samlConfigStore:n,spaceStore:s,onClose:a}=e;const[r,l]=(0,u.useState)(i),d=(0,be.O7)(),c=(0,ei.y)((e=>({container:{background:e.popoverBackground,width:450,padding:24,borderRadius:3,transition:"all 500ms ease"},title:{fontFamily:v.Z.getCompositeFontFamily(ss.SP).sans,fontSize:17,fontWeight:500,lineHeight:"24px",textAlign:"center"},subtitle:{fontFamily:v.Z.getCompositeFontFamily(ss.SP).sans,fontSize:14,fontWeight:500,lineHeight:"19px",margin:"20px 0 0"},copyButton:{borderRadius:3,padding:"4px 8px",display:"flex",alignItems:"center",justifyContent:"center",color:e.lightTextColor,fontFamily:v.Z.getCompositeFontFamily(ss.SP).sans,fontSize:12,fontWeight:500,lineHeight:"14px"},copyIcon:{width:16,height:16,marginRight:4,fill:e.mediumIconColor},url:{width:"100%",color:e.mediumTextColor,fontFamily:v.Z.getCompositeFontFamily(ss.SP).sans,fontSize:14,fontWeight:400,lineHeight:"18px"},readonlyInput:{display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid ".concat(e.outlineButtonBorder),height:32,paddingLeft:12,paddingRight:12,borderRadius:3},divider:{margin:"20px auto 20px"},radioContainer:{display:"flex",justifyContent:"space-evenly",flexDirection:"column",height:60},radioOption:{display:"flex",alignItems:"center"},caption:{margin:"4px 0 8px"},centeredCaption:{margin:"4px 24px 8px",textAlign:"center"},buttonContainer:{display:"flex",alignItems:"center",justifyContent:"flex-end",marginTop:24},buttonSpacing:{marginRight:8},feedback:{color:"dark"===e.mode?e.accentColors.orange[500]:e.accentColors.orange[400],display:"flex",flexDirection:"row",alignItems:"center",fontSize:"14px",height:20}})),[]),p=(0,u.useMemo)((()=>us(r)),[r]),g=(0,Me.VK)((()=>"unconfigured"===n.state.status),[n]),f=(0,Me.VK)((()=>(0,as.v9)(s.id,Kt.Z.domainBaseUrl)),[s]),S=(0,u.useCallback)((()=>{ti.RD({environment:d,stringValue:f,copiedMessage:ti.tq.copiedLinkToClipboard})}),[d,f]),b=(0,u.useCallback)((()=>{l((e=>({...e,active:"url"})))}),[]),M=(0,u.useCallback)((()=>{l((e=>({...e,active:"xml"})))}),[]),w=(0,ei.y)((e=>({input:{transition:"all 200ms ease-in-out",boxShadow:"none",margin:"12px 0",width:"100%",background:e.popoverBackground,border:"1px solid ".concat(e.outlineButtonBorder)}})),[]),C=(0,u.useMemo)((()=>"url"===r.active?{placeholder:"https://...",value:r.url,onChange:e=>{const t=e.target.value;l((e=>({...e,url:t})))},style:{height:32,...w.input}}:{placeholder:'<md:EntityDescriptor entityID="...',value:r.xml,onChange:e=>{const t=e.target.value;l((e=>({...e,xml:t})))},textarea:!0,style:{height:118,...w.input},inputStyle:{width:"100%",height:"100%"}}),[r,w]),k=(0,u.useCallback)((()=>{t(r)}),[t,r]);return o()("div",{style:c.container},void 0,o()(oi.Z,{style:c.title},void 0,o()(y.FormattedMessage,{id:"identityAndProvisioning.editSamlConfig.title",defaultMessage:"SAML SSO Configuration",description:"Modal title indicating the content is about configuring SAML settings."})),o()(oi.Z,{isSmall:!0,style:c.centeredCaption,isMultiline:!0},void 0,o()(y.FormattedMessage,{id:"identityAndProvisioning.editSamlConfig.byline",defaultMessage:"Configure SAML SSO for your Notion workspace with your Identity Provider (IDP). <guidelink>Learn more</guidelink>.",description:"Label explaining what to do with the Assertion Consumer Service (ACS) URL.",values:{guidelink:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()(ao.Z,{href:(0,V.UY)("guides.samlSettings"),external:!0},void 0,t)}}})),o()(oi.Z,{style:c.subtitle},void 0,o()(y.FormattedMessage,{id:"identityAndProvisioning.editSamlConfig.acsTitle",defaultMessage:"Assertion Consumer Service (ACS) URL",description:"Label indicating the URL below is the Assertion Consumer Service (ACS) URL."})),o()(oi.Z,{isSmall:!0,style:c.caption,isMultiline:!0},void 0,o()(y.FormattedMessage,{id:"identityAndProvisioning.editSamlConfig.acsByline",defaultMessage:"Enter this in your IDP's SAML configuration.",description:"Label explaining what to do with the Assertion Consumer Service (ACS) URL."})),o()("div",{style:c.readonlyInput},void 0,o()(oi.Z,{style:c.url},void 0,f),o()(ni.Z,{onClick:S,style:c.copyButton},void 0,h.Z.copy(c.copyIcon),o()(y.FormattedMessage,{id:"verifyDomainModal.editSamlConfig.copy",defaultMessage:"Copy",description:"Button for copying the SSO URL."}))),o()(oi.Z,{style:c.subtitle},void 0,o()(y.FormattedMessage,{id:"identityAndProvisioning.editSamlConfig.idpTitle",defaultMessage:"Identity Provider Details",description:"Label indicating the fields below are for the IDP details."})),o()(oi.Z,{isSmall:!0,style:c.caption},void 0,o()(y.FormattedMessage,{id:"identityAndProvisioning.editSamlConfig.idpUrlByline",defaultMessage:"Enter the value provided by your IDP.",description:"Label explaining what to do with the IDP SAML URL."})),o()("div",{style:c.radioContainer},void 0,o()(Je.Z,{style:c.radioOption,onClick:b},void 0,o()(rs.Z,{isSelected:"url"===r.active}),o()(oi.Z,{},void 0,o()(y.FormattedMessage,{id:"identityAndProvisioning.editSamlConfig.idpUrl",defaultMessage:"Identity Provider URL",description:"Describes the value of this button to be for the IDP URL"}))),o()(Je.Z,{style:c.radioOption,onClick:M},void 0,o()(rs.Z,{isSelected:"xml"===r.active}),o()(oi.Z,{},void 0,o()(y.FormattedMessage,{id:"identityAndProvisioning.editSamlConfig.idpXml",defaultMessage:"Identity Provider Metadata XML",description:"Describes the value of this button to be for the IDP XML"})))),m().createElement(lt.Z,C),o()("div",{style:c.feedback},void 0,o()(cs,{validation:p})),o()("div",{style:c.buttonContainer},void 0,o()(jt.Z,{isLarge:!0,style:c.buttonSpacing,onClick:a},void 0,o()(y.FormattedMessage,{id:"identityAndProvisioning.editSamlConfig.cancel",defaultMessage:"Cancel",description:"Button that cancels changes"})),o()(Ee.Z,{isLarge:!0,disabled:"invalid"===p.type,onClick:k},void 0,o()(y.FormattedMessage,g?{id:"identityAndProvisioning.editSamlConfig.enableSaml",defaultMessage:"Enable SAML",description:"Button that saves changes and enables SAML"}:{id:"identityAndProvisioning.editSamlConfig.saveChanges",defaultMessage:"Save changes",description:"Button that saves changes"}))))}function cs(e){let t,{validation:i}=e;if("valid"===i.type)return null;switch(i.reason){case"empty":t=o()(y.FormattedMessage,{id:"identityAndProvisioning.editSamlConfig.feedback.empty",defaultMessage:"You cannot leave this field blank",description:"Feedback message explaining this field cannot be left blank."});break;case"signed_request":t=o()(y.FormattedMessage,{id:"identityAndProvisioning.editSamlConfig.feedback.signed_request",defaultMessage:"Requests cannot be signed",description:"Feedback message explaining the WantAuthnRequestsSigned property must be set to false"})}return m().createElement(m().Fragment,null,h.Z.warning({height:16,width:16,margin:"0 4px 0 8px"}),o()("span",{},void 0,t))}function us(e){return"url"===e.active?(0,as.jY)(e.url):"xml"===e.active?(0,as.a7)(e.xml):void(0,H.t1)(e.active)}function ms(e){let{spaceStore:t,samlConfigStore:i,domainSettingsStore:n,isSamlStatusEnabled:s,promptUpgrade:a,disabled:r}=e;const[l,d]=(0,u.useState)({isOpened:!1,enableSamlOnSave:!1}),{updateStatus:c,updateSamlIdpUrl:p,updateSamlIdpXml:g}=is({samlConfigStore:i,spaceStore:t}),{verifiedDomains:h}=No({spaceStore:t,samlConfigStore:i,domainSettingsStore:n}),f=(0,Go.Z)(),S=(0,ei.y)((()=>({settingContainer:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",cursor:r?"default":"pointer"},settingTitle:{fontWeight:v.Z.fontWeight.medium},settingByline:{marginBottom:4},configButton:{marginTop:14,opacity:r?.5:1}})),[r]),b=o()(y.FormattedMessage,{id:"identityAndProvisioning.samlToggle.title",defaultMessage:"Enable SAML SSO",description:"Title describing how the content in this section is for verified email domains."}),M=o()(y.FormattedMessage,{id:"identityAndProvisioning.samlToggle.byline",defaultMessage:"Anyone using email addresses with a verified domain can log in via SAML SSO.",description:"Byline describing how enabling SAML will use verified email domains for SSO."});return a?o()(zo,{title:b,byline:M,targetTier:f}):m().createElement(m().Fragment,null,o()(ts,{title:b,byline:M,isOn:s,disabled:r,tooltipForDisabled:0===h.length?o()(y.FormattedMessage,{id:"identityAndProvisioning.samlToggle.disabledTooltipNoVerifiedDomains",defaultMessage:"Verify a domain to enable SAML.",description:"Tooltip explaining that SAML configuration is disabled if there are no verified domains."}):void 0,onToggle:function(){if(r)return;const{useMetadataUrl:e,idpMetadata:t,idpMetadataUrl:n}=i.state,o=e&&n||!e&&t;switch(i.state.status){case"disabled":o?c("configured"):d({isOpened:!0,enableSamlOnSave:!0});break;case"unconfigured":d({isOpened:!0,enableSamlOnSave:!0});break;case"configured":case"enforced":c("disabled")}}}),o()(jt.Z,{disabled:r,isLarge:!0,style:S.configButton,onClick:function(){r||d({isOpened:!0,enableSamlOnSave:!1})}},void 0,o()(y.FormattedMessage,{id:"identityAndProvisioning.samlToggle.configure",defaultMessage:"Edit SAML SSO configuration",description:"Button for opening the modal that allows the user to configure their SSO configuration."})),o()(ls,{isOpen:l.isOpened,onClose:()=>d({isOpened:!1,enableSamlOnSave:!1}),onSaveChanges:async function(e){if("invalid"===us(e).type)return;let t=!1;switch(e.active){case"url":t=await p(e.url);break;case"xml":t=await g(e.xml)}t&&(l.enableSamlOnSave&&await c("configured"),d({isOpened:!1,enableSamlOnSave:!1}))},spaceStore:t,samlConfigStore:i}))}var ps=i(39634),gs=(i(65069),i(40394));const hs={id:"name",headerTitle:o()(y.FormattedMessage,{id:"identityAndProvisioning.secondaryWorkspaces.table.name",description:"Title of the 'Name' column in the secondary workspaces table.",defaultMessage:"Name"}),renderCell:e=>o()(oi.Z,{},void 0,e.space.name),widthData:{width:50},sortable:!0},fs={id:"memberCount",headerTitle:o()(y.FormattedMessage,{id:"identityAndProvisioning.secondaryWorkspaces.table.memberCount",description:"Title of the 'Members' column in the secondary workspaces table.",defaultMessage:"Members"}),renderCell:e=>o()(oi.Z,{},void 0,o()(y.FormattedMessage,{id:"identityAndProvisioning.secondaryWorkspaces.table.members",description:"Describes how many members are in the row.",defaultMessage:"{count} members",values:{count:e.space.memberCount}})),widthData:{width:20},sortable:!0},vs={id:"createdAt",headerTitle:o()(y.FormattedMessage,{id:"identityAndProvisioning.secondaryWorkspaces.table.plan",description:"Title of the 'Created At' column in the secondary workspaces table.",defaultMessage:"Created at"}),renderCell:e=>o()(oi.Z,{},void 0,ho()(e.space.createdTime).format("MMM D, YYYY")),widthData:{width:20},sortable:!0},ys=[hs,fs,vs];function Ss(e){let{spaces:t}=e;const[i,n]=(0,u.useState)({column:hs,sortAscending:!1}),s=t.map((e=>({id:e.id,isClickable:!1,space:e}))),a=(0,ei.y)((e=>(0,gs.b)({columnRenderInfo:ys,theme:e,containerMarginTop:12})),[]);return o()(gs.D,{hideHeaderRowPadding:!0,columnRenderInfo:ys,rows:bs(s,i),sortState:i,onSortStateChanged:n,renderNoRowsComponent:()=>o()(oi.Z,{isSmall:!0,style:{marginTop:15,marginBottom:40,textAlign:"center"}},void 0,o()(y.FormattedMessage,{id:"identityAndProvisioning.secondaryWorkspaces.empty",defaultMessage:"No linked workspaces.",description:"Message displayed on the table that shows linked workspaces if there are no workspaces to show."})),styles:a})}function bs(e,t){let{column:i,sortAscending:n}=t,o=[];switch(i.id){case"name":o=c().sortBy(e,(e=>e.space.name));break;case"createdAt":o=c().sortBy(e,(e=>e.space.createdTime));break;case"memberCount":o=c().sortBy(e,(e=>e.space.memberCount))}return n?o:o.reverse()}function Ms(e){let{spaceStore:t,spaceIds:i}=e;const n=(0,be.O7)(),s=(0,ei.y)((()=>({settingContainer:{margin:"18px 0"}})),[]),a=(0,Me.VK)((()=>i.map((e=>Lo.Z.getPublicSpaceData(n,e)||void 0)).filter(H.$K)),[i,n]),r=(0,u.useCallback)((()=>{ps.j({environment:n,from:"saml_settings",prepopulatedContent:"Request to add or remove a workspace for SAML Single Sign-on on workspace ".concat(t.id,".")})}),[t,n]);return o()("div",{style:s.settingContainer},void 0,o()(Uo,{title:o()(y.FormattedMessage,{id:"identityAndProvisioning.secondaryWorkspaces.title",defaultMessage:"Linked workspaces",description:"Title describing that this section contains linked workspaces."}),byline:o()(y.FormattedMessage,{id:"identityAndProvisioning.secondaryWorkspaces.message",defaultMessage:"This SAML SSO configuration applies to the following other workspaces. <contactlink>Contact support</contactlink> to add or remove a workspace.",description:"Describes that the SSO configuration on this page is being applied to the following workspaces.",values:{contactlink:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()(ao.Z,{onClick:r},void 0,t)}}}),settingItem:null}),o()(Ss,{spaces:a}))}function ws(e){let{spaceStore:t,samlConfigStore:i,domainSettingsStore:n}=e;const{verifiedDomains:s,isSamlAvailable:a,isSamlEditable:r,isSamlStatusEnabled:l}=No({spaceStore:t,samlConfigStore:i,domainSettingsStore:n}),d=!r||!a||!l,c=(0,Me.VK)((()=>i.state.spaceIds.filter((e=>e!==t.id))),[i,t]);return m().createElement(m().Fragment,null,o()($o.Z,{title:o()(y.FormattedMessage,{id:"identityAndProvisioning.samlToggle.learnMore",defaultMessage:"Learn about SAML SSO",description:"Button that links to help center that talks about SAML SSO."}),href:(0,V.UY)("guides.samlSettings"),style:{marginTop:18,marginBottom:16},analyticsFrom:"saml_settings"}),o()(ms,{disabled:!r||0===s.length,promptUpgrade:!a,isSamlStatusEnabled:l,spaceStore:t,samlConfigStore:i,domainSettingsStore:n}),o()(os,{disabled:d,spaceStore:t,samlConfigStore:i}),o()(ns,{disabled:d,spaceStore:t,samlConfigStore:i}),o()(Ms,{spaceStore:t,spaceIds:c}))}const Cs=(0,y.defineMessages)({failedCreatingNewScimToken:{id:"scimTokenSettings.error.failedCreatingNewScimToken",defaultMessage:"Failed to create a new SCIM token, please try again later.",description:"The error message shown when a SCIM token cannot be created."}});function ks(e){const[t,i]=(0,u.useState)(!1),n=(0,be.O7)();const s=!t&&"Able"===e.tokenCreationAbility,r=t||"Able"!==e.tokenCreationAbility,l=o()(Je.Z,{isBlue:s,isLightGray:r,disabled:r,style:{position:"relative",marginLeft:"auto",marginRight:0},icon:e=>h.Z.plus({...e,width:14,height:14,fill:"inherit",marginRight:"6px"}),onClick:async function(){i(!0);try{const t=await async function(e){let{environment:t,spaceStore:i,userStore:n}=e;const{botStore:o,transactionPromise:s}=(0,nn.bf)({environment:t,spaceStore:i,name:"SCIM",userId:n.id,spaceRole:"editor",type:"scim"});return await s,o.id}({...e,environment:n});e.onNewScimToken(t)}catch(t){C.showErrorMessage(Te.default.formatMessage(Cs.failedCreatingNewScimToken))}i(!1)}},void 0,o()(y.FormattedMessage,{id:"scimTokenSettings.NewSCIMTokenButton.title",defaultMessage:"Add token",description:"Button to create a new SCIM token."}));let d;switch(e.tokenCreationAbility){case"Able":return l;case"Undefined":d=o()(y.FormattedMessage,{defaultMessage:"Not able to create a new SCIM token right now. Please try again later.",id:"scimTokenSettings.NewSCIMTokenButton.unableToCreateTokenMessage.undefined",description:"Message shown when the user cannot create a new SCIM token just yet. We might be waiting to hear back from the server and update the status."});break;case"SpaceHasExistingToken":d=o()(y.FormattedMessage,{defaultMessage:"To create a new SCIM token, please revoke the existing token.",id:"scimTokenSettings.NewSCIMTokenButton.unableToCreateTokenMessage.spaceHasLegacyToken",description:"Message shown when the user cannot create a new SCIM token because an existing one is present. They must first revoke that token to create a new one."});break;case"UserHasExistingToken":d=o()(y.FormattedMessage,{defaultMessage:"You already have a registered SCIM token. To create a new one, please revoke the token created by you.",id:"scimTokenSettings.NewSCIMTokenButton.unableToCreateTokenMessage.userHasExistingToken",description:"Message shown when the user already has a new SCIM token, and cannot create another one."});break;default:(0,H.t1)(e.tokenCreationAbility)}return o()(Ue.Z,{textWrap:!1,renderTooltip:()=>d,placement:Ue.Z.Placement.Right,render:e=>m().createElement("div",a()({},e,{style:{paddingLeft:"4px"}}),l)})}function Ts(e){let{userId:t,currentSpaceStore:i}=e;return Mt.Z.createChildStore(i,{table:Ce.KJ,id:t})}var Is=i(62385);const Zs={container:{display:"flex",alignItems:"center",fontSize:v.Z.fontSize.UIRegular.desktop,overflow:"hidden"},userAvatar:{paddingRight:6},userName:{flexShrink:1,...v.Z.textOverflowStyle}};function Ps(e){let{userStore:t,componentAfterName:i}=e;const n=(0,y.useIntl)(),s=(0,Me.VK)((()=>null==t?void 0:t.getValue()),[t]),a=(0,Me.VK)((()=>{if(s)return(0,Ce.Nz)(n,s)}),[s,n]);return o()("div",{style:Zs.container},void 0,o()(Hn.Z,{style:Zs.userAvatar,avatarShouldShowShadow:!0,userValue:s,size:20}),o()("div",{style:Zs.userName},void 0,a),i)}function _s(e,t){return e.created_by_table===Ce.KJ&&e.created_by_id===(null==t?void 0:t.id)}const xs={buttonStyle:{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:3,height:20,width:20,marginRight:1},menuItemButton:{minWidth:200}};function Fs(e){let{onRevokeToken:t}=e;const i=(0,ei.F)();return m().createElement(m().Fragment,null,o()(Ue.Z,{textWrap:!1,renderTooltip:()=>m().createElement(m().Fragment,null,o()(y.FormattedMessage,{defaultMessage:"Revoke this token.",id:"revokeTokenButton.tooltip"})),placement:Ue.Z.Placement.Right,render:e=>o()(Qe.Z,{popupType:Qe.Z.PopupType.Popup,placementToOrigin:Qe.Z.Placement.Right,renderOrigin:t=>m().createElement(ni.Z,a()({className:N.TA,style:xs.buttonStyle,mobileFeedback:!1},e,t),h.Z.trash({fill:i.mediumIconColor,width:12,height:12})),onClick:()=>{C.confirmUserAction({message:o()(y.FormattedMessage,{id:"manageSCIMTokenTable.ConfirmDeletingTokenModal.message",defaultMessage:"Are you sure you want to revoke this token?",description:"Title of the modal asking admin users if they want to revoke a SCIM token."}),description:o()(y.FormattedMessage,{id:"manageSCIMTokenTable.ConfirmDeletingTokenModal.description",defaultMessage:"Existing SCIM configurations that use this token will no longer work once the token is revoked, and you'll have to provide them with a new token.",description:"Body of the modal asking admin users if they want to revoke a SCIM token, and explaining that integrations that use the token will only work again once a new token is generated and provided to the integration."}),acceptLabel:o()(y.FormattedMessage,{id:"manageSCIMTokenTable.ConfirmDeletingTokenModal.acceptButton.label",defaultMessage:"Revoke token",description:"Button confirming that the SCIM token will be revoked."}),cancelLabel:o()(y.FormattedMessage,{id:"manageSCIMTokenTable.ConfirmDeletingTokenModal.cancelButton.label",defaultMessage:"Cancel",description:"Button cancelling the action of deleting a SCIM token."})}).then((e=>e&&t()))},render:e=>(e.close(),m().createElement(m().Fragment,null))})}))}const As=()=>{const e=(0,ei.F)();return o()(Ue.Z,{textWrap:!1,renderTooltip:()=>m().createElement(m().Fragment,null,o()(y.FormattedMessage,{defaultMessage:"Outdated token. Revoke this token and generate a new one to view its contents.",id:"manageScimTokenTable.OutdatedWarningIcon.tooltip"})),placement:Ue.Z.Placement.Right,render:t=>m().createElement("div",a()({},t,{style:{paddingLeft:"4px"}}),h.Z.warning({fill:(0,g.fi)("orange",e).fill,width:12,height:12}))})};function Bs(e){let{clipboardTextFn:t}=e;const i=(0,be.O7)();const n=(0,ei.F)(),s={height:25,background:n.whiteButtonBackground,color:n.regularTextColor,fontWeight:v.Z.fontWeight.regular,padding:"4px 6px",fontSize:11.5};return o()(Is.Z,{onClick:async function(){const e=await t();void 0!==e&&ti.RD({environment:i,stringValue:e,copiedMessage:ti.tq.copiedTokenToClipboard,showCopyModal:!!i.device.isSafari||void 0})},style:s},void 0,h.Z.copy({height:16,width:16,paddingRight:4}),o()(y.FormattedMessage,{defaultMessage:"Copy",id:"codeBlock.copyToClipboard.button"}))}const Es="•••••••••••";function Rs(){return o()(Ue.Z,{textWrap:!1,renderTooltip:()=>o()(y.FormattedMessage,{defaultMessage:"This token can only be viewed by its creator.",id:"manageScimTokenTable.renderTokenThatCannotBeViewed.tooltip"}),placement:Ue.Z.Placement.Right,render:e=>m().createElement("div",e,Es)})}function Ds(e){let{row:t}=e;const i=(0,be.O7)();return t.legacy?m().createElement(m().Fragment,null,Es,o()(As,{})):t.ownedByCurrentUser?m().createElement(m().Fragment,null,Es,o()(Bs,{clipboardTextFn:()=>(0,nn.VG)({environment:i,botId:t.id})})):o()(Rs,{})}const Ls={id:"token",headerTitle:o()(y.FormattedMessage,{id:"manageScimTokenTable.columnTitle.token",description:"Title of the 'Token' column in the manage SCIM token table.",defaultMessage:"Token"}),renderCell:e=>o()(Ds,{row:e}),widthData:{width:40},sortable:!1,hasClickableContents:!0},Os=()=>{const e=Zs;return o()(Ue.Z,{textWrap:!1,renderTooltip:()=>o()(y.FormattedMessage,{defaultMessage:"This token was created by a user who is no longer an admin in the workspace.",id:"scimTableLegacyUserCell.tooltip"}),placement:Ue.Z.Placement.Right,render:t=>m().createElement("div",t,o()("div",{style:e.container},void 0,o()(Hn.Z,{style:e.userAvatar,avatarShouldShowShadow:!0,size:20}),o()("div",{style:e.userName},void 0,o()("i",{},void 0,"Deactivated user"))))})},Ns={id:"addedBy",headerTitle:o()(y.FormattedMessage,{id:"manageScimTokenTable.columnTitle.addedBy",description:"Title of the 'Added by' column in the manage SCIM token table.",defaultMessage:"Added by"}),renderCell:e=>{if(e.legacy)return o()(Os,{});{const t=e.ownedByCurrentUser?o()(oi.Z,{isSecondaryColor:!0,style:{marginLeft:4,textAlign:"center"}},void 0,o()(y.FormattedMessage,{id:"manageSCIMTokenTable.colums.addedBy.selfIndicator",defaultMessage:"(you)",description:"Displayed next to a user's name to indicate they're the user who generated a SCIM token. Example: John Doe (you)"})):m().createElement(m().Fragment,null);return o()(Ps,{userStore:e.ownerUserStore,componentAfterName:t})}},widthData:{width:40},sortable:!1,hasClickableContents:!1},Us={id:"created",headerTitle:o()(y.FormattedMessage,{id:"manageScimTokenTable.columnTitle.created",description:"Title of the 'Created' (i.e. when it was created) column in the manage SCIM token table.",defaultMessage:"Created"}),renderCell:e=>m().createElement(m().Fragment,null,(0,Zt.default)(e.createdAt).locale(e.userLocale).format(j.YF)),widthData:{width:40},sortable:!0,hasClickableContents:!1},Ws=[Ls,Ns,Us,{id:"revokeToken",headerTitle:void 0,renderCell:e=>o()(Fs,{onRevokeToken:()=>{e.onRevokeToken()}}),widthData:{width:10},sortable:!1,hasClickableContents:!0}];function Vs(e,t){let{column:i,sortAscending:n}=t;const o=null==i?void 0:i.id;let s=e=>e.id;switch(o){case"name":s=e=>e.name;break;case"created":s=e=>e.createdAt;break;case"token":case"addedBy":case"revokeToken":case void 0:break;default:(0,H.t1)(o)}const a=c().sortBy(e,s);return n||a.reverse(),a}function zs(e){let{botStores:t,onRevokeToken:i}=e;const[{currentUserStore:n,currentSpaceStore:s}]=(0,Me.oR)(F.default),a=(0,y.useIntl)(),r=(0,Me.VK)((()=>{if(!s)return[];const e=null==n?void 0:n.getValue();return c().compact(t.map((t=>{const n=t.getValue();if(!n||!(0,Gn.xe)(n))return;const o={id:n.id,isClickable:!1,createdAt:n.created_at,userLocale:a.locale,name:n.name,onRevokeToken:()=>{i(n.id)}},r="notion_user"===(l=n).created_by_table&&l.created_by_id===Ce.s$.id;var l;return r?{...o,legacy:r}:{...o,legacy:r,ownedByCurrentUser:_s(n,e),ownerUserStore:"notion_user"===n.created_by_table?Ts({userId:n.created_by_id,currentSpaceStore:s}):void 0}})))}),[t,s,n,a.locale,i]),[l,d]=(0,u.useState)({column:Us,sortAscending:!1}),p=(0,ei.y)((e=>(0,gs.b)({columnRenderInfo:Ws,theme:e,containerMarginTop:0})),[]);return o()(gs.D,{columnRenderInfo:Ws,rows:Vs(r,l),sortState:l,onSortStateChanged:d,onRowClick:()=>m().createElement(m().Fragment,null),renderNoRowsComponent:()=>o()(oi.Z,{isSmall:!0,style:{marginTop:15,marginBottom:40,textAlign:"center"}},void 0,o()(y.FormattedMessage,{id:"manageSCIMTokenTable.noTokensFound.message",defaultMessage:"No active SCIM tokens.",description:"Message displayed on the table that shows SCIM tokens if there are no active tokens."})),styles:p})}async function qs(e){let{environment:t,spaceId:i}=e;return(await(0,nn.Yw)({environment:t,table:hi.bx,id:i,type:"scim"})).botIds}const Hs=function(e){let{botIds:t,setBotIds:i,spaceStore:n}=e;const s=(0,be.O7)(),a=n.id;if((0,u.useEffect)((()=>{void 0===t&&qs({environment:s,spaceId:a}).then(i)}),[t,s,i,a]),t){const e=t.map((e=>(0,bt.Kv)(n,{table:we.cZ,id:e,spaceId:a})));return o()(zs,{botStores:e,onRevokeToken:e=>{(0,nn.P0)({environment:s,botId:e,onSuccess:()=>{qs({environment:s,spaceId:a}).then(i)}})}})}return o()(qn.Z,{})};var Gs=i(6906),Ks=i(84619),js=i(89101),Ys=i(5851),Qs=i(33689),Xs=i(78454),Js=i(5478),$s=i(85567),ea=i(719),ta=i(69435);class ia extends p.Z{constructor(){super(...arguments),l()(this,"storeTypes",{tokenOptionsButtonPopupStore:jn.Z,domainVerificationStore:Ko.ZP}),l()(this,"removeDomainVerification",(async e=>{switch(e.type){case"verified":this.removeEmailDomainFromSAMLConfig(e.domain),await this.saveSamlConfig(),this.props.securitySettingsStore.state.error&&C.showError(this.props.securitySettingsStore.state.error);break;case"unverified":case"invalid":{const t=await w.deleteDomainVerificationCode(this.environment,{id:e.id});"success"===t.type?await _({environment:this.environment,spaceId:this.props.spaceStore.id,store:this.props.samlConfigStore}):"failed"===t.type&&C.showErrorMessage(t.error.message);break}}})),l()(this,"handleDisablePublicAccessSwitcherClick",(async()=>{const{securitySettingsStore:e}=this.props,t=e.state.disablePublicAccess;if(!t){if(!(await C.confirmUserAction({message:o()(y.FormattedMessage,{id:"securitySAMLSettings.preventPublicSharing.confirmationModal.message",defaultMessage:"Are you sure? This will remove access for anyone who is not a member or guest of the workspace from all pages in this workspace."}),acceptLabel:o()(y.FormattedMessage,{id:"securitySAMLSettings.preventPublicSharing.confirmationModal.confirmButton.label",defaultMessage:"Yes"})})))return}e.setState({...e.state,disablePublicAccess:!t})})),l()(this,"handleAllowDisableGuestsSwitcherClick",(async()=>{const{securitySettingsStore:e}=this.props,t=e.state.disableGuests;if(!t){if(!(await C.confirmUserAction({message:o()(y.FormattedMessage,{id:"securitySAMLSettings.disableGuests.confirmationModal.message",defaultMessage:"Are you sure? All guests in this workspace will be removed."}),acceptLabel:o()(y.FormattedMessage,{id:"securitySAMLSettings.disableGuests.confirmationModal.confirmButton.label",defaultMessage:"Yes"})})))return}e.setState({...e.state,disableGuests:!t})})),l()(this,"handleDisableMoveToSwitcherClick",(()=>{const{securitySettingsStore:e}=this.props;e.setState({...e.state,disableMoveToSpace:!e.state.disableMoveToSpace})})),l()(this,"handleAllowDisableWorkspaceTopLevelSwitcherClick",(()=>{const{securitySettingsStore:e}=this.props;e.setState({...e.state,disableSpacePageEdits:!e.state.disableSpacePageEdits})})),l()(this,"handleDisableExportClick",(()=>{const{securitySettingsStore:e}=this.props;e.setState({...e.state,disableExport:!e.state.disableExport})})),l()(this,"handleDisablePublicAccessRequestsClick",(()=>{const{securitySettingsStore:e}=this.props;e.setState({...e.state,disablePublicAccessRequests:!e.state.disablePublicAccessRequests})})),l()(this,"handleUpdateClick",(async()=>{const[,,e]=await Promise.all([Ys.n(this.environment,{securitySettingsState:this.props.securitySettingsStore.state,spaceStore:this.props.spaceStore}),this.saveSamlConfig(),this.saveWorkspaceCreationSetting()]);this.props.securitySettingsStore.state.error?C.showError(this.props.securitySettingsStore.state.error):"failed"===(null==e?void 0:e.type)?C.showError(e):this.closeSettings()})),l()(this,"handleCancelClick",(()=>{this.closeSettings()})),l()(this,"handleEnableSamlToggle",(()=>{if(!this.isSamlEditable())return;const{state:e}=this.props.samlConfigStore,t=!this.isInvalidSamlConfig(e);"unconfigured"===e.status||"disabled"===e.status?t&&this.props.samlConfigStore.setState({...e,status:"configured"}):this.props.samlConfigStore.setState({...e,status:t?"disabled":"unconfigured"})})),l()(this,"handleIdpMetadataUrlChange",(e=>{this.props.samlConfigStore.setState({...this.props.samlConfigStore.state,idpMetadataUrl:e.target.value})})),l()(this,"handleIdpMetadataUrlBlur",(e=>{Boolean(e.target.value)&&this.setUseMetadataUrl(!0)})),l()(this,"handleIdpMetadataChange",(e=>{this.props.samlConfigStore.setState({...this.props.samlConfigStore.state,idpMetadata:e.target.value})})),l()(this,"handleIdpMetadataBlur",(e=>{Boolean(e.target.value)&&this.setUseMetadataUrl(!1)})),l()(this,"handleEnforceSamlToggle",(()=>{const{state:e}=this.props.samlConfigStore;this.isSamlEditable()&&("enforced"===e.status?this.props.samlConfigStore.setState({...e,status:"configured"}):"configured"!==e.status||this.isInvalidSamlConfig(e)||this.props.samlConfigStore.setState({...e,status:"enforced"}))})),l()(this,"handleCreateAccountToggle",(()=>{const{state:e}=this.props.samlConfigStore;this.isSamlEditable()&&this.props.samlConfigStore.setState({...e,createAccount:!e.createAccount})})),l()(this,"handleEmailDomainContactUsClick",(()=>{ps.j({environment:this.environment,from:"saml_settings",prepopulatedContent:"Request to add or change an email domain for SAML Single Sign-on on workspace ".concat(this.props.spaceStore.id,".")})})),l()(this,"handleWorkspaceContactUsClick",(()=>{ps.j({environment:this.environment,from:"saml_settings",prepopulatedContent:"Request to add or remove a workspace for SAML Single Sign-on on workspace ".concat(this.props.spaceStore.id,".")})})),l()(this,"handleUpgradeClick",(()=>{Wo.y(this.environment,{from:"space_saml",for:this.getUpsellTier()})})),l()(this,"setUseMetadataUrl",(e=>{this.props.samlConfigStore.setState({...this.props.samlConfigStore.state,useMetadataUrl:e})}))}renderComponent(){if(!cn.Z.state.online)return this.renderOfflineMessage();return"on"===re.default.getEligibleGroup({experimentId:"split_identity_provisioning",defaultGroup:"unassigned"})?o()(yo.Z,{},void 0,this.renderSecuritySettings()):o()(yo.Z,{controlRow:this.renderControlRow()},void 0,this.renderSecuritySettings(),this.renderSamlSettings(),this.renderScimSettings(),this.renderSetupInformationSettings())}renderUpsell(){if((0,Qs.J)({environment:this.environment}))return;const e=this.getUpsellTier();return o()("div",{style:{border:"1px solid ".concat(this.theme.regularDividerColor),borderRadius:3,padding:16,marginTop:(0,W.uT)(this.environment)?void 0:24,marginBottom:24}},void 0,o()(ta.Z,{for:e,from:"space_saml",icon:h.Z.key,title:o()(y.FormattedMessage,{id:"securitySAMLSettings.upsell.title",defaultMessage:"Upgrade for advanced security, SAML & SCIM"}),caption:o()(y.FormattedMessage,{id:"securitySAMLSettings.upsell.caption",defaultMessage:"Upgrade to the {upsellTier} Plan for advanced security settings, SAML single sign-on, and automated user and group provisioning.",values:{upsellTier:(0,Gs.Z)(e)}}),learnMoreRoute:"guides.securitySettings"}))}renderSecuritySettings(){const{securitySettingsStore:e}=this.props,t=.5,i=o()(Vo.Z,{subscriptionTier:this.getUpsellTier(),analyticsName:"space_saml",onClick:this.handleUpgradeClick,desktopStyle:{display:"inline-block",marginLeft:8,marginTop:-3}}),n=n=>o()("div",{},void 0,o()("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:n?this.handleDisablePublicAccessSwitcherClick:this.handleUpgradeClick},void 0,o()("div",{style:this.getTitleStyle()},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.securitySection.preventPublicSharing.label",defaultMessage:"Disable public page sharing"}),!n&&i,o()(oi.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.securitySection.preventPublicSharing.caption",defaultMessage:"Disable the Share to web option in the Share menu on every page in this workspace."}))),o()("div",{style:{marginTop:5,opacity:n?void 0:t}},void 0,o()(es.Z,{on:e.state.disablePublicAccess,disabled:!n}))),o()(so.Z,{size:24,style:{opacity:0}})),s=n=>{if(!(0,z.bq)())return o()("div",{},void 0,o()("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:n?this.handleAllowDisableWorkspaceTopLevelSwitcherClick:this.handleUpgradeClick},void 0,o()("div",{style:this.getTitleStyle()},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.securitySection.disableSpacePageEdits.label",defaultMessage:"Prevent members from editing the Workspace section"}),!n&&i,o()(oi.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"85%"}},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.securitySection.disableSpacePageEdits.caption",defaultMessage:"Disable the ability for members to create, move, reorder, and delete top-level Workspace pages."}))),o()("div",{style:{marginTop:5,opacity:n?void 0:t}},void 0,o()(es.Z,{on:e.state.disableSpacePageEdits,disabled:!n}))),o()(so.Z,{size:24,style:{opacity:0}}))},a=n=>o()("div",{},void 0,o()("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:n?this.handleAllowDisableGuestsSwitcherClick:this.handleUpgradeClick},void 0,o()("div",{style:this.getTitleStyle()},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.securitySection.disableGuests.label",defaultMessage:"Disable guests"}),!n&&i,o()(oi.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.securitySection.disableGuests.caption",defaultMessage:"Prevent anyone from inviting people outside the workspace to pages."}))),o()("div",{style:{marginTop:5,opacity:n?void 0:t}},void 0,o()(es.Z,{on:e.state.disableGuests,disabled:!n}))),o()(so.Z,{size:24,style:{opacity:0}})),r=n=>o()("div",{},void 0,o()("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:n?this.handleDisableMoveToSwitcherClick:this.handleUpgradeClick},void 0,o()("div",{style:this.getTitleStyle()},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.securitySection.disableMovingPages.label",defaultMessage:"Disable moving or duplicating pages to other workspaces"}),!n&&i,o()(oi.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.securitySection.disableMovingPages.caption",defaultMessage:"Prevent anyone from moving or duplicating pages to other workspaces via the Move To or Duplicate To actions."}))),o()("div",{style:{marginTop:5,opacity:n?void 0:t}},void 0,o()(es.Z,{on:e.state.disableMoveToSpace,disabled:!n}))),o()(so.Z,{size:24,style:{opacity:0}})),{state:l}=e,d=n=>o()("div",{},void 0,o()("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:n?this.handleDisableExportClick:this.handleUpgradeClick},void 0,o()("div",{style:this.getTitleStyle()},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.securitySection.disableExport.label",defaultMessage:"Disable export"}),!n&&i,o()(oi.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.securitySection.disableExport.caption",defaultMessage:"Prevent anyone from exporting as Markdown, CSV, or PDF."}))),o()("div",{style:{marginTop:5,opacity:n?void 0:t}},void 0,o()(es.Z,{on:e.state.disableExport,disabled:!n}))),o()(so.Z,{size:24,style:{opacity:0}}));const c=e=>{(0,W.uT)(this.environment)};return(0,Qs.J)({environment:this.environment})?o()(u.Fragment,{},void 0,o()(Yt.Z,{large:!0,divider:"full"},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.securitySection.title",defaultMessage:"Security"})),c(),n(!0),s(!0),a(!0),r(!0),d(!0),o()("div",{style:{height:36}})):o()(u.Fragment,{},void 0,this.renderUpsell(),o()("div",{style:this.getHeaderStyle()},void 0,o()("span",{style:{marginRight:8}},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.securitySection.title",defaultMessage:"Security"}))),c(),n(l.disablePublicAccess),s(l.disableSpacePageEdits),a(l.disableGuests),r(l.disableMoveToSpace),d(l.disableExport),o()("div",{style:{height:32}}))}renderSamlSettings(){return o()(pn.Z,{request:{environment:this.environment,spaceId:this.props.spaceStore.id,samlStore:this.props.samlConfigStore,domainSettingsStore:this.props.domainSettingsStore},performRequest:this.requestSamlSectionData,render:(e,t,i)=>i?t&&!e?this.isSamlAvailable()?this.renderSamlConfig():this.renderUpgradeSamlPrompt():void 0:o()(qn.Z,{})})}async requestSamlSectionData(e){const{environment:t,spaceId:i,samlStore:n,domainSettingsStore:o}=e,[s,a]=await Promise.all([_({environment:t,spaceId:i,store:n}),o.updateValueForSpace({environment:t,spaceId:i,store:o})]);return{samlResponse:s,domainResponse:a}}renderSamlHelp(){return o()("div",{style:{marginTop:18,marginBottom:24}},void 0,o()($o.Z,{title:o()(y.FormattedMessage,{id:"securitySAMLSettings.SAMLSection.helpButton.label",defaultMessage:"Learn about SAML and single sign-on"}),href:(0,V.UY)("guides.samlSettings"),analyticsFrom:"saml_settings"}))}renderSamlUneditable(e){if(this.isSamlEditable()||!e)return;const t=Lo.Z.getPublicSpaceData(this.environment,e);return t?o()("div",{style:{marginBottom:24}},void 0,o()(oi.Z,{isMultiline:!0},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.SAMLSection.uneditableMessage",defaultMessage:"SAML is being managed by the workspace <bold>{workspaceName}</bold>. Please go there to change any SAML settings.",values:{workspaceName:t.name,bold:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()("span",{style:{fontWeight:v.Z.fontWeight.semibold}},void 0,t)}}}))):void 0}renderUpgradeSamlPrompt(){return o()("div",{},void 0,o()(u.Fragment,{},void 0,o()("div",{style:this.getHeaderStyle()},void 0,o()("span",{style:{marginRight:8}},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.title",defaultMessage:"SAML single sign-on"})),o()(Vo.Z,{subscriptionTier:"enterprise",analyticsName:"space_saml",onClick:this.handleUpgradeClick,desktopStyle:{marginTop:-1}})),this.renderSamlHelp()))}removeEmailDomainFromSAMLConfig(e){const t=this.props.samlConfigStore.state.emailDomains.filter((t=>t!==e));this.props.samlConfigStore.setState({...this.props.samlConfigStore.state,emailDomains:t})}renderEmailDomains(e){return o()(u.Fragment,{},void 0,o()(Yt.Z,{smallMarginBottom:!0},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.emailDomainsSection.title",defaultMessage:"Email domains"})),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:{width:"85%",marginBottom:12,marginTop:2}},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.emailDomainsSection.emailInput.captionNoSupportLink",defaultMessage:"Once you enable SAML, anyone using an email address with the domains below will be able to log in using SAML SSO.",description:"Byline describing how enabling SAML will use these email domains for SSO."})),o()(jo.ZP,{domains:e,onRemoveDomain:this.removeDomainVerification,domainVerificationStore:this.stores.domainVerificationStore,verificationType:"saml_config",verificationTargetId:this.props.spaceStore.id,refreshDomains:async()=>{await _({environment:this.environment,spaceId:this.props.spaceStore.id,store:this.props.samlConfigStore})},onClickAddDomain:async()=>{await this.saveSamlConfig()}}))}renderWorkspaceCreationDropdown(){const e=this.props.domainSettingsStore.state;if(!e.spaceCreation)return;const t="on"===re.default.getGroup("show_workspace_owner");return o()("div",{style:{marginTop:16}},void 0,o()(ro.Z,{isMobile:this.environment.device.isMobile,disabled:!this.isDomainSettingsAvailable()||!this.isSamlEditable(),title:o()(y.FormattedMessage,{id:"domainSettings.workspaceCreation.title",defaultMessage:"Workspace creation",description:"Title of workspace creation dropdown"}),caption:o()(y.FormattedMessage,{id:"domainSettings.workspaceCreation.caption",defaultMessage:"Limit workspace creation for your verified domains.",description:"Caption of workspace creation dropdown"}),type:"dropdown",currentOption:e.spaceCreation,options:[{key:"unrestricted",label:o()(y.FormattedMessage,{id:"domainSettings.workspaceCreation.unrestricted.title",defaultMessage:"Anyone",description:"Dropdown option to remove restrictions on workspace creation"})},{key:"admins_only",label:o()(y.FormattedMessage,t?{id:"domainSettings.workspaceCreation.workspaceOwnerOnly.title",defaultMessage:"Only workspace owners",description:"Dropdown option to restrict workspace creation to workspace owners"}:{id:"domainSettings.workspaceCreation.admins_only.title",defaultMessage:"Only admins",description:"Dropdown option to restrict workspace creation to admins"})}],onSelectOption:e=>this.updateWorkspaceCreation(e)}))}updateWorkspaceCreation(e){this.props.domainSettingsStore.setState({...this.props.domainSettingsStore.state,spaceCreation:e})}renderSpaceNames(e){var t=this;if(!this.isSamlEditable())return;const i=e.map((e=>Lo.Z.getPublicSpaceData(this.environment,e))).filter((e=>Boolean(e)));return i.length<=1?void 0:o()(u.Fragment,{},void 0,o()(Yt.Z,{smallMarginBottom:!0},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.spaceNamesSection.title",defaultMessage:"Workspaces"})),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:{...ia.captionStyle,marginBottom:12,marginTop:2}},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.spaceNamesSection.spaceNameInput.caption",defaultMessage:"The SAML settings here apply to multiple workspaces. <contactlink>Contact support</contactlink> to add or remove a workspace.",values:{contactlink:function(){for(var e=arguments.length,i=new Array(e),n=0;n<e;n++)i[n]=arguments[n];return o()(ao.Z,{onClick:t.handleWorkspaceContactUsClick},void 0,i)}}})),o()("div",{style:{height:32}},void 0,o()(ea.Z,{placeholder:"",value:"",onChange:()=>{},onRemoveLastToken:()=>{},readOnly:!0,tokens:i.map((e=>o()($s.Z,{showRemoveButton:!1,isSingle:!1,format:Ks.l.Medium,value:e.name},e.id)))})),o()(so.Z,{size:40}))}renderSingleSignOnUrl(){const e=(0,as.v9)(this.props.spaceStore.id,Kt.Z.domainBaseUrl);return o()(u.Fragment,{},void 0,o()(Yt.Z,{},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.title",defaultMessage:"Single sign-on URL"})),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:{...ia.captionStyle,marginTop:2}},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.url.caption",defaultMessage:"Enter this in your Identity Provider's SAML configuration."})),o()("div",{},void 0,o()("div",{style:{display:"flex",alignItems:"flex-start",marginTop:12,marginBottom:6}},void 0,o()(lt.Z,{type:"text",format:lt.B.Default,value:e,disabled:!0,style:{borderTopRightRadius:0,borderBottomRightRadius:0,width:"calc(100% - 90px)",height:32}}),o()(Ee.Z,{onClick:()=>{ti.RD({environment:this.environment,stringValue:e,copiedMessage:ti.tq.copiedLinkToClipboard})},style:{borderTopLeftRadius:0,borderBottomLeftRadius:0},isLarge:!0},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.url.tooltip",defaultMessage:"Copy link"})))))}renderSetupInformation(){const e=(e,t)=>o()(Ue.Z,{delayThreshold:0,renderTooltip:()=>t,render:t=>m().createElement(ao.Z,a()({onClick:()=>{ti.RD({environment:this.environment,stringValue:e,copiedMessage:ti.tq.copiedPropertyToClipboard})}},t),e)}),t="enterprise"===T.CM(this.environment),i={...ia.captionStyle,whiteSpace:"nowrap"};return o()("div",{style:{paddingTop:8,display:"flex",gap:20}},void 0,o()("div",{},void 0,o()(oi.Z,{isSmall:!0,isMultiline:!0,style:i},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.SetupInformationSection.workspaceId",defaultMessage:"Workspace ID",description:"Label next to copy workspace ID button"})),t&&m().createElement(m().Fragment,null,o()("div",{style:{paddingTop:6}}),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:i},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.SetupInformationSection.scimBaseUrl",defaultMessage:"SCIM base URL",description:"Label next to copy scim base URL button"})),o()("div",{style:{paddingTop:8}}),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:i},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.SetupInformationSection.samlSSOEntityID",defaultMessage:"SSO/SAML Entity ID",description:"Label next to copy saml/sso entity ID button"})))),o()("div",{style:{flexGrow:1}},void 0,o()(oi.Z,{isSmall:!0,isMultiline:!0,style:ia.captionStyle},void 0,e(this.props.spaceStore.id,this.props.intl.formatMessage({id:"securitySAMLSettings.SetupInformationSection.workspaceId.copyTooltip",defaultMessage:"Click to copy ID",description:"Tooltip shown when hovering on copy workspace button"}))),t&&m().createElement(m().Fragment,null,o()("div",{style:{paddingTop:6}}),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:ia.captionStyle},void 0,e(Kt.Z.domainBaseUrl+js._j.scimApiBasePath,this.props.intl.formatMessage({id:"securitySAMLSettings.SetupInformationSection.scimBaseUrl.copyTooltip",defaultMessage:"Click to copy link",description:"Tooltip shown when hovering on copy scim base URL button"}))),o()("div",{style:{paddingTop:8}}),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:ia.captionStyle},void 0,e((0,as.AE)(Kt.Z.domainBaseUrl),this.props.intl.formatMessage({id:"securitySAMLSettings.SetupInformationSection.samlSSOEntityID.copyTooltip",defaultMessage:"Click to copy link",description:"Tooltip shown when hovering on copy saml/sso entity ID button"}))))))}renderIdpSettings(e){return o()(u.Fragment,{},void 0,o()(Je.Z,{style:this.getRadioTitleStyle(),onClick:e=>{this.setUseMetadataUrl(!0)},disabled:!this.isSamlEditable()},void 0,o()(rs.Z,{isSelected:Boolean(e.useMetadataUrl)})," ",o()(y.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.IdentityProviderMetadataURLOption.label",defaultMessage:"IDP metadata URL"})),o()("div",{style:{maxWidth:"100%",marginLeft:32}},void 0,o()(lt.Z,{value:e.idpMetadataUrl,onChange:this.handleIdpMetadataUrlChange,onBlur:this.handleIdpMetadataUrlBlur,placeholder:"https://...",style:{height:32},readOnly:!this.isSamlEditable()})),o()(Je.Z,{style:this.getRadioTitleStyle(),onClick:e=>{this.setUseMetadataUrl(!1)},disabled:!this.isSamlEditable()},void 0,o()(rs.Z,{isSelected:!e.useMetadataUrl})," ",o()(y.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.IdentityProviderMetadataXMLOption.label",defaultMessage:"IDP metadata XML"})),o()("div",{style:{maxWidth:"100%",marginLeft:32}},void 0,o()(lt.Z,{textarea:!0,value:e.idpMetadata,onChange:this.handleIdpMetadataChange,onBlur:this.handleIdpMetadataBlur,placeholder:this.props.intl.formatMessage({id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.IdentityProviderMetadataXMLOption.input.placeholder",defaultMessage:"IDP metadata XML"}),readOnly:!this.isSamlEditable()}),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:ia.captionStyle},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.singleSignOnURLSettings.IdentityProviderMetadataXMLOption.caption",defaultMessage:"Enter the value provided by your Identity Provider (IDP)."}))))}renderCreateAccountToggle(e){const t=!this.isSamlEditable();return o()("div",{},void 0,o()(so.Z,{size:24,style:{marginTop:12}}),o()("div",{style:ia.settingOptionStyle(t),onClick:this.handleCreateAccountToggle},void 0,o()("div",{style:this.getTitleStyle()},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.automaticallyCreateAccounts.label",defaultMessage:"Automatically create accounts on sign-in"}),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:ia.captionStyle},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.automaticallyCreateAccounts.caption",defaultMessage:"Allow users to create Notion accounts without provisioning from the IDP."}))),o()(es.Z,{on:e,disabled:t})),o()(so.Z,{size:24}))}renderEnableSamlToggle(e,t){return o()("div",{},void 0,o()("div",{style:ia.settingOptionStyle(t||!this.isSamlEditable()),onClick:this.handleEnableSamlToggle},void 0,o()("div",{style:this.getTitleStyle()},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enableSAML.label",defaultMessage:"Enable SAML"}),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:ia.captionStyle},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enableSAML.caption",defaultMessage:"This allows users with emails on the configured domains to log in with SAML. SAML authentication can be enforced below."}))),o()("div",{},void 0,t?o()(Ue.Z,{delayThreshold:0,renderTooltip:()=>o()(y.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enableSAML.tooltip",defaultMessage:"SAML can be enabled once it is fully configured."}),alignment:Xs.v2.End,render:e=>m().createElement("div",e,o()(es.Z,{on:!1,disabled:!0}))}):o()(es.Z,{on:"disabled"!==e&&"unconfigured"!==e,disabled:!this.isSamlEditable()}))),o()(so.Z,{size:24}))}renderEnforceSamlToggle(e,t){return o()("div",{style:ia.settingOptionStyle(t||!this.isSamlEditable()),onClick:this.handleEnforceSamlToggle},void 0,o()("div",{style:this.getTitleStyle()},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enforceSAML.label",defaultMessage:"Enforce SAML"}),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:ia.captionStyle},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enforceSAML.captionMulti",defaultMessage:"Once enforced, workspace members with an email on the domains configured above can only use SAML SSO to log in. Administrator accounts can still log in using email."}))),o()("div",{},void 0,t?o()(Ue.Z,{delayThreshold:0,renderTooltip:()=>o()(y.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.enforceSAML.tooltip",defaultMessage:"Enable SAML to access this option."}),alignment:Xs.v2.End,render:e=>m().createElement("div",e,o()(es.Z,{on:!1,disabled:!0}))}):o()(es.Z,{on:"enforced"===e,disabled:!this.isSamlEditable()})))}renderSamlConfig(){const e="on"===re.default.getEligibleGroup({experimentId:"domain_claim",defaultGroup:"unassigned"}),t=this.props.samlConfigStore.state,i="configured"!==t.status&&"enforced"!==t.status&&this.isInvalidSamlConfig(t),n=[...t.emailDomains.map((e=>({domain:e,status:Js.YF.Success,data:{type:"verified",domain:e}}))),...t.domainVerifications.filter((e=>!t.emailDomains.includes(e.domain))).sort(((e,t)=>e.createdAt-t.createdAt)).map((e=>Date.now()>e.expiresAt||Boolean(e.invalidatedAt)?{domain:e.domain,status:Js.YF.Failure,data:{type:"invalid",id:e.id,domain:e.domain,verificationCode:e.verificationCode,createdAt:e.createdAt,expiresAt:e.expiresAt,invalidatedAt:e.invalidatedAt}}:{domain:e.domain,status:Js.YF.Pending,data:{type:"unverified",id:e.id,domain:e.domain,verificationCode:e.verificationCode,createdAt:e.createdAt,expiresAt:e.expiresAt,invalidatedAt:e.invalidatedAt}}))];return o()(u.Fragment,{},void 0,o()("div",{style:this.getHeaderStyle()},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.SAMLSingleSignOnSection.title",defaultMessage:"SAML single sign-on"})),this.renderSamlHelp(),this.renderSamlUneditable(t.id),this.renderEmailDomains(n),e&&this.renderWorkspaceCreationDropdown(),o()(so.Z,{size:40}),this.renderSpaceNames(t.spaceIds),this.renderSingleSignOnUrl(),this.renderIdpSettings(t),this.renderCreateAccountToggle(t.createAccount),this.renderEnableSamlToggle(t.status,i),this.renderEnforceSamlToggle(t.status,i))}renderScimSettings(){const e="enterprise"===T.CM(this.environment);return o()(oa,{headerStyle:this.getHeaderStyle(),spaceStore:this.props.spaceStore,userStore:this.props.userStore,handleUpgradeClick:this.handleUpgradeClick,isEnterprise:e})}renderSetupInformationSettings(){return o()(u.Fragment,{},void 0,o()(so.Z,{size:48,style:{opacity:0}}),o()("div",{style:this.getHeaderStyle()},void 0,o()("span",{style:{marginRight:8}},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.SetupInformationSection.title",defaultMessage:"Setup Information",description:"Section title for Setup Information"}))),this.renderSetupInformation())}renderControlRow(){if((0,Qs.J)({environment:this.environment})||(0,W.uT)(this.environment))return o()("div",{style:{display:"flex"}},void 0,o()(Ee.Z,{isLarge:!0,onClick:this.handleUpdateClick},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.updateButton.label",defaultMessage:"Update"})),o()(jt.Z,{isLarge:!0,style:{marginLeft:12},onClick:this.handleCancelClick},void 0,o()(y.FormattedMessage,{id:"securitySAMLSettings.cancelButton.label",defaultMessage:"Cancel"})))}renderOfflineMessage(){return o()(yo.Z,{},void 0,o()(oi.Z,{isSmall:!0,isMultiline:!0,style:{textAlign:"center"}},void 0,o()(y.FormattedMessage,{defaultMessage:"Please go online to manage security settings.",id:"securitySAMLSettings.offline.message"})))}closeSettings(){ve.Z.setState({...ve.Z.state,open:!1})}isSamlAvailable(){return this.props.samlConfigStore.state.emailDomains.length>0||"enterprise"===T.CM(this.environment)}isDomainSettingsAvailable(){return this.props.domainSettingsStore.state.emailDomains.length>0&&"enterprise"===T.CM(this.environment)}isSamlEditable(){const e=this.props.samlConfigStore.state;return this.isSamlAvailable()&&(!e.id||e.id===this.props.spaceStore.id)}isInvalidSamlConfig(e){return 0===e.emailDomains.length||e.useMetadataUrl&&!e.idpMetadataUrl||!e.useMetadataUrl&&!e.idpMetadata}async saveSamlConfig(){if(!this.isSamlAvailable())return;const e=this.props.samlConfigStore.state,t=await w.adminSamlConfigForSpace(this.environment,{spaceId:this.props.spaceStore.id,status:e.status,useMetadataUrl:e.useMetadataUrl,idpMetadataUrl:e.idpMetadataUrl,idpMetadata:e.idpMetadata,createAccount:e.createAccount,emailDomains:e.emailDomains});"failed"===t.type?this.props.securitySettingsStore.setState({...this.props.securitySettingsStore.state,error:t}):this.props.securitySettingsStore.setState({...this.props.securitySettingsStore.state,error:void 0})}async saveWorkspaceCreationSetting(){if(this.props.domainSettingsStore.state.spaceCreation&&0!==this.props.samlConfigStore.state.emailDomains.length)return await w.updateWorkspaceCreationForEmailDomains(this.environment,{emailDomains:this.props.samlConfigStore.state.emailDomains,workspaceCreationEnum:this.props.domainSettingsStore.state.spaceCreation,spaceId:this.props.spaceStore.id})}getUpsellTier(){return(0,U.WS)()?"business":"enterprise"}static settingOptionStyle(){return{display:"flex",alignItems:"center",width:"100%",cursor:arguments.length>0&&void 0!==arguments[0]&&arguments[0]?"default":"pointer"}}getHeaderStyle(){return{fontWeight:v.Z.fontWeight.medium,fontSize:18,borderBottom:"1px solid ".concat(this.theme.regularDividerColor),paddingBottom:6,marginBottom:12,display:"flex",alignItems:"center"}}getTitleStyle(){return{fontSize:14,marginRight:8,flexGrow:1}}getRadioTitleStyle(){return{marginTop:8,marginBottom:4}}}function na(e){let{botIds:t,spaceStore:i,environment:n}=e;if(void 0===t)return"Undefined";const o=t.map((e=>(0,bt.Kv)(i,{table:we.cZ,id:e,spaceId:i.id}))),s=c().compact(o.map((e=>e.getValue())));if(s.some((e=>e.created_by_table===Ce.KJ&&e.created_by_id===Ce.s$.id)))return"SpaceHasExistingToken";return s.some((e=>e.created_by_table===Ce.KJ&&e.created_by_id===n.currentUser.id))?"UserHasExistingToken":"Able"}function oa(e){let{headerStyle:t,spaceStore:i,userStore:n,handleUpgradeClick:s,isEnterprise:a}=e;const[r,l]=(0,u.useState)(void 0),d=(0,be.O7)(),c=(0,Me.VK)((()=>na({botIds:r,spaceStore:i,environment:d})),[r,d,i]),m=o()(y.FormattedMessage,{id:"securitySAMLSettings.SCIMSection.title",defaultMessage:"SCIM configuration"}),p=o()(so.Z,{size:48,style:{opacity:0}});if(a){const e={...t,borderBottom:void 0,marginBottom:2};return o()(u.Fragment,{},void 0,p,o()("div",{style:e},void 0,o()("span",{style:{display:"flex",marginRight:8,width:"100%",justifyContent:"space-between"}},void 0,m,o()(ks,{onNewScimToken:e=>l((t=>[...null!=t?t:[],e])),spaceStore:i,userStore:n,tokenCreationAbility:c}))),o()(Hs,{spaceStore:i,userStore:n,botIds:r,setBotIds:l}),sa())}return o()(u.Fragment,{},void 0,p,o()("div",{style:t},void 0,o()("span",{style:{marginRight:8}},void 0,m),o()(Vo.Z,{subscriptionTier:"enterprise",analyticsName:"space_saml",onClick:s,desktopStyle:{marginTop:-1}})),sa())}function sa(){return o()($o.Z,{title:o()(y.FormattedMessage,{id:"securitySAMLSettings.SCIMSection.helpButton.label",defaultMessage:"Learn about SCIM"}),style:{marginTop:18,marginBottom:24},href:(0,V.UY)("guides.scim"),analyticsFrom:"scim_settings"})}l()(ia,"captionStyle",{marginTop:4,width:"85%"});const aa=(0,y.injectIntl)(ia);function ra(e){let{userStore:t,spaceStore:i,promptUpgrade:n}=e;const[s,a]=(0,u.useState)(void 0),r=(0,be.O7)(),l=(0,Me.VK)((()=>na({botIds:s,spaceStore:i,environment:r})),[s,r,i]),d=o()(y.FormattedMessage,{id:"identityAndProvisioning.scim.title",defaultMessage:"SCIM tokens",description:"Title describing how this section is for SCIM tokens."}),c=o()(y.FormattedMessage,{id:"identityAndProvisioning.scim.byline",defaultMessage:"Generate a token to configure SCIM.",description:"Byline describing how this section is for SCIM tokens."});return n?o()(zo,{title:d,byline:c,targetTier:"enterprise"}):m().createElement(m().Fragment,null,o()(Uo,{title:d,byline:c,settingItem:o()(ks,{onNewScimToken:e=>a((t=>[...null!=t?t:[],e])),spaceStore:i,userStore:t,tokenCreationAbility:l})}),o()($o.Z,{title:o()(y.FormattedMessage,{id:"securitySAMLSettings.SCIMSection.helpButton.label",defaultMessage:"Learn about SCIM"}),style:{marginTop:18,marginBottom:24},href:(0,V.UY)("guides.scim"),analyticsFrom:"scim_settings"}),o()(Hs,{spaceStore:i,userStore:t,botIds:s,setBotIds:a}))}function la(e){let{userStore:t,spaceStore:i}=e;const n=(0,be.O7)(),s=(0,Me.VK)((()=>"enterprise"===T.CM(n)),[n]);return o()(ra,{promptUpgrade:!s,userStore:t,spaceStore:i})}function da(e){let{primaryWorkspaceName:t}=e;const i=(0,ei.y)((e=>({container:{background:e.accentColors.blue[100],padding:"18px 24px",borderRadius:4,margin:"0 0 24px"}})),[]);return o()("div",{style:i.container},void 0,o()(oi.Z,{},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.secondaryWorkspace.uneditableTitle",defaultMessage:"The primary workspace is <bold>{primaryWorkspaceName}</bold>.",description:"Short message pointing out the primary workspace for this current workspace",values:{primaryWorkspaceName:t,bold:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()("span",{style:{fontWeight:v.Z.fontWeight.semibold}},void 0,t)}}})),o()("br",{}),o()(oi.Z,{isMultiline:!0},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.secondaryWorkspace.uneditableMessage",defaultMessage:"The verified domains and SAML SSO configuration are being managed by the workspace <bold>{primaryWorkspaceName}</bold>. Please navigate there or contact an admin of that workspace to edit the verified domains or SSO configuration.",description:"Short message telling the customer that the current workspace has its SAML and domain settings being managed by another workspace.",values:{primaryWorkspaceName:t,bold:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()("span",{style:{fontWeight:v.Z.fontWeight.semibold}},void 0,t)}}})))}function ca(e){let{spaceStore:t,isEnterprise:i}=e;const n=(0,y.useIntl)(),s=(0,Me.VK)((()=>t.id),[t]);return m().createElement(m().Fragment,null,o()(ua,{left:o()(y.FormattedMessage,{id:"securitySAMLSettings.SetupInformationSection.workspaceId",defaultMessage:"Workspace ID",description:"Label next to copy workspace ID button"}),right:o()(ma,{text:s,tooltip:n.formatMessage({id:"securitySAMLSettings.SetupInformationSection.workspaceId.copyTooltip",defaultMessage:"Click to copy ID",description:"Tooltip shown when hovering on copy workspace button"})})}),i&&m().createElement(m().Fragment,null,o()(ua,{left:o()(y.FormattedMessage,{id:"securitySAMLSettings.SetupInformationSection.samlSSOEntityIDLink",defaultMessage:"SAML SSO/SAML Entity ID",description:"Label next to copy saml/sso entity ID button"}),right:o()(ma,{text:(0,as.AE)(Kt.Z.domainBaseUrl),tooltip:n.formatMessage({id:"securitySAMLSettings.SetupInformationSection.samlSSOEntityID.copyTooltip",defaultMessage:"Click to copy link",description:"Tooltip shown when hovering on copy saml/sso entity ID button"})})}),o()(ua,{left:o()(y.FormattedMessage,{id:"securitySAMLSettings.SetupInformationSection.scimBaseUrl",defaultMessage:"SCIM base URL",description:"Label next to copy scim base URL button"}),right:o()(ma,{text:Kt.Z.domainBaseUrl+js._j.scimApiBasePath,tooltip:n.formatMessage({id:"securitySAMLSettings.SetupInformationSection.scimBaseUrl.copyTooltip",defaultMessage:"Click to copy link",description:"Tooltip shown when hovering on copy scim base URL button"})})})))}function ua(e){let{left:t,right:i}=e;const n=(0,ei.y)((()=>({container:{padding:4,display:"flex",alignItems:"center",justifyContent:"flex-start"},leftItem:{width:160,whiteSpace:"nowrap"},rightItem:{whiteSpace:"nowrap"}})),[]);return o()("div",{style:n.container},void 0,o()(oi.Z,{isSmall:!0,isMultiline:!0,style:n.leftItem},void 0,t),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:n.rightItem},void 0,i))}function ma(e){let{tooltip:t,text:i}=e;const n=(0,be.O7)();return o()(Ue.Z,{delayThreshold:0,renderTooltip:()=>t,render:e=>m().createElement(ao.Z,a()({onClick:()=>{ti.RD({environment:n,stringValue:i,copiedMessage:ti.tq.copiedPropertyToClipboard})}},e),i)})}function pa(e){let{userStore:t,spaceStore:i,samlConfigStore:n,domainSettingsStore:s}=e;const a=(0,be.O7)(),r=(0,Me.VK)((()=>cn.Z.state.online),[]),{loadingSaml:l,loadedSaml:d,errorSaml:c}=(0,u.useContext)(Eo),m=(0,Me.VK)((()=>function(e){let{environment:t,samlConfigStore:i,spaceStore:n}=e;const o=Do({environment:t,samlConfigStore:i}),s=!i.state.id||i.state.id===n.id;return o&&s}({environment:a,samlConfigStore:n,spaceStore:i})),[a,n,i]),p=(0,Me.VK)((()=>n.state.id?Lo.Z.getPublicSpaceData(a,n.state.id):void 0),[a,n]),g=(0,ei.y)((()=>({header:{marginTop:48}})),[]),h=(0,Me.VK)((()=>"enterprise"===T.CM(a)),[a]);return r?l?o()(yo.Z,{},void 0,o()(qn.Z,{style:{margin:"0 auto"}})):c?(C.showErrorMessage(c.message),null):d?o()(yo.Z,{},void 0,!m&&p?o()(da,{primaryWorkspaceName:p.name}):null,o()(Yt.Z,{large:!0,divider:"full"},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.domain.title",defaultMessage:"Domain management",description:"Domain settings menu title"})),o()(Jo,{spaceStore:i,samlConfigStore:n,domainSettingsStore:s}),o()(Yt.Z,{large:!0,divider:"full",style:g.header},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.saml.title",defaultMessage:"SAML Single sign-on (SSO)",description:"SAML SSO settings menu title"})),o()(ws,{spaceStore:i,samlConfigStore:n,domainSettingsStore:s}),o()(Yt.Z,{large:!0,divider:"full",style:g.header},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.scim.title",defaultMessage:"SCIM provisioning",description:"SCIM settings menu title"})),o()(la,{userStore:t,spaceStore:i}),o()(Yt.Z,{large:!0,divider:"full",style:g.header},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.setupInfo.title",defaultMessage:"Setup information",description:"Setup information settings menu title"})),o()(ca,{spaceStore:i,isEnterprise:h})):null:o()(yo.Z,{},void 0,o()(oi.Z,{isSmall:!0,isMultiline:!0,style:{textAlign:"center"}},void 0,o()(y.FormattedMessage,{defaultMessage:"Please go online to manage identity and provisioning settings.",id:"identityProvisioningSettings.offline.message",description:"Offline message for the Identity and Provisioning settings menu"})))}var ga=i(63143),ha=i(27242),fa=i(66957),va=i(16402);function ya(){return o()(Ue.Z,{renderTooltip:()=>o()(y.FormattedMessage,{id:"identityAndProvisioning.claimWorkspaces.table.pendingWorkspaceClaim.Explanation",defaultMessage:"Workspace claim request is being processed.",description:"Indicator that the space in this row is in a pending state for being claimed."}),render:e=>m().createElement(oi.Z,e,o()(y.FormattedMessage,{id:"identityAndProvisioning.claimWorkspaces.table.pendingClaim",defaultMessage:"Pending",description:"Indicator that the space in this row is in a pending state for being claimed."}))})}function Sa(e){let{admin:t}=e;const i=(0,y.useIntl)();return o()(Ue.Z,{renderTooltip:()=>o()(y.FormattedMessage,{id:"identityAndProvisioning.claimWorkspaces.table.pendingWorkspaceTransferExplanation",defaultMessage:"Waiting for {name} to transfer the workspace to an external account.",description:"Indicator that the space in this row is in a pending state for being transferred.",values:{name:(0,Ce.Nz)(i,t)}}),render:e=>m().createElement(oi.Z,e,o()(y.FormattedMessage,{id:"identityAndProvisioning.claimWorkspaces.table.pendingTransfer",defaultMessage:"Pending",description:"Indicator that the space in this row is in a pending state for being transferred."}))})}var ba=i(93405),Ma=i(73063);function wa(e){let{space:t,actions:i}=e;const n=(0,Me.qz)(void 0,jn.Z),s=(0,ei.y)((()=>({container:{minWidth:325}})),[]);return o()(Qe.Z,{popupType:Oe.kQ.Popup,style:s.container,buttonPopupStore:n,renderOrigin:e=>m().createElement(Ma.Z,a()({icon:h.Z.dots},e)),render:()=>o()(Ca,{space:t,actions:i,popupStore:n})})}function Ca(e){let{space:t,actions:i,popupStore:n}=e;const s={key:"workspace-actions",render:e=>m().createElement(Ne.Z,e),items:i.map((e=>{const i=!!e.getDisabledState&&e.getDisabledState(t),n=e.getTooltip?e.getTooltip(t):null;return{key:e.id,render:t=>o()(Ue.Z,{render:n=>m().createElement(ba.Z,a()({},t,n,{shouldWrapCaption:!0,svg:t=>e.getIcon(t),title:e.name,caption:e.caption,style:{paddingTop:8,paddingBottom:8,opacity:i?.5:1},disabled:i})),renderTooltip:()=>n,disableTooltip:!Boolean(n),placement:Ue.Z.Placement.Left}),action:()=>e.onAction(t)}}))};return o()(De.Z,{menuType:Fe.o.Popup},void 0,o()(Le.Z,{type:Le.i.Vertical,initialFocus:void 0,sections:[s],onAccept:()=>{n.setState({open:!1})}}))}function ka(e){let{id:t,name:i,icon:n,subscriptionTier:s,memberCount:a,highlightIconContainer:r}=e;const l=(0,y.useIntl)(),d=n?{pointer:{table:hi.bx,id:t,spaceId:t},icon:n}:void 0,c=(0,ei.y)((e=>({container:{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",padding:"8px 0",width:"100%"},summaryContainer:{width:"calc(100% - ".concat(38,"px)")},iconContainer:{height:38,width:38,flexGrow:0,flexShrink:0,flexBasis:38,marginRight:12,display:"flex",justifyContent:"center",alignItems:"center",background:r?e.selectLightGray[50]:void 0,borderRadius:6},name:{fontSize:14,fontWeight:500},byline:{fontSize:12,opacity:.5}})),[r]);return o()("div",{style:c.container},void 0,o()("div",{style:c.iconContainer},void 0,o()(mn.Z,{disabled:!0,icon:d,isEmptyPage:!1,size:32,title:i,isLarge:!0,emojiSize:28,isRaw:!1})),o()("div",{style:c.summaryContainer},void 0,o()(oi.Z,{style:c.name,showTooltipWhenTruncated:!0},void 0,i),o()(oi.Z,{style:c.byline},void 0,o()(y.FormattedMessage,{id:"identityAndProvisioning.claimWorkspaces.summaryByline",defaultMessage:"{subscriptionTier} · {memberCount, plural, one {{memberCount} member} other {{memberCount} members}}",description:"Label for the workspace indicating number of workspace members and workspace plan type.",values:{subscriptionTier:Ta(s,l),memberCount:a}}))))}function Ta(e,t){switch(e){case"personal_free":return t.formatMessage(Ia.personalPlan);case"personal":return t.formatMessage(Ia.personalProPlan);case"team_free":return t.formatMessage(Ia.teamTrialPlan);case"team":return t.formatMessage(Ia.teamPlan);default:(0,H.t1)(e)}}const Ia=(0,y.defineMessages)({personalPlan:{id:"identityAndProvisioning.claimWorkspaces.personalPlan",defaultMessage:"Personal",description:"Label for the workspace indicating it has a Personal Plan"},personalProPlan:{id:"identityAndProvisioning.claimWorkspaces.proPlan",defaultMessage:"Personal Pro",description:"Label for the workspace indicating it has a Personal Pro Plan"},teamTrialPlan:{id:"identityAndProvisioning.claimWorkspaces.teamTrialPlan",defaultMessage:"Team (Trial)",description:"Label for the workspace indicating it has a Team (Trial) Plan"},teamPlan:{id:"identityAndProvisioning.claimWorkspaces.teamPlan",defaultMessage:"Team",description:"Label for the team indicating it has a Team Plan"}});function Za(e){let{users:t,deletedUserEmailDomain:i}=e;const n=(0,Me.qz)(void 0,jn.Z),s=(0,ei.y)((()=>({container:{minWidth:275}})),[]);return o()(Qe.Z,{popupType:Oe.kQ.Popup,style:s.container,buttonPopupStore:n,renderOrigin:e=>m().createElement(xa,a()({users:t,deletedUserEmailDomain:i},e)),render:()=>o()(Pa,{users:t,popupStore:n})})}function Pa(e){let{users:t,popupStore:i}=e;const n=(0,be.O7)(),s={key:"workspace-users-menu",render:e=>m().createElement(Ne.Z,e),items:t.map((e=>({key:e.id,render:t=>m().createElement(_a,a()({user:e},t)),action:()=>(0,k.navigateToExternalURL)({environment:n,url:"mailto:".concat(e.email)})})))};return o()(De.Z,{menuType:Fe.o.Popup},void 0,o()(Le.Z,{type:Le.i.Vertical,initialFocus:0,sections:[s],onAccept:()=>{i.setState({open:!1})}}))}function _a(e){let{user:t,...i}=e;const n=(0,y.useIntl)(),s=(0,ei.y)((e=>({container:{display:"flex",flexDirection:"row",justifyContent:"flex-start",alignItems:"center",height:"auto",paddingTop:8,paddingBottom:8,margin:"0 6px"},avatarContainer:{display:"flex",justifyContent:"center",alignItems:"center"},copyContainer:{display:"flex",justifyContent:"center",alignItems:"center",marginLeft:"auto",opacity:.5},nameContainer:{marginLeft:8,marginRight:8},name:{fontSize:14,lineHeight:1.2,maxWidth:300},email:{fontSize:12,lineHeight:1.2,opacity:.5,maxWidth:300}})),[]);return m().createElement(Je.Z,a()({style:s.container},i),o()("div",{style:s.avatarContainer},void 0,o()(Hn.Z,{userValue:t,size:24})),o()("div",{style:s.nameContainer},void 0,o()(oi.Z,{style:s.name},void 0,(0,Ce.Nz)(n,t)),o()(oi.Z,{style:s.email},void 0,t.email)),o()("div",{style:s.copyContainer},void 0,h.Z.mail({height:18,width:18})))}function xa(e){let{users:t,deletedUserEmailDomain:i,...n}=e;const s=(0,y.useIntl)(),r=(0,ei.y)((e=>({container:{display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center",marginLeft:"-8px",maxWidth:"100%"},empty:{fontSize:14,maxWidth:150,opacity:.5},name:{fontSize:14,maxWidth:150},plusMore:{opacity:.5,display:"inline"}})),[]);return 0===t.length?o()(Ue.Z,{render:e=>m().createElement(Je.Z,a()({style:r.container,disabled:!0},n,e),o()(oi.Z,{style:r.empty},void 0,o()(y.FormattedMessage,{id:"identityAndProvisioning.claimWorkspaces.users.empty",defaultMessage:"Deleted user",description:"Empty state for when there are no users to display."}))),disableTooltip:!i,renderTooltip:()=>o()(y.FormattedMessage,{id:"identityAndProvisioning.claimWorkspaces.users.emptyTooltip",defaultMessage:"Deleted user from {domain}",description:"Detailed empty state for when there are no users to display.",values:{domain:"@".concat(i)}})}):m().createElement(Je.Z,a()({style:r.container},n),o()(oi.Z,{},void 0,o()(y.FormattedMessage,{id:"identityAndProvisioning.claimWorkspaces.users.name",defaultMessage:"{remainingCount, plural, =0 {{firstUser}} one {{firstUser} <gray>+{remainingCount}</gray>} other {{firstUser} <gray>+{remainingCount}</gray>}}",description:"Shows the name of the first user in the list, followed by the number of additional users left that are not shown.",values:{firstUser:(0,Ce.Nz)(s,t[0]),remainingCount:t.length-1,gray:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()(oi.Z,{style:r.plusMore},void 0,t)}}})))}const Fa=[{id:"workspaces",headerTitle:o()(y.FormattedMessage,{id:"identityAndProvisioning.claimWorkspaces.table.name",defaultMessage:"Workspaces",description:"Header for the name column in the unauthorized workspaces table."}),renderCell:e=>o()(ka,{id:e.space.id,name:e.space.name,icon:e.space.icon,subscriptionTier:e.space.subscriptionTier,memberCount:e.space.memberCount}),widthData:{width:60},sortable:!1},{id:"admins",headerTitle:o()(y.FormattedMessage,{id:"identityAndProvisioning.claimWorkspaces.table.admins",defaultMessage:"Workspace owners",description:"Header for the workspace owners column in the unauthorized workspaces table."}),renderCell:e=>o()(Za,{users:e.space.admins}),widthData:{width:40},sortable:!1},{id:"createdBy",headerTitle:o()(y.FormattedMessage,{id:"identityAndProvisioning.claimWorkspaces.table.createdBy",defaultMessage:"Created by",description:"Header for the created by column in the unauthorized workspaces table."}),renderCell:e=>e.space.creator?o()(Za,{users:[e.space.creator]}):o()(Za,{users:[],deletedUserEmailDomain:e.space.creatorEmailDomain}),widthData:{width:40},sortable:!1},{id:"createdAt",headerTitle:o()(y.FormattedMessage,{id:"identityAndProvisioning.claimWorkspaces.table.createdAt",defaultMessage:"Created date",description:"Header for the created date column in the unauthorized workspaces table."}),renderCell:e=>o()(oi.Z,{style:{opacity:.5}},void 0,(0,va.gs)(e.space.createdAt)),widthData:{width:30},sortable:!1},{id:"action",headerTitle:null,renderCell:e=>(0,f.DI)(e.space.spaceRequest)?o()(Sa,{admin:e.space.admins[0]}):(0,f.XR)(e.space.spaceRequest)?o()(ya,{}):e.actions.length>0?o()(wa,{space:e.space,actions:e.actions}):null,widthData:{width:15},sortable:!1}];function Aa(e){let{claimableWorkspaces:t,workspaceActions:i,loadMoreClaimableWorkspaces:n,loading:s}=e;const a=t.map((e=>({id:e.id,isClickable:!1,space:e,actions:i}))),r=(0,ei.y)((e=>(0,gs.b)({columnRenderInfo:Fa,theme:e,containerMarginTop:0})),[]);return m().createElement(m().Fragment,null,o()(gs.D,{hideHeaderRowPadding:!0,showRowBorders:!0,columnRenderInfo:Fa,rows:a,renderNoRowsComponent:()=>o()(oi.Z,{isSmall:!0,style:{marginTop:15,marginBottom:40,textAlign:"center"}},void 0,!s&&o()(y.FormattedMessage,{id:"identityAndProvisioning.claimWorkspaces.table.empty",defaultMessage:"No claimable workspaces.",description:"Message displayed on the table that shows workspaces if there are no workspaces to show."})),styles:r,getStyleForRow:function(e){if((0,f.DI)(e.space.spaceRequest)||(0,f.XR)(e.space.spaceRequest))return{opacity:.5}},onScrollBottom:n}),s&&o()(qn.Z,{style:{margin:"24px auto 24px"}}))}var Ba=i(33728),Ea=i(16354);const Ra=(0,y.defineMessages)({emailPlaceholder:{id:"identityProvisioningSettings.transferWorkspaces.transferModal.contactEmail.placeholder",defaultMessage:"it@example.com",description:"Placeholder text for it contact email address"}}),Da=e=>{let{onDismiss:t,workspaceQueuedForTransfer:i,currentSpaceId:n}=e;const[s,a]=(0,u.useState)(),[r,l]=(0,u.useState)(!1),{setSpaceRequest:d}=(0,u.useContext)(Eo),c=(0,be.O7)(),p=(0,ei.y)((e=>({modalInnerStyle:{width:406,padding:"24px 20px 16px 20px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},closeIconContainer:{position:"absolute",top:10,right:10,backgroundColor:e.accentColors.gray[75],borderRadius:"50%",height:22,width:22,display:"flex",justifyContent:"center",alignItems:"center"},closeIcon:{width:14,height:14,fill:e.mediumTextColor},modalIcon:{fill:e.mediumIconColor,height:24,width:24},title:{fontWeight:v.Z.fontWeight.medium,fontSize:16,display:"inline-flex",alignItems:"center",justifyContent:"center",marginTop:9},description:{fontWeight:v.Z.fontWeight.regular,textAlign:"center",fontSize:13,lineHeight:"16px",letterSpacing:"-0.08",marginTop:9},workspaceContainer:{position:"relative",borderRadius:6,border:"1px solid ".concat(e.regularDividerColor),padding:"0 12px",boxSizing:"border-box",marginTop:30,width:"100%",height:60,justifyContent:"center",display:"flex",alignItems:"center"},checkContainer:{position:"absolute",right:12,display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20},check:{fill:e.mediumIconColor,height:16,width:16},dividerContainer:{marginTop:20},dividerInner:{borderBottomColor:e.regularDividerColor},contactEmailContainer:{position:"relative",width:"100%",minHeight:56,marginTop:13},contactEmailTitle:{fontWeight:v.Z.fontWeight.medium,fontSize:14,marginBottom:8,letterSpacing:-.15,display:"inline-flex",alignItems:"center"},helpIcon:{fill:e.lightIconColor,marginLeft:4,height:16,width:16},primaryButton:{width:"100%",marginTop:32},buttonCaption:{color:e.mediumTextColor,marginTop:8,textAlign:"center",fontSize:12},secondaryButton:{margin:"8px auto 0",justifyContent:"center",fontWeight:v.Z.fontWeight.medium,color:e.lightTextColor},buttonCaptionError:{color:e.errorText,marginTop:8,fontSize:13}})),[]),g=Boolean(i);return o()(Zn.Z,{open:g,innerStyle:p.modalInnerStyle,preventHideChildrenWhileOpening:!0,onDismiss:t,render:()=>m().createElement(m().Fragment,null,o()("div",{style:p.closeIconContainer},void 0,o()(Je.Z,{isSmall:!0,onClick:t,ignoreLocalHoverState:!0},void 0,h.Z.closeSmall(p.closeIcon))),o()("div",{},void 0,h.Z.personBadgeExclamationMark(p.modalIcon)),o()(oi.Z,{style:p.title},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.transferWorkspaces.transferModal.selfServe.title",defaultMessage:"Require account change",description:"Title for the transfer workspace modal."}),o()(Ea.Z,{href:(0,V.UY)("guides.domainManagement")},void 0,o()(Ma.Z,{icon:h.Z.help}))),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:p.description},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.transferWorkspaces.transferModal.byline",defaultMessage:"You’re about to require the Workspace Owner of 1 workspace to use an external Notion accounts. They will be unable to use the workspace until the change is made.",description:"Details explaining what it means to transfer a workspace."})),o()("div",{style:p.workspaceContainer},void 0,i?o()(ka,{id:i.id,name:i.name,icon:i.icon,subscriptionTier:i.subscriptionTier,memberCount:i.memberCount}):null,o()("div",{style:p.checkContainer},void 0,h.Z.thinCheck(p.check))),o()(so.Z,{size:"100%",innerStyle:p.dividerInner,style:p.dividerContainer}),o()("div",{style:p.contactEmailContainer},void 0,o()(oi.Z,{style:p.contactEmailTitle},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.transferWorkspaces.transferModal.contactEmail.title",defaultMessage:"Send request from",description:"Title for contact email input field"}),o()(Ue.Z,{renderTooltip:()=>o()(y.FormattedMessage,{id:"identityAndProvisioning.claimWorkspaces.table.pendingExplanation",defaultMessage:"The Workspace Owner can contact this email for inquiries",description:"Explanation that email is for unmanaged workspace owner to reach out admin for questions about the request."}),render:e=>m().createElement("span",e,h.Z.help(p.helpIcon))})),o()(lt.Z,{value:s,placeholder:Te.default.formatMessage(Ra.emailPlaceholder),onChange:e=>{l(!1),a(e.target.value)}}),r&&o()(oi.Z,{isSmall:!0,style:p.buttonCaptionError},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.transferWorkspaces.transferModal.contactEmail.error",defaultMessage:"Invalid email address",description:"Error for missing or invalid email address"}))),o()(Ee.Z,{isLarge:!0,style:p.primaryButton,onClick:async()=>{const e=(0,Ba.H3)(s);if((0,Ba.oH)(e)){if(i&&e){const o=await w.initiateWorkspaceTransfer(c,{requestingSpaceId:n,targetSpaceId:i.id,contactEmail:e});if("failed"===o.type)C.showErrorMessage(o.error.message);else{const n=o.data.workspaceTransfer;d(i.id,n),M.trackSpaceTransferRequested(c,{contactEmail:e,currentOwners:i.admins.map((e=>e.id)),targetSpaceId:i.id,verifiedDomain:i.creatorEmailDomain}),t()}}}else l(!0)}},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.transferWorkspaces.transferModal.confirm",defaultMessage:"Confirm change",description:"Primary action for initiating the transfer process."})),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:p.buttonCaption},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.transferWorkspaces.transferModal.buttonCaption",defaultMessage:"This cannot be undone",description:"Button caption about the timeline"})),o()(Je.Z,{style:p.secondaryButton,onClick:t},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.transferWorkspaces.transferModal.cancel",defaultMessage:"Cancel",description:"Canceling the current action"})))})},La=e=>{let{onDismiss:t,workspaceQueuedForClaiming:i,requestingSpaceId:n}=e;const s=(0,Me.VK)((()=>re.default.checkGate("domain_claim_sales_assisted")),[]),a=(0,be.O7)(),{setSpaceRequest:r}=(0,u.useContext)(Eo),l=(0,ei.y)((e=>({modalInnerStyle:{width:406,padding:"24px 20px 16px 20px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},closeIconContainer:{position:"absolute",top:10,right:10,backgroundColor:e.accentColors.gray[75],borderRadius:"50%",height:22,width:22,display:"flex",justifyContent:"center",alignItems:"center"},closeIcon:{width:14,height:14,fill:e.mediumTextColor},title:{fontWeight:v.Z.fontWeight.medium,fontSize:16,marginBottom:8,display:"inline-flex",alignItems:"center",justifyContent:"center"},helpIcon:{fill:e.lightIconColor,marginLeft:4,height:16,width:16},description:{fontWeight:v.Z.fontWeight.regular,textAlign:"center",fontSize:13,lineHeight:"16px",letterSpacing:"-0.08px",marginTop:9},workspaceContainer:{position:"relative",borderRadius:6,border:"1px solid ".concat(e.regularDividerColor),padding:"0 12px",boxSizing:"border-box",marginTop:30,width:"100%",height:60,justifyContent:"center",display:"flex",alignItems:"center"},checkContainer:{position:"absolute",right:12,display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20},check:{fill:e.mediumIconColor,height:16,width:16},primaryButton:{width:"100%",marginTop:32},secondaryButton:{margin:"8px auto 0",justifyContent:"center",fontWeight:v.Z.fontWeight.medium,color:e.lightTextColor},buttonCaption:{color:e.mediumTextColor,marginTop:8,textAlign:"center",fontSize:12}})),[]),d=Boolean(i)&&s,c=async()=>{if(!d||!i)return;const e=await w.requestClaimAndUpgrade(a,{requestingSpaceId:n,targetSpaceId:i.id});"failed"===e.type?(0,C.showError)(e):(M.trackSpaceClaimUpgradeRequested(a,{currentOwners:i.admins.map((e=>e.id)),targetSpaceId:i.id,verifiedDomain:i.creatorEmailDomain,memberCount:i.memberCount}),r(i.id,e.data.spaceRequest)),t()};return o()(Zn.Z,{open:d,innerStyle:l.modalInnerStyle,preventHideChildrenWhileOpening:!0,onDismiss:t,render:()=>m().createElement(m().Fragment,null,o()("div",{style:l.closeIconContainer},void 0,o()(Je.Z,{isSmall:!0,onClick:t},void 0,h.Z.closeSmall(l.closeIcon))),o()(oi.Z,{style:l.title},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.claimModal.salesAssisted.title",defaultMessage:"Request workspace claim",description:"Title for the claim workspace modal."}),o()(Ea.Z,{href:(0,V.UY)("guides.domainManagement")},void 0,o()(Ma.Z,{icon:h.Z.help}))),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:l.description},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.claimModal.salesAssisted.byline",defaultMessage:"You’re about to take ownership of {currentWorkspaceName} and upgrade it to an Enterprise plan. You’ll become the Workspace owner and the existing owners will be downgraded to members.",description:"Details explaining what it means to claim and upgrade a workspace.",values:{currentWorkspaceName:i?i.name:"the workspace below"}})),o()("div",{style:l.workspaceContainer},void 0,i?o()(ka,{id:i.id,name:i.name,icon:i.icon,subscriptionTier:i.subscriptionTier,memberCount:i.memberCount}):null,o()("div",{style:l.checkContainer},void 0,h.Z.thinCheck(l.check))),o()(Ee.Z,{isLarge:!0,style:l.primaryButton,onClick:c},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.claimModal.salesAssisted.sendRequest",defaultMessage:"Send request",description:"Primary action for continuing the claim process to the payment step."})),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:l.buttonCaption},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.claimModal.salesAssisted.buttonCaption",defaultMessage:"This request may take a few days to process. For more information, contact your <accountmanageremail>Account Management team</accountmanageremail>.",description:"Button caption about the timeline",values:{accountmanageremail:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()(ao.Z,{href:"mailto:am@makenotion.com"},void 0,t)}}})),o()(Je.Z,{style:l.secondaryButton,onClick:t},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.claimModal.salesAssisted.cancel",defaultMessage:"Cancel",description:"Canceling the current action"})))})},Oa=e=>{let{onDismiss:t,workspaceQueuedForClaiming:i}=e;const n=(0,Me.VK)((()=>re.default.checkGate("domain_claim_run_self_serve")),[]),s=(0,ei.y)((e=>({modalInnerStyle:{width:406,padding:"24px 20px 16px 20px",display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center"},closeIconContainer:{position:"absolute",top:10,right:10,backgroundColor:e.accentColors.gray[75],borderRadius:"50%",height:22,width:22,display:"flex",justifyContent:"center",alignItems:"center"},closeIcon:{width:14,height:14,fill:e.mediumTextColor},modalIcon:{fill:e.mediumIconColor,height:24,width:24},title:{fontWeight:v.Z.fontWeight.medium,fontSize:16,display:"inline-flex",alignItems:"center",justifyContent:"center",marginTop:9},helpIcon:{fill:e.lightIconColor,marginLeft:4,height:16,width:16},description:{fontWeight:v.Z.fontWeight.regular,textAlign:"center",fontSize:13,lineHeight:"16px",letterSpacing:"-0.08px",marginTop:9},workspaceContainer:{position:"relative",borderRadius:6,border:"1px solid ".concat(e.regularDividerColor),padding:"0 12px",boxSizing:"border-box",marginTop:30,width:"100%",height:60,justifyContent:"center",display:"flex",alignItems:"center"},checkContainer:{position:"absolute",right:12,display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20},check:{fill:e.mediumIconColor,height:16,width:16},primaryButton:{width:"100%",marginTop:32},secondaryButton:{margin:"8px auto 0",justifyContent:"center",fontWeight:v.Z.fontWeight.medium,color:e.lightTextColor}})),[]),a=Boolean(i);return o()(Zn.Z,{open:a,innerStyle:s.modalInnerStyle,preventHideChildrenWhileOpening:!0,onDismiss:t,render:()=>m().createElement(m().Fragment,null,o()("div",{style:s.closeIconContainer},void 0,o()(Je.Z,{isSmall:!0,onClick:t,ignoreLocalHoverState:!0},void 0,h.Z.closeSmall(s.closeIcon))),o()("div",{},void 0,h.Z.arrowUpCircled(s.modalIcon)),o()(oi.Z,{style:s.title},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.claimModal.selfServe.title",defaultMessage:"Claim workspace",description:"Title for the claim workspace modal."}),o()(Ea.Z,{href:(0,V.UY)("guides.domainManagement")},void 0,o()(Ma.Z,{icon:h.Z.help}))),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:s.description},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.claimModal.selfServe.byline",defaultMessage:"You’re about to take ownership of {currentWorkspaceName} and upgrade it to an Enterprise plan. You’ll become the Workspace owner and the existing owners will be downgraded to members.",description:"Details explaining what it means to claim and upgrade a workspace.",values:{currentWorkspaceName:i?i.name:"the workspace below"}})),o()("div",{style:s.workspaceContainer},void 0,i?o()(ka,{id:i.id,name:i.name,icon:i.icon,subscriptionTier:i.subscriptionTier,memberCount:i.memberCount}):null,o()("div",{style:s.checkContainer},void 0,h.Z.thinCheck(s.check))),o()(Ee.Z,{isLarge:!0,style:s.primaryButton,onClick:()=>{n&&i&&(0,D.Xb)(i)}},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.claimModal.selfServe.reviewAndPay",defaultMessage:"Review and pay",description:"Primary action for continuing the claim process to the payment step."})),o()(Je.Z,{style:s.secondaryButton,onClick:t},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.claimModal.selfServe.cancel",defaultMessage:"Cancel",description:"Canceling the current action"})))})};function Na(e){let{spaceStore:t}=e;const{claimableWorkspaces:i,domainVerifications:n,loadingSpaces:s,errorClaimableSpaces:a,errorVerifications:r,navigateTo:l,removeClaimableWorkspace:d,loadMoreClaimableWorkspaces:c,tab:m,setSelectedTab:p}=(0,u.useContext)(Eo),g=(0,Me.VK)((()=>!ha.Z.state.open&&Boolean(ha.Z.state.succeeded)),[]),[f,S]=(0,u.useState)(),[b,M]=(0,u.useState)(),w=(0,Me.VK)((()=>T.Th(ye.default.state.data)),[]);function k(){S(void 0),M(void 0)}(0,u.useEffect)((()=>{g&&f&&(d(f.id),S(void 0),ha.Z.reset())}),[g,f,d,S]);const I=(0,Me.VK)((()=>re.default.checkGate("domain_claim_run_self_serve")),[]),Z=(0,Me.VK)((()=>re.default.checkGate("domain_claim_sales_assisted")),[]),P=(0,Me.VK)((()=>re.default.checkGate("domain_claim_personal_transfer")),[]),_=w?Z:I,x=(0,ei.y)((e=>({link:{fontSize:14,fontWeight:400,color:e.mediumTextColor,textDecoration:"none"},title:{marginTop:21,fontWeight:v.Z.fontWeight.semibold,fontSize:17},byline:{fontSize:14,fontWeight:v.Z.fontWeight.regular,color:e.mediumTextColor},count:{marginLeft:4,opacity:.5,fontWeight:400},tabBarMenu:{margin:"12px 0 0",boxShadow:"none"}})),[]);if(a)return C.showErrorMessage(a.message),null;if(r)return C.showErrorMessage(r.message),null;const F=i.filter((e=>function(e){switch(e){case"personal":case"personal_free":return!0;case"enterprise":case"business":case"free":case"student":case"team":case"team_free":return!1}}(e.subscriptionTier))),A=i.filter((e=>function(e){switch(e){case"team":case"team_free":return!0;case"enterprise":case"business":case"free":case"student":case"personal":case"personal_free":return!1}}(e.subscriptionTier))),B=P?[{id:"external-transfer",getIcon:e=>h.Z.arrowsDiverging({...e,height:14,width:14}),name:o()(y.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.actions.externalTransfer",defaultMessage:"Require account change",description:"Button option for starting an external transfer of this workspace's ownership."}),caption:o()(y.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.actions.externalTransferCaption",defaultMessage:"Owner will be prompted to change workspace ownership to a personal account.",description:"Caption for the external transfer button."}),onAction:e=>M(e)}]:[],E=_?[{id:"claim-and-upgrade",getIcon:e=>h.Z.arrowUpCircled({...e,height:14,width:14}),name:o()(y.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.actions.claimAndUpgrade",defaultMessage:"Claim and upgrade",description:"Button option for starting a claim and upgrade workflow for the selected workspace."}),caption:o()(y.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.actions.claimAndUpgradeCaption",defaultMessage:"Take ownership of the workspace and upgrade it to an Enterprise plan",description:"Caption for the claim and upgrade button."}),onAction:e=>S(e),getDisabledState:e=>{const{isEligible:t}=Ua(n,e.creatorEmailDomain);return!t},getTooltip:e=>{const t=Ua(n,e.creatorEmailDomain);if(!t.isEligible)return o()(y.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.actions.disabledTooltip",defaultMessage:"This feature will be enabled in {numDays, plural, one {{numDays} day} other {{numDays} days}}.",values:{numDays:t.daysUntilEligible},description:"Tooltip explaining that this feature is disabled for some amount of time."})}}]:[];return o()(yo.Z,{},void 0,o()(ao.Z,{style:x.link,onClick:()=>l(Fo)},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.breadcrumb",defaultMessage:"← Identity & Provisioning",description:"Link for navigating back to the previous 'Identity & Provisioning' settings page."})),o()(Yt.Z,{large:!0,style:x.title},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.title",defaultMessage:"Manage workspaces",description:"Title for the manage workspaces section."})),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:x.byline},void 0,o()(y.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.byline",defaultMessage:"Claim verified-domain workspaces to your Enterprise plan or require Owners to use an external domain.",description:"Byline for the claim workspaces section."})),o()(fa.Z,{tabs:[o()(y.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.personalSpaces",defaultMessage:"Personal Plan",description:"Title for the table that shows all claimable personal plan workspaces."},"personal"),o()(y.FormattedMessage,{id:"identityProvisioningSettings.claimWorkspaces.teamSpaces",defaultMessage:"Team Plan",description:"Title for the table that shows all claimable team plan workspaces."},"team")],selectedIndex:m,onChange:e=>p(e),style:x.tabBarMenu}),o()(Da,{onDismiss:k,workspaceQueuedForTransfer:b,currentSpaceId:t.id}),m===Bo.Personal?o()(Aa,{claimableWorkspaces:F,workspaceActions:B,loadMoreClaimableWorkspaces:c,loading:s},"personal"):o()(Aa,{claimableWorkspaces:A,workspaceActions:E,loadMoreClaimableWorkspaces:c,loading:s},"team"),w?o()(La,{onDismiss:k,workspaceQueuedForClaiming:f,requestingSpaceId:t.id}):o()(Oa,{onDismiss:k,workspaceQueuedForClaiming:f}))}function Ua(e,t){const i=e.find((e=>{let{domain:i}=e;return t===i}));if(!i||!i.verified_at)return{isEligible:!0};const n=(Date.now()-i.verified_at)/ga.A0;return n>=14?{isEligible:!0}:{isEligible:!1,daysUntilEligible:Math.ceil(14-n)}}function Wa(e){let{userStore:t,spaceStore:i,samlConfigStore:n,domainSettingsStore:s}=e;const{page:a}=(0,u.useContext)(Eo);switch(a){case Fo:return o()(pa,{userStore:t,spaceStore:i,samlConfigStore:n,domainSettingsStore:s});case Ao:return o()(Na,{spaceStore:i})}}const Va=function(e){let{userStore:t,spaceStore:i,samlConfigStore:n,domainSettingsStore:s}=e;return o()(Ro,{spaceStore:i,samlConfigStore:n,domainSettingsStore:s},void 0,o()(Wa,{userStore:t,spaceStore:i,samlConfigStore:n,domainSettingsStore:s}))};var za=i(24211),qa=i(79092),Ha=i(54153),Ga=i(84908),Ka=i(39218);var ja=i(65680),Ya=i(31194);class Qa extends p.Z{constructor(){super(...arguments),l()(this,"storeTypes",{buttonPopupStore:jn.Z}),l()(this,"handleSelectChange",(e=>{const{label:t}=this.getItemLabelAndCaption(e);if(this.props.confirm){const i=()=>{this.props.onChange(e)};C.showDialog({showCancel:!0,keepFocus:!1,message:o()(y.FormattedMessage,{id:"languagePicker.changeLanguage.confirmationMessage",defaultMessage:"Are you sure you want to update the language to {language}?",values:{language:t}}),items:[{label:o()(y.FormattedMessage,{id:"languagePicker.changeLanguage.updateButton.label",defaultMessage:"Update"}),color:"red",onAccept:i}]})}else this.props.onChange(e)}))}renderComponent(){const{device:e}=this.environment;if(!e.isMobile)return o()(Qe.Z,{popupType:Qe.Z.PopupType.Popup,buttonPopupStore:this.stores.buttonPopupStore,renderOrigin:e=>m().createElement(m().Fragment,null,m().createElement(Je.Z,a()({style:{marginLeft:-8,paddingLeft:8,paddingRight:8}},e),this.props.pickerLabel?this.props.pickerLabel:this.getItemLabelAndCaption(this.props.currentLocale).label,(0,ja.ay)(this.props.currentLocale)&&o()(wt.Z,{desktopStyle:{marginLeft:4}},void 0,o()(y.FormattedMessage,{id:"languagePicker.betaBadge",defaultMessage:"Beta"})),h.Z.chevronDown({width:10,marginLeft:4,fill:this.theme.lightIconColor}))),placementToOrigin:Ya.Iw.Bottom,alignmentToOrigin:Ya.lU.Start,render:e=>{let t;t="on"===re.default.getGroup("polyglot")?[...ja.tp,...ja.is]:[...ja.tp];const i=[{key:"languages",render:e=>m().createElement(Ne.Z,a()({},e,{topBorder:0!==e.index})),items:t.map((t=>({key:t,render:e=>this.getItem(t,e.focused,e),action:()=>{this.handleSelect(t),e.close()}})))}],n={menuType:Fe.o.Popup,width:240};return m().createElement(De.Z,a()({className:N.hK},n),o()(Le.Z,{type:Le.i.Vertical,initialFocus:void 0,sections:i}))}})}renderItem(e){return m().createElement(Re.Z,a()({},e.props,{title:o()("div",{style:{display:"flex",alignItems:"center"}},void 0,o()("div",{style:{...e.style,marginRight:0}},void 0,e.label)),caption:e.caption&&o()("span",{style:{color:this.theme.mediumTextColor}},void 0,e.caption),shouldWrapCaption:!0,right:(0,ja.ay)(e.locale)&&o()(wt.Z,{},void 0,o()(y.FormattedMessage,{id:"languagePicker.betaBadge",defaultMessage:"Beta"}))}))}handleSelect(e){this.props.currentLocale!==e&&this.handleSelectChange(e)}getItemLabelAndCaption(e){var t;return{"en-US":{label:"English",caption:(t=this.props.intl).formatMessage({defaultMessage:"English (US)",id:"languagePicker.captions.englishUS"})},"de-DE":{label:"German",caption:t.formatMessage({defaultMessage:"German",id:"languagePicker.captions.germanDE",description:"The name of a language represented in a list of languages"})},"ko-KR":{label:"한국어",caption:t.formatMessage({defaultMessage:"Korean",id:"languagePicker.captions.koreanKo"})},"zh-CN":{label:"简体中文",caption:t.formatMessage({defaultMessage:"Simplified Chinese",id:"languagePicker.captions.chineseS"})},"zh-TW":{label:"繁體中文",caption:t.formatMessage({defaultMessage:"Traditional Chinese",id:"languagePicker.captions.chineseT"})},"ja-JP":{label:"日本語",caption:t.formatMessage({defaultMessage:"Japanese",id:"languagePicker.captions.japaneseJa"})},"es-ES":{label:"Español (España)",caption:t.formatMessage({defaultMessage:"Spanish (Spain)",id:"languagePicker.captions.spanishEs"})},"es-LA":{label:"Español (Latinoamérica)",caption:t.formatMessage({defaultMessage:"Spanish (Latin America)",id:"languagePicker.captions.spanishLatam"})},"pt-BR":{label:"Português (Brasil)",caption:t.formatMessage({defaultMessage:"Portuguese (Brazil)",id:"languagePicker.captions.portugueseBr"})},"fr-FR":{label:"Français (France)",caption:t.formatMessage({defaultMessage:"French",id:"languagePicker.captions.frenchFr"})},pseudo:{label:"🤡Pseudolocale🤡",caption:t.formatMessage({defaultMessage:"Pseudolocale",id:"languagePicker.captions.pseudolocale",description:"[Do not translate] A fake language added for localization QA purposes."})}}[e]}getItem(e,t,i){return this.renderItem({...this.getItemLabelAndCaption(e),focused:t,props:i,locale:e})}}const Xa=(0,y.injectIntl)(Qa);class Ja extends p.Z{renderComponent(){return o()("div",{style:this.getSettingsOptionStyle()},void 0,o()("div",{style:{display:"flex",alignItems:"flex-start",width:"100%"}},void 0,o()("div",{style:{flex:1}},void 0,o()(oi.Z,{},void 0,o()(y.FormattedMessage,{id:"languageRegionSettings.language.label",defaultMessage:"Language"})),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:{width:"80%"}},void 0,o()(y.FormattedMessage,{id:"languageSettings.languageSwitcher.subtitle",defaultMessage:"Change the language used in the user interface."}))),o()(Xa,{confirm:!0,onChange:async e=>{(0,M.trackLocaleChanged)(this.environment,{locale:e});const t=await w.setLocale(this.environment,{locale:e});"success"===t.type?(Ha.Z.set("preferredLocale",e),await Ka.transactionQueue.drain(),this.environment.device.isElectron?Ga.refreshAll({includeFocusedWindow:!0}):window.location.reload()):C.showError(t)},currentLocale:this.props.locale})))}getSettingsOptionStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%",height:"auto",paddingLeft:e.isMobile?t.state.paddingLeftCSS:0,paddingRight:e.isMobile?t.state.paddingRightCSS:0}}}const $a=Ja;var er=i(57269),tr=i(32056);function ir(e){var t,i;return(null==e||null===(t=e.getSettingsStore())||void 0===t||null===(i=t.getKeyStore("regional_format_settings"))||void 0===i?void 0:i.getKeyStore("region").getValue())||"United States"}function nr(e,t){var i,n;const o=null==e||null===(i=e.getKeyStore("settings"))||void 0===i||null===(n=i.getKeyStore("regional_format_settings"))||void 0===n?void 0:n.getValue();return"full_date"===t?null!=o&&o.use_default_region_settings?or(ir(e)):(null==o?void 0:o.full_date)||or(ir(e)):"short_date"===t?null!=o&&o.use_default_region_settings?{type:"short"}:(null==o?void 0:o.short_date)||{type:"short"}:"number"===t?null!=o&&o.use_default_region_settings?"number":(null==o?void 0:o.number)||"number":"week_start_on"===t?null!=o&&o.use_default_region_settings?"sunday":(null==o?void 0:o.week_start_on)||"sunday":(0,H.t1)(t)}function or(e){return"ja"===e?{type:"short"}:{type:"long"}}const sr={full_date:(0,y.defineMessages)({full:{defaultMessage:"Full date",id:"regionalFormatSettings.customSettingOption.fullDate.full"},long:{defaultMessage:"Long",id:"regionalFormatSettings.customSettingOption.fullDate.long"},medium:{defaultMessage:"Medium",id:"regionalFormatSettings.customSettingOption.fullDate.medium"},short:{defaultMessage:"Short",id:"regionalFormatSettings.customSettingOption.fullDate.short"},iso:{defaultMessage:"ISO",id:"regionalFormatSettings.customSettingOption.fullDate.iso"},custom:{defaultMessage:"Custom",id:"regionalFormatSettings.customSettingOption.fullDate.custom"}}),short_date:(0,y.defineMessages)({short:{defaultMessage:"Short",id:"regionalFormatSettings.customSettingOption.shortDate.short"},iso:{defaultMessage:"ISO",id:"regionalFormatSettings.customSettingOption.shortDate.iso"},custom:{defaultMessage:"Custom",id:"regionalFormatSettings.customSettingOption.shortDate.custom"}}),number:(0,y.defineMessages)({number:{defaultMessage:"Number",id:"regionalFormatSettings.customSettingOption.number.number"},number_with_commas:{defaultMessage:"Number with commas",id:"regionalFormatSettings.customSettingOption.number.withCommas"},percent:{defaultMessage:"Percent",id:"regionalFormatSettings.customSettingOption.number.percent"}}),week_start_on:(0,y.defineMessages)({sunday:{defaultMessage:"Sunday",id:"regionalFormatSettings.customSettingOption.weekStartOn.sunday"},monday:{defaultMessage:"Monday",id:"regionalFormatSettings.customSettingOption.weekStartOn.monday"}})},ar=(0,y.defineMessages)({full_date:{defaultMessage:"Full date",id:"regionalFormatSettings.defaultSetting.fullDate"},short_date:{defaultMessage:"Short date",id:"regionalFormatSettings.defaultSetting.shortDate"},number:{defaultMessage:"Numbers",id:"regionalFormatSettings.defaultSetting.numbers"},week_start_on:{defaultMessage:"Week starts",id:"regionalFormatSettings.defaultSetting.weekStart"}});function rr(e,t){if("full_date"===t){return sr[t][nr(e,t).type]}if("short_date"===t){return sr[t][nr(e,t).type]}if("number"===t){return sr[t][nr(e,t)]}if("week_start_on"===t){return sr[t][nr(e,t)]}return(0,H.t1)(t)}function lr(e,t){return(0,tr.uf)(1234567,e,t)}const dr=(0,y.defineMessages)({sunday:{id:"regionalFormatSettings.defaultRegionalSettings.startDayOfWeek.sunday",defaultMessage:"Sunday"},monday:{id:"regionalFormatSettings.defaultRegionalSettings.startDayOfWeek.monday",defaultMessage:"Monday"}});function cr(e,t){const i=(0,Zt.default)();return(0,er.mT)((0,za.E2)(t),i,e)}function ur(e,t){const i=(0,Zt.default)();return(0,er.T0)((0,za.E2)(t),i,e)}var mr=i(82902);const pr={full_date:(0,y.defineMessages)({full:{defaultMessage:"Full date",id:"regionalFormatSettings.customSettingOption.fullDate.full"},long:{defaultMessage:"Long",id:"regionalFormatSettings.customSettingOption.fullDate.long"},medium:{defaultMessage:"Medium",id:"regionalFormatSettings.customSettingOption.fullDate.medium"},short:{defaultMessage:"Short",id:"regionalFormatSettings.customSettingOption.fullDate.short"},iso:{defaultMessage:"ISO",id:"regionalFormatSettings.customSettingOption.fullDate.iso"},custom:{defaultMessage:"Custom",id:"regionalFormatSettings.customSettingOption.fullDate.custom"}}),short_date:(0,y.defineMessages)({short:{defaultMessage:"Short",id:"regionalFormatSettings.customSettingOption.shortDate.short"},iso:{defaultMessage:"ISO",id:"regionalFormatSettings.customSettingOption.shortDate.iso"},custom:{defaultMessage:"Custom",id:"regionalFormatSettings.customSettingOption.shortDate.custom"}}),number:(0,y.defineMessages)({number:{defaultMessage:"Number",id:"regionalFormatSettings.customSettingOption.number.number"},number_with_commas:{defaultMessage:"Number with commas",id:"regionalFormatSettings.customSettingOption.number.withCommas"},percent:{defaultMessage:"Percent",id:"regionalFormatSettings.customSettingOption.number.percent"}}),week_start_on:(0,y.defineMessages)({sunday:{defaultMessage:"Sunday",id:"regionalFormatSettings.customSettingOption.weekStartOn.sunday"},monday:{defaultMessage:"Monday",id:"regionalFormatSettings.customSettingOption.weekStartOn.monday"}})};function gr(e){const[,,t]=(0,Me.oR)(void 0,jn.Z),i=(0,ei.F)(),[n,s]=(0,Me.VK)((()=>[e.userSettingsStore.isDefined(),rr(e.userSettingsStore,e.option)]),[e.option,e.userSettingsStore]);return n?o()(Qe.Z,{popupType:Qe.Z.PopupType.Popup,buttonPopupStore:t,renderOrigin:e=>m().createElement(Je.Z,e,Te.default.formatMessage(s),h.Z.chevronDown({width:10,marginLeft:4,fill:i.lightIconColor})),placementToOrigin:Ya.Iw.Bottom,alignmentToOrigin:Ya.lU.Start,render:t=>"week_start_on"===e.option||"number"===e.option?o()(hr,{userSettingsStore:e.userSettingsStore,option:e.option,onAccept:()=>{t.close()}}):"full_date"===e.option||"short_date"===e.option?o()(fr,{userSettingsStore:e.userSettingsStore,option:e.option,onAccept:()=>{t.close()}}):(0,H.t1)(e.option)}):o()(qn.Z,{})}function hr(e){const t=(0,be.O7)(),i=(0,y.useIntl)();return o()(De.Z,{menuType:Fe.o.Popup,width:216},void 0,o()(Le.Z,{type:Le.i.Vertical,initialFocus:void 0,sections:[{key:"options",render:e=>m().createElement(Ne.Z,a()({},e,{topBorder:0!==e.index})),items:(0,H.Yd)(pr[e.option]).map((n=>({key:n,render:t=>{const o="number"===e.option?lr(n,i):void 0;return m().createElement(Re.Z,a()({},t,{title:Te.default.formatMessage(pr[e.option][n]),caption:o}))},action:()=>{(0,A.createAndCommit)({userAction:"CustomRegionalFormatSettings.SimpleFormatPicker",environment:t,perform:t=>{(0,L.d2)({userSettingsStore:e.userSettingsStore,data:{regional_format_settings:{...e.userSettingsStore.getRegionalFormatSettings(),use_default_region_settings:!1,region:ir(e.userSettingsStore),[e.option]:n}},transaction:t})}}),e.onAccept()}})))}]}))}function fr(e){const t=(0,be.O7)(),[i,n]=(0,u.useState)((()=>{})),s=(0,y.useIntl)(),r=(0,H.Yd)(pr[e.option]),l=n=>{const o="custom"===n?{type:n,format:i}:{type:n};(0,A.createAndCommit)({userAction:"CustomRegionalFormatSettings.onAction",environment:t,perform:t=>{(0,L.d2)({userSettingsStore:e.userSettingsStore,data:{regional_format_settings:{...e.userSettingsStore.getRegionalFormatSettings(),use_default_region_settings:!1,region:ir(e.userSettingsStore),[e.option]:o}},transaction:t})}}),e.onAccept()};return o()(De.Z,{menuType:Fe.o.Popup,width:216},void 0,o()(Le.Z,{type:Le.i.Vertical,initialFocus:void 0,disableMouseLeaveBlur:!0,sections:[{key:"options",render:e=>m().createElement(Ne.Z,a()({},e,{topBorder:0!==e.index})),items:r.map((t=>({key:t,render:r=>{if("custom"===t)return m().createElement(mr.Z,a()({},r,{renderOrigin:i=>m().createElement(Re.Z,a()({},i,{title:Te.default.formatMessage(pr[e.option][t])})),onFocus:()=>{},renderExtension:()=>o()(vr,{customFormat:i,onChange:e=>{n(e)},onAccept:()=>{l(t)}}),title:Te.default.formatMessage(pr[e.option][t])}));{const i="full_date"===e.option?cr({type:t},s):ur({type:t},s);return m().createElement(Re.Z,a()({},r,{title:Te.default.formatMessage(pr[e.option][t]),caption:i}))}},action:()=>{l(t)}})))}]}))}function vr(e){const t=(0,ei.y)((e=>({container:{},label:{color:e.mediumTextColor,fontWeight:v.Z.fontWeight.semibold,paddingTop:6,paddingBottom:6,paddingLeft:14,paddingRight:14},actionButton:{marginTop:6}})),[]);return o()("div",{style:t.container},void 0,o()("div",{},void 0,o()(oi.Z,{isSmall:!0,style:t.label},void 0,o()(y.FormattedMessage,{id:"regionalFormatSettings.customDateFormat.title",defaultMessage:"Custom format"}))),o()(In.ZP,{focus:!0,value:e.customFormat||"",onChange:t=>{e.onChange(t.target.value)}}),o()(Re.Z,{style:t.actionButton,focused:!1,onClick:e.onAccept,title:o()(y.FormattedMessage,{id:"regionalFormatSettings.customDateFormat.applyChanges",defaultMessage:"Apply changes"})}))}function yr(e){const t=(0,ei.y)((()=>({container:{flex:1,display:"flex",flexDirection:"column"},controlRow:{flex:1,display:"flex"},label:{flex:1},subtitle:{width:"80%"}})),[]),i=(0,Me.VK)((()=>e.userSettingsStore.isReady()),[e.userSettingsStore]),n=(0,Me.VK)((()=>e.userSettingsStore.shouldUseDefaultRegionalFormatting()),[e.userSettingsStore]),s=(0,be.O7)();return i?o()("div",{style:t.container},void 0,o()("div",{style:t.controlRow},void 0,o()("div",{style:t.label},void 0,o()(oi.Z,{},void 0,o()(y.FormattedMessage,{id:"regionalFormatSettings.label.title",defaultMessage:"Use regional defaults"})),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:t.subtitle},void 0,o()(y.FormattedMessage,{id:"regionalFormatSettings.label.subtitle",defaultMessage:"Automatically apply standard formats of your region"}))),o()(es.Z,{on:n,onClick:()=>{(0,A.createAndCommit)({userAction:"RegionalFormatSettings.RegionalFormatSettings",environment:s,perform:t=>{const i=n?{use_default_region_settings:!1,full_date:void 0,short_date:void 0,time:void 0,number:void 0,week_start_on:void 0}:{use_default_region_settings:!0};(0,L.d2)({userSettingsStore:e.userSettingsStore,data:{regional_format_settings:{region:ir(e.userSettingsStore),...i}},transaction:t})}})}})),o()("div",{},void 0,o()(n?Sr:Cr,{userSettingsStore:e.userSettingsStore}))):o()(qn.Z,{})}function Sr(e){const t=(0,ei.y)((()=>({container:{marginTop:12}})),[]);return o()("div",{style:t.container},void 0,wr.map((t=>o()(br,{userSettingsStore:e.userSettingsStore,option:t}))))}function br(e){const t=(0,ei.y)((e=>({container:{display:"flex"},option:{color:e.lightTextColor,fontSize:v.Z.fontSize.UIRegular.desktop,width:100},example:{color:e.mediumTextColor,fontSize:v.Z.fontSize.UIRegular.desktop}})),[]),i=(0,y.useIntl)(),[n,s]=(0,Me.VK)((()=>[e.userSettingsStore.isDefined(),Mr(e.userSettingsStore,i,e.option)]),[i,e.option,e.userSettingsStore]);return n?o()("div",{style:t.container},void 0,o()("div",{style:t.option},void 0,Te.default.formatMessage(ar[e.option])),o()("div",{style:t.example},void 0,s)):o()(qn.Z,{})}function Mr(e,t,i){if("full_date"===i){return cr(nr(e,i),t)}if("short_date"===i){return ur(nr(e,i),t)}if("number"===i){return lr(nr(e,i),t)}if("week_start_on"===i){return function(e){return"sunday"===e?Te.default.formatMessage(dr.sunday):"monday"===e?Te.default.formatMessage(dr.monday):(0,H.t1)(e)}(nr(e,i))}return(0,H.t1)(i)}const wr=["full_date","short_date","number","week_start_on"];function Cr(e){return o()("div",{},void 0,wr.map((t=>o()(kr,{userSettingsStore:e.userSettingsStore,option:t}))))}function kr(e){const t=(0,y.useIntl)(),[i,n,s]=(0,Me.VK)((()=>[e.userSettingsStore.isDefined(),ir(e.userSettingsStore),Mr(e.userSettingsStore,t,e.option)]),[t,e.option,e.userSettingsStore]),a=(0,ei.y)(Tr,[]);return i?m().createElement(m().Fragment,null,o()(so.Z,{size:24}),o()("div",{style:a.container},void 0,o()("div",{style:a.controlRow},void 0,o()("div",{style:a.label},void 0,o()(oi.Z,{},void 0,Te.default.formatMessage(ar[e.option])),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:a.subtitle},void 0,s)),o()(gr,{userSettingsStore:e.userSettingsStore,region:n,option:e.option})))):o()(qn.Z,{})}function Tr(){return{container:{flex:1,display:"flex",flexDirection:"column"},controlRow:{flex:1,display:"flex"},label:{flex:1},subtitle:{width:"80%"}}}const Ir=[{name:"Afghanistan",countryCode:"AF"},{name:"Åland Islands",countryCode:"AX"},{name:"Albania",countryCode:"AL"},{name:"Algeria",countryCode:"DZ"},{name:"American Samoa",countryCode:"AS"},{name:"Andorra",countryCode:"AD"},{name:"Angola",countryCode:"AO"},{name:"Anguilla",countryCode:"AI"},{name:"Antarctica",countryCode:"AQ"},{name:"Antigua and Barbuda",countryCode:"AG"},{name:"Argentina",countryCode:"AR"},{name:"Armenia",countryCode:"AM"},{name:"Aruba",countryCode:"AW"},{name:"Australia",countryCode:"AU",vatApplicable:!0},{name:"Austria",countryCode:"AT",vatApplicable:!0},{name:"Azerbaijan",countryCode:"AZ"},{name:"Bahamas",countryCode:"BS"},{name:"Bahrain",countryCode:"BH"},{name:"Bangladesh",countryCode:"BD"},{name:"Barbados",countryCode:"BB"},{name:"Belarus",countryCode:"BY"},{name:"Belgium",countryCode:"BE",vatApplicable:!0},{name:"Belize",countryCode:"BZ"},{name:"Benin",countryCode:"BJ"},{name:"Bermuda",countryCode:"BM"},{name:"Bhutan",countryCode:"BT"},{name:"Bolivia (Plurinational State of)",countryCode:"BO"},{name:"Bonaire, Sint Eustatius and Saba",countryCode:"BQ"},{name:"Bosnia and Herzegovina",countryCode:"BA"},{name:"Botswana",countryCode:"BW"},{name:"Bouvet Island",countryCode:"BV"},{name:"Brazil",countryCode:"BR"},{name:"British Indian Ocean Territory",countryCode:"IO"},{name:"Brunei Darussalam",countryCode:"BN"},{name:"Bulgaria",countryCode:"BG",vatApplicable:!0},{name:"Burkina Faso",countryCode:"BF"},{name:"Burundi",countryCode:"BI"},{name:"Cabo Verde",countryCode:"CV"},{name:"Cambodia",countryCode:"KH"},{name:"Cameroon",countryCode:"CM"},{name:"Canada",countryCode:"CA",vatApplicable:!0},{name:"Cayman Islands",countryCode:"KY"},{name:"Central African Republic",countryCode:"CF"},{name:"Chad",countryCode:"TD"},{name:"Chile",countryCode:"CL"},{name:"China",countryCode:"CN"},{name:"Christmas Island",countryCode:"CX"},{name:"Cocos (Keeling) Islands",countryCode:"CC"},{name:"Colombia",countryCode:"CO"},{name:"Comoros",countryCode:"KM"},{name:"Congo",countryCode:"CG"},{name:"Congo, Democratic Republic of the",countryCode:"CD"},{name:"Cook Islands",countryCode:"CK"},{name:"Costa Rica",countryCode:"CR"},{name:"Côte d'Ivoire",countryCode:"CI"},{name:"Croatia",countryCode:"HR",vatApplicable:!0},{name:"Curaçao",countryCode:"CW"},{name:"Cyprus",countryCode:"CY",vatApplicable:!0},{name:"Czechia",countryCode:"CZ",vatApplicable:!0},{name:"Denmark",countryCode:"DK",vatApplicable:!0},{name:"Djibouti",countryCode:"DJ"},{name:"Dominica",countryCode:"DM"},{name:"Dominican Republic",countryCode:"DO"},{name:"Ecuador",countryCode:"EC"},{name:"Egypt",countryCode:"EG"},{name:"El Salvador",countryCode:"SV"},{name:"Equatorial Guinea",countryCode:"GQ"},{name:"Eritrea",countryCode:"ER"},{name:"Estonia",countryCode:"EE",vatApplicable:!0},{name:"Eswatini",countryCode:"SZ"},{name:"Ethiopia",countryCode:"ET"},{name:"Falkland Islands (Malvinas)",countryCode:"FK"},{name:"Faroe Islands",countryCode:"FO"},{name:"Fiji",countryCode:"FJ"},{name:"Finland",countryCode:"FI",vatApplicable:!0},{name:"France",countryCode:"FR",vatApplicable:!0},{name:"French Guiana",countryCode:"GF"},{name:"French Polynesia",countryCode:"PF"},{name:"French Southern Territories",countryCode:"TF"},{name:"Gabon",countryCode:"GA"},{name:"Gambia",countryCode:"GM"},{name:"Georgia",countryCode:"GE"},{name:"Germany",countryCode:"DE",vatApplicable:!0},{name:"Ghana",countryCode:"GH"},{name:"Gibraltar",countryCode:"GI"},{name:"Greece",countryCode:"GR",vatApplicable:!0},{name:"Greenland",countryCode:"GL"},{name:"Grenada",countryCode:"GD"},{name:"Guadeloupe",countryCode:"GP"},{name:"Guam",countryCode:"GU"},{name:"Guatemala",countryCode:"GT"},{name:"Guernsey",countryCode:"GG"},{name:"Guinea",countryCode:"GN"},{name:"Guinea-Bissau",countryCode:"GW"},{name:"Guyana",countryCode:"GY"},{name:"Haiti",countryCode:"HT"},{name:"Heard Island and McDonald Islands",countryCode:"HM"},{name:"Holy See",countryCode:"VA"},{name:"Honduras",countryCode:"HN"},{name:"Hong Kong",countryCode:"HK"},{name:"Hungary",countryCode:"HU",vatApplicable:!0},{name:"Iceland",countryCode:"IS"},{name:"India",countryCode:"IN",vatApplicable:!0},{name:"Indonesia",countryCode:"ID"},{name:"Iraq",countryCode:"IQ"},{name:"Ireland",countryCode:"IE",vatApplicable:!0},{name:"Isle of Man",countryCode:"IM"},{name:"Israel",countryCode:"IL"},{name:"Italy",countryCode:"IT",vatApplicable:!0},{name:"Jamaica",countryCode:"JM"},{name:"Japan",countryCode:"JP"},{name:"Jersey",countryCode:"JE"},{name:"Jordan",countryCode:"JO"},{name:"Kazakhstan",countryCode:"KZ"},{name:"Kenya",countryCode:"KE"},{name:"Kiribati",countryCode:"KI"},{name:"Korea, Republic of",countryCode:"KR",vatApplicable:!0},{name:"Kosovo",countryCode:"XK"},{name:"Kuwait",countryCode:"KW"},{name:"Kyrgyzstan",countryCode:"KG"},{name:"Lao People's Democratic Republic",countryCode:"LA"},{name:"Latvia",countryCode:"LV",vatApplicable:!0},{name:"Lebanon",countryCode:"LB"},{name:"Lesotho",countryCode:"LS"},{name:"Liberia",countryCode:"LR"},{name:"Libya",countryCode:"LY"},{name:"Liechtenstein",countryCode:"LI"},{name:"Lithuania",countryCode:"LT",vatApplicable:!0},{name:"Luxembourg",countryCode:"LU",vatApplicable:!0},{name:"Macao",countryCode:"MO"},{name:"Madagascar",countryCode:"MG"},{name:"Malawi",countryCode:"MW"},{name:"Malaysia",countryCode:"MY"},{name:"Maldives",countryCode:"MV"},{name:"Mali",countryCode:"ML"},{name:"Malta",countryCode:"MT",vatApplicable:!0},{name:"Marshall Islands",countryCode:"MH"},{name:"Martinique",countryCode:"MQ"},{name:"Mauritania",countryCode:"MR"},{name:"Mauritius",countryCode:"MU"},{name:"Mayotte",countryCode:"YT"},{name:"Mexico",countryCode:"MX"},{name:"Micronesia (Federated States of)",countryCode:"FM"},{name:"Moldova, Republic of",countryCode:"MD"},{name:"Monaco",countryCode:"MC"},{name:"Mongolia",countryCode:"MN"},{name:"Montenegro",countryCode:"ME"},{name:"Montserrat",countryCode:"MS"},{name:"Morocco",countryCode:"MA"},{name:"Mozambique",countryCode:"MZ"},{name:"Myanmar",countryCode:"MM"},{name:"Namibia",countryCode:"NA"},{name:"Nauru",countryCode:"NR"},{name:"Nepal",countryCode:"NP"},{name:"Netherlands",countryCode:"NL",vatApplicable:!0},{name:"New Caledonia",countryCode:"NC"},{name:"New Zealand",countryCode:"NZ",vatApplicable:!0},{name:"Nicaragua",countryCode:"NI"},{name:"Niger",countryCode:"NE"},{name:"Nigeria",countryCode:"NG"},{name:"Niue",countryCode:"NU"},{name:"Norfolk Island",countryCode:"NF"},{name:"North Macedonia",countryCode:"MK"},{name:"Northern Mariana Islands",countryCode:"MP"},{name:"Norway",countryCode:"NO",vatApplicable:!0},{name:"Oman",countryCode:"OM"},{name:"Pakistan",countryCode:"PK"},{name:"Palau",countryCode:"PW"},{name:"Palestine, State of",countryCode:"PS"},{name:"Panama",countryCode:"PA"},{name:"Papua New Guinea",countryCode:"PG"},{name:"Paraguay",countryCode:"PY"},{name:"Peru",countryCode:"PE"},{name:"Philippines",countryCode:"PH"},{name:"Pitcairn",countryCode:"PN"},{name:"Poland",countryCode:"PL",vatApplicable:!0},{name:"Portugal",countryCode:"PT",vatApplicable:!0},{name:"Puerto Rico",countryCode:"PR"},{name:"Qatar",countryCode:"QA"},{name:"Réunion",countryCode:"RE"},{name:"Romania",countryCode:"RO",vatApplicable:!0},{name:"Russian Federation",countryCode:"RU",vatApplicable:!0},{name:"Rwanda",countryCode:"RW"},{name:"Saint Barthélemy",countryCode:"BL"},{name:"Saint Helena, Ascension and Tristan da Cunha",countryCode:"SH"},{name:"Saint Kitts and Nevis",countryCode:"KN"},{name:"Saint Lucia",countryCode:"LC"},{name:"Saint Martin (French part)",countryCode:"MF"},{name:"Saint Pierre and Miquelon",countryCode:"PM"},{name:"Saint Vincent and the Grenadines",countryCode:"VC"},{name:"Samoa",countryCode:"WS"},{name:"San Marino",countryCode:"SM"},{name:"Sao Tome and Principe",countryCode:"ST"},{name:"Saudi Arabia",countryCode:"SA"},{name:"Senegal",countryCode:"SN"},{name:"Serbia",countryCode:"RS"},{name:"Seychelles",countryCode:"SC"},{name:"Sierra Leone",countryCode:"SL"},{name:"Singapore",countryCode:"SG",vatApplicable:!0},{name:"Sint Maarten (Dutch part)",countryCode:"SX"},{name:"Slovakia",countryCode:"SK",vatApplicable:!0},{name:"Slovenia",countryCode:"SI",vatApplicable:!0},{name:"Solomon Islands",countryCode:"SB"},{name:"Somalia",countryCode:"SO"},{name:"South Africa",countryCode:"ZA"},{name:"South Georgia and the South Sandwich Islands",countryCode:"GS"},{name:"South Sudan",countryCode:"SS"},{name:"Spain",countryCode:"ES",vatApplicable:!0},{name:"Sri Lanka",countryCode:"LK"},{name:"Sudan",countryCode:"SD"},{name:"Suriname",countryCode:"SR"},{name:"Svalbard and Jan Mayen",countryCode:"SJ"},{name:"Sweden",countryCode:"SE",vatApplicable:!0},{name:"Switzerland",countryCode:"CH",vatApplicable:!0},{name:"Taiwan",countryCode:"TW",vatApplicable:!0},{name:"Tajikistan",countryCode:"TJ"},{name:"Tanzania, United Republic of",countryCode:"TZ"},{name:"Thailand",countryCode:"TH"},{name:"Timor-Leste",countryCode:"TL"},{name:"Togo",countryCode:"TG"},{name:"Tokelau",countryCode:"TK"},{name:"Tonga",countryCode:"TO"},{name:"Trinidad and Tobago",countryCode:"TT"},{name:"Tunisia",countryCode:"TN"},{name:"Turkey",countryCode:"TR"},{name:"Turkmenistan",countryCode:"TM"},{name:"Turks and Caicos Islands",countryCode:"TC"},{name:"Tuvalu",countryCode:"TV"},{name:"Uganda",countryCode:"UG"},{name:"Ukraine",countryCode:"UA"},{name:"United Arab Emirates",countryCode:"AE"},{name:"United Kingdom",countryCode:"GB",vatApplicable:!0},{name:"United States",countryCode:"US"},{name:"United States Minor Outlying Islands",countryCode:"UM"},{name:"Uruguay",countryCode:"UY"},{name:"Uzbekistan",countryCode:"UZ"},{name:"Vanuatu",countryCode:"VU"},{name:"Venezuela (Bolivarian Republic of)",countryCode:"VE"},{name:"Viet Nam",countryCode:"VN"},{name:"Virgin Islands (British)",countryCode:"VG"},{name:"Virgin Islands (U.S.)",countryCode:"VI"},{name:"Wallis and Futuna",countryCode:"WF"},{name:"Western Sahara",countryCode:"EH"},{name:"Yemen",countryCode:"YE"},{name:"Zambia",countryCode:"ZM"},{name:"Zimbabwe",countryCode:"ZW"}];function Zr(e){const t=(0,ei.y)((()=>({container:{flex:1,display:"flex"},label:{flex:1},subtitle:{width:"80%"}})),[]);return o()("div",{style:t.container},void 0,o()("div",{style:t.label},void 0,o()(oi.Z,{},void 0,o()(y.FormattedMessage,{id:"regionSettings.region.label",defaultMessage:"Region"})),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:t.subtitle},void 0,o()(y.FormattedMessage,{id:"regionSettings.region.subtitle",defaultMessage:"Affects the default formats for dates, numbers, and currencies"}))),o()(Pr,{userSettingsStore:e.userSettingsStore,onChange:e.onChange,pickerLabel:e.pickerLabel}))}function Pr(e){const t=(0,ei.F)(),[,,i]=(0,Me.oR)(void 0,jn.Z),n=(0,Me.VK)((()=>ir(e.userSettingsStore)),[e.userSettingsStore]),[s,r]=m().useState("");return o()(Qe.Z,{popupType:Qe.Z.PopupType.Popup,buttonPopupStore:i,renderOrigin:i=>m().createElement(Je.Z,i,e.userSettingsStore?n:e.pickerLabel,h.Z.chevronDown({width:10,marginLeft:4,fill:t.lightIconColor})),placementToOrigin:Ya.Iw.Bottom,alignmentToOrigin:Ya.lU.Start,render:t=>o()(De.Z,{menuType:Fe.o.Popup,width:216,header:o()(xr,{value:s,onChange:e=>r(e)})},void 0,o()(Le.Z,{type:Le.i.Vertical,initialFocus:void 0,sections:[{key:"regions",render:e=>m().createElement(Ne.Z,a()({},e,{topBorder:0!==e.index})),items:(0,Cn.ZP)(s,Ir,(e=>e.name)).map((i=>({key:i.countryCode,render:e=>m().createElement(Re.Z,a()({},e,{title:i.name})),action:()=>{e.onChange(i.countryCode),t.close(),r("")}})))}]}))})}const _r=(0,y.defineMessages)({regionSearchPlaceholder:{defaultMessage:"Search for a region...",id:"settings.regionSettings.regionSearch"}});function xr(e){return o()(Ne.Z,{isInput:!0},void 0,o()(In.ZP,{value:e.value,onChange:t=>{e.onChange(t.target.value)},focus:!0,placeholder:Te.default.formatMessage(_r.regionSearchPlaceholder),focusAfterAnimation:!0}))}class Fr extends p.Z{renderComponent(){return cn.Z.state.online?this.renderSettings():this.renderOfflineMessage()}renderOfflineMessage(){return o()(yo.Z,{},void 0,o()(oi.Z,{isSmall:!0,style:{textAlign:"center"}},void 0,o()(y.FormattedMessage,{defaultMessage:"Please go online to manage your language and region.",id:"languageSettings.offline.message"})))}renderSettings(){var e;const{currentUserSettingsStore:t}=F.default.state;if(!t)return;const i=(null===(e=t.getSettings())||void 0===e?void 0:e.preferred_locale)||za.al,n="on"===re.default.getGroup("aloha");return o()(yo.Z,{},void 0,o()(Yt.Z,{large:!0,divider:"full"},void 0,o()(y.FormattedMessage,{id:"languageSettings.languageSection.title",defaultMessage:"Language & region"})),o()($a,{locale:i,userSettingsStore:t}),o()(so.Z,{size:24}),n?o()("div",{style:{marginTop:12}},void 0,o()(Zr,{locale:i,userSettingsStore:t,onChange:e=>{}}),o()(so.Z,{size:24}),o()(Yt.Z,{large:!0,divider:"full"},void 0,o()(y.FormattedMessage,{id:"languageSettings.formatsSection.title",defaultMessage:"Formats"})),o()(yr,{locale:i,userSettingsStore:t}),o()(so.Z,{size:24})):o()(qa.Z,{}))}}const Ar=Fr;var Br=i(52796);class Er extends p.Z{renderComponent(){return o()("div",{style:this.getStyle(),onMouseDown:this.props.onMouseDown,onClick:this.props.onClick,onDoubleClick:this.props.onDoubleClick,onContextMenu:this.props.onContextMenu},void 0,o()("div",{style:this.getSidebarStyle()},void 0,this.props.sidebar),o()("div",{style:this.getChildrenStyle()},void 0,this.props.children))}getStyle(){return{display:"flex",height:"100%",flexDirection:this.props.isReversed?"row-reverse":"row"}}getSidebarStyle(){return{height:"100%",background:this.theme.cardSidebarBackground,flexGrow:0,flexShrink:0,maxWidth:250,overflowY:"auto"}}getChildrenStyle(){return{flexGrow:1,position:"relative",zIndex:1,height:"100%"}}}const Rr=Er;let Dr;!function(e){e.Users="users",e.Content="content"}(Dr||(Dr={}));class Lr extends I.Z{getInitialState(){return{currentTab:Dr.Users}}}const Or=new Lr,Nr={lastActive:"descending"};async function Ur(e){const{environment:t,filter:i,spaceId:n,usersTabData:o}=e,s=null==o?void 0:o.dailyUsersData;if(!s||i!==(null==o?void 0:o.filter)){const e=await w.getDailyUsersAnalytics(t,{spaceId:n,dateRange:i});return"failed"===e.type?e.error:e.data}return s}async function Wr(e){const{environment:t,filter:i,sort:n,spaceStore:o,usersTabData:s}=e,a=null==s?void 0:s.filter,r=null==s?void 0:s.userTableSort;if(null==s||!s.usersAndStats||a!==i||r!==n){const e=await w.loadWorkspaceAnalyticsUsers(t,{spaceId:o.id,filters:{timeRange:i},sort:n});return"failed"===e.type?e.error:e.data.users.map((e=>{const t=Mt.Z.createChildStore(o,{table:Ce.KJ,id:e.userId}).getValue();if(t)return{stats:e,user:t}})).filter(H.$K)}return s.usersAndStats}function Vr(e,t){return(0,Zo.Jx)(e)?e.message:t.formatMessage({defaultMessage:"Failed to retrieve user analytics. Try refreshing and reopening the settings.",id:"workspaceAnalytics.usersTab.refershUserAnalytics.defaultFailed",description:"Default error message when retrieving user analytics fails and no localized message available."})}var zr=i(17126);const qr=["last_7_days","last_28_days","last_90_days","all_time"];var Hr=i(77907);const Gr=(0,y.defineMessages)({user:{id:"spaceAnalyticsUsersTab.column.user",defaultMessage:"User",description:"Name of the user column for users tab in workspace analytics"},lastActive:{id:"spaceAnalyticsUsersTab.column.lastActive",defaultMessage:"Last active",description:"Name of the last active column for users tab in workspace analytics"},teamspaces:{id:"spaceAnalyticsUsersTab.column.teamspaces",defaultMessage:"Teamspaces",description:"Name of the teamspaces column for users tab in workspace analytics"},pageViews:{id:"spaceAnalyticsUsersTab.column.pageViews",defaultMessage:"Page views",description:"Name of the page views column for users tab in workspace analytics"},pageEdits:{id:"spaceAnalyticsUsersTab.column.pageEdits",defaultMessage:"Page edits",description:"Name of the page edits column for users tab in workspace analytics"}}),Kr=(0,y.defineMessages)({last_7_days:{id:"spaceAnalyticsUserTab.usersOverTime.dateFilter.last7days",defaultMessage:"Last 7 Days",description:"Option to show users over time data for the last 7 days."},last_28_days:{id:"spaceAnalyticsUserTab.usersOverTime.dateFilter.last28days",defaultMessage:"Last 28 Days",description:"Option to show users over time data for the last 28 days."},last_90_days:{id:"spaceAnalyticsUserTab.usersOverTime.dateFilter.last90days",defaultMessage:"Last 90 Days",description:"Option to show users over time data for the last 90 days."},all_time:{id:"spaceAnalyticsUserTab.usersOverTime.dateFilter.allTime",defaultMessage:"All Time",description:"Option to show users over time data for all time."}}),jr={user:Gr.user,last_active:Gr.lastActive,teamspaces:Gr.teamspaces,page_views:Gr.pageViews,page_edits:Gr.pageEdits};const Yr={user:function(e){return o()(ai.Z,{userValue:e.user})},last_active:function(e){const t=e.last_active;return o()(oi.Z,{},void 0,t?zr.ou.fromMillis(t).setLocale(ss.SP).toLocaleString(zr.ou.DATETIME_FULL):"N/A")}},Qr=e=>t=>o()(oi.Z,{},void 0,t[e]||"N/A"),Xr=[];for(const rm in jr)Xr.push({id:rm,renderCell:Yr[rm]||Qr(rm),headerTitle:Te.default.formatMessage(jr[rm]),widthData:{width:100},sortable:!1});function Jr(e){const t=(0,ei.y)((e=>({sectionTitle:{fontWeight:v.Z.fontWeight.semibold},wrapper:{flexDirection:"row",display:"flex",justifyContent:"space-around"},numUsersCaption:{display:"flex"},overviewText:{textAlign:"center"},table:{marginTop:10},error:{color:g.ZP.red}})),[]),{usersTabData:i,onDailyUsersFilterChange:n}=e;if(!i||!i.usersAndStats)return n("last_90_days"),m().createElement(m().Fragment,null);const s=i.usersAndStats.map((e=>{let{user:t,stats:i}=e;return{id:i.userId,user:t,isClickable:!1,last_active:i.lastActive,teamspaces:1,page_views:i.numPageViews,page_edits:i.numPageEdits}}));return o()("div",{},void 0,o()(oi.Z,{style:t.sectionTitle},void 0,o()(y.FormattedMessage,{id:"settings.workspaceAnalytics.usersTab.userEngagement.title",defaultMessage:"User engagement",description:"User engagement section title for users tab of workspace analytics."})),o()($r,{},void 0,o()("div",{style:t.wrapper},void 0,o()("div",{style:t.overviewText},void 0,o()(oi.Z,{},void 0,"179 Members"),o()(oi.Z,{style:t.numUsersCaption,isSmall:!0},void 0,h.Z.plus({height:11,width:11}),o()(y.FormattedMessage,{id:"settings.workspaceAnalytics.usersTab.topLevel.membersAdded",defaultMessage:"{numUsers} added in the last 28 days",description:"Caption in workspace analytics describing the number of users who have been added in the last month",values:{numUsers:3}}))),o()("div",{style:t.overviewText},void 0,o()(oi.Z,{},void 0,"58 active"),o()(oi.Z,{isSmall:!0},void 0,o()(y.FormattedMessage,{id:"settings.workspaceAnalytics.usersTab.topLevel.active.last28Days",defaultMessage:"In the last 28 days",description:"Caption under the number of active users in the workspace in the workspace analytics tab"}))))),o()($r,{},void 0,o()(el,{filter:i.filter,dailyUsersData:i.dailyUsersData,onDailyUsersFilterChange:n,dailyUsersError:i.dailyUsersError})),o()(oi.Z,{style:t.sectionTitle},void 0,o()(y.FormattedMessage,{id:"settings.workspaceAnalytics.usersTab.allUsers.title",defaultMessage:"All users in Notion",description:"Section title above users graph for workspace analytics."})),i.usersAndStatsError&&o()(oi.Z,{isMultiline:!1,style:t.error},void 0,i.usersAndStatsError),o()(gs.D,{columnRenderInfo:Xr,rows:s,renderNoRowsComponent:()=>o()("div",{},void 0,"N/A"),styles:{container:{marginLeft:20},tableHeaderRow:{},paddingRowCell:{}}}))}function $r(e){const t=(0,ei.y)((e=>({border:{borderRadius:3,overflow:"hidden",border:"1px solid ".concat(e.regularDividerColor),backgroundColor:e.contentBackground,marginTop:12,marginBottom:12,color:e.regularTextColor,padding:20}})),[]);return o()("div",{style:t.border},void 0,e.children)}function el(e){const{filter:t,dailyUsersData:i,onDailyUsersFilterChange:n,dailyUsersError:s}=e,a=(0,ei.y)((e=>({graphHeader:{marginBottom:10,display:"flex",justifyContent:"space-between",width:720},graphTitle:{fontSize:15,fontWeight:"bolder"},emptyGraphBody:{textAlign:"center",paddingTop:50,paddingBottom:50},error:{color:g.ZP.red}})),[]),r=(0,Me.VK)((()=>{if(0===i.length)return;return{startDate:i[0].ds,endDate:i[i.length-1].ds}}),[i]),l=(0,Me.VK)((()=>i.map((e=>({ds:e.ds,values:{all_users:e.all_users,active_users:e.active_users}})))),[i]);let d;return d=!r||i.length<5?o()("div",{style:a.emptyGraphBody},void 0,o()(oi.Z,{isSecondaryColor:!0},void 0,o()(y.FormattedMessage,{id:"workspaceAnalytics.usersOverTime.emptyGraph",defaultMessage:"Not enough data to display graph",description:"Placeholder text when there is not enough data points to display the user over time graph."}))):o()(Hr.LazyTimeSeries,{startDate:r.startDate,endDate:r.endDate,width:725,data:l,height:300,layers:[{key:"all_users",stroke:"#2383E2",fill:"#F1F8FB",renderLabel:e=>o()(y.FormattedMessage,{id:"workspaceAnalytics.usersOverTime.allUsers",defaultMessage:"{users, plural, one {1 user} other {{users} users}}",description:"A label total users in a workspace per day in the users analytics graph.",values:{users:e}})},{key:"active_users",stroke:"#D3A43D",fill:"#FAF7ED",renderLabel:e=>o()(y.FormattedMessage,{id:"workspaceAnalytics.usersOverTime.activeUsers",defaultMessage:"{activeUsers, plural, one {1 active user} other {{activeUsers} active users}}",description:"A label active (logged in and used Notion) users in a workspace per day in the users analytics graph.",values:{activeUsers:e}})}]}),m().createElement(m().Fragment,null,o()("div",{style:a.graphHeader},void 0,o()(oi.Z,{style:a.graphTitle},void 0,o()(y.FormattedMessage,{id:"workspaceAnalytics.usersOverTime.title",defaultMessage:"Users over time",description:"Title of the user analytics daily user graph."})),o()(tl,{currentFilter:t,onDailyUsersFilterChange:n})),s&&o()(oi.Z,{isMultiline:!1,style:a.error},void 0,s),d)}function tl(e){const t=(0,ei.y)((e=>({popup:{width:125,marginLeft:5}})),[]),{currentFilter:i,onDailyUsersFilterChange:n}=e,[s,r]=(0,u.useState)(!1),l=(0,u.useCallback)((e=>{n(e),r(!1)}),[r,n]),d=o()(Ye.u,{on:s,icon:h.Z.calendar({width:16,marginRight:6,fill:"currentColor"}),title:Te.default.formatMessage(Kr[i]),onClick:()=>{r(!0)}}),c=[{key:"filters",items:qr.map((e=>{const t=()=>{l(e)};return{key:e,action:t,render:()=>o()(Re.Z,{focused:!1,onClick:t,title:Te.default.formatMessage(Kr[e])})}})),render:e=>m().createElement(Ne.Z,a()({},e,{title:null,loading:!1}))}],p=o()(De.Z,{menuType:Fe.o.Popup,header:null},void 0,o()(Le.Z,{type:Le.i.Vertical,initialFocus:0,sections:c}));return o()(vt.Z,{marginAfter:!1},void 0,o()(Oe.ZP,{popupType:Oe.ZP.PopupType.Popup,placementToOrigin:Oe.ZP.Placement.Bottom,alignmentToOrigin:Oe.ZP.Alignment.Start,open:s,render:()=>p,onDismiss:()=>r(!1),keepFocus:!0,origin:d,preventScaleTransition:!0,style:t.popup}))}const il=function(e){const t=(0,ei.y)((e=>({headingStyle:{marginBottom:0,paddingBottom:0,fontSize:16,fontWeight:v.Z.fontWeight.medium,display:"flex",justifyContent:"space-between"},tabsStyle:{paddingLeft:0,paddingRight:0,marginTop:-6,marginBottom:14}})),[]),i=(0,be.O7)(),n=(0,y.useIntl)(),[{currentSpaceStore:s}]=(0,Me.oR)(F.default),[a,r]=(0,Me.oR)(Or),l=(0,u.useCallback)((async e=>{s&&await async function(e){var t,i;const{environment:n,intl:o,spaceStore:s,spaceAnalyticsStore:a,setState:r}=e,l=e.filter||(null===(t=a.usersTabData)||void 0===t?void 0:t.filter)||"last_90_days",c=e.sort||(null===(i=a.usersTabData)||void 0===i?void 0:i.userTableSort)||Nr,[u,m]=await Promise.all([Ur({environment:n,filter:l,spaceId:s.id,usersTabData:a.usersTabData}),Wr({environment:n,filter:l,sort:c,spaceStore:s,usersTabData:a.usersTabData})]),p=(0,d.isError)(u)?[]:u,g=(0,d.isError)(m)?[]:m;r({currentTab:Dr.Users,usersTabData:{filter:l,userTableSort:c,dailyUsersError:(0,d.isError)(u)?Vr(u,o):void 0,dailyUsersData:p,usersAndStatsError:(0,d.isError)(m)?Vr(m,o):void 0,usersAndStats:g}})}({environment:i,intl:n,filter:e,spaceStore:s,spaceAnalyticsStore:a,setState:r})}),[i,n,s,a,r]),c=(0,u.useCallback)((e=>{if(s)switch(e){case Dr.Content:case Dr.Users:r({...a,currentTab:e});break;default:(0,H.t1)(e)}}),[s,r,a]),p={[Dr.Users]:o()(y.FormattedMessage,{id:"workspaceAnalyticsTabs.members.title",defaultMessage:"Members",description:"Title for the members tab in workspace analytics"}),[Dr.Content]:o()(y.FormattedMessage,{id:"workspaceAnalyticsTabs.content.title",defaultMessage:"Content",description:"Title for the content tab in workspace analytics"})},g=[Dr.Users,Dr.Content],h=g.map((e=>p[e])),f=a.currentTab;return o()(yo.Z,{},void 0,o()(Yt.Z,{large:!0,style:t.headingStyle},void 0,o()(y.FormattedMessage,{id:"settings.workspaceAnalytics.title",defaultMessage:"Workspace analytics",description:"Header for workspace analytics page in settings modal"})),yo.Z.renderDivider(),o()(fa.Z,{tabs:h,selectedIndex:g.indexOf(f),onChange:e=>{c(g[e])},style:t.tabsStyle}),function(e){const{spaceAnalyticsStore:t,onDailyUsersFilterChange:i}=e,n=t.currentTab;switch(n){case Dr.Content:return m().createElement(m().Fragment,null);case Dr.Users:return o()(Jr,{usersTabData:t.usersTabData,onDailyUsersFilterChange:i});default:(0,H.t1)(n)}}({spaceAnalyticsStore:a,onDailyUsersFilterChange:l}))};i(73210);var nl=i(86080);class ol extends I.Z{getInitialState(){return{churnSurveyModalOpen:!1}}}const sl=ol;var al=i(12318),rl=i(24684);var ll=i(17256);const dl=["not_using_enough","switching","too_expensive","too_difficult","missing_features","upgraded_by_mistake","consolidating_workspaces","other"];class cl extends I.Z{getInitialState(){return{reasons:[],reasonOther:"",stage:"questionnaire",churnSurveyId:(0,rn.ZP)()}}handleNextStage(e){const{downgradeCoupon:t,acceptedOffer:i,isWorkspaceDeletion:n}=e;switch(this.state.stage){case"questionnaire":return t?this.setState({...this.state,stage:t}):n?this.setState({...this.state,stage:"closed"}):this.setState({...this.state,stage:"downgrade"});case"enterprise_annual":case"enterprise_three_months":return i?this.setState({...this.state,stage:"accepted_enterprise_offer"}):n?this.setState({...this.state,stage:"closed"}):this.setState({...this.state,stage:"confirmation"});case"team_annual":case"team_three_months":return i?this.setState({...this.state,stage:"accepted_team_offer"}):n?this.setState({...this.state,stage:"closed"}):this.setState({...this.state,stage:"confirmation"});case"downgrade":return this.setState({...this.state,stage:"confirmation"});case"confirmation":return this.setState({...this.state,stage:"closed"})}}}const ul=cl,ml=(0,y.defineMessages)({reasonOtherPlaceholder:{id:"churnSurvey.reasons.reasonOtherPlaceholder",defaultMessage:"Tell us more...",description:"Shown in the downgrade survey in case they want to put a custom reason for why they downgraded."},tenPercentOff:{id:"churnSurvey.offer.tenPercent",defaultMessage:"Get 10% off",description:"Shown in a button to confirm a customer wants to accept the 10% off discount we presented to them."},fiftyPercentOff:{id:"churnSurvey.offer.fiftyPercent",defaultMessage:"Get 50% off",description:"Shown in a button to confirm a customer wants to accept the 50% off discount we presented to them."},collaborativeTeamspaces:{id:"churnSurvey.features.collaborativeTeamspaces",defaultMessage:"Collaborative teamspaces",description:"Describes feature customers will lose access to if they downgrade."},sharingPermissions:{id:"churnSurvey.features.sharingPermissions",defaultMessage:"Sharing permissions",description:"Describes feature customers will lose access to if they downgrade."},versionHistory:{id:"churnSurvey.features.versionHistory",defaultMessage:"30 day version history",description:"Describes feature customers will lose access to if they downgrade."},adminTools:{id:"churnSurvey.features.adminTools",defaultMessage:"Admin tools",description:"Describes feature customers will lose access to if they downgrade."},saml:{id:"churnSurvey.features.saml",defaultMessage:"SAML SSO",description:"Describes feature customers will lose access to if they downgrade."},auditLog:{id:"churnSurvey.features.auditLog",defaultMessage:"Audit log",description:"Describes feature customers will lose access to if they downgrade."},security:{id:"churnSurvey.features.securityAndControls",defaultMessage:"Advanced security and controls",description:"Describes feature customers will lose access to if they downgrade."}}),pl={free:o()(y.FormattedMessage,{id:"churnSurveyMenu.free.title",defaultMessage:"Free",description:"Describes which plan the customer is downgrading to when downgrading plans."}),personal:o()(y.FormattedMessage,{id:"churnSurveyMenu.personal.title",defaultMessage:"Personal Pro",description:"Describes which plan the customer is downgrading to when downgrading plans."}),team:o()(y.FormattedMessage,{id:"churnSurveyMenu.team.title",defaultMessage:"Team",description:"Describes which plan the customer is downgrading to when downgrading plans."}),business:o()(y.FormattedMessage,{id:"churnSurveyMenu.business.title",defaultMessage:"Business",description:"Describes which plan the customer is downgrading to when downgrading plans."})};class gl extends p.Z{constructor(){super(...arguments),l()(this,"storeTypes",{store:ul}),l()(this,"handleDowngrade",(e=>{this.handleNextStage(e),this.props.onAccept()})),l()(this,"handleNextStage",(e=>{this.stores.store.handleNextStage(e),null!=e&&e.isWorkspaceDeletion&&this.props.onAccept()}))}renderComponent(){const{churnType:e,onClose:t,periodEnd:i,isWorkspaceDeletion:n}=this.props,{store:s}=this.stores,a=(0,ll.Z)(i).format("LL"),r=pl[e];return"closed"===s.state.stage&&t(),(0,M.trackChurnSurvey)(this.environment,this.stores.store.state),o()("div",{style:{fontSize:14}},void 0,o()("div",{style:{textAlign:"center",padding:"16px 8px 0px"}},void 0,o()(ni.Z,{onClick:()=>{(0,M.trackChurnSurveyClose)(this.environment,s.state),t()},style:this.getCancelStyle(),hoveredStyle:{background:this.theme.buttonPressedBackground}},void 0,h.Z.closeSmall({width:14,fill:this.theme.mediumTextColor})),this.renderStageIcon(s),o()("div",{style:{padding:"0px 10px"}},void 0,this.renderTitle(s,r),this.renderDescription(s,a))),this.renderContent(s,e,r),o()("div",{style:{padding:"20px 24px"}},void 0,this.renderFooter(s,t,r,n)))}renderMessageForReason(e){switch(e){case"not_using_enough":return o()(y.FormattedMessage,{id:"churnSurvey.reasons.notUsingEnough",defaultMessage:"Not using it enough",description:"Shown as a checkbox option when asked why a customer is downgrading their plan."});case"switching":return o()(y.FormattedMessage,{id:"churnSurvey.reasons.switching",defaultMessage:"Switching to another tool",description:"Shown as a checkbox option when asked why a customer is downgrading their plan."});case"too_expensive":return o()(y.FormattedMessage,{id:"churnSurvey.reasons.tooExpensive",defaultMessage:"Cost (too expensive or budget cuts)",description:"Shown as a checkbox option when asked why a customer is downgrading their plan."});case"too_difficult":return o()(y.FormattedMessage,{id:"churnSurvey.reasons.tooDifficult",defaultMessage:"Too difficult to use",description:"Shown as a checkbox option when asked why a customer is downgrading their plan."});case"missing_features":return o()(y.FormattedMessage,{id:"churnSurvey.reasons.missingFeatures",defaultMessage:"Missing features",description:"Shown as a checkbox option when asked why a customer is downgrading their plan."});case"upgraded_by_mistake":return o()(y.FormattedMessage,{id:"churnSurvey.reasons.upgradedByMistake",defaultMessage:"Upgraded by mistake",description:"Shown as a checkbox option when asked why a customer is downgrading their plan."});case"consolidating_workspaces":return o()(y.FormattedMessage,{id:"churnSurvey.reasons.consolidating_workspaces",defaultMessage:"Consolidating Notion workspaces",description:"Shown as a checkbox option when asked why a customer is downgrading their plan."});case"other":return o()(y.FormattedMessage,{id:"churnSurvey.reasons.other",defaultMessage:"Other",description:"Shown as a checkbox option when asked why a customer is downgrading their plan."});default:(0,H.t1)(e)}}renderStageIcon(e){const{stage:t}=e.state;switch(t){case"questionnaire":case"enterprise_annual":case"enterprise_three_months":case"team_annual":case"team_three_months":return h.Z.settingsCredit(this.getIconStyle());case"downgrade":return h.Z.arrowDown(this.getIconStyle());case"accepted_enterprise_offer":case"accepted_team_offer":case"confirmation":return h.Z.statusCompleteGroup(this.getIconStyle());case"closed":return;default:(0,H.t1)(t)}}renderTitle(e,t){const i=e.state.stage;let n;const s=this.props.churnType===this.props.currentPlan;switch(i){case"questionnaire":if(this.props.isWorkspaceDeletion){n=o()(y.FormattedMessage,{id:"churnSurvey.header.questionnaire.workspaceCancellation.title",defaultMessage:"Why do you want to delete your workspace?",description:"Shown when a customer attempts to delete their workspace."});break}if(s){n=o()(y.FormattedMessage,{id:"churnSurvey.header.questionnaire.cancellation.title",defaultMessage:"Why do you want to cancel?",description:"Shown when a customer attempts to cancel their plan"});break}n=o()(y.FormattedMessage,{id:"churnSurvey.header.questionnaire.title",defaultMessage:"Why do you want to downgrade?",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"team_three_months":n=o()(y.FormattedMessage,{id:"churnSurvey.header.teamOfferMonthly.title",defaultMessage:"50% off your Team Plan, on us.",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"team_annual":n=o()(y.FormattedMessage,{id:"churnSurvey.header.teamOfferAnnual.title",defaultMessage:"10% off your Team Plan, on us.",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"enterprise_three_months":case"enterprise_annual":n=o()(y.FormattedMessage,{id:"churnSurvey.header.enterpriseOffer.title",defaultMessage:"10% off your Enterprise plan.",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"downgrade":if(s){n=o()(y.FormattedMessage,{id:"downgradeModal.header.cancellation.title",defaultMessage:"Continue cancelling?",description:"Shown when a customer attempts to cancel their plan.",values:{planMessage:t}});break}n=o()(y.FormattedMessage,{id:"downgradeModal.header.downgrade.title",defaultMessage:"Continue downgrading to {planMessage}?",description:"Shown when a customer attempts to downgrade from a paid plan.",values:{planMessage:t}});break;case"accepted_enterprise_offer":n=o()(y.FormattedMessage,{id:"downgradeModal.header.acceptedEnterpriseOfferConfirmation.title",defaultMessage:"Thank you for staying on your Enterprise Plan",description:"Shown when a customer accepted the offer to stay in their Enterprise plan."});break;case"accepted_team_offer":n=o()(y.FormattedMessage,{id:"downgradeModal.header.acceptedTeamOfferConfirmation.title",defaultMessage:"Thank you for staying on your Team Plan",description:"Shown when a customer accepted the offer to stay in their Team plan."});break;case"confirmation":n=o()(y.FormattedMessage,{id:"downgradeModal.header.confirmation.title",defaultMessage:"Thank you for switching to {planMessage}",description:"Shown when a customer attempts to downgrade from a paid plan.",values:{planMessage:t}});break;case"closed":break;default:(0,H.t1)(i)}return o()("h3",{style:gl.headerStyle},void 0,n)}renderDescription(e,t){const{stage:i}=e.state;let n;switch(i){case"questionnaire":n=o()(y.FormattedMessage,{id:"churnSurvey.reasons.description",defaultMessage:"We'd love your input to make Notion better",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"team_three_months":n=o()(y.FormattedMessage,{id:"churnSurvey.teamMonthlyOffer.description",defaultMessage:"Get 50% off for 3 months if you keep your plan.",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"team_annual":n=o()(y.FormattedMessage,{id:"churnSurvey.teamAnnualOffer.description",defaultMessage:"Get 10% off if you keep your plan.",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"enterprise_three_months":n=o()(y.FormattedMessage,{id:"churnSurvey.enterpriseMonthlyOffer.description",defaultMessage:"Get 10% off for 3 months if you keep your plan.",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"enterprise_annual":n=o()(y.FormattedMessage,{id:"churnSurvey.enterpriseAnnualOffer.description",defaultMessage:"Get 10% off if you keep your plan.",description:"Shown when a customer attempts to downgrade from a paid plan."});break;case"downgrade":n=o()(y.FormattedMessage,{id:"churnSurvey.downgrade.description",defaultMessage:"You'll still enjoy all the features of your current plan until {periodEnd}. You can resubscribe or switch to another plan anytime.",description:"Shown when a customer attempts to downgrade from a paid plan.",values:{periodEnd:o()("span",{style:{fontWeight:600}},void 0,t)}});break;case"accepted_team_offer":case"accepted_enterprise_offer":n=o()(y.FormattedMessage,{id:"churnSurvey.acceptedOfferConfirmation.description",defaultMessage:"Your updated pricing will kick in on your upcoming renewal date of {periodEnd}",description:"Shown when a customer attempts to downgrade from a paid plan.",values:{periodEnd:o()("span",{style:{fontWeight:600}},void 0,t)}});break;case"confirmation":n=o()(y.FormattedMessage,{id:"churnSurvey.confirmation.description",defaultMessage:"You'll still enjoy all features of your current plan until {periodEnd}. You can resubscribe or switch to another plan anytime.",description:"Shown when a customer attempts to downgrade from a paid plan.",values:{periodEnd:o()("span",{style:{fontWeight:600}},void 0,t)}});break;case"closed":break;default:(0,H.t1)(i)}return o()("p",{style:{lineHeight:1.4,marginTop:8}},void 0,o()("div",{style:this.getDescriptionStyle()},void 0,n))}renderSurveySection(e){const{reasons:t,reasonOther:i}=e.state;return o()("div",{style:gl.surveySectionStyle},void 0,dl.map((n=>{if(this.props.isWorkspaceDeletion&&"upgraded_by_mistake"===n)return;const s=t.includes(n);return m().createElement(m().Fragment,null,o()("div",{style:this.getRowStyle(!0),onClick:()=>{e.setState({...e.state,reasons:s?c().without(t,n):[...t,n]})}},n,o()(Vt.Z,{checked:s,size:14}),o()("span",{style:{marginLeft:4}},void 0,this.renderMessageForReason(n))),"other"===n&&s&&o()(lt.Z,{style:gl.inlineInputStyle,autoFocus:!0,value:i,placeholder:Te.default.formatMessage(ml.reasonOtherPlaceholder),onChange:t=>{e.setState({...e.state,reasonOther:t.target.value})}}))})))}renderDowngradeSection(e,t){let i=[];i="personal_free"===e||"free"===e?rl.k0:"personal"===e?rl.rs:rl.X3;if(!(this.props.churnType===this.props.currentPlan))return o()("div",{style:{padding:"0px 24px 0px"}},void 0,o()("p",{style:this.getDowngradeDescriptionStyle()},void 0,o()(y.FormattedMessage,{id:"churnSurvey.downgradeSection.description",defaultMessage:"The following restrictions will apply when plan switches to {planMessage}",description:"Describes the changes a user will experience when downgrading.",values:{planMessage:t}})),o()("div",{},void 0,i.map((e=>m().createElement(m().Fragment,null,o()("div",{style:this.getRowStyle(!1)},void 0,e.icon(this.getDowngradeSectionIconStyle(!1)),o()("span",{style:this.getRestrictionDurationStyle()},void 0,o()("s",{},void 0,Te.default.formatMessage(e.duration))),h.Z.arrowRight(this.getDowngradeSectionIconStyle(!0)),o()("span",{style:this.getRestrictionHighlightedMessageStyle()},void 0,e.highlightedMessage&&Te.default.formatMessage(e.highlightedMessage)),e.message&&Te.default.formatMessage(e.message)))))))}renderTeamOfferSection(){return m().createElement(m().Fragment,null,o()("li",{},void 0,Te.default.formatMessage(ml.collaborativeTeamspaces)),o()("li",{},void 0,Te.default.formatMessage(ml.sharingPermissions)),o()("li",{},void 0,Te.default.formatMessage(ml.versionHistory)),o()("li",{},void 0,Te.default.formatMessage(ml.adminTools)))}renderEnterpriseOfferSection(){return m().createElement(m().Fragment,null,o()("li",{},void 0,Te.default.formatMessage(ml.saml)),o()("li",{},void 0,Te.default.formatMessage(ml.auditLog)),o()("li",{},void 0,Te.default.formatMessage(ml.security)))}renderOfferSection(e){return o()("div",{style:{padding:"0px 24px 0px"}},void 0,o()("p",{style:this.getDowngradeDescriptionStyle()},void 0,o()(y.FormattedMessage,{id:"churnSurvey.offerSection.description",defaultMessage:"You'll get to keep",description:"Describes the changes a user will keep if they don't downgrade their plan."})),o()("ul",{style:{margin:0,paddingLeft:28,color:this.theme.mediumTextColor}},void 0,e.startsWith("team")&&this.renderTeamOfferSection(),e.startsWith("enterprise")&&this.renderEnterpriseOfferSection()))}renderContent(e,t,i){const{stage:n}=e.state;switch(n){case"questionnaire":return this.renderSurveySection(e);case"downgrade":return this.renderDowngradeSection(t,i);case"team_three_months":case"team_annual":case"enterprise_three_months":case"enterprise_annual":return this.renderOfferSection(n);default:return}}renderOfferAcceptButton(e){const{customerId:t,churnType:i}=this.props,n="team_three_months"===e;return o()(Ee.Z,{isLarge:!0,style:{width:"100%"},onClick:async()=>{await async function(e,t){const{customerId:i,newPlan:n,downgradeCoupon:o}=t,s=await w.applyCustomerOffer(e,{customerId:i,newPlan:n,offerType:"downgrade_flow",downgradeCoupon:o});"failed"===s.type&&C.showError(s)}(this.environment,{customerId:t,newPlan:i,downgradeCoupon:e}),this.handleNextStage({downgradeCoupon:e,acceptedOffer:!0})}},void 0,n&&Te.default.formatMessage(ml.fiftyPercentOff),!n&&Te.default.formatMessage(ml.tenPercentOff))}renderTopButton(e,t,i){const{customerId:n,churnType:s,currentPlan:a}=this.props,r=s===a;return o()("div",{style:{display:"flex"}},void 0,"questionnaire"===e&&o()(Ee.Z,{isLarge:!0,style:{width:"100%"},onClick:async()=>{const e=await async function(e,t){const{customerId:i,newPlan:n}=t,o=await w.getCustomerOffer(e,{customerId:i,newPlan:n,offerType:"downgrade_flow"});if("failed"!==o.type)return o.data.coupon;C.showError(o)}(this.environment,{customerId:n,newPlan:s});this.handleNextStage({downgradeCoupon:e,isWorkspaceDeletion:i})}},void 0,o()(y.FormattedMessage,{id:"churnSurvey.continueButton.title",defaultMessage:"Continue",description:"Shown in downgrade modal so users can continue downgrading."})),"downgrade"===e&&o()(ni.Z,{style:this.getDowngradeButtonStyle(e),onClick:()=>this.handleDowngrade({}),hoveredStyle:{background:g.ZP.redWithAlpha(.8)}},void 0,r&&o()(y.FormattedMessage,{id:"churnSurvey.cancelSubscription.title",defaultMessage:"Cancel subscription",description:"Button shown in case the user wants to cancel their subscription."}),!r&&o()(y.FormattedMessage,{id:"churnSurvey.downgradeButton.title",defaultMessage:"Downgrade",description:"Button shown in case the user no longer wants to downgrade their subscription."})),t&&this.renderOfferAcceptButton(e))}renderFooter(e,t,i,n){const{stage:s}=e.state;if(!s)return;const a=this.isShowingOfferStages(s),r=this.isShowingAcceptedOfferStages(s);return m().createElement(m().Fragment,null,this.renderTopButton(s,a,n),"confirmation"!==s&&o()("div",{style:{display:"flex"}},void 0,o()(ni.Z,{style:this.getDowngradeButtonStyle(),onClick:()=>{a?this.handleDowngrade({isWorkspaceDeletion:n}):((0,M.trackChurnSurveyClose)(this.environment,e.state),t())}},void 0,a&&!n&&o()(y.FormattedMessage,{id:"churnSurvey.offer.continueDowngrading.title",defaultMessage:"Downgrade to {planMessage}",description:"Shown in the downgrade modal in case they no longer want to downgrade.",values:{planMessage:i}}),a&&n&&o()(y.FormattedMessage,{id:"churnSurvey.offer.continueDeletingWorkspace.title",defaultMessage:"Continue deleting entire workspace",description:"Shown in the downgrade modal in case they no longer want to downgrade.",values:{planMessage:i}}),!a&&!r&&o()(y.FormattedMessage,{id:"churnSurvey.cancelButton.title",defaultMessage:"Cancel",description:"Shown in the downgrade modal in case they no longer want to downgrade."}))))}isShowingOfferStages(e){switch(e){case"team_three_months":case"team_annual":case"enterprise_annual":case"enterprise_three_months":return!0;case"questionnaire":case"downgrade":case"accepted_enterprise_offer":case"accepted_team_offer":case"confirmation":case"closed":return!1;default:(0,H.t1)(e)}}isShowingAcceptedOfferStages(e){switch(e){case"accepted_enterprise_offer":case"accepted_team_offer":return!0;case"questionnaire":case"team_three_months":case"team_annual":case"enterprise_annual":case"enterprise_three_months":case"downgrade":case"confirmation":case"closed":return!1;default:(0,H.t1)(e)}}getRowStyle(e){return{display:"flex",alignItems:"center",cursor:e?"pointer":"default",marginBottom:4}}getDescriptionStyle(){return{margin:0,color:this.theme.mediumTextColor,marginBottom:8}}getIconStyle(){return{display:"inline",height:36,fill:this.theme.accentColors.gray[500],marginTop:8,marginBottom:8}}getDowngradeDescriptionStyle(){return{lineHeight:1.4,marginTop:8,fontWeight:v.Z.fontWeight.medium}}getDowngradeSectionIconStyle(e){return{display:"inline",height:e?14:18,fill:this.theme.accentColors.gray[500],width:void 0,padding:"0px 8px"}}getRestrictionDurationStyle(){return{marginLeft:4,color:this.theme.accentColors.gray[500]}}getRestrictionHighlightedMessageStyle(){return{marginRight:4,color:this.theme.redBadgeBackground}}getCancelStyle(){return{position:"absolute",top:"10px",right:"10px",background:this.theme.buttonHoveredBackground,borderRadius:"100%",width:20,height:20,display:"flex",alignItems:"center",justifyContent:"center",zIndex:10}}getDowngradeButtonStyle(e){const t="downgrade"===e;return{width:"100%",color:t?g.ZP.white:this.theme.mediumTextColor,background:t?this.theme.redBadgeBackground:this.theme.whiteButtonBackground,boxShadow:void 0,display:"inline-flex",alignItems:"center",justifyContent:"center",flexShrink:0,whiteSpace:"nowrap",height:28,borderRadius:3,fill:g.ZP.lightTextColor,lineHeight:1.2,paddingLeft:12,paddingRight:12,fontSize:14,fontWeight:v.Z.fontWeight.medium,marginTop:4}}}l()(gl,"surveySectionStyle",{padding:"0px 24px"}),l()(gl,"headerStyle",{margin:0,marginBottom:8}),l()(gl,"inlineInputStyle",{marginBottom:12,width:"calc(100% - 18px)"});const hl=gl;var fl=i(93007),vl=i(33411);const yl=(0,y.defineMessages)({workspaceDomainInputPlaceholder:{id:"spaceBasicSettingsDomain.domainSection.workspaceDomainInput.placeholder",defaultMessage:"Your domain",description:"Placeholder text for inputting a domain."},copyDomainTooltip:{id:"spaceBasicSettingsDomain.workspaceDomain.tooltip",defaultMessage:"Click to copy link",description:"Tooltip for a button to copy link."}}),Sl=()=>{const e=(0,ei.F)();return o()("div",{style:{color:e.invoiceGreen,display:"flex",flexDirection:"row",alignItems:"center",fontSize:"14px"}},void 0,h.Z.circleCheckFilled({height:16,width:16,margin:"0 4px 0 8px",color:e.invoiceGreen}),o()("span",{},void 0,o()(y.FormattedMessage,{defaultMessage:"Available",description:"website domain is available for selection",id:"spaceBasicSettings.domainSection.workspaceDomainInput.validationMessage.available"})))},bl=()=>o()("div",{style:{color:g.ZP.red,display:"flex",flexDirection:"row",alignItems:"center",fontSize:"14px"}},void 0,h.Z.warning({height:16,width:16,margin:"0 4px 0 8px"}),o()("span",{},void 0,o()(y.FormattedMessage,{defaultMessage:"Used",description:"website domain is currently in use by another workspace",id:"spaceBasicSettings.domainSection.workspaceDomainInput.validationMessage.used"}))),Ml=()=>o()("div",{style:{color:g.ZP.red,display:"flex",flexDirection:"row",alignItems:"center",fontSize:"14px"}},void 0,h.Z.warning({height:16,width:16,margin:"0 4px 0 8px"}),o()("span",{},void 0,o()(y.FormattedMessage,{defaultMessage:"Not allowed",description:"website domain is not available for selection",id:"spaceBasicSettings.domainSection.workspaceDomainInput.validationMessage.notAllowed"}))),wl=()=>o()(vl.Z,{show:!0,showDelay:500,showHold:300,render:()=>o()(qn.Z,{style:{textAlign:"center",visibility:"visible",display:"inline",marginLeft:8}})}),Cl=e=>{const[t,i]=(0,Me.oR)(e.spaceBasicSettingsStore),{domain:n,domainState:s}=t,r=(0,be.O7)(),l=(0,ei.F)(),[d,c]=(0,u.useState)(!0),p=m().createRef();return m().createElement(m().Fragment,null,o()(Yt.Z,{},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.domainSection.title",defaultMessage:"Domain"})),o()("div",{style:{display:"flex",alignItems:"center"}},void 0,o()("div",{style:{background:l.inputBackground,borderRadius:3,boxShadow:"rgb(15 15 15 / 10%) 0px 0px 0px 1px inset",display:"flex"}},void 0,m().createElement(lt.Z,{type:"text",style:{background:"none",boxShadow:"none",padding:"4px 6px",width:255},ref:p,value:n,placeholder:Te.default.formatMessage(yl.workspaceDomainInputPlaceholder),readOnly:!e.canAdminSpaceStore,onChange:e.handleSpaceUrlChange,onFocus:e=>{c(!1),e.target.select()}})),d&&e.domainIsAutogenerated&&o()("div",{style:{color:g.ZP.blue,fontSize:v.Z.fontSize.UIRegular.desktop,fontWeight:500,textAlign:"right",padding:"4px 6px",whiteSpace:"nowrap"},onClick:()=>{var e;null===(e=p.current)||void 0===e||e.focusInput(),c(!1),i({...t,domain:""})}},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.changeDomain.cta.text",defaultMessage:"Set your own",description:"Prompt beside an autogenerated domain name that encourages the user to set / customize their public website domain name"})),n&&"available"===s&&o()(Sl,{}),"inuse"===s&&o()(bl,{}),"disallowed"===s&&o()(Ml,{}),"loading"===s&&wl()),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:4}},void 0,((e,t)=>{const i=t=>o()(Ue.Z,{delayThreshold:0,renderTooltip:()=>Te.default.formatMessage(yl.copyDomainTooltip),render:i=>m().createElement(ao.Z,a()({onClick:()=>{(0,ti.RD)({environment:e,stringValue:t,copiedMessage:ti.tq.copiedLinkToClipboard})}},i),t)});return o()("div",{style:{paddingTop:8}},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.domainSection.workspaceDomainInput.viewPublicPage.caption",defaultMessage:"Pages shared to web will be under {linkText}.",values:{linkText:i("".concat(t,".").concat(Kt.Z.publicDomainName))}}),o()("div",{style:{paddingTop:6}}),o()(y.FormattedMessage,{id:"spaceBasicSettings.domainSection.workspaceDomainInput.joinWorkspace.caption",defaultMessage:"Anyone with an allowed email domain can join this workspace via {linkText}.",values:{linkText:i("".concat(window.location.host,"/").concat(t))}}))})(r,n)))},kl=e=>{const t=(0,y.useIntl)(),i=(0,ei.F)(),n=(0,be.O7)(),s=(0,Me.VK)((()=>(0,T.M9)(n)),[n]),a=!Boolean(s),[r,l]=(0,Me.oR)(ce);return o()("div",{onClick:()=>{s&&(0,Wo.y)(n,{from:"public_domain_home_page",for:s})}},void 0,m().createElement(lt.Z,{type:"text",ref:e.textInputRef,style:{background:i.inputBackground,borderRadius:3,boxShadow:"rgb(15 15 15 / 10%) 0px 0px 0px 1px inset",display:"flex",padding:"4px 6px"},value:r.query,onChange:e=>{l({...r,query:e.target.value})},onFocus:()=>{a&&l({...r,openDropdown:!0})},disabled:!a,left:h.Z.searchThick({fill:i.mediumIconColor,width:16,height:16,marginRight:8,marginLeft:8,flexGrow:0,flexShrink:0}),placeholder:t.formatMessage({defaultMessage:"Select a page shared to web",id:"spaceBasicSettings.PublicHomePageSection.input.placeholder"})}))};var Tl=i(80270),Il=i(29026),Zl=i(11470);const Pl=()=>o()(vl.Z,{show:!0,showDelay:500,showHold:300,render:()=>o()(qn.Z,{style:{textAlign:"center",visibility:"visible",display:"inline",marginLeft:8}})}),_l=async(e,t)=>{if(!cn.Z.state.online)return[];const i=await(0,ke.UJ)({environment:t,query:e,source:"public_home_page_menu",limit:Il.Xv});return""===e?i.splice(0,5):i},xl=e=>{const t=(0,be.O7)(),[i,n]=(0,Me.oR)(e.spaceBasicSettingsStore,me),[s,r]=(0,Me.oR)(ce),{query:l}=s,[{value:d,status:c}]=(0,Kn.r5)((()=>_l(l,t)),[l,t]),u=(0,Me.VK)((()=>(0,O.RM)()),[]);if(!(l||d&&0!==d.length))return null;return o()("div",{style:{marginTop:2,marginBottom:2}},void 0,o()(Le.Z,{type:Le.i.Vertical,sections:[{key:"recent public pages section",render:e=>m().createElement(Ne.Z,e),items:"idle"===c||"pending"===c?[{key:"loading spinner",render:Pl,action:()=>{}}]:u&&d&&0!==d.length?[...d.map((e=>{const t=Tl.Z.createChildStore(u,{table:pi.iU,id:e.id});return{key:"".concat(e.id," page"),render:e=>m().createElement(Zl.Z,a()({store:t},e)),action:()=>{n({...i,publicHomePage:e.id}),r({...s,openDropdown:!1,displaySummary:!0})}}}))]:[{key:"no results",render:()=>o()(oi.Z,{isSmall:!0,style:{marginLeft:8}},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.PublicHomePageSection.dropdownLabel.noResults",defaultMessage:"No results"})),action:()=>{}}]}],initialFocus:void 0}))};var Fl=i(17755),Al=i(22808);class Bl extends m().PureComponent{render(){return o()("div",{style:{height:this.getSize(),width:this.getSize(),...Bl.wrapStyle,verticalAlign:"top",marginTop:1,...this.props.style}},void 0,this.renderIcon())}renderIcon(){const{icon:e}=this.props;if(e){if((0,Al.Z)(e.icon))return o()("div",{style:{fontSize:this.getEmojiSize()}},void 0,e.icon);{const t=Fl.EK({url:e.icon,baseUrl:this.props.baseUrl,fullyQualified:!0,permissionRecord:e.pointer,width:this.getImageSize(),userId:void 0});return o()("img",{alt:"icon",src:t,style:{width:this.getImageSize(),height:this.getImageSize(),...Bl.imageStyle}})}}}getSize(){return this.props.size}getEmojiSize(){return.9*this.props.size}getImageSize(){return.888*this.props.size}}l()(Bl,"wrapStyle",{display:"flex",alignItems:"center",justifyContent:"center",borderRadius:3}),l()(Bl,"imageStyle",{objectFit:"cover",borderRadius:3,marginTop:1});const El=Bl;var Rl=i(76798);const Dl=e=>{const[t,i]=(0,Me.oR)(e.spaceBasicSettingsStore,me),[n,s]=(0,Me.oR)(ce),[a,r]=(0,Me.VK)((()=>{const e=(0,O.RM)();if(!e||!t.publicHomePage)return[];const i=Tl.Z.createChildStore(e,{table:pi.iU,id:t.publicHomePage});return[i,i.getIcon()]}),[t]);return a?o()("div",{style:{display:"flex",alignItems:"center"}},void 0,o()("div",{style:{display:"flex",paddingRight:8}},void 0,r&&o()(El,{baseUrl:"",icon:r,size:18,style:{display:"inline-flex",marginRight:2,verticalAlign:"text-top"}}),o()(Rl.Z,{store:a,style:{display:"inline",whiteSpace:"normal",marginRight:Boolean(r)?3:0,wordBreak:"break-word"}})),o()(jt.Z,{onClick:()=>{s({...n,displaySummary:!1}),i({...t,publicHomePage:void 0})}},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.PublicHomePageSection.dropdownLabel",defaultMessage:"Clear"}))):null},Ll=e=>{const t=(0,be.O7)(),i=m().createRef(),[n,s]=(0,Me.oR)(ce),[r]=(0,Me.oR)(e.spaceBasicSettingsStore),{openDropdown:l,displaySummary:d}=n,{publicHomePage:c,domain:u}=r,p="".concat(u,".").concat(Kt.Z.publicDomainName),g=(0,Me.VK)((()=>(0,T.M9)(t)),[t]),h=!Boolean(g);return m().createElement(m().Fragment,null,o()(Yt.Z,{style:{display:"flex",alignItems:"center"}},void 0,o()("span",{style:{marginRight:8}},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.PublicHomePageSection.title",defaultMessage:"Public home page"})),g&&o()(Vo.Z,{subscriptionTier:g,analyticsName:"public_domain_home_page",desktopStyle:{marginTop:-1}})),h&&c&&d?o()(Dl,{spaceBasicSettingsStore:e.spaceBasicSettingsStore}):o()(Oe.ZP,{alignmentToOrigin:Oe.ZP.Alignment.Start,keepFocus:t.device.isPhone,onDismiss:()=>{var e;null===(e=i.current)||void 0===e||e.handleBlur(),s({...n,openDropdown:!1,displaySummary:!0})},origin:o()(kl,{textInputRef:i}),open:l,popupType:Oe.ZP.PopupType.Popup,style:{width:250},render:()=>o()(De.Z,{menuType:Fe.o.Popup,width:250},void 0,o()(xl,{spaceBasicSettingsStore:e.spaceBasicSettingsStore}))}),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:8}},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.PublicHomePageSection.caption",defaultMessage:"Access your public home page via {linkText}.",values:{linkText:o()(Ue.Z,{delayThreshold:0,renderTooltip:()=>o()(y.FormattedMessage,{id:"spaceBasicSettings.PublicHomePageSection.caption.tooltip",defaultMessage:"Click to copy link"}),render:e=>m().createElement(ao.Z,a()({onClick:()=>{(0,ti.RD)({environment:t,stringValue:p,copiedMessage:ti.tq.copiedLinkToClipboard})}},e),p)})}})))};function Ol(){return o()(y.FormattedMessage,{id:"spaceBasicSettings.workspaceNameSection.nameInput.caption",defaultMessage:"You can use your organization or company name. Keep it simple.",description:"The caption below the text input where a user edits the name of their workspace"})}const Nl=(0,y.defineMessages)({nameInputPlaceholder:{id:"spaceBasicSettings.nameInput.placeholder",defaultMessage:"e.g. company name"},workspaceDomainInputPlaceholder:{id:"spaceBasicSettings.domainSection.workspaceDomainInput.placeholder",defaultMessage:"URL"},allowedEmailDomainsInputPlaceholder:{id:"spaceBasicSettings.allowedEmailDomainsSection.emailDomainInput.placeholder",defaultMessage:"Type an email domain…"},copyDomainTooltip:{id:"spaceBasicSettings.workspaceDomain.tooltip",defaultMessage:"Click to copy link"}});class Ul extends p.Z{constructor(){super(...arguments),l()(this,"storeTypes",{spaceBasicSettingsStore:me,store:sl,tokenQuery:al.default.of("")}),l()(this,"handleSpaceNameChange",(e=>{this.stores.spaceBasicSettingsStore.setState({...this.stores.spaceBasicSettingsStore.state,name:e.target.value})})),l()(this,"handleCheckDomainAvailability",(e=>{const{spaceBasicSettingsStore:t}=this.stores,{spaceStore:i}=this.props;x._u({environment:this.environment,spaceStore:i,domain:e}).then((e=>{if("success"!==e.type)this.stores.spaceBasicSettingsStore.setState({...this.stores.spaceBasicSettingsStore.state,domainState:"loading"});else{const i=e.data.domain===t.state.domain;this.stores.spaceBasicSettingsStore.setState({...this.stores.spaceBasicSettingsStore.state,domainState:i?e.data.domainState:t.state.domainState})}}))})),l()(this,"checkSpaceDomainAvailabilityDebounced",d.debounce(this.handleCheckDomainAvailability,250)),l()(this,"handleSpaceUrlChange",(e=>{const t=x.$U(e.target.value);this.checkSpaceDomainAvailabilityDebounced(t),this.stores.spaceBasicSettingsStore.setState({...this.stores.spaceBasicSettingsStore.state,domain:t}),this.forceUpdate()})),l()(this,"handleConfirm",(async()=>{const{spaceStore:e}=this.props,{spaceBasicSettingsStore:t}=this.stores;await x.Y5({environment:this.environment,spaceId:e.id,spaceBasicSettingsStore:t})&&(await x.OF({environment:this.environment,spaceStore:e,spaceBasicSettingsStore:t}),ce.setState(ce.getInitialState()),ve.Z.setState({...ve.Z.state,open:!1}))})),l()(this,"handleCancelClick",(()=>{ve.Z.setState({...ve.Z.state,open:!1}),ce.setState(ce.getInitialState())})),l()(this,"handleExportClick",(()=>{const{currentSpaceStore:e}=F.default.state;e&&xe.q$({environment:this.environment,root:{table:"space",id:e.id,spaceId:e.id}})})),l()(this,"handleExportMembersClick",(()=>{const{currentSpaceStore:e}=F.default.state,{data:t}=ye.default.state;e&&t&&"subscribed_admin"===t.type&&xe.$G({spaceStore:e,subscriptionData:t,intl:this.props.intl})})),l()(this,"handleLeaveClick",(()=>{const{spaceStore:e}=this.props,{currentUserSettingsStore:t}=F.default.state;t&&C.showDialog({message:o()(y.FormattedMessage,{id:"spaceBasicSettings.leaveWorkspaceConfirmationDialog.prompt",defaultMessage:"Are you sure you want to leave this workspace?"}),showCancel:!0,keepFocus:!0,items:[{label:o()(y.FormattedMessage,{id:"spaceBasicSettings.leaveWorkspaceConfirmationDialog.leaveButton.label",defaultMessage:"Leave"}),color:"red",onAccept:async()=>{await x.bf({environment:this.environment,spaceId:e.id,userSettingsStore:t})&&(M.trackLeaveSpace(this.environment),ve.Z.setState({...ve.Z.state,open:!1}))}}]})})),l()(this,"renderChurnSurveyModal",(()=>{const{data:e}=ye.default.state,t=this.stores.store.state,i="on"===re.default.getGroup("churn_survey"),n=T.XX(e);if(i&&n&&t.churnSurveyModalOpen)return o()(hl,{churnType:t.churnType,currentPlan:t.churnType,isWorkspaceDeletion:!0,periodEnd:n.periodEnd,customerId:n.customerId,onAccept:()=>{const{store:e}=this.stores;e.state.churnSurveyModalOpen&&e.state.onAccept()},onClose:()=>{const{store:e}=this.stores;e.state.churnSurveyModalOpen&&e.state.onClose(),e.reset()}})})),l()(this,"handleDeleteClick",(async()=>{const e=T.CM(this.environment);if(!e)return;const{data:t}=ye.default.state,i=T.XX(t),n="on"===re.default.getGroup("churn_survey");if((0,M.trackDeleteWorkspaceAttempt)(this.environment),n&&i){if(!(await new Promise((t=>{const{store:i}=this.stores;i.setState({churnType:e,churnSurveyModalOpen:!0,onAccept:async()=>{t(!0),await this.showWorkspaceDeletionConfirmation()},onClose:()=>t(!1)})}))))return}await this.showWorkspaceDeletionConfirmation()})),l()(this,"showWorkspaceDeletionConfirmation",(async()=>{const{currentUserSettingsStore:e}=F.default.state;if(!e)return;const{spaceStore:t,intl:i}=this.props,n=(0,wn.getSpaceName)(this.environment,t)||i.formatMessage({defaultMessage:"Untitled workspace",id:"spaceBasicSettings.deleteWorkspace.untitledWorkspace.placeholder"}),s=(0,ja.Bd)(ss.SP)?o()(y.FormattedMessage,{id:"spaceBasicSettings.deleteWorkspaceConfirmationDialog.prompt",defaultMessage:"This action cannot be undone. This will permanently delete the workspace, including all pages and files. Please type the name of the workspace to confirm."}):m().createElement(m().Fragment,null,o()(fl.Z,{style:{marginTop:16},translations:{es:"Esta acción no se puede deshacer. Esto eliminará permanentemente el espacio de trabajo, incluidas todas las páginas y archivos. Por favor escriba el nombre del espacio de trabajo para confirmar.",ru:"Это действие не может быть отменено. Это навсегда удалит рабочее пространство, включая все страницы и файлы. Пожалуйста, введите название рабочей области для подтверждения.",zh:"此操作无法撤消。 这将永久删除工作区，包括所有页面和文件。 请输入要确认的工作空间的名称。",de:"Diese Aktion kann nicht rückgängig gemacht werden. Dadurch wird der Arbeitsbereich einschließlich aller Seiten und Dateien dauerhaft gelöscht. Bitte geben Sie den Namen des Arbeitsbereichs zur Bestätigung ein.",fr:"Cette action ne peut pas être annulée. Cela supprimera définitivement l'espace de travail, y compris toutes les pages et tous les fichiers. Veuillez saisir le nom de l'espace de travail pour confirmer.",ja:"この操作を元に戻すことはできません。 これにより、すべてのページとファイルを含むワークスペースが完全に削除されます。 確認するワークスペースの名前を入力してください。",it:"Questa azione non può essere annullata. Questo eliminerà definitivamente l'area di lavoro, incluse tutte le pagine e i file. Digita il nome dell'area di lavoro per confermare.",pt:"Essa ação não pode ser desfeita. Isso excluirá permanentemente o espaço de trabalho, incluindo todas as páginas e arquivos. Por favor, digite o nome do espaço de trabalho para confirmar.",nl:"Deze actie kan niet ongedaan gemaakt worden. Hiermee wordt de werkruimte permanent verwijderd, inclusief alle pagina's en bestanden. Typ de naam van de werkruimte om te bevestigen.",pl:"Tego działania nie można cofnąć. Spowoduje to trwałe usunięcie obszaru roboczego, w tym wszystkich stron i plików. Wpisz nazwę obszaru roboczego, aby potwierdzić.",sv:"Den här åtgärden kan inte ångras. Detta tar bort arbetsytan permanent, inklusive alla sidor och filer. Vänligen skriv in arbetsplatsens namn för att bekräfta.",uk:"Цю дію не можна скасувати. Це дозволить остаточно видалити робочу область, включаючи всі сторінки та файли. Введіть назву робочої області для підтвердження.",no:"Denne handlingen kan ikke fortrykkes. Dette vil permanent slette arbeidsområdet, inkludert alle sider og filer. Vennligst skriv navnet på arbeidsområdet for å bekrefte.",tr:"Bu işlem geri alınamaz. Bu, tüm sayfaları ve dosyaları içeren çalışma alanını kalıcı olarak siler. Lütfen onaylamak için çalışma alanının adını yazın.",cs:"Tuto akci nelze vrátit zpět. Tím se trvale odstraní pracovní prostor včetně všech stránek a souborů. Zadejte prosím název pracovního prostoru, který chcete potvrdit.",vi:"Hành động này không thể được hoàn tác. Điều này sẽ xóa vĩnh viễn không gian làm việc, bao gồm tất cả các trang và tệp. Vui lòng nhập tên của không gian làm việc để xác nhận.",da:"Denne handling kan ikke fortrydes. Dette vil permanent slette arbejdsområdet, inklusive alle sider og filer. Indtast navnet på arbejdsområdet for at bekræfte.",hu:"Ez a művelet nem visszavonható. Ez véglegesen törli a munkaterületet, beleértve az összes oldalt és fájlt. Kérjük, írja be a munkaterület nevét a megerősítéshez.",ar:"لا يمكن التراجع عن هذا الإجراء. سيؤدي ذلك إلى حذف مساحة العمل كليا ، بما يشمل جميع الصفحات والملفات. يرجى كتابة اسم مساحة العمل للتأكيد.",th:"การกระทำนี้ไม่สามารถยกเลิกได้ นี่จะเป็นการลบพื้นที่ทำงานอย่างถาวรรวมถึงหน้าและไฟล์ทั้งหมด โปรดพิมพ์ชื่อของพื้นที่ทำงานเพื่อยืนยัน",he:"לא ניתן לבטל פעולה זו. פעולה זו תמחק לצמיתות את סביבת העבודה, כולל כל הדפים והקבצים. הקלד את שם מרחב העבודה כדי לאשר.",fi:"Tätä toimintoa ei voi peruuttaa. Tämä poistaa työtilan pysyvästi, mukaan lukien kaikki sivut ja tiedostot. Vahvista kirjoittamalla työtilan nimi.",id:"Tindakan ini tidak bisa dibatalkan. Ini akan secara permanen menghapus ruang kerja, termasuk semua halaman dan file. Silakan ketik nama ruang kerja untuk mengonfirmasi."}}));await nl.b({message:o()("div",{},void 0,o()("div",{},void 0,s)),acceptLabel:o()(y.FormattedMessage,{id:"spaceBasicSettings.deleteWorkspaceConfirmationDialog.deleteWorkspaceButton.label",defaultMessage:"Permanently delete workspace"}),requiredInputValue:n})&&(x.Ns({environment:this.environment,spaceId:t.id,userSettingsStore:e}),M.trackDeleteSpace(this.environment),ve.Z.setState({...ve.Z.state,open:!1}))})),l()(this,"handleRecordIconChange",(e=>{const{spaceStore:t}=this.props;A.createAndCommit({userAction:"SpaceBasicSettings.handleRecordIconChange",environment:this.environment,perform:i=>{an.sO({store:t.getIconStore(),value:e,transaction:i})}})}))}willMount(e){super.willMount(e);const{spaceStore:t}=this.props,{spaceBasicSettingsStore:i}=this.stores,n=i.getValueForSpace(t);n&&i.setState(n)}renderComponent(){return cn.Z.state.online?this.renderSettings():this.renderOfflineMessage()}renderOfflineMessage(){return o()(yo.Z,{},void 0,o()(oi.Z,{isSmall:!0,style:{textAlign:"center"}},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.offlineMessage",defaultMessage:"Please go online to manage settings."})))}validateDomain(){const{spaceBasicSettingsStore:e}=this.stores,{domain:t,domainState:i}=e.state;return!!t&&("available"===i||"current-space"===i)}renderSettings(){const{spaceStore:e}=this.props,{spaceBasicSettingsStore:t}=this.stores,{name:i}=t.state,{data:n}=ye.default.state;if(!n)return;const s=e.canAdmin(),a=(0,wn.isGuestOfSpace)(e),r=(0,wn.getSpacePermissionItems)(e),l=T.qF(this.environment),d=s&&!e.getDisableExport(),c=s,p=T.CM(this.environment),g="subscribed_admin"===n.type&&("enterprise"===p||"business"===p),h=Lo.Z.getPublicSpaceData(this.environment,e.id);return o()(yo.Z,{controlRow:s&&this.renderControlRow()},void 0,this.renderSpaceBasicHeader(),a&&o()(oi.Z,{isSmall:!0,isMultiline:!0,style:{textAlign:"center"}},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.guestLimitedAccessMessage",defaultMessage:"You are currently a guest in this workspace. Ask an admin to add you as a member in order to see other pages and workspace settings."})),a&&yo.Z.renderDivider(),s&&o()(u.Fragment,{},void 0,o()(Yt.Z,{},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.workspaceNameSection.title",defaultMessage:"Name"})),o()(lt.Z,{value:i,placeholder:Te.default.formatMessage(Nl.nameInputPlaceholder),readOnly:!s,onChange:this.handleSpaceNameChange}),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:4}},void 0,o()(Ol,{})),yo.Z.renderDivider()),s&&o()(u.Fragment,{},void 0,o()(Yt.Z,{},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.workspaceIconSection.title",defaultMessage:"Icon"})),o()("div",{style:{width:72,height:72,border:"1px solid ".concat(this.theme.regularDividerColor),borderRadius:6,display:"flex",justifyContent:"center",alignItems:"center"}},void 0,o()(mn.Z,s?{bucket:"public",disabled:!1,icon:(0,wn.getSpaceIcon)(this.environment,e),isEmptyPage:!1,title:i,size:64,iconLoggingData:{recordTable:e.table,source:"workspace_settings"},onChange:this.handleRecordIconChange}:{disabled:!0,icon:(0,wn.getSpaceIcon)(this.environment,e),isEmptyPage:!1,title:i,size:64})),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:8}},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.workspaceIconSection.caption",defaultMessage:"Upload an image or pick an emoji. It will show up in your sidebar and notifications."})),yo.Z.renderDivider()),s&&m().createElement(m().Fragment,null,o()(Cl,{canAdminSpaceStore:s,domainIsAutogenerated:null==h?void 0:h.domainIsAutogenerated,spaceStore:e,spaceBasicSettingsStore:t,handleSpaceUrlChange:this.handleSpaceUrlChange}),yo.Z.renderDivider()),s&&l&&o()(u.Fragment,{},void 0,o()(Yt.Z,{},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.allowedEmailDomainsSection.title",defaultMessage:"Allowed email domains"})),this.renderAllowedEmailDomains(),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:4}},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.allowedEmailDomainsSection.emailDomainInput.caption",defaultMessage:"Anyone with email addresses at these domains can automatically join your workspace."})),yo.Z.renderDivider()),s&&o()(u.Fragment,{},void 0,o()(Ll,{spaceBasicSettingsStore:t}),yo.Z.renderDivider()),d&&o()(u.Fragment,{},void 0,o()(Yt.Z,{},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.exportContentSection.title",defaultMessage:"Export content"})),o()("div",{style:{display:"flex"}},void 0,o()(jt.Z,{isLarge:!0,onClick:this.handleExportClick},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.exportContentSection.exportButton.label",defaultMessage:"Export all workspace content"}))),o()("div",{style:{height:12}}),o()($o.Z,{title:o()(y.FormattedMessage,{id:"spaceBasicSettings.exportContentSection.helpButton.caption",defaultMessage:"Learn about exporting workspaces."}),href:(0,V.UY)("guides.exportWorkspace"),analyticsFrom:"space_settings"}),yo.Z.renderDivider()),c&&o()(u.Fragment,{},void 0,o()(Yt.Z,{style:{display:"flex",alignItems:"center"}},void 0,o()("span",{style:{marginRight:8}},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.exportMembersSection.title",defaultMessage:"Export members"})),!g&&o()(Vo.Z,{subscriptionTier:U.WS()?"business":"enterprise",analyticsName:"space_export_members",desktopStyle:{marginTop:-1}})),o()("div",{style:{display:"flex"}},void 0,o()(jt.Z,{isLarge:!0,disabled:!g,onClick:this.handleExportMembersClick,disabledFeedback:!0},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.exportMembersSection.exportAsCSVButton.label",defaultMessage:"Export members as CSV"}))),o()("div",{style:{height:12}}),o()($o.Z,{title:o()(y.FormattedMessage,{id:"spaceBasicSettings.exportMembersSection.helpButton.caption",defaultMessage:"Learn about exporting members."}),href:(0,V.UY)("guides.exportMembers"),analyticsFrom:"space_settings"}),yo.Z.renderDivider()),o()(Yt.Z,{},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.dangerousSettingsSection.title",defaultMessage:"Danger zone"})),o()("div",{style:{display:"flex"}},void 0,(r.length>1||a)&&o()(jt.Z,{isLarge:!0,onClick:this.handleLeaveClick,style:{marginRight:s?12:void 0}},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.dangerousSettingsSection.leaveWorkspaceButton.label",defaultMessage:"Leave workspace"})),s&&m().createElement(m().Fragment,null,this.renderModal(),o()(jt.Z,{isLarge:!0,isRed:!0,onClick:this.handleDeleteClick},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.dangerousSettingsSection.deleteWorkspaceButton.label",defaultMessage:"Delete entire workspace"})))),s&&o()(u.Fragment,{},void 0,o()("div",{style:{height:12}}),o()($o.Z,{title:o()(y.FormattedMessage,{id:"spaceBasicSettings.dangerousSettingsSection.deleteWorkspaceHelpButton.caption",defaultMessage:"Learn about deleting workspaces."}),href:(0,V.UY)("guides.deleteWorkspace"),analyticsFrom:"space_settings"})))}renderSpaceBasicHeader(){return o()(Yt.Z,{large:!0,divider:"full"},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.title",defaultMessage:"Workspace settings"}))}renderControlRow(){return o()("div",{style:{display:"flex"}},void 0,o()(Ee.Z,{isLarge:!0,onClick:this.handleConfirm,disabled:!this.validateDomain()},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.updateButton.label",defaultMessage:"Update"})),o()(jt.Z,{isLarge:!0,style:{marginLeft:12},onClick:this.handleCancelClick},void 0,o()(y.FormattedMessage,{id:"spaceBasicSettings.cancelButton.label",defaultMessage:"Cancel"})))}renderAllowedEmailDomains(){const{device:e}=this.environment,{spaceStore:t}=this.props,{spaceBasicSettingsStore:i}=this.stores,{emailDomains:n}=i.state,s=t.canAdmin();return o()(Oe.ZP,{popupType:e.isMobile?Oe.ZP.PopupType.SlideUp:Oe.ZP.PopupType.Popup,sameWidthAsOrigin:!0,open:this.stores.tokenQuery.get().length>0,origin:o()(ea.Z,{placeholder:Te.default.formatMessage(Nl.allowedEmailDomainsInputPlaceholder),value:this.stores.tokenQuery.get(),onChange:e=>this.stores.tokenQuery.set(e.target.value),readOnly:!s,onRemoveLastToken:()=>{const e=n.slice(0,n.length-1);i.setState({...i.state,emailDomains:e})},tokens:n.map((e=>o()($s.Z,{showRemoveButton:!0,isSingle:!1,format:Ks.l.Medium,onClickRemove:()=>{const t=n.filter((t=>t!==e));i.setState({...i.state,emailDomains:t})},value:e},e)))}),render:()=>{const t=this.stores.tokenQuery.get().trim(),{data:s}=ye.default.state,{spaceStore:r}=this.props,l=o()(y.FormattedMessage,{id:"spaceBasicSettings.allowedEmailDomainsSection.emailDomainsDropdown.placeholder",defaultMessage:"Type an email domain…"}),d=o()(y.FormattedMessage,{id:"spaceBasicSettings.allowedEmailDomainsSection.emailDomainsDropdown.placeholderNoResults",defaultMessage:"Type an email domain of a member of this workspace…"}),c=s?T.hn(s).map((e=>{if(("unsubscribed_admin"===s.type||"unsubscribed_member"===s.type||"subscribed_admin"===s.type)&&s.joinedMemberIds.includes(e.userId)){const t=Mt.Z.createChildStore(r,{table:Ce.KJ,id:e.userId}).getEmail();return t&&(0,Ba.Gd)(t)}})).filter(((e,t,i)=>Boolean(e&&t===i.indexOf(e)&&!n.includes(e)))):[],u=(0,Cn.ZP)(t,c,(e=>e)).map(((e,t)=>({key:t,render:t=>m().createElement(Re.Z,a()({},t,{title:e})),action:()=>{const t=[...n,e];i.setState({...i.state,emailDomains:t}),this.stores.tokenQuery.set("")}})));let p;return p=e.isMobile?{menuType:Fe.o.ActionSheet}:{menuType:Fe.o.Popup,width:"100%"},m().createElement(De.Z,p,o()(Le.Z,{type:Le.i.Vertical,initialFocus:u.length>0?0:void 0,sections:[{key:0,render:e=>m().createElement(Ne.Z,a()({},e,{disableDesktopPadding:!0,title:u.length>0?l:d})),items:u}]}))},onDismiss:()=>{this.stores.tokenQuery.set("")}})}renderModal(){const{churnSurveyModalOpen:e}=this.stores.store.state;if("on"===re.default.getGroup("churn_survey"))return o()(Zn.Z,{innerStyle:{width:300,height:"auto",overflow:"scroll"},open:e,render:this.renderChurnSurveyModal,onDismiss:()=>{const{store:e}=this.stores;e.state.churnSurveyModalOpen&&e.state.onClose(),e.reset()}})}}const Wl=(0,y.injectIntl)(Ul);var Vl=i(93192),zl=i(53471),ql=i(97832),Hl=i(71669),Gl=i(81865),Kl=i(33954),jl=i(78873);let Yl;!function(e){e.Password="Password",e.CurrentEmail="TemporaryPasscode"}(Yl||(Yl={}));class Ql extends I.Z{getInitialState(){return{open:!1,authorized:!1,authorizationType:void 0}}}const Xl=Ql;var Jl=i(37770),$l=i(13490);class ed extends p.Z{constructor(){super(...arguments),l()(this,"storeTypes",{store:Xl}),l()(this,"renderModalContent",(()=>{const{store:e}=this.stores,{state:t}=e;return o()("div",{style:{...this.styles.modal,...this.getColors().modal}},void 0,o()(Jl.Z,{fetch:this.getAuthorizationType,loading:e=>e&&o()("div",{style:this.styles.loadingSpinner},void 0,o()(qn.Z,{})),render:()=>o()(m().Fragment,{},void 0,t.authorizationType===Yl.Password?this.renderVerifyPassword(t):t.authorizationType===Yl.CurrentEmail?this.renderVerifyCurrentEmail(t):void 0,t.authorized&&this.renderSetNewEmail(t))}))})),l()(this,"renderSetNewEmail",(e=>{const{store:t}=this.stores,{userValue:i}=this.props;if(t.state.authorized)return o()(m().Fragment,{},void 0,o()("p",{style:this.styles.paragraph},void 0,o()(y.FormattedMessage,{id:"profileSettings.changeEmailModal.newEmailInstructions",defaultMessage:"Please enter a new email and we will send you a verification code."})),o()("div",{},void 0,this.renderNewEmailInput()),t.state.newEmailContainsVerifiedDomain&&(0,Ba.Gd)(t.state.newEmail)!==(0,Ba.Gd)((null==i?void 0:i.email)||"")&&this.renderClaimedEmailDomainWarning(e),t.state.newEmailPasscodeSent?this.renderNewEmailPasscodeInput(e):this.renderSendNewEmailPasscodeButton(e),this.renderEducationPlanDowngradeWarning())})),l()(this,"handleSendCurrentEmailVerification",(async()=>{const{userValue:e}=this.props,{store:t}=this.stores;if(!e)return;const i=await w.sendTemporaryPassword(this.environment,{email:e.email,disableLoginLink:!0,isSignup:!1});"success"===i.type?t.setState({...t.state,currentEmailPasscodeSent:!0,currentEmailPasscode:"",error:void 0}):t.setState({...t.state,currentEmailPasscodeSent:!0,error:(0,Kl.wf)(this.props.intl,i)})})),l()(this,"handleChangeCurrentEmailPasscode",(e=>{const{store:t}=this.stores;t.setState({...t.state,currentEmailPasscode:e.currentTarget.value,error:void 0})})),l()(this,"handleChangePassword",(e=>{const{store:t}=this.stores;t.setState({open:!0,authorized:!1,authorizationType:Yl.Password,password:e.currentTarget.value,error:void 0})})),l()(this,"handleClearPassword",(()=>{const{store:e}=this.stores;e.setState({open:!0,authorized:!1,authorizationType:Yl.Password,password:""})})),l()(this,"handleSubmitAuthorization",(async()=>{const{store:e}=this.stores;if(!e.state.authorized)if(e.state.authorizationType===Yl.Password){const t=this.getUserCurrentEmail();if(!t)return;const i=await w.loginWithEmail(this.environment,{email:t,password:e.state.password});if("failed"===i.type)return void e.setState({...e.state,error:(0,Kl.wf)(this.props.intl,i)});e.setState({...e.state,authorized:!0,newEmail:"",newEmailPasscode:"",newEmailPasscodeSent:!1,newEmailContainsVerifiedDomain:!1})}else e.state.authorizationType===Yl.CurrentEmail&&e.setState({...e.state,authorized:!0,newEmail:"",newEmailPasscode:"",newEmailPasscodeSent:!1,newEmailContainsVerifiedDomain:!1})})),l()(this,"handleChangeNewEmail",(e=>{const{store:t}=this.stores;t.setState({...t.state,newEmail:e.currentTarget.value,error:void 0})})),l()(this,"handleClearNewEmail",(()=>{const{store:e}=this.stores;e.setState({...e.state,newEmail:"",newEmailPasscodeSent:!1,newEmailContainsVerifiedDomain:!1,error:void 0})})),l()(this,"handleSendNewEmailVerification",(async()=>{const{store:e}=this.stores;if(!e.state.authorized)return;const t=(0,Ba.Gd)(e.state.newEmail),[i,n]=await Promise.all([await w.sendEmailVerification(this.environment,{email:e.state.newEmail}),t?await w.getVerifiedEmailDomain(this.environment,{emailDomain:t}):void 0]);if("success"===i.type){const t=(0,H.$K)(n)&&"failed"===n.type?(0,Kl.wf)(this.props.intl,n):void 0;e.setState({...e.state,newEmailPasscodeSent:!0,newEmailPasscode:"",error:t,newEmailContainsVerifiedDomain:(0,H.$K)(n)&&"success"===n.type&&void 0!==n.data.id})}else e.setState({...e.state,error:(0,Kl.wf)(this.props.intl,i)})})),l()(this,"handleChangeNewEmailPasscode",(e=>{const{store:t}=this.stores;t.setState({...t.state,newEmailPasscode:e.currentTarget.value,error:void 0})})),l()(this,"handleSubmit",(async()=>{const{store:e}=this.stores;if(!e.state.authorized)return;const t=e.state.authorizationType===Yl.Password?{type:"Password",password:e.state.password,newEmail:e.state.newEmail,newEmailPasscode:e.state.newEmailPasscode}:{type:"CurrentEmail",currentEmailPasscode:e.state.currentEmailPasscode,newEmail:e.state.newEmail,newEmailPasscode:e.state.newEmailPasscode},i=await w.changeEmail(this.environment,t);if("success"===i.type)M.trackUpdateEmail(this.environment,{new_email:e.state.newEmail,error:void 0}),await this.closeModal();else{const t=(0,Kl.wf)(this.props.intl,i);M.trackUpdateEmail(this.environment,{new_email:e.state.newEmail,error:t}),e.setState({...e.state,error:t})}})),l()(this,"handleSendUsMessageClick",(()=>{ps.j({environment:this.environment,from:"change_email_student"})})),l()(this,"openModal",(()=>{const{store:e}=this.stores;e.setState({open:!0,authorized:!1,authorizationType:void 0})})),l()(this,"closeModal",(async()=>{const{store:e}=this.stores,{hasEducationPlan:t}=this.props;e.reset(),t&&await D.bi(this.environment)})),l()(this,"getAuthorizationType",(async()=>{const{store:e}=this.stores,{intl:t}=this.props,i=this.getUserCurrentEmail();if(!i)return;const n=await jl.c({environment:this.environment,userEmail:i});n.error?e.setState({open:e.state.open,authorized:!1,authorizationType:void 0,error:t.formatMessage({id:"profileSettings.changeEmailModal.errorFetchingAccountData",defaultMessage:"Could not fetch account information for {currentEmail}."},{currentEmail:i})}):n.value.isSamlEnforced||!n.value.hasPassword?e.setState({open:!0,authorized:!1,authorizationType:Yl.CurrentEmail,currentEmailPasscodeSent:!1,currentEmailPasscode:""}):e.setState({open:!0,authorized:!1,authorizationType:Yl.Password,password:""})})),l()(this,"styles",{modal:{width:460,padding:32,borderRadius:3,fontSize:14},loadingSpinner:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center"},paragraph:{marginTop:12,marginBottom:14},error:{color:g.ZP.red,fontSize:12,marginTop:4,marginLeft:8},bold:{fontWeight:v.Z.fontWeight.bold},input:{padding:"4px 8px"},button:{marginTop:14},educationPlanWarning:{display:"flex",marginTop:14,paddingTop:14},claimedEmailDomainWarning:{marginTop:14,marginBottom:14}})}renderComponent(){const{userValue:e}=this.props,{store:t}=this.stores;return o()(m().Fragment,{},void 0,o()($l.Z,{},void 0,o()(y.FormattedMessage,{id:"profileSettings.personalInfoSection.emailSetting.label",defaultMessage:"Email"})),o()("div",{},void 0,o()("span",{style:{marginRight:12}},void 0,e&&e.email),o()(Is.Z,{onClick:this.openModal},void 0,o()(y.FormattedMessage,{id:"profileSettings.personalInfoSection.emailSetting.changeEmailButton.label",defaultMessage:"Change email"}))),o()(Zn.Z,{open:t.state.open,onDismiss:this.closeModal,render:this.renderModalContent}))}renderVerifyPassword(e){const{userValue:t}=this.props;if(t)return o()(m().Fragment,{},void 0,o()("p",{style:{margin:0}},void 0,this.renderCurrentEmail()),o()("p",{style:this.styles.paragraph},void 0,o()(y.FormattedMessage,{id:"profileSettings.changeEmailModal.enterPasswordInstructions",defaultMessage:"Please enter your password."})),o()(lt.Z,{style:{display:"none"},type:"text",value:t.email,autoComplete:"username",disabled:!0}),o()(lt.Z,{type:"password",disabled:e.authorized,value:e.password,onChange:this.handleChangePassword,showClearButton:!0,onClearButtonClick:this.handleClearPassword,onSubmit:this.handleSubmitAuthorization,placeholder:this.props.intl.formatMessage({id:"profileSettings.changeEmailModal.passwordInput.label",defaultMessage:"Password"}),style:this.styles.input,focusInitial:!0,autoComplete:"current-password"}),!e.authorized&&e.error&&o()("div",{style:this.styles.error},void 0,e.error),!e.authorized&&o()(Ee.Z,{isLarge:!0,style:this.styles.button,onClick:this.handleSubmitAuthorization},void 0,o()(y.FormattedMessage,{id:"profileSettings.changeEmailModal.continueButton.label",defaultMessage:"Continue",description:"After the user verifies their current password or email, they click this button to continue changing their email."})))}renderVerifyCurrentEmail(e){return o()(m().Fragment,{},void 0,o()("p",{style:{...this.styles.paragraph,marginTop:0}},void 0,this.renderCurrentEmail()," ",e.currentEmailPasscodeSent?o()(y.FormattedMessage,{id:"profileSettings.changeEmailModal.sentVerificationCodeToCurrentEmail",defaultMessage:"We've sent a temporary verification code to this email."}):o()(y.FormattedMessage,{id:"profileSettings.changeEmailModal.sendVerificationCodeToCurrentEmail",defaultMessage:"We'll send a temporary verification code to this email."})),e.currentEmailPasscodeSent?this.renderCurrentEmailPasscodeInput(e):this.renderSendCurrentEmailPasscodeButton())}renderSendCurrentEmailPasscodeButton(){return o()(Ee.Z,{isLarge:!0,onClick:this.handleSendCurrentEmailVerification},void 0,o()(y.FormattedMessage,{id:"profileSettings.changeEmailModal.sendCurrentEmailVerificationCode.label",defaultMessage:"Send verification code",description:"Sends a temporary verification passcode to the user's current email."}))}renderCurrentEmailPasscodeInput(e){return o()(m().Fragment,{},void 0,o()(lt.Z,{value:e.currentEmailPasscode,onChange:this.handleChangeCurrentEmailPasscode,onSubmit:this.handleSubmitAuthorization,placeholder:this.props.intl.formatMessage({id:"profileSettings.changeEmailModal.enterCurrentEmailVerificationCodeInput.placeholder",defaultMessage:"Enter verification code"}),focusInitial:!0,style:this.styles.input}),!e.authorized&&o()(Ee.Z,{isLarge:!0,style:this.styles.button,onClick:this.handleSubmitAuthorization},void 0,o()(y.FormattedMessage,{id:"profileSettings.changeEmailModal.continueButton.label",defaultMessage:"Continue",description:"After the user verifies their current password or email, they click this button to continue changing their email."})))}renderNewEmailInput(){const{store:e}=this.stores;if(e.state.authorized)return o()(lt.Z,{value:e.state.newEmail,onChange:this.handleChangeNewEmail,onSubmit:this.handleSendNewEmailVerification,showClearButton:!0,onClearButtonClick:this.handleClearNewEmail,placeholder:this.props.intl.formatMessage({id:"profileSettings.changeEmailModal.newEmailInput.placeholder",defaultMessage:"Enter new email"}),style:this.styles.input,focusInitial:!0})}renderSendNewEmailPasscodeButton(e){return o()(m().Fragment,{},void 0,e.error&&o()("div",{style:this.styles.error},void 0,e.error),o()(Ee.Z,{isLarge:!0,style:this.styles.button,onClick:this.handleSendNewEmailVerification},void 0,o()(y.FormattedMessage,{id:"profileSettings.changeEmailModal.sendVerificationCodeButton.label",defaultMessage:"Send verification code"})))}renderNewEmailPasscodeInput(e){const t=this.getSubmitHandler();return o()(m().Fragment,{},void 0,o()("p",{style:this.styles.paragraph},void 0,o()(y.FormattedMessage,{id:"profileSettings.changeEmailModal.verificationCodeSentMessage",defaultMessage:"We just sent you a temporary verification code to {newEmail}.",values:{newEmail:o()("span",{style:this.styles.bold},void 0,e.newEmail)}})),o()(lt.Z,{value:e.newEmailPasscode,onChange:this.handleChangeNewEmailPasscode,onSubmit:t,placeholder:this.props.intl.formatMessage({id:"profileSettings.changeEmailModal.enterVerificationCodeInput.placeholder",defaultMessage:"Enter verification code"}),focusInitial:!0,style:this.styles.input}),e.error&&o()("div",{style:this.styles.error},void 0,e.error),o()(Ee.Z,{isLarge:!0,style:this.styles.button,onClick:t},void 0,o()(y.FormattedMessage,{id:"profileSettings.changeEmailModal.changeEmailButton.label",defaultMessage:"Change email"})))}renderEducationPlanDowngradeWarning(){var e=this;const{hasEducationPlan:t}=this.props;if(t)return o()("div",{style:{...this.styles.educationPlanWarning,...this.getColors().educationPlanWarning}},void 0,h.Z.help({width:14,marginTop:4,marginRight:6,fill:this.theme.lightIconColor})," ",o()("div",{},void 0,o()(y.FormattedMessage,{defaultMessage:"Changing your email may downgrade your workspace on a Free Education Plan to the basic Free Plan. You won't lose any data, but you'll need to upgrade to re-access paid features. Have questions about this? <sendmessagelink>Message support</sendmessagelink>.",id:"emailChangeSettings.downgradeEducationPlan.warning.message",values:{sendmessagelink:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return o()(ao.Z,{onClick:e.handleSendUsMessageClick},void 0,i)}}})))}renderCurrentEmail(){const{userValue:e}=this.props;if(e)return o()(y.FormattedMessage,{id:"profileSettings.changeEmailModal.currentEmail",defaultMessage:"Your current email is {currentEmail}.",values:{currentEmail:o()("span",{style:this.styles.bold},void 0,e&&e.email)}})}renderClaimedEmailDomainWarning(e){var t;return o()(oi.Z,{isSmall:!0,isMultiline:!0,style:this.styles.claimedEmailDomainWarning},void 0,o()(y.FormattedMessage,{id:"profileSettings.changeEmailModal.claimedEmailDomainWarning",defaultMessage:"The email domain {newEmailDomain} has been claimed by an organization. If you continue with changing this email address, any workspaces created by this account can be managed by the organization. See <domainclaimlink>this page</domainclaimlink> for more info.",values:{newEmailDomain:null!==(t=(0,Ba.Gd)(e.newEmail))&&void 0!==t?t:e.newEmail,domainclaimlink:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()(ao.Z,{href:(0,V.UY)("guides.domainManagement"),external:!0},void 0,t)}},description:"A message notifying the user that the email they wish to use has an email domain that has been verified by an organization"}))}showConfirmationModal(e){return C.confirmUserAction({message:o()(y.FormattedMessage,{id:"profileSettings.changeEmailModal.confirmationModal.title",defaultMessage:"Are you sure you want to change your email?",description:"Title of the modal asking users to confirm if they want to change their email."}),description:o()(y.FormattedMessage,{id:"profileSettings.changeEmailModal.confirmationModal.description",defaultMessage:"If you continue changing this email address to this domain, any workspaces created by this account can be managed by the organization.",values:{verifiedDomain:(0,Ba.Gd)(e)},description:"A message notifying the user that the email they wish to use has an email domain that has been verified by an organization"}),acceptLabel:o()(y.FormattedMessage,{id:"profileSettings.changeEmailModal.confirmationModal.acceptButton.label",defaultMessage:"Change email",description:"Button confirming that the email will be changed."}),cancelLabel:o()(y.FormattedMessage,{id:"profileSettings.changeEmailModal.confirmationModal.cancelButton.label",defaultMessage:"Go back",description:"Button prompting the user to go back to the change email modal."})})}getUserCurrentEmail(){const{store:e}=this.stores,{userValue:t,intl:i}=this.props;if(t)return t.email;e.setState({open:e.state.open,authorized:!1,authorizationType:void 0,error:i.formatMessage({id:"profileSettings.changeEmailModal.errorNoUserValue",defaultMessage:"User value is undefined."})})}getSubmitHandler(){const{store:e}=this.stores,{userValue:t}=this.props;if(!e.state.authorized)return()=>{};if(e.state.newEmailContainsVerifiedDomain&&(0,Ba.Gd)(e.state.newEmail)!==(0,Ba.Gd)((null==t?void 0:t.email)||"")){const t=e.state.newEmail;return async()=>{await this.showConfirmationModal(t)&&await this.handleSubmit()}}return this.handleSubmit}getColors(){return{modal:{background:this.theme.contentBackground},educationPlanWarning:{color:this.theme.lightTextColor,borderTop:"1px solid ".concat(this.theme.regularDividerColor)}}}}const td=(0,y.injectIntl)(ed);class id extends I.Z{getInitialState(){return{open:!1}}}const nd=new id;class od extends p.Z{constructor(){super(...arguments),l()(this,"handleLogOutFromActiveSessions",(async()=>{M.trackLogOutFromActiveSessions(this.environment),await w.logoutActiveSessions(this.environment,{}),this.openConfirmationModal()}))}renderComponent(){return m().createElement(m().Fragment,null,o()("div",{style:this.getSettingsOptionStyle()},void 0,o()(Yt.Z,{smallMarginBottom:!0},void 0,o()(y.FormattedMessage,{id:"manageActiveSessions.title",defaultMessage:"Log out of all devices"})),o()(oi.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},void 0,o()(y.FormattedMessage,{id:"manageActiveSessions.logOutActiveSessions.label",defaultMessage:"You will be logged out of all other active sessions besides this one and will have to log back in."})),o()(jt.Z,{isLarge:!0,isRed:!0,onClick:this.handleLogOutFromActiveSessions,style:{marginTop:12}},void 0,o()(y.FormattedMessage,{id:"manageActiveSessions.logOutActiveSessions.button",defaultMessage:"Log out"}))),this.renderManageActiveSessionsModal())}renderManageActiveSessionsModal(){const{device:e}=this.environment,{open:t}=nd.state,i=this.getUserEmailAddress();return o()(Zn.Z,{open:t,onDismiss:this.closeConfirmationModal,innerStyle:{width:e.isPhone?"90%":350,padding:24,display:"flex",flexDirection:"column"},render:()=>m().createElement(m().Fragment,null,o()("div",{style:{marginBottom:24}},void 0,o()(y.FormattedMessage,i?{id:"manageActiveSessions.confirmationModal.withEmail",defaultMessage:"You have been logged out from other active sessions for {email}.",values:{email:i}}:{id:"manageActiveSessions.confirmationModal.withoutEmail",defaultMessage:"You have been logged out from other active sessions for your account."})),o()(Ee.Z,{onClick:this.closeConfirmationModal},void 0,o()(y.FormattedMessage,{id:"manageActiveSessions.confirmationModal.close",defaultMessage:"Close"})))})}openConfirmationModal(){nd.setState({...nd.state,open:!0})}closeConfirmationModal(){nd.setState({...nd.state,open:!1})}getUserEmailAddress(){let e;const{currentUserStore:t}=F.default.state;if(t){const i=t.getValue();e=i&&i.email}return e}getSettingsOptionStyle(){const{device:e,WindowSizeStore:t}=this.environment;return{display:"flex",flexDirection:"column",alignItems:"flex-start",width:"100%",height:"auto",paddingLeft:e.isMobile?t.state.paddingLeftCSS:0,paddingRight:e.isMobile?t.state.paddingRightCSS:0}}}const sd=od;var ad=i(1548),rd=i(30045);class ld extends p.Z{constructor(){super(...arguments),l()(this,"storeTypes",{spaceProfileSettingsStore:fe,passwordRequestStore:on.Z,isEducationStore:al.default.of(!1)}),l()(this,"handleUploadProfilePhoto",(()=>{M.trackUploadProfilePhoto(this.environment),zl.cR({environment:this.environment,onStart:this.handleUploadStart,bucket:"public",onError:this.handleUploadError,onComplete:this.handleUploadComplete,accept:"image/*"})})),l()(this,"handleDeleteProfilePhoto",(()=>{this.stores.spaceProfileSettingsStore.setState({...this.stores.spaceProfileSettingsStore.state,profilePhoto:void 0})})),l()(this,"handleUpdateClick",(()=>{const{name:e,profilePhoto:t}=this.stores.spaceProfileSettingsStore.state;e?(A.createAndCommit({userAction:"SpaceProfileSettings.handleUpdateClick",environment:this.environment,perform:i=>{const{currentUserStore:n}=F.default.state;n&&b.A({userStore:n,data:{profilePhoto:t,name:e},transaction:i})}}),ve.Z.setState({...ve.Z.state,open:!1})):C.showErrorMessage(o()(y.FormattedMessage,{id:"profileSettings.personalInfoSection.nameMissing.message",defaultMessage:"Please fill in name."}))})),l()(this,"handleCancelClick",(()=>{ve.Z.setState({...ve.Z.state,open:!1})})),l()(this,"handleNameChange",(e=>{M.trackNameChanged(this.environment,{from:this.stores.spaceProfileSettingsStore.state.name,to:e.target.value}),this.stores.spaceProfileSettingsStore.setState({...this.stores.spaceProfileSettingsStore.state,name:e.target.value})})),l()(this,"handleUploadStart",(()=>{this.stores.spaceProfileSettingsStore.setState({...this.stores.spaceProfileSettingsStore.state,uploadingProfilePhoto:!0})})),l()(this,"handleUploadError",(()=>{this.stores.spaceProfileSettingsStore.setState({...this.stores.spaceProfileSettingsStore.state,uploadingProfilePhoto:!1}),C.showErrorMessage(o()(y.FormattedMessage,{id:"profileSettings.profilePhotoSection.uploadProfilePhotoError.message",defaultMessage:"Upload failed."}))})),l()(this,"handleUploadComplete",(e=>{this.stores.spaceProfileSettingsStore.setState({...this.stores.spaceProfileSettingsStore.state,profilePhoto:e[0],uploadingProfilePhoto:!1})}))}willMount(e){super.willMount(e);const{spaceProfileSettingsStore:t,isEducationStore:i}=this.stores,{currentUserStore:n,currentUserSettingsStore:o,currentUserRootStore:s}=F.default.state;if(n&&o){const e=t.getValueForUser(n,o);e&&t.setState(e)}if(s){const e=((0,T.xR)({environment:this.environment,userRootStore:s})||[]).some((e=>e===Kt.Z.pricing.student.productId));i.set(e)}}renderComponent(){return cn.Z.state.online?this.renderSettings():this.renderOfflineMessage()}renderOfflineMessage(){return o()(yo.Z,{},void 0,o()(oi.Z,{isSmall:!0,style:{textAlign:"center"}},void 0,o()(y.FormattedMessage,{defaultMessage:"Please go online to manage your profile.",id:"profileSettings.offline.message"})))}renderSettings(){const{currentUserStore:e}=F.default.state;if(!e)return;e.getValue();const{profilePhoto:t,uploadingProfilePhoto:i,name:n}=this.stores.spaceProfileSettingsStore.state,{passwordRequestStore:s}=this.stores,a="on"===re.default.getGroup("user-data-consent");return s.state.loading?o()(qn.Z,{style:{margin:"50% auto"}}):o()(yo.Z,{controlRow:this.renderControlRow()},void 0,this.renderSpaceProfileHeader(),o()("div",{style:{marginBottom:24}},void 0,o()($o.Z,{style:{display:"block"},buttonStyle:{height:"inherit",whiteSpace:"inherit"},title:o()("div",{style:{display:"block"}},void 0,o()(y.FormattedMessage,{id:"profileSettings.helpButton.caption",defaultMessage:"Changes to account settings will apply to all of your workspaces."})," ",o()(y.FormattedMessage,{id:"profileSettings.helpButton.learnMoreLink",defaultMessage:"<s>Learn more.</s>",values:{s:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()("span",{style:{textDecoration:"underline"}},void 0,t)}}})),href:(0,V.UY)("guides.profileSettings"),analyticsFrom:"profile_settings"})),o()(Yt.Z,{},void 0,o()(y.FormattedMessage,{id:"profileSettings.profilePhotoSection.title",defaultMessage:"Photo"})),t&&o()(Gl.Z,{url:t,isAuthenticated:!1,stripGoogleIconQuery:!0,width:90,render:(e,t)=>o()("div",{style:{width:90,height:90}},void 0,o()(Hl.Z,{src:t,style:{width:90,height:90,objectFit:"cover",borderRadius:"100%"}}))}),o()(jt.Z,{isLarge:!0,onClick:this.handleUploadProfilePhoto,style:{marginTop:8,marginBottom:4}},void 0,o()("div",{style:{display:"flex",alignItems:"center"}},void 0,o()(y.FormattedMessage,{id:"profileSettings.profilePhotoSection.uploadPhotoButton.label",defaultMessage:"Upload photo"}),i&&o()(qn.Z,{style:{marginLeft:4}}))),t&&"on"===re.default.getGroup("remove-profile-photo-string")&&o()(jt.Z,{onClick:this.handleDeleteProfilePhoto,style:{marginTop:4,marginLeft:12,marginBottom:2}},void 0,o()("div",{style:{display:"flex",alignItems:"center"}},void 0,o()(y.FormattedMessage,{id:"profileSettings.profilePhotoSection.removePhotoButton.label",defaultMessage:"Remove"}))),yo.Z.renderDivider(),o()(Yt.Z,{},void 0,o()(y.FormattedMessage,{id:"profileSettings.personalInfoSection.title",defaultMessage:"Personal info"})),o()(td,{userValue:(0,O.S4)(this.environment),hasEducationPlan:this.stores.isEducationStore.get()}),this.renderNameRow(n),yo.Z.renderDivider(),o()(ad.Z,{isEducationPlan:this.props.isEducationPlan,requestStore:s}),a&&yo.Z.renderDivider(),a&&o()(rd.Z,{}),yo.Z.renderDivider(),o()(sd,{}),yo.Z.renderDivider(),o()(ql.Z,{}))}renderNameRow(e){return m().createElement(m().Fragment,null,o()($l.Z,{hasMarginTop:!0},void 0,o()(y.FormattedMessage,{id:"profileSettings.personalInfoSection.nameInput.label",defaultMessage:"Preferred name",description:"User's name, may be full name or a nickname."})),o()(lt.Z,{value:e,onChange:this.handleNameChange}))}renderControlRow(){return o()("div",{style:{display:"flex"}},void 0,o()(Ee.Z,{isLarge:!0,onClick:this.handleUpdateClick},void 0,o()(y.FormattedMessage,{id:"profileSettings.updateButton.label",defaultMessage:"Update"})),o()(jt.Z,{isLarge:!0,style:{marginLeft:12},onClick:this.handleCancelClick},void 0,o()(y.FormattedMessage,{id:"profileSettings.cancelButton.label",defaultMessage:"Cancel"})))}renderSpaceProfileHeader(){return o()(Yt.Z,{large:!0,divider:"full"},void 0,o()(y.FormattedMessage,{id:"profileSettings.title",defaultMessage:"Account"}))}}const dd=(0,y.injectIntl)(ld);function cd(e){let{users:t,store:i,extraColumns:n,initialSort:s}=e;const[a,r]=(0,u.useState)(s);function l(e,t){return o()(ni.Z,{disabled:!t.sortable,ignoreLocalHoverState:!0,onClick:()=>{!function(e){r({column:e,asc:(null==a?void 0:a.column)===e&&!(null!=a&&a.asc)})}(e)},style:{display:"flex",alignItems:"center"}},void 0,t.title,t.sortable&&a&&a.column===e&&function(e){const{up:t}=e,i={width:10,height:10,marginLeft:4};return t?h.Z.arrowDownSmall({...i,transform:"rotate(180deg)"}):h.Z.arrowDownSmall(i)}({up:a.asc}))}const d={name:{title:o()(y.FormattedMessage,{id:"spacePermissionsSettings.userTable.userColumn.header",defaultMessage:"User"}),style:{width:"60%"},sortable:!0,renderer:e=>o()(ai.Z,{userValue:e}),getValue:e=>e.name||"Unknown"},...n},p=c().keys(d).map((e=>({key:e,header:l(e,d[e]),style:d[e].style}))),g=(0,Me.VK)((()=>t.map((e=>({member:e,store:Mt.Z.createChildStore(i,{table:Ce.KJ,id:e.userId})}))).filter((e=>void 0!==e.store.getValue())).map((e=>{let{store:t}=e;return t.getValue()})).filter(H.$K)),[t,i]),f=a?g.sort(((e,t)=>{const i=d[a.column].getValue(e),n=d[a.column].getValue(t);var o=i<n?-1:i>n?1:0;return a.asc?o:-1*o})):g;return o()(si.Z,{columns:p,rows:f.map((e=>{const t=Object.values(d).map((t=>t.renderer?t.renderer(e):m().createElement(m().Fragment,null,t.getValue(e))));return{key:e.id,columns:t}}))})}var ud;!function(e){e[e.UserUserSimilarity=0]="UserUserSimilarity"}(ud||(ud={}));const md={[ud.UserUserSimilarity]:o()(y.FormattedMessage,{id:"spaceSettingsDebugZone.userUserSimilarity.title",defaultMessage:"User Similarity",description:"Title for a tab in a debug view where users can see how similar they are to other users in their workspace."})};function pd(){const e=(0,Io.mS)();return["on"===re.default.getGroup("user_similarity_debugging")||e?ud.UserUserSimilarity:void 0].filter(H.$K)}function gd(e){let{store:t}=e;const{isOnline:i,subscriptionDataStoreData:n,userSimilarityData:s,visibleUsersLoaded:a,visibleUsers:r}=(0,Me.VK)((()=>{var e,i;const n=null===(e=ye.default.state)||void 0===e?void 0:e.data,o=n?T.uF(n):[],s=c().every(o.map((e=>Mt.Z.createChildStore(t,{table:Ce.KJ,id:e.userId}).isReady())));return{isOnline:cn.Z.state.online,subscriptionDataStoreData:n,userSimilarityData:(null===(i=ye.default.state.data)||void 0===i?void 0:i.userSimilarity)||{},visibleUsersLoaded:s,visibleUsers:o}}),[t]);if(!i)return o()(oi.Z,{isSmall:!0,style:{textAlign:"center"}},void 0,o()(y.FormattedMessage,{id:"spacePermissionsSettings.offlineMessage",defaultMessage:"Please go online to manage members."}));if(!n)return o()(qn.Z,{style:{margin:"calc(50% - 1em) auto"}});if(!a)return o()(qn.Z,{style:{margin:"calc(50% - 1em) auto"}});const l={style:{},title:m().createElement(m().Fragment,null,"Similarity Score"),sortable:!0,renderer:e=>{var t;return m().createElement(m().Fragment,null,(null===(t=s[e.id])||void 0===t?void 0:t.toFixed(3))||0)},getValue:e=>s[e.id]||0};return o()(cd,{users:r,store:t,extraColumns:{similarityColumn:l},initialSort:{column:"similarityColumn",asc:!1}})}function hd(e){let{store:t}=e;const{tabs:i}=(0,Me.VK)((()=>({tabs:pd()})),[]),[n,s]=(0,u.useState)(i[0]);return o()(yo.Z,{},void 0,o()(fa.Z,{tabs:i.map((e=>md[e])),selectedIndex:i.indexOf(n),onChange:e=>s(i[e]),style:{paddingLeft:0,paddingRight:0,marginTop:-6,marginBottom:14},tabTitleStyle:{fontSize:16}}),n===ud.UserUserSimilarity&&o()(gd,{store:t}))}const fd=(0,y.defineMessages)({accountTab:{id:"spaceSettingsSidebar.accountTab.title",defaultMessage:"My account"},settingsTab:{id:"spaceSettingsSidebar.settingsTab.title",defaultMessage:"Settings"},teamsTab:{id:"spaceSettingsSidebar.teamsTab.title",description:"Title of the workspace settings tab to edit high-level teamspace settings",defaultMessage:"Teamspaces"},membersTab:{id:"spaceSettingsSidebar.membersTab.title",defaultMessage:"Members"},plansTab:{id:"spaceSettingsSidebar.plansTab.title",defaultMessage:"Plans"},upgradeTab:{id:"spaceSettingsSidebar.upgradeTab.title",defaultMessage:"Upgrade"},billingTab:{id:"spaceSettingsSidebar.billingTab.title",defaultMessage:"Billing"},subscriptionTab:{id:"spaceSettingsSidebar.subscriptionTab.title",defaultMessage:"Subscription"},connectedAppsTab:{id:"spaceSettingsSidebar.connectedAppsTab.title",defaultMessage:"My connected apps"},userConnectionsTab:{id:"spaceSettingsSidebar.userConnectionsTab.title",defaultMessage:"My connections",description:"Settings tab title for integrations/connections that user has installed"},creditTab:{id:"spaceSettingsSidebar.creditTab.title",defaultMessage:"Earn credit"},securitySAMLTab:{id:"spaceSettingsSidebar.securityAndSAMLTab.title",defaultMessage:"Security & identity",description:"Tab label for Security & identity settings"},securityTab:{id:"spaceSettingsSidebar.securityTab.title",defaultMessage:"Security",description:"Tab label for Security settings"},identityProvisioningTab:{id:"spaceSettingsSidebar.identity&ProvisioningTab.title",defaultMessage:"Identity & provisioning",description:"Tab label for Identity & Provisioning settings"},languageAndRegionTab:{id:"spaceSettingsSidebar.languageAndRegionTab.title",defaultMessage:"Language & region"},integrationsTab:{id:"spaceSettingsSidebar.integrationsTab.title",defaultMessage:"Integrations"},spaceConnectionsTab:{id:"spaceSettingsSidebar.spaceConnectionsTab.title",defaultMessage:"Connections",description:"Settings tab title for integrations/connections installed on workspace"},experimentsTab:{id:"spaceSettingsSidebar.experimentsTab.title",defaultMessage:"Experiments"},auditLogTab:{id:"spaceSettingsSidebar.auditLogTab.title",defaultMessage:"Audit log"},notificationsAndSettings:{id:"spaceSettingsSidebar.notificationsAndSettings.title",defaultMessage:"My notifications & settings"},debugZoneTab:{id:"spaceSettingsSidebar.debugZoneTab.title",defaultMessage:"Debug Zone",description:"Tab label for various debugging information"},analyticsTab:{id:"spaceSettingsSidebar.analyticsTab.title",defaultMessage:"Analytics",description:"Tab label for the analytics tab in settings modal"}}),vd={width:20,height:20},yd={profile:e=>o()(Hn.Z,{size:20,avatarShouldShowShadow:!0,userValue:(0,O.S4)(e)}),notifications_and_settings:()=>h.Z.settingsNotificationsAndPersonal(vd),connected_apps:()=>h.Z.settingsConnectedApps(vd),language_and_region:()=>h.Z.settingsLanguage(vd),credit:()=>h.Z.settingsCredit(vd),settings:()=>h.Z.settings(vd),teams:()=>h.Z.settingsWorkspace(vd),members:()=>h.Z.settingsMembers(vd),plans:()=>{const{data:e}=ye.default.state;return e&&T.YK(e)?h.Z.settingsPlans(vd):h.Z.settingsUpgrade(vd)},billing:()=>h.Z.settingsBilling(vd),subscription:()=>h.Z.settingsSubscription(vd),security:()=>"on"===re.default.getEligibleGroup({experimentId:"split_identity_provisioning",defaultGroup:"unassigned"})?h.Z.settingsSecurity(vd):h.Z.settingsIdentityProvisioning(vd),identity_provisioning:()=>h.Z.settingsIdentityProvisioning(vd),integrations:()=>h.Z.settingsIntegration(vd),experiments:()=>h.Z.sparkles(vd),audit_log:()=>h.Z.ledger(vd),debug_zone:()=>h.Z.sidebarTemplates(vd),analytics:()=>h.Z.alarmClock(vd)},Sd={profile:()=>Te.default.formatMessage(fd.accountTab),notifications_and_settings:()=>Te.default.formatMessage(fd.notificationsAndSettings),connected_apps:()=>"on"===re.default.getEligibleGroup({experimentId:"better_integrations",defaultGroup:"control"})?Te.default.formatMessage(fd.userConnectionsTab):Te.default.formatMessage(fd.connectedAppsTab),credit:()=>Te.default.formatMessage(fd.creditTab),language_and_region:()=>Te.default.formatMessage(fd.languageAndRegionTab),settings:()=>Te.default.formatMessage(fd.settingsTab),teams:()=>Te.default.formatMessage(fd.teamsTab),members:()=>Te.default.formatMessage(fd.membersTab),plans:()=>{const{data:e}=ye.default.state;return e&&T.YK(e)?Te.default.formatMessage(fd.plansTab):Te.default.formatMessage(fd.upgradeTab)},billing:()=>Te.default.formatMessage(fd.billingTab),subscription:()=>Te.default.formatMessage(fd.subscriptionTab),security:()=>"on"===re.default.getEligibleGroup({experimentId:"split_identity_provisioning",defaultGroup:"unassigned"})?Te.default.formatMessage(fd.securityTab):Te.default.formatMessage(fd.securitySAMLTab),identity_provisioning:()=>Te.default.formatMessage(fd.identityProvisioningTab),integrations:()=>"on"===re.default.getEligibleGroup({experimentId:"better_integrations",defaultGroup:"control"})?Te.default.formatMessage(fd.spaceConnectionsTab):Te.default.formatMessage(fd.integrationsTab),experiments:()=>Te.default.formatMessage(fd.experimentsTab),audit_log:()=>Te.default.formatMessage(fd.auditLogTab),debug_zone:()=>Te.default.formatMessage(fd.debugZoneTab),analytics:()=>Te.default.formatMessage(fd.analyticsTab)};var bd=i(60897);var Md=i(80567);const wd={workspaceBalance:o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.workspaceSubscriptionBalance.title",defaultMessage:"Workspace balance"}),applyCoupon:o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.applyCoupon.title",defaultMessage:"Apply coupon"}),discount:o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.discount.title",defaultMessage:"Discount"})};var Cd=i(34859);class kd extends I.Z{getInitialState(){return{paymentMethodModalOpen:!1,billingIntervalModalOpen:!1,billingEmailModalOpen:!1,vatIdModalOpen:!1,addressModalOpen:!1,applyCreditModalOpen:!1,billingEventsLimit:20,applyCouponModalOpen:!1,addressErrorMessage:void 0}}setAddressField(e){const t=this.state.temporaryAddress?this.state.temporaryAddress:{name:"",businessName:"",addressLine1:"",addressLine2:"",zipCode:"",city:"",state:"",country:""};this.setState({...this.state,temporaryAddress:{...t,...e},addressErrorMessage:void 0})}}const Td=kd;class Id extends I.Z{getInitialState(){return{inputValue:void 0}}}const Zd=Id;class Pd extends p.Z{constructor(){super(...arguments),l()(this,"storeTypes",{store:Zd}),l()(this,"handleInputChange",(e=>{const{store:t}=this.stores,i=e.target.value,n=this.inputValueToCents(i);let o;o=i?void 0!==n?i:this.getCurrentInputValue():"",t.setState({inputValue:o}),this.forceUpdate(),this.props.onChange(this.inputValueToCents(o)||0)}))}renderComponent(){const{focus:e,selectAll:t,availableCredit:i}=this.props,n=this.getCurrentInputValue();return o()(lt.Z,{value:n,onChange:this.handleInputChange,focus:e,selectAll:t,disabled:i<=0,style:{maxWidth:120},inputStyle:{textAlign:"right"}})}getCurrentInputValue(){const{availableCredit:e}=this.props,{inputValue:t}=this.stores.store.state;return void 0===t?"".concat(Math.floor(e/100)):t}inputValueToCents(e){const{availableCredit:t}=this.props,i=Math.floor(100*parseFloat(e));if(!isNaN(i)&&i<=t&&i>=0)return i}}const _d=Pd;var xd=i(84076);class Fd extends p.Z{constructor(){super(...arguments),l()(this,"storeTypes",{store:Td,billingHistoryRequestStore:on.Z}),l()(this,"performGetBillingHistoryRequest",(async e=>{const{spaceStore:t}=this.props,i=await w.getBillingHistory(this.environment,{spaceId:t.id,limit:e});if("failed"===i.type)throw i.error;return i.data})),l()(this,"renderBillingHistoryResults",((e,t)=>{this.props.mockBillingHistoryResult&&(t=this.props.mockBillingHistoryResult);const{billingHistoryRequestStore:i}=this.stores;return o()("div",{},void 0,t&&0===t.events.length&&o()("div",{style:{color:this.theme.mediumTextColor,fontSize:14}},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.invoicesSection.noInvoicesMessage",defaultMessage:"This workspace has no payments yet."})),t&&t.events.length>0&&o()("table",{},void 0,o()("tbody",{},void 0,t.events.map(this.renderBillingHistoryEvent))),t&&!t.reachedEndOfResults&&o()(Je.Z,{onClick:this.handleLoadMoreBillingEventsClick,style:{marginLeft:-4,width:"100%"}},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.invoicesSection.loadMoreInvoicesButton.label",defaultMessage:"Load more"})),i.state.loading&&o()(qn.Z,{}))})),l()(this,"renderBillingHistoryEvent",((e,t)=>{let i;const{intl:n}=this.props;return i="paid"===e.status?e.total<0?o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.invoicesSection.invoiceStatus.credited",defaultMessage:"Credited"}):o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.invoicesSection.invoiceStatus.paid",defaultMessage:"Paid"}):e.attempted?o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.invoicesSection.invoiceStatus.failed",defaultMessage:"Failed"}):o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.invoicesSection.invoiceStatus.due",defaultMessage:"Due",description:"Label for the amount that the user owes on a given invoice"}),o()("tr",{style:{height:28,fontSize:14,whiteSpace:"nowrap"}},t,o()("td",{style:{width:"100%",paddingRight:18,color:this.theme.mediumTextColor}},void 0,(0,ll.Z)(e.timestamp).format("LL")),o()("td",{style:{paddingRight:18}},void 0,i),o()("td",{style:{paddingRight:18,textAlign:"right"}},void 0,(0,tr.Dx)({amount:e.total,currency:"dollar",intl:n})),o()("td",{},void 0,o()(xd.Z,{inline:!0,href:"/invoice/".concat(e.id),external:!0,innerStyle:this.getViewInvoiceButtonStyle()},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.invoicesSection.viewInvoiceButton",defaultMessage:"View invoice"}))))})),l()(this,"handleLoadMoreBillingEventsClick",(()=>{this.stores.store.setState({...this.stores.store.state,billingEventsLimit:this.stores.store.state.billingEventsLimit+Fd.billingEventsLimitIncrement})}))}renderComponent(){const{store:e,billingHistoryRequestStore:t}=this.stores,i={request:e.state.billingEventsLimit,performRequest:this.performGetBillingHistoryRequest,render:this.renderBillingHistoryResults};return o()("div",{},void 0,o()(Yt.Z,{large:!0,divider:"full",style:{marginTop:36}},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.invoicesSection.title",defaultMessage:"Invoices"})),m().createElement(pn.Z,a()({},i,{requestStore:t})))}static getModalStyle(e){return{width:480,background:e.popoverBackground,padding:24,borderRadius:3}}getViewInvoiceButtonStyle(){return{color:this.theme.mediumTextColor,padding:"2px 3px",borderRadius:3}}}l()(Fd,"billingEventsLimitIncrement",20),l()(Fd,"modalTitleStyle",{fontSize:18,marginBottom:16,fontWeight:v.Z.fontWeight.medium});const Ad=(0,y.injectIntl)(Fd);var Bd=i(18647),Ed=i(90850);class Rd extends I.Z{getInitialState(){return{temporaryCouponCode:void 0,couponCodeInput:void 0,error:void 0}}}const Dd=Rd,Ld=(0,y.defineMessages)({couponCodePlaceholder:{id:"couponEntryInput.placeholder",defaultMessage:"Coupon code"},couponCodeNotFoundError:{id:"couponEntryInput.error.noPromo",defaultMessage:"Invalid coupon code"}});class Od extends p.Z{constructor(){super(...arguments),l()(this,"storeTypes",{couponCode:Dd})}didMount(){const e=(0,Ed.Zk)(this.environment.currentUser.id);e&&this.stores.couponCode.setState({...this.stores.couponCode.state,temporaryCouponCode:e})}renderComponent(){return o()("div",{style:this.getContainerStyle()},void 0,o()("div",{style:{display:"flex",flexDirection:"row"}},void 0,o()(lt.Z,{textarea:!1,value:this.stores.couponCode.state.couponCodeInput,placeholder:Te.default.formatMessage(Ld.couponCodePlaceholder),onSubmit:()=>this.checkCouponCode(),onChange:e=>{this.stores.couponCode.setState({...this.stores.couponCode.state,couponCodeInput:e.target.value})},style:{height:32,paddingLeft:10,marginRight:this.props.hideApply?0:10}}),o()(pn.Z,{request:this.stores.couponCode.state.temporaryCouponCode||null,performRequest:async e=>{if(e)return this.applyCouponCode(e)},render:(e,t,i)=>{if(!this.props.hideApply)return o()(jt.Z,{isLarge:!1,onClick:()=>this.checkCouponCode()},void 0,o()(po.Z,{loaded:i,spinnerSize:16,showSpinnerTimeout:500},void 0,o()(y.FormattedMessage,{id:"couponEntryInput.button.apply",defaultMessage:"Apply"})))}})),this.stores.couponCode.state.error&&o()(oi.Z,{isMultiline:!1,style:{paddingTop:8,color:g.ZP.red}},void 0,this.stores.couponCode.state.error))}checkCouponCode(){const e=this.stores.couponCode.state.couponCodeInput;e&&(this.stores.couponCode.setState({...this.stores.couponCode.state,temporaryCouponCode:e}),this.stores.couponCode.setState({...this.stores.couponCode.state,couponCodeInput:""}))}async applyCouponCode(e){const t=await w.getPromoCode(this.environment,{code:e});if("success"===t.type){var i;if(t.data.promo)return null!==(i=t.data.promo.applies_to)&&void 0!==i&&i.length&&!t.data.promo.applies_to.includes(this.props.plan)?void this.showError(e):(this.stores.couponCode.setState({...this.stores.couponCode.state,error:void 0}),this.props.handlePromo(t.data.promo),M.trackCouponCodeEntered(this.environment,{code:e,valid:!0,id:t.data.promo.id}),t.data.promo);this.showError(e)}else if("failed"===t.type){const e=t.error.name;this.stores.couponCode.setState({...this.stores.couponCode.state,error:e})}else(0,H.t1)(t)}showError(e){this.stores.couponCode.setState({...this.stores.couponCode.state,error:Te.default.formatMessage(Ld.couponCodeNotFoundError)}),M.trackCouponCodeEntered(this.environment,{code:e,valid:!1,id:void 0})}getContainerStyle(){return{display:"flex",flexDirection:"column",...this.props.style?this.props.style:void 0}}}const Nd=Od;var Ud=i(93039),Wd=i(1063);const Vd=(0,y.defineMessages)({apply_credit:{id:"spaceSubscriptionBilling.applyCreditButton.label",defaultMessage:"Apply credit",description:"Button a user clicks to apply Notion credits towards their Notion bill."},update:{id:"spaceSubscriptionBilling.updateButton.label",defaultMessage:"Update"},add:{id:"spaceSubscriptionBilling.addButton.label",defaultMessage:"Add"},apply:{id:"spaceSubscriptionBilling.apply.label",defaultMessage:"Apply"}});class zd extends p.Z{renderComponent(){const{title:e,caption:t,buttonArgs:i}=this.props,n=m().createElement(y.FormattedMessage,Vd[i.buttonPurpose]);return o()("div",{style:{display:"flex",alignItems:"center",fontSize:14}},void 0,o()("div",{style:{marginRight:"auto"}},void 0,e),o()("div",{style:{color:this.theme.mediumTextColor}},void 0,t),o()("div",{style:{minWidth:110,display:"flex",justifyContent:"flex-end"}},void 0,i.showButton&&o()(Je.Z,{isBlue:!0,onClick:i.onClick,style:zd.buttonStyle},void 0,n)))}}l()(zd,"buttonStyle",{marginLeft:18,marginRight:-4,fontWeight:v.Z.fontWeight.medium});const qd=(0,y.injectIntl)(zd),Hd={offline:o()(y.FormattedMessage,{defaultMessage:"Please go online to manage billing.",id:"spaceSubscriptionBilling.offline.message"})};class Gd extends p.Z{constructor(){super(...arguments),l()(this,"couponEntryInput",null),l()(this,"storeTypes",{store:Td,billingHistoryRequestStore:on.Z}),l()(this,"renderPaymentMethodModal",(()=>{const{customerData:e,spaceStore:t}=this.props;return o()(Hr.LazySpaceSubscriptionUpdatePaymentMethodModal,{customerData:e,spaceStore:t,onComplete:this.handleModalClose})})),l()(this,"renderBillingIntervalModal",(()=>{const{temporaryBillingInterval:e}=this.stores.store.state,{customerData:t}=this.props,i=e||t.interval,{monthlyPlanAmount:n,yearlyPlanAmount:s}=t,a=1-s/(12*n);return o()(Kd,{theme:this.theme,title:o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.changeBillingInterval.title",defaultMessage:"Change billing interval"}),helpButton:o()($o.Z,{title:o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.changeBillingInterval.helpButton.label",defaultMessage:"Learn about how this change will impact what you pay."}),href:(0,V.UY)("guides.changeBillingInterval"),analyticsFrom:"billing_interval_settings"}),acceptAction:"update",onAccept:this.handleBillingIntervalAccept,onClose:this.handleModalClose},void 0,o()("div",{style:{marginTop:12,marginBottom:16}},void 0,T.Rj({environment:this.environment,productId:t.productId,yearlyPlanAmount:s,monthlyPlanAmount:n,yearlySavingsPercent:a,currentBillingInterval:i,handleMonthlyBillingClick:this.handleMonthlyBillingClick,handleYearlyBillingClick:this.handleYearlyBillingClick})))})),l()(this,"renderApplyCreditModal",(()=>{const{subscriptionData:e,customerData:t,intl:i}=this.props,{availableCredit:n}=e,s=this.getCurrentFormCreditAmount(),a=Math.max(0,(t.nextInvoiceAmount||0)-s);return o()("div",{style:Gd.getModalStyle(this.theme)},void 0,o()("div",{style:Gd.modalTitleStyle},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.useCreditModal.title",defaultMessage:"Use Notion credit - {creditInDollars} available",values:{creditInDollars:(0,tr.Dx)({amount:n,currency:"dollar",intl:i})}})),o()("div",{style:{fontSize:14,display:"flex",alignItems:"center",marginBottom:16}},void 0,o()("div",{style:{width:"100%",marginRight:20,color:this.theme.mediumTextColor}},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.useCreditModal.amountOfCreditQuestion",defaultMessage:"How much credit would you like to apply to your next invoice?"})),o()(_d,{availableCredit:n,focus:!0,selectAll:!0,onChange:this.handleApplyCreditAmountInputChange}),o()("div",{style:{whiteSpace:"nowrap",marginLeft:8}},void 0,"/"," ",(0,tr.Dx)({amount:n,currency:"dollar",intl:i}))),o()("div",{style:{borderTop:"1px solid ".concat(this.theme.regularDividerColor),paddingTop:16}},void 0,o()("div",{style:{paddingBottom:18,fontSize:12,color:this.theme.mediumTextColor}},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.useCreditModal.warning",defaultMessage:"Applying credit to your account <bold>cannot be undone</bold>.",values:{bold:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()("b",{},void 0,t)}}})),o()("div",{style:{display:"flex",alignItems:"center"}},void 0,o()("div",{style:{fontSize:36,lineHeight:1}},void 0,(0,tr.Dx)({amount:a,currency:"dollar",intl:i})),o()("div",{style:{marginLeft:8,fontSize:12,color:this.theme.mediumTextColor,alignSelf:"flex-end"}},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.useCreditModal.nextInvoiceAmount",defaultMessage:"next invoice total",description:"Text that appears next to the amount, in dollars, that the user's next invoice will be after applying their Notion credits to their bill."})),o()(jt.Z,{isLarge:!0,style:{marginLeft:"auto"},onClick:this.handleModalClose},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.useCreditModal.cancelButton.label",defaultMessage:"Cancel"})),o()(Ee.Z,{isLarge:!0,style:{marginLeft:12},disabled:s<=0,onClick:this.handleApplyCreditAccept},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.useCreditModal.applyCreditButton.label",defaultMessage:"Apply credit"})))))})),l()(this,"renderSingleTextFieldModal",((e,t,i,n,s)=>o()(Kd,{theme:this.theme,title:t,acceptAction:s,onAccept:n,onClose:this.handleModalClose},void 0,o()(lt.Z,{focus:!0,selectAll:!0,value:e,onChange:i,onSubmit:n,style:Gd.modalInputStyle})))),l()(this,"renderBillingEmailModal",(()=>{const{customerData:e}=this.props,{temporaryBillingEmail:t}=this.stores.store.state,i=void 0!==t?t:e.billingEmail||"",n=e.billingEmail?"update":"add";return this.renderSingleTextFieldModal(i,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.changeBillingEmailModal.title",defaultMessage:"Change billing email"}),this.handleBillingEmailChange,this.handleBillingEmailAccept,n)})),l()(this,"renderVatIdModal",(()=>{const{customerData:e}=this.props,{temporaryVatId:t}=this.stores.store.state,i=void 0!==t?t:e.vatId||"",n=e.vatId?"update":"add";return o()(Kd,{theme:this.theme,title:o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.changeVATIDModal.title",defaultMessage:"Change VAT/GST number"}),acceptAction:n,onAccept:this.handleVatIdAccept,onClose:this.handleModalClose},void 0,o()(lt.Z,{focus:!0,selectAll:!0,value:i,onChange:this.handleVatIdChange,onSubmit:this.handleVatIdAccept,style:Gd.modalInputStyle}),o()("div",{style:{color:this.theme.mediumTextColor,fontSize:v.Z.fontSize.UISmall.desktop,marginTop:-10}},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.changeVATIDModal.subtitle",defaultMessage:"Please include your country code"})))})),l()(this,"renderApplyCouponModal",(()=>o()(Kd,{theme:this.theme,title:o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.applyCouponModal.title",defaultMessage:"Apply coupon"}),acceptAction:"apply",onAccept:()=>{this.couponEntryInput&&this.couponEntryInput.checkCouponCode()},onClose:this.handleModalClose},void 0,m().createElement(Nd,{ref:e=>this.couponEntryInput=e,hideApply:!0,plan:this.props.customerData.plan,handlePromo:async e=>{this.handleModalClose();await D.Mg({environment:this.environment,spaceStore:this.props.spaceStore,coupon:e&&"coupon"===e.source?e.code:void 0,promoCodeId:e&&"promo_code"===e.source?e.code:void 0,from:"space_settings-billing_tab"})&&(0,C.showMessage)({message:o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.applyCouponModal.successMessage",defaultMessage:"Coupon applied!"})})}})))),l()(this,"updateTemporaryAddress",(e=>{const{temporaryAddress:t}=this.stores.store.state;this.stores.store.setState({...this.stores.store.state,temporaryAddress:{...this.props.customerData.address,...t,...e}})})),l()(this,"renderAddressModal",(()=>{const{customerData:e}=this.props,{temporaryAddress:t,addressErrorMessage:i}=this.stores.store.state,n=T.CM(this.environment);return o()("div",{style:{display:"flex",flexDirection:"column",maxHeight:"75vh"}},void 0,o()("div",{style:Gd.getModalStyle(this.theme)},void 0,o()("div",{style:Gd.modalTitleStyle},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.changeYourAddressModal.title",defaultMessage:"Change your address"})),o()(Ud.J,{address:t||{name:e.customerName||"",businessName:"",addressLine1:"",addressLine2:"",zipCode:"",city:"",state:"",country:""},updateAddress:e=>{this.stores.store.setAddressField(e)},shouldShowBusinessName:Boolean(n&&["team","enterprise"].includes(n))}),o()("div",{style:{color:g.ZP.red,marginTop:10}},void 0,i)),o()("div",{style:{display:"flex",justifyContent:"flex-end",padding:"16px 24px",background:this.theme.cardContentBackground}},void 0,o()(jt.Z,{isLarge:!0,onClick:this.handleModalClose},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.changeBillingAddressModal.cancelButton.label",defaultMessage:"Cancel"})),o()(Ee.Z,{style:{marginLeft:12},isLarge:!0,disabled:void 0===this.getUpdatedAddress(),onClick:this.handleAddressAccept},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.changeBillingAddressModal.updateButton.label",defaultMessage:"Update"}))))})),l()(this,"handleChangePlanClick",(()=>{ve.Z.setState({open:!0,currentTab:"plans",defaultSubtab:void 0})})),l()(this,"handlePaymentMethodChangeClick",(()=>{this.stores.store.setState({...this.stores.store.state,paymentMethodModalOpen:!0})})),l()(this,"handleBillingIntervalChangeClick",(()=>{this.stores.store.setState({...this.stores.store.state,billingIntervalModalOpen:!0})})),l()(this,"handleBillingEmailChangeClick",(()=>{this.stores.store.setState({...this.stores.store.state,billingEmailModalOpen:!0})})),l()(this,"handleAddressChangeClick",(()=>{this.stores.store.setState({...this.stores.store.state,addressModalOpen:!0})})),l()(this,"handleVatIdChangeClick",(e=>{const t=e.address.country;if(!t)return void(0,C.showErrorMessage)(o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.vatId.missingCountry",defaultMessage:"To update your VAT/GST number, please update your billing address."}));!{AE:"ae_trn",AU:"au_abn",CA:"ca_bn",CH:"ch_vat",ES:"eu_vat",AT:"eu_vat",BE:"eu_vat",BG:"eu_vat",CY:"eu_vat",CZ:"eu_vat",DE:"eu_vat",EE:"eu_vat",FI:"eu_vat",FR:"eu_vat",GR:"eu_vat",HR:"eu_vat",HU:"eu_vat",IE:"eu_vat",IT:"eu_vat",LT:"eu_vat",LU:"eu_vat",LV:"eu_vat",MT:"eu_vat",NL:"eu_vat",PL:"eu_vat",PT:"eu_vat",RO:"eu_vat",RU:"ru_inn",SE:"eu_vat",SI:"eu_vat",SK:"eu_vat",GB:"gb_vat",IN:"in_gst",KR:"kr_brn",NZ:"nz_gst",SG:"sg_gst"}[t]?(0,C.showErrorMessage)(o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.vatId.vatNotRequired",defaultMessage:"A VAT/GST number is not required for your tax jurisdiction."})):this.stores.store.setState({...this.stores.store.state,vatIdModalOpen:!0})})),l()(this,"handleApplyCouponClick",(()=>{this.stores.store.setState({...this.stores.store.state,applyCouponModalOpen:!0})})),l()(this,"handleModalClose",(()=>{this.stores.store.reset()})),l()(this,"handleBillingEmailChange",(e=>{this.stores.store.setState({...this.stores.store.state,temporaryBillingEmail:e.target.value})})),l()(this,"handleBillingEmailAccept",(async()=>{const{spaceStore:e,customerData:t}=this.props,{temporaryBillingEmail:i}=this.stores.store.state;i!==t.billingEmail&&await D.Mg({environment:this.environment,spaceStore:e,billingEmail:i,from:"space_settings-billing_tab"}),this.handleModalClose()})),l()(this,"handleVatIdChange",(e=>{this.stores.store.setState({...this.stores.store.state,temporaryVatId:e.target.value})})),l()(this,"handleVatIdAccept",(async()=>{const{spaceStore:e,customerData:t}=this.props,{temporaryVatId:i}=this.stores.store.state;i!==t.vatId&&await D.Mg({environment:this.environment,spaceStore:e,vatId:i,from:"space_settings-billing_tab"}),this.handleModalClose()})),l()(this,"handleAddressAccept",(async()=>{const{spaceStore:e}=this.props,t=this.getUpdatedAddress();if(!t)return void this.stores.store.setState({...this.stores.store.state,addressErrorMessage:this.props.intl.formatMessage({id:"spaceSubscriptionBilling.address.invalidError",defaultMessage:"Your address is invalid. Please update your address so we can process your payment."})});const i=await(0,Md.a)(this.environment,t);if(!i.valid)return void this.stores.store.setState({...this.stores.store.state,addressErrorMessage:this.props.intl.formatMessage({id:"spaceSubscriptionBilling.address.invalidError",defaultMessage:"Your address is invalid. Please update your address so we can process your payment."})});const n={...t,...i.validatedAddresses?i.validatedAddresses[0]:void 0};if(t)try{await D.y3({environment:this.environment,spaceStore:e,address:n}),this.handleModalClose()}catch(o){}})),l()(this,"getUpdatedAddress",(()=>{const{customerData:e}=this.props,{temporaryAddress:t}=this.stores.store.state;if(t&&t!==e.address)return t})),l()(this,"handleMonthlyBillingClick",(()=>{this.stores.store.setState({...this.stores.store.state,temporaryBillingInterval:"month"})})),l()(this,"handleYearlyBillingClick",(()=>{this.stores.store.setState({...this.stores.store.state,temporaryBillingInterval:"year"})})),l()(this,"handleBillingIntervalAccept",(async()=>{const{spaceStore:e,customerData:t}=this.props,{temporaryBillingInterval:i}=this.stores.store.state;if(i&&i!==t.interval){const t=this.getPlanForOppositeBillingInterval();t&&await D.Mg({environment:this.environment,spaceStore:e,plan:t,from:"space_settings-billing_tab"})}this.handleModalClose()})),l()(this,"handleUseCardClick",(()=>{this.stores.store.setState({...this.stores.store.state,temporaryBillingType:"charge_automatically"})})),l()(this,"handleCardUpdateClick",(async()=>{const{spaceStore:e}=this.props,{customerData:t}=this.props;if(t.billingEmail){const i=await D.Ay({name:"Update your Card",panelLabel:"Update",email:t.billingEmail});await D.Mg({environment:this.environment,spaceStore:e,stripeToken:i,from:"space_settings-billing_tab"})}this.handleModalClose()})),l()(this,"handlePaymentMethodAccept",(async()=>{const{spaceStore:e}=this.props,{customerData:t}=this.props,{temporaryBillingType:i}=this.stores.store.state;if("charge_automatically"===(i||t.billing)&&!t.brand){const{currentUserStore:i}=F.default.state,n=i?i.getValue():void 0,o=t.billingEmail||(n?n.email:void 0);if(!o)throw new Error("No billing email found.");const s=await D.Ay({name:"Update your Card",panelLabel:"Update",email:o});await D.Mg({environment:this.environment,spaceStore:e,stripeToken:s,billingEmail:o,from:"space_settings-billing_tab"})}this.handleModalClose()})),l()(this,"handleApplyCreditClick",(()=>{this.stores.store.setState({...this.stores.store.state,applyCreditModalOpen:!0})})),l()(this,"handleApplyCreditAccept",(async()=>{const e=this.getCurrentFormCreditAmount(),{spaceStore:t}=this.props;e>0&&await D.Mg({environment:this.environment,spaceStore:t,creditAmount:e,from:"space_settings-billing_tab"}),this.handleModalClose(),M.trackSubscriptionApplyCredit(this.environment,{amount:e})})),l()(this,"handleApplyCreditAmountInputChange",(e=>{this.stores.store.setState({...this.stores.store.state,temporaryApplyCreditCents:e})})),l()(this,"handleRestartSubscriptionClick",(async()=>{const{spaceStore:e}=this.props,{customerData:t}=this.props;await D.Mg({environment:this.environment,spaceStore:e,plan:t.plan,from:"space_settings-billing_tab"}),this.handleModalClose()}))}willMount(){D.bi(this.environment)}renderComponent(){return cn.Z.state.online?this.renderBilling():Gd.renderOfflineMessage()}static renderOfflineMessage(){return o()(yo.Z,{},void 0,o()(oi.Z,{isSmall:!0,style:{textAlign:"center"}},void 0,Hd.offline))}renderBilling(){const{customerData:e,subscriptionData:t}=this.props,{paymentMethodModalOpen:i,billingIntervalModalOpen:n,billingEmailModalOpen:s,addressModalOpen:r,applyCreditModalOpen:l,vatIdModalOpen:d,applyCouponModalOpen:c}=this.stores.store.state;return o()("div",{style:Gd.wrapStyle},void 0,o()(Bd.Z,{style:Gd.scrollerStyle,type:Cd.Z.Y},void 0,this.renderHeader(e),this.renderSummary(t),this.renderPaymentMethod(e),this.renderSeparator(),this.renderBillingInterval(e),this.renderSeparator(),this.renderBillingEmail(e),this.renderSeparator(),this.renderAddress(e),this.renderSeparator(),this.renderVatId(e),this.renderSeparator(),this.renderCredit(e),this.renderSeparator(),this.renderCoupon(),this.renderDiscount(),m().createElement(Ad,a()({},this.props,{data:t})),o()(Zn.Z,{open:i,render:this.renderPaymentMethodModal,onDismiss:this.handleModalClose}),o()(Zn.Z,{open:n,render:this.renderBillingIntervalModal,onDismiss:this.handleModalClose}),o()(Zn.Z,{open:l,render:this.renderApplyCreditModal,onDismiss:this.handleModalClose}),o()(Zn.Z,{open:s,render:this.renderBillingEmailModal,onDismiss:this.handleModalClose}),o()(Zn.Z,{open:r,render:this.renderAddressModal,onDismiss:this.handleModalClose}),o()(Zn.Z,{open:d,render:this.renderVatIdModal,onDismiss:this.handleModalClose}),o()(Zn.Z,{open:c,render:this.renderApplyCouponModal,onDismiss:this.handleModalClose})))}renderHeader(e){let t=o()(y.FormattedMessage,{id:"legacyPlan.title",defaultMessage:"Legacy Plan",description:"Shown in settings and the sidebar to describe which plan you have."});switch(e.productId){case Kt.Z.pricing.personal.productId:t=o()(y.FormattedMessage,{id:"personalPlan.title",defaultMessage:"Personal Pro Plan",description:"Shown in settings and the sidebar to describe which plan you have."});break;case Kt.Z.pricing.student.productId:t=o()(y.FormattedMessage,{id:"personalEducationPlan.title",defaultMessage:"Personal Pro Plan (Education)",description:"Shown in settings and the sidebar to describe which plan you have."});break;case Kt.Z.pricing.team.productId:t=o()(y.FormattedMessage,{id:"teamPlan.title",defaultMessage:"Team Plan",description:"Shown in settings and the sidebar to describe which plan you have."});break;case Kt.Z.pricing.business.productId:t=o()(y.FormattedMessage,{id:"businessPlan.title",defaultMessage:"Business Plan",description:"Shown in settings and the sidebar to describe which plan you have."});break;case Kt.Z.pricing.enterprise.productId:t=o()(y.FormattedMessage,{id:"enterprisePlan.title",defaultMessage:"Enterprise Plan",description:"Shown in settings and the sidebar to describe which plan you have."})}return o()(Yt.Z,{large:!0,divider:"full"},void 0,t)}renderSummary(e){const{spaceStore:t}=this.props,i=T.D0(this.environment,t,e),n=T.DH(e),s="subscribed_admin"===e.type;return o()("div",{style:Gd.summaryStyle},void 0,o()("div",{style:Gd.summaryMessageStyle},void 0,i),n&&o()(Ee.Z,{isLarge:!0,onClick:this.handleRestartSubscriptionClick,style:{marginRight:8}},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.restartSubscriptionButton.label",defaultMessage:"Restart subscription"})),s&&o()(jt.Z,{isLarge:!0,onClick:this.handleChangePlanClick},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.changePlanButton.label",defaultMessage:"Change plan"})))}renderSeparator(){return o()("div",{style:{flex:"none",height:1,marginTop:10,marginBottom:10,background:this.theme.regularDividerColor}})}renderPaymentMethod(e){return o()(qd,{title:o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.paymentMethod.title",defaultMessage:"Payment method"}),caption:o()(u.Fragment,{},void 0,"send_invoice"===e.billing&&o()("div",{},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.paymentMethod.value.achOrWireTransfer",defaultMessage:"ACH or Wire Transfer"})),"charge_automatically"===e.billing&&(e.last4&&e.brand?o()("div",{},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.paymentMethod.value.creditCard",defaultMessage:"{creditCardBrand} ending in {lastFourDigits}",values:{creditCardBrand:(0,Gs.Z)(e.brand),lastFourDigits:e.last4}})):o()("div",{},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.paymentMethod.value.none",defaultMessage:"None",description:"The payment method setting we display for users who haven't set up a payment method yet"})))),buttonArgs:{showButton:!0,buttonPurpose:"update",onClick:this.handlePaymentMethodChangeClick}})}renderBillingInterval(e){return o()(qd,{title:o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.billingInterval.title",defaultMessage:"Billing interval"}),caption:o()("div",{},void 0,"month"===e.interval?o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.billingInterval.value.monthly",defaultMessage:"Monthly"}):o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.billingInterval.value.yearly",defaultMessage:"Yearly"})),buttonArgs:{showButton:Boolean(this.getPlanForOppositeBillingInterval()),buttonPurpose:"update",onClick:this.handleBillingIntervalChangeClick}})}renderBillingEmail(e){return o()(qd,{title:o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.billingEmail.title",defaultMessage:"Billing email"}),caption:o()("div",{},void 0,e.billingEmail||""),buttonArgs:{showButton:!0,buttonPurpose:Boolean(e.billingEmail)?"update":"add",onClick:this.handleBillingEmailChangeClick}})}renderVatId(e){return o()(qd,{title:o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.VATID.title",defaultMessage:"VAT/GST number",description:"Title for the section where users can update their VAT (value added tax) identification number"}),caption:o()("div",{},void 0,e.vatId||""),buttonArgs:{showButton:!0,buttonPurpose:Boolean(e.vatId)?"update":"add",onClick:()=>this.handleVatIdChangeClick(e)}})}renderAddress(e){return o()(qd,{title:o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.subscriptionSettingsSection.yourAddress.title",defaultMessage:"Your address"}),caption:o()("div",{style:{textAlign:"right",width:"80%",float:"right"}},void 0,this.renderAddressString(e.address)||""),buttonArgs:{showButton:!0,buttonPurpose:e.address&&!c().isEmpty(e.address)?"update":"add",onClick:this.handleAddressChangeClick}})}renderCredit(e){const t=-Math.min(0,e.accountBalance),{intl:i}=this.props;return o()(qd,{title:wd.workspaceBalance,caption:o()("div",{},void 0,(0,tr.Dx)({amount:t,currency:"dollar",intl:i})),buttonArgs:{showButton:!0,buttonPurpose:"apply_credit",onClick:this.handleApplyCreditClick}})}renderCoupon(){const e=T.CM(this.environment);return e&&T.Fu(e)?o()("div",{style:{display:"flex",alignItems:"center",fontSize:14,justifyContent:"end"}},void 0,o()("div",{style:{minWidth:110,display:"flex",justifyContent:"flex-end"}},void 0,o()(Wd.X,{tier:e}))):null}renderDiscount(){var e;const{customerData:t}=this.props;return null!==(e=t.promo)&&void 0!==e&&e.percent_off?o()(qd,{title:wd.discount,caption:o()("div",{},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.discount.percentOff",defaultMessage:"{percentOff}% off",values:{percentOff:t.promo.percent_off}})),buttonArgs:{showButton:!1,buttonPurpose:"add",onClick:()=>{}}}):null}renderAddressString(e){return e?this.props.intl.formatList([e.name,e.businessName,e.addressLine1,e.country].filter(Boolean),{type:"conjunction",style:"narrow"}):""}getCurrentFormCreditAmount(){const{subscriptionData:e}=this.props,{store:t}=this.stores,{temporaryApplyCreditCents:i}=t.state;return void 0!==i?i:e.availableCredit}getPlanForOppositeBillingInterval(){const{customerData:e}=this.props,t=bd.KK.find((t=>t.indexOf(e.plan)>=0));if(t){const i=t.indexOf(e.plan);return t[0===i?1:0]}}static getModalStyle(e){return{width:500,background:e.popoverBackground,padding:24,borderRadius:3}}}function Kd(e){const t=m().createElement(y.FormattedMessage,Vd[e.acceptAction]);return o()("div",{style:Gd.getModalStyle(e.theme)},void 0,o()("div",{style:Gd.modalTitleStyle},void 0,e.title),e.children,o()("div",{style:{marginBottom:20}},void 0,e.helpButton),o()("div",{style:{display:"flex",justifyContent:"flex-end"}},void 0,o()(jt.Z,{isLarge:!0,onClick:e.onClose,style:{marginRight:12}},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionBilling.cancelButton.label",defaultMessage:"Cancel"})),o()(Ee.Z,{isLarge:!0,onClick:e.onAccept},void 0,t)))}l()(Gd,"modalTitleStyle",{fontSize:18,marginBottom:16,fontWeight:v.Z.fontWeight.medium}),l()(Gd,"wrapStyle",{display:"flex",flexDirection:"column",height:"100%"}),l()(Gd,"scrollerStyle",{height:"100%",padding:"36px 60px"}),l()(Gd,"summaryStyle",{display:"flex",alignItems:"flex-start",fontSize:14,marginBottom:36}),l()(Gd,"summaryMessageStyle",{marginRight:"auto",paddingRight:32}),l()(Gd,"modalInputStyle",{marginTop:12,marginBottom:20});const jd=(0,y.injectIntl)(Gd);class Yd extends p.Z{constructor(){super(...arguments),l()(this,"storeTypes",{store:Td,billingHistoryRequestStore:on.Z})}willMount(){D.bi(this.environment)}renderComponent(){const{data:e}=this.props;return cn.Z.state.online?o()("div",{style:Yd.wrapStyle},void 0,o()(Bd.Z,{style:Yd.scrollerStyle,type:Cd.Z.Y},void 0,o()(Yt.Z,{large:!0,divider:"full"},void 0,m().createElement(y.FormattedMessage,fd.billingTab)),this.renderCredit(e),this.renderSeparator(),m().createElement(Ad,this.props))):Yd.renderOfflineMessage()}static renderOfflineMessage(){return o()(yo.Z,{},void 0,o()(oi.Z,{isSmall:!0,style:{textAlign:"center"}},void 0,Hd.offline))}renderCredit(e){const t=-Math.min(0,e.accountBalance),{intl:i}=this.props;return o()(qd,{title:wd.workspaceBalance,caption:o()("div",{},void 0,(0,tr.Dx)({amount:t,currency:"dollar",intl:i})),buttonArgs:{showButton:!1,buttonPurpose:"apply_credit",onClick:c().noop}})}renderSeparator(){return o()("div",{style:{flex:"none",marginTop:30}})}}l()(Yd,"wrapStyle",{display:"flex",flexDirection:"column",height:"100%"}),l()(Yd,"scrollerStyle",{height:"100%",padding:"36px 60px"});const Qd=(0,y.injectIntl)(Yd);var Xd=i(2438),Jd=i(64684);class $d extends I.Z{getInitialState(){return{termType:"yearly"}}}const ec=new $d;var tc=i(41892);const ic=["not_using_enough","too_difficult","trial_over","too_expensive","security_compliance_requirements","company_shutting_down","upgraded_by_mistake","using_alternative","missing_features","other"],nc=["google_drive_docs","asana","trello","microsoft_office","atlassian_confluence","atlassian_jira","airtable","coda","dropbox_paper","quip","evernote","other"];class oc extends I.Z{getInitialState(){return{reasons:[],reasonMissingFeatures:"",reasonOther:"",alternatives:[],alternativeOther:"",otherFeedback:""}}}const sc=oc,ac=(0,y.defineMessages)({missingFeaturesPlaceholder:{id:"churnSurveyMenu.reasons.missingFeaturesPlaceholder",defaultMessage:"Let us know which features are missing..."},reasonOtherPlaceholder:{id:"churnSurveyMenu.reasons.reasonOtherPlaceholder",defaultMessage:"Tell us more..."},alternativeOtherPlaceholder:{id:"churnSurveyMenu.alternatives.alternativeOtherPlaceholder",defaultMessage:"Tell us more..."},otherFeedbackPlaceholder:{id:"churnSurveyMenu.other.otherFeedbackPlaceholder",defaultMessage:"Our team will review your feedback to make Notion better."}});class rc extends p.Z{constructor(){super(...arguments),l()(this,"shuffledReasons",[...c().shuffle(c().without(ic,"other")),"other"]),l()(this,"shuffledAlternatives",[...c().shuffle(c().without(nc,"other")),"other"]),l()(this,"storeTypes",{store:sc}),l()(this,"handleAccept",(()=>{(0,M.trackChurnSurvey)(this.environment,this.stores.store.state),this.props.onAccept()}))}renderComponent(){var e=this;const{churnType:t,onClose:i,periodEnd:n}=this.props,{store:s}=this.stores,{reasons:a,reasonMissingFeatures:r,reasonOther:l,alternatives:d,alternativeOther:u,otherFeedback:p}=s.state,g=(0,ll.Z)(n).format("LL");return o()("div",{style:{fontSize:14}},void 0,o()("div",{style:{display:"flex",fontSize:14,padding:24,paddingBottom:20,borderBottom:"1px solid ".concat(this.theme.lightDividerColor)}},void 0,o()("div",{},void 0,o()("h3",{style:rc.headerStyle},void 0,o()(y.FormattedMessage,"personal"===t?{id:"churnSurveyMenu.header.personal.title",defaultMessage:"Downgrade to Personal"}:{id:"churnSurveyMenu.header.team.title",defaultMessage:"Downgrade to Team Trial"})),o()("p",{style:{lineHeight:1.4,margin:"8px 0 12px"}},void 0,o()(y.FormattedMessage,{id:"churnSurveyMenu.header.description",defaultMessage:"Notion is constantly improving. Before you downgrade, we’d love your input to help us make Notion better for everyone. Thank you for your feedback."})),o()(jt.Z,{onClick:i},void 0,o()(y.FormattedMessage,{id:"churnSurveyMenu.goBackButton.title",defaultMessage:"Back to Plans"}))),o()("div",{style:{alignSelf:"center",padding:"0px 8px"}},void 0,o()("img",{src:tc.Z.images.downgradeFeedbackPng,style:{filter:this.theme.illustrationFilter},width:160}))),o()("div",{style:{padding:"8px 12px",margin:"20px 24px 12px 24px",background:this.theme.sidebarBackground,borderRadius:3}},void 0,o()(y.FormattedMessage,{id:"churnSurveyMenu.header.covidMessage",defaultMessage:"💛 If you are impacted by COVID-19, <contactuslink>contact us</contactuslink> for assistance.",values:{contactuslink:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return o()(ao.Z,{onClick:()=>{(0,ps.j)({environment:e.environment,from:"churn_survey"})}},void 0,i)}}})),o()("div",{style:rc.surveySectionStyle},void 0,o()("h4",{style:rc.subheaderStyle},void 0,o()(y.FormattedMessage,{id:"churnSurveyMenu.reasons.title",defaultMessage:"1. What are your reasons for downgrading?"})),o()("div",{style:this.getDescriptionStyle()},void 0,o()(y.FormattedMessage,{id:"churnSurveyMenu.reasons.description",defaultMessage:"Please select one or more"})),this.shuffledReasons.map((e=>{const t=a.includes(e);return m().createElement(m().Fragment,null,o()("div",{style:rc.optionRowStyle,onClick:()=>{s.setState({...s.state,reasons:t?c().without(a,e):[...a,e]})}},e,o()(Vt.Z,{checked:t,size:14}),o()("span",{style:{marginLeft:4}},void 0,this.renderMessageForReason(e))),"missing_features"===e&&t&&o()(lt.Z,{style:rc.inlineInputStyle,autoFocus:!0,value:r,placeholder:Te.default.formatMessage(ac.missingFeaturesPlaceholder),onChange:e=>{s.setState({...s.state,reasonMissingFeatures:e.target.value})}}),"other"===e&&t&&o()(lt.Z,{style:rc.inlineInputStyle,autoFocus:!0,value:l,placeholder:Te.default.formatMessage(ac.reasonOtherPlaceholder),onChange:e=>{s.setState({...s.state,reasonOther:e.target.value})}}))}))),o()("div",{style:rc.surveySectionStyle},void 0,o()("h4",{style:rc.subheaderStyle},void 0,o()(y.FormattedMessage,{id:"churnSurveyMenu.alternatives.title",defaultMessage:"2. What tools are you using instead?"})),o()("div",{style:this.getDescriptionStyle()},void 0,o()(y.FormattedMessage,{id:"churnSurveyMenu.alternatives.description",defaultMessage:"Please select one or more"})),this.shuffledAlternatives.map((e=>{const t=d.includes(e);return m().createElement(m().Fragment,null,o()("div",{style:rc.optionRowStyle,onClick:()=>{s.setState({...s.state,alternatives:t?c().without(d,e):[...d,e]})}},e,o()(Vt.Z,{checked:t,size:14}),o()("span",{style:{marginLeft:4}},void 0,this.renderMessageForAlternative(e))),"other"===e&&t&&o()(lt.Z,{style:rc.inlineInputStyle,autoFocus:!0,value:u,placeholder:Te.default.formatMessage(ac.alternativeOtherPlaceholder),onChange:e=>{s.setState({...s.state,alternativeOther:e.target.value})}}))}))),o()("div",{style:rc.surveySectionStyle},void 0,o()("h4",{style:rc.subheaderStyle},void 0,o()(y.FormattedMessage,{id:"churnSurveyMenu.otherFeedback.title",defaultMessage:"3. Any other feedback for us?"})),o()(lt.Z,{textarea:!0,style:{marginTop:4},value:p,placeholder:Te.default.formatMessage(ac.otherFeedbackPlaceholder),onChange:e=>{s.setState({...s.state,otherFeedback:e.target.value})}})),o()("div",{style:{padding:"20px 24px",marginTop:20,borderTop:"1px solid ".concat(this.theme.lightDividerColor)}},void 0,o()("h4",{style:rc.subheaderStyle},void 0,o()(y.FormattedMessage,{id:"churnSurveyMenu.continueDowngrade.title",defaultMessage:"Continue downgrade?"})),o()("p",{style:{margin:"4px 0 20px",lineHeight:1.4}},void 0,o()(y.FormattedMessage,"personal"===t?{id:"churnSurveyMenu.continueDowngrade.downgradeMessage.personal",defaultMessage:"If you cancel now, you'll still enjoy all the features of your paid plan until {periodEnd}. You can resubscribe or switch to another paid plan anytime.{br}After {periodEnd}, this workspace will be downgraded to the free Personal plan, with these restrictions: <li>Single-person use</li><li>Guest limit of 5 per workspace</li><li>Upload files up to 5 MB</li><li>No version history</li><li>No member shared workspace</li>",values:{periodEnd:o()("span",{style:{fontWeight:600}},void 0,g),br:o()("div",{style:{height:8}}),li:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()("ul",{style:rc.restrictionListItemStyle},void 0,o()("li",{},void 0,t))}}}:{id:"churnSurveyMenu.continueDowngrade.downgradeMessage.team",defaultMessage:"If you cancel now, you'll still enjoy all the features of your paid plan until {periodEnd}. You can resubscribe or switch to another paid plan anytime.{br}After {periodEnd}, this workspace will be downgraded to a free trial of the Team Plan, with these restrictions: <li>1,000 block limit</li><li>Upload files up to 5 MB</li><li>No version history</li><li>No bulk exports</li><li>No advanced permissions</li><li>No permission groups</li>",values:{periodEnd:o()("span",{style:{fontWeight:600}},void 0,g),br:o()("div",{style:{height:8}}),li:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()("ul",{style:rc.restrictionListItemStyle},void 0,o()("li",{},void 0,t))}}})),o()("div",{style:{display:"flex"}},void 0,o()(jt.Z,{isRed:!0,onClick:this.handleAccept},void 0,o()(y.FormattedMessage,{id:"churnSurveyMenu.downgradeButton.title",defaultMessage:"Downgrade"})),o()(jt.Z,{onClick:i,style:{marginLeft:12}},void 0,o()(y.FormattedMessage,{id:"churnSurveyMenu.cancelButton.title",defaultMessage:"Cancel"})))))}renderMessageForReason(e){return"not_using_enough"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.reasons.notUsingEnough",defaultMessage:"Not using it enough"}):"too_difficult"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.reasons.toDifficult",defaultMessage:"Too difficult to use"}):"trial_over"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.reasons.trialOver",defaultMessage:"Trial is over"}):"too_expensive"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.reasons.tooExpensive",defaultMessage:"Too expensive"}):"security_compliance_requirements"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.reasons.securityComplianceRequirements",defaultMessage:"Security or compliance requirements"}):"company_shutting_down"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.reasons.companyShuttingDown",defaultMessage:"Company is shutting down or making cuts"}):"upgraded_by_mistake"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.reasons.upgradedByMistake",defaultMessage:"Upgraded by mistake"}):"using_alternative"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.reasons.usingAlternative",defaultMessage:"Using an alternative"}):"missing_features"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.reasons.missingFeatures",defaultMessage:"Missing features"}):"other"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.reasons.other",defaultMessage:"Other"}):void(0,H.t1)(e)}renderMessageForAlternative(e){return"google_drive_docs"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.alternatives.googleDriveDocs",defaultMessage:"Google Drive / Docs"}):"asana"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.alternatives.asana",defaultMessage:"Asana"}):"trello"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.alternatives.trello",defaultMessage:"Trello"}):"microsoft_office"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.alternatives.microsoftOffice",defaultMessage:"Microsoft 365 / Office"}):"atlassian_confluence"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.alternatives.atlassianConfluence",defaultMessage:"Confluence"}):"atlassian_jira"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.alternatives.atlassianJira",defaultMessage:"Jira"}):"airtable"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.alternatives.airtable",defaultMessage:"Airtable"}):"coda"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.alternatives.coda",defaultMessage:"Coda"}):"dropbox_paper"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.alternatives.dropboxPaper",defaultMessage:"Dropbox Paper"}):"quip"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.alternatives.quip",defaultMessage:"Quip"}):"evernote"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.alternatives.evernote",defaultMessage:"Evernote"}):"other"===e?o()(y.FormattedMessage,{id:"churnSurveyMenu.alternatives.other",defaultMessage:"Other"}):void(0,H.t1)(e)}getDescriptionStyle(){return{margin:0,color:this.theme.mediumTextColor,marginBottom:8}}}l()(rc,"optionRowStyle",{display:"flex",alignItems:"center",cursor:"pointer",marginBottom:4}),l()(rc,"restrictionListItemStyle",{paddingLeft:20,margin:"6px 0"}),l()(rc,"surveySectionStyle",{padding:"8px 24px"}),l()(rc,"headerStyle",{margin:0,marginBottom:8}),l()(rc,"subheaderStyle",{margin:0,marginTop:8,fontSize:16,fontWeight:600}),l()(rc,"inlineInputStyle",{marginBottom:12,marginLeft:18,width:"calc(100% - 18px)"});const lc=rc;var dc=i(7678),cc=i(95256);const uc={"en-US":{enterpriseContact:"https://notionup.typeform.com/to/FbZ6Tk",enterpriseTrial:"https://notionup.typeform.com/to/OHk8LR",startupFounder:"https://notionup.typeform.com/to/HgYsu8",startupPartner:"https://notionup.typeform.com/to/XEqmGB",nonprofit:"https://notionup.typeform.com/to/nlhrVv",apiPrivateBeta:"https://notionup.typeform.com/to/dSurQQp2"},"ko-KR":{enterpriseContact:"https://notionup.typeform.com/to/K5knuI18",enterpriseTrial:"https://notionup.typeform.com/to/XkdAkTfV",startupFounder:"https://notionup.typeform.com/to/DYAiiu7x",startupPartner:"https://notionup.typeform.com/to/GfPkKEJZ",nonprofit:"https://notionup.typeform.com/to/cSKAL2LL",apiPrivateBeta:"https://notionup.typeform.com/to/dSurQQp2"}};const mc=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()("p",{style:{marginTop:8,marginBottom:8}},void 0,1===t.length?t[0]:m().Children.toArray(t))},pc=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()(ao.Z,{external:!0,href:(0,V.UY)("guides.guides")},void 0,t)},gc=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()(ao.Z,{external:!0,href:(0,V.UY)("guides.billingAndPayment")},void 0,t)};function hc(e,t,i){!async function(e){const t=uc[ss.SP][e.typeform];let i={};e.params&&(i={...i,...e.params});const n=t+"?".concat(Object.keys(i).map((e=>"".concat(e,"=").concat(i[e]))).join("&"));M.trackOpenTypeform(e.environment,{from:e.frontContext,typeform_name:e.typeform}),await(0,cc.Z)("https://embed.typeform.com/embed.js"),window.typeformEmbed.makePopup(n,{hideHeaders:!0,hideFooter:!1}).open()}({environment:e,typeform:"enterpriseContact",frontContext:t,params:{source:i}})}const fc={general:function(e){return[{question:o()(y.FormattedMessage,{id:"faq.freeVsPersonalAndTeam.question",defaultMessage:"How is the free Personal Plan different from the Personal Pro and Team Plans?"}),answer:o()(y.FormattedMessage,{id:"faq.freeVsPersonalAndTeam.answer",defaultMessage:'<p>The biggest difference is how you can collaborate with others.</p><p>The free Personal Plan is designed for individual use, but allows up to 5 unique guests. These are friends, family members, and others you can invite to collaborate with you privately on any page. You can also share a page publicly and turn on commenting or editing access. In the Share menu at the top right, turn on "Share to web" then "Allow editing." Any Notion user with the link will be able to edit your page.</p><p>With the Personal Pro Plan, you can invite unlimited guests for private collaboration. For example, if you run your own business, you can invite all your clients to provide feedback on your work. </p><p>With the Team Plan, you can add members to your workspace so you all share and work on the same content. It also comes with more permission and admin controls so you and your teammates can work together securely. See the plan comparison chart for more details.</p>',values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.overGuestLimitInFreePlan.question",defaultMessage:"What happens when I go over the guest limit on my Personal Plan?"}),answer:o()(y.FormattedMessage,{id:"faq.overGuestLimitInFreePlan.answer",defaultMessage:"<p>Upgrade to the Personal Pro Plan for unlimited guests, or the Team Plan if you collaborate with the same group of people automatically. You can also review and remove inactive guests in Settings & Members.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.teamTrial.question",defaultMessage:"How do I try out the Team Plan for free?"}),answer:o()(y.FormattedMessage,{id:"faq.teamTrial.answer",defaultMessage:"<p>When asked how you would like to set up Notion during sign up, select Team, and you’ll be automatically enrolled in a Team Plan trial. You’ll get access to most features of a paid Team Plan, with a 1,000 block storage limit. If your team wants to add more than that, upgrade to the full Team Plan. Details above.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.overStorageLimitInFreePlan.question",defaultMessage:"What happens when I go over the block storage limit on my Team trial?"}),answer:o()(y.FormattedMessage,{id:"faq.overStorageLimitInFreePlan.answer",defaultMessage:"<p>You can still read, edit, and organize existing content blocks as usual, but you won’t be able to add new content blocks.</p><p>However, you can delete existing content blocks to free up your storage.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.useNotionForFree.question",defaultMessage:"Can I use Notion for free?"}),answer:o()(y.FormattedMessage,{id:"faq.useNotionForFree.answer",defaultMessage:"<p>Absolutely! Notion is free to use indefinitely.</p><p>The Personal Plan is completely free for individual use. The Team Plan has a free trial with a 1,000 block limit, more than enough to try out Notion with your team before upgrading.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.whatIsABlock.question",defaultMessage:"What is a block?"}),answer:o()(y.FormattedMessage,{id:"faq.whatIsABlock.answer",defaultMessage:"<p>A block is any single piece of content you add to your page, like a paragraph of text, a to-do item, an image, a code block, an embedded file, etc. Think of your page as being made up of these building blocks.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.deleteBlocks.question",defaultMessage:"Can I delete blocks to free up my storage?"}),answer:o()(y.FormattedMessage,{id:"faq.deleteBlocks.answer",defaultMessage:"<p>Of course! It works just like the storage limit on your phone or computer. If you delete something, you will free up space for more.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.studentDiscount.question",defaultMessage:"Do you offer student discounts?"}),answer:o()(y.FormattedMessage,{id:"faq.studentDiscount.answer",defaultMessage:"<p>The Personal Pro Plan is free for students and educators. This lets you collaborate with unlimited guests and gives you version history. Simply sign up with your school email address and you’ll immediately gain access to these features.</p><p>If you’re already on a Personal Pro Plan, change the email associated with your account to your school email address to get it for free. If you're already on our free Education Plan, you've been automatically upgraded to the Personal Pro Plan.</p><p><helpcenterlink>Visit the help center to learn more</helpcenterlink></p>",values:{p:mc,helpcenterlink:pc}})},{question:o()(y.FormattedMessage,{id:"faq.howToEarnCredit.question",defaultMessage:"How do I earn credit?"}),answer:o()(y.FormattedMessage,{id:"faq.howToEarnCredit.answer",defaultMessage:"<p>You can earn credit by using Notion across your devices and trying out new features. Go to the Earn Credit tab in Settings & Members to learn more.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.howToApplyCredit.question",defaultMessage:"How do I apply credit to my workspace?"}),answer:o()(y.FormattedMessage,{id:"faq.howToApplyCredit.answer",defaultMessage:"<p>To apply credit, you must first upgrade to a paid plan. As part of this process, you can choose to apply some or all of your account credit to the plan.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.whyBillingInformation.question",defaultMessage:"Why do you need my billing information if I have enough credit to pay for Notion?"}),answer:o()(y.FormattedMessage,{id:"faq.whyBillingInformation.answer",defaultMessage:"<p>We still require your billing information, even if you applied enough credit to make your first bill $0, because you may run out of credit in the future and we need to be able to charge your account.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.runOutOfCredit.question",defaultMessage:"What happens if I run out of credit?"}),answer:o()(y.FormattedMessage,{id:"faq.runOutOfCredit.answer",defaultMessage:"<p>If you run out of credit, your account will be charged via your selected payment method.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.maximumEarnedCredit.question",defaultMessage:"Is there a maximum amount of credit I can earn?"}),answer:o()(y.FormattedMessage,{id:"faq.maximumEarnedCredit.answer",defaultMessage:"<p>Yes, you can earn up to {maximumAmountInDollars} in credit.</p>",values:{p:mc,maximumAmountInDollars:(0,tr.Dx)({amount:dc.cw,currency:"dollar",intl:Te.default.getIntl()})}})},{question:o()(y.FormattedMessage,{id:"faq.advancedPermissions.question",defaultMessage:"What advanced permissions does the paid Team & Enterprise Plans offer?"}),answer:o()(y.FormattedMessage,{id:"faq.advancedPermissions.answer",defaultMessage:'<p>If you are on a free Team trial, you can set the access level on each page to "Full access," "Can view," or "Can comment." That dictates how other users can interact with that page. "Full access" means someone can edit, comment, and share the page with others.</p><p>On paid Team and Enterprise Plans, you have the ability to grant "Can edit" access to other users. This gives someone the ability to edit and comment on that page, but not share it with others. This is especially useful if you do not want your content leaking outside your team.</p><p><contactsales>Contact sales to learn more</contactsales></p>',values:{p:mc,contactsales:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return o()(ao.Z,{onClick:()=>hc(e,"faq","Advanced permissions")},void 0,i)}}})},{question:o()(y.FormattedMessage,{id:"faq.teamAdminTools.question",defaultMessage:"What admin tools come with the Team Plan? "}),answer:o()(y.FormattedMessage,{id:"faq.teamAdminTools.answer",defaultMessage:"<p>On a free Team trial, every member in your workspace is an admin. This means all of you can adjust team settings and invite other people into the workspace.</p><p>If you want only a few people to have admin abilities, we recommend upgrading to the full Team Plan. It comes with tools that allow you to make only select people admins while everyone else is a member. Members can't edit billing information or security options, and can't share your content outside the workspace.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.personalPricing.question",defaultMessage:"How is pricing calculated for the Personal Pro Plan?"}),answer:o()(y.FormattedMessage,{id:"faq.personalPricing.answer",defaultMessage:"<p>If you upgrade your workspace to Personal Pro, you will be charged a flat fee ($5 monthly or $48 yearly).</p><p>Guests are free of charge, but they can only be added to one page at a time.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.teamPricing.question",defaultMessage:"How is pricing calculated for the Team Plan?"}),answer:o()(y.FormattedMessage,{id:"faq.teamPricing.answer",defaultMessage:'<p>If you upgrade your workspace to the Team Plan, you will be charged a fee per member ($10 monthly or $96 yearly). For example, if you pay per month and have 5 members, you will be charged $50 each month.</p><p>Guests are free of charge – but they can only access individual pages they are invited to. In other words, guests won’t be able to see all the team pages under the "Workspace" section in the left sidebar.</p>',values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.monthlyAndYearlyBilling.question",defaultMessage:"Do you have monthly and yearly billing options?"}),answer:o()(y.FormattedMessage,{id:"faq.monthlyAndYearlyBilling.answer",defaultMessage:"<p>Yes! We offer both monthly and yearly billing options. The yearly billing option is always cheaper (an estimated 20% discount). For example, the Team Plan is $10 per member per month when you choose the monthly option, but $8 per member per month if you choose to pay yearly.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.addingAndRemovingMembers.question",defaultMessage:"How does adding and removing members work?"}),answer:o()(y.FormattedMessage,{id:"faq.addingAndRemovingMembers.answer",defaultMessage:"<p>Whether you're on a monthly or yearly billing schedule, your account may be charged on a monthly basis if you make these types of changes. If you added members, your account will be charged a prorated amount based on the percentage of the billing cycle left at the time each member was added. If you removed members, your account will be credited in the same way.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.changePlans.question",defaultMessage:"What happens when I change plans?"}),answer:o()(y.FormattedMessage,{id:"faq.changePlans.answer",defaultMessage:"<p>Upgrading or downgrading your plan works similarly to adding and removing members. Your account will be charged or credited based on the percentage of the billing cycle left at the time the plan was changed.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.cancelPlan.question",defaultMessage:"How do I cancel my paid plan?"}),answer:o()(y.FormattedMessage,{id:"faq.cancelPlan.answer",defaultMessage:'<p>Your Notion subscription, annual or monthly, will automatically renew until you cancel it. You can cancel your subscription by going to "Settings & members" in the left-hand sidebar on a desktop computer, then selecting "Plans," then "Downgrade." After you cancel, you’ll still have access to all the paid features until the end of your billing cycle.</p><p><billingandpaymentlink>More on billing & payment here</billingandpaymentlink></p>',values:{p:mc,billingandpaymentlink:gc}})},{question:o()(y.FormattedMessage,{id:"faq.paymentFailure.question",defaultMessage:"What happens if my payment fails? Like if my credit card expires?"}),answer:o()(y.FormattedMessage,{id:"faq.paymentFailure.answer",defaultMessage:"<p>Your account email will be notified after each failed payment. Payments may be retried up to 4 times within the next month. After this, if the payment did not succeed, you will be downgraded to the free plan.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.changePaymentMethod.question",defaultMessage:"Can I change my payment method?"}),answer:o()(y.FormattedMessage,{id:"faq.changePaymentMethod.answer",defaultMessage:"<p>You can change your payment method at any time in your billing settings.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.refund.question",defaultMessage:"How do refunds work?"}),answer:o()(y.FormattedMessage,{id:"faq.refund.answer",defaultMessage:"<p>Our refund policy is simple. If you believe you've made a mistake signing up for a paid Notion subscription online or in-app, please contact us inside the app or email team@makenotion.com. We'll be happy to refund you the full amount (not pro-rated) if you downgrade your subscription within 72 hours of signing up for monthly billing, or within 30 days of signing up for annual billing.</p><p>And if for any reason you're unhappy with Notion, please let us know at team@makenotion.com — we'd love to hear your feedback, and will be happy to work with you to create the best experience possible.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.mandatoryRefund.question",defaultMessage:"What if I live in a region with a mandatory refund policy?"}),answer:o()(y.FormattedMessage,{id:"faq.mandatoryRefund.answer",defaultMessage:"<p>If you live in the European Union, United Kingdom, or another region with a mandatory refund policy, you may be eligible for a monthly subscription refund past 72 hours. For example, customers in the European Union can receive a full refund for a monthly subscription within 14 days of purchase, rather than 72 hours.</p><p>To request a refund, please contact us inside the app or email team@makenotion.com. If you live in a region with a mandatory refund policy, please let us know and we'll be happy to assist you.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.serviceLevelAgreement.question",defaultMessage:"Do you have a Service-Level Agreement (SLA)?"}),answer:o()(y.FormattedMessage,{id:"faq.serviceLevelAgreement.answer",defaultMessage:"<p>We do not offer a standard SLA. For teams with greater than 100 members, we can offer a custom SLA.</p><p><contactsales>Contact sales to learn more</contactsales></p>",values:{p:mc,contactsales:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return o()(ao.Z,{onClick:()=>hc(e,"faq","SLA")},void 0,i)}}})},{question:o()(y.FormattedMessage,{id:"faq.importStorageLimit.question",defaultMessage:"How does importing content from another app affect my block storage limit if I'm on the Team Plan trial?"}),answer:o()(y.FormattedMessage,{id:"faq.importStorageLimit.answer",defaultMessage:"<p>Content created via import doesn’t count toward your workspace’s storage limit. We want to make sure you get started with Notion as smoothly as possible.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.paymentProcessor.question",defaultMessage:"How is my payment being processed?"}),answer:o()(y.FormattedMessage,{id:"faq.paymentProcessor.answer",defaultMessage:"<p>We use Stripe to process your payment. It’s the same payment provider used by products such as Twitter, Pinterest, and Lyft. We do not handle your credit card information directly.</p>",values:{p:mc}})},{question:o()(y.FormattedMessage,{id:"faq.multipleTeams.question",defaultMessage:"Can I belong to multiple teams on Notion? "}),answer:o()(y.FormattedMessage,{id:"faq.multipleTeams.answer",defaultMessage:"<p>Yes! You can use the same email address to create and join multiple teams. However, each one of these workspaces is on its own plan and needs to be upgraded individually.</p>",values:{p:mc}})}]}};class vc extends p.Z{constructor(){super(...arguments),l()(this,"renderFaqItem",((e,t)=>o()(u.Fragment,{},t,o()("div",{style:vc.questionStyle},void 0,e.question),o()("div",{style:this.getAnswerStyle()},void 0,e.answer)))),l()(this,"handleHelpButtonClick",(()=>{ps.j({environment:this.environment,from:"pricing"})}))}renderComponent(){return o()("div",{style:{maxWidth:600}},void 0,this.getFaqList().map(((e,t)=>this.renderFaqItem(e,t))),o()("div",{style:{color:this.props.isSettings?this.theme.mediumTextColor:g.ZP.frontTextMedium}},void 0,this.props.cta?"intercom"===this.props.cta?this.renderIntercomCTA():this.renderGuidesCTA():null))}renderIntercomCTA(){var e=this;return o()(y.FormattedMessage,{id:"faqList.moreQuestionsTextIntercom",defaultMessage:"Still have more questions? <messagelink>Message support</messagelink>",values:{messagelink:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return o()(ao.Z,{onClick:e.handleHelpButtonClick},void 0,i)}}})}renderGuidesCTA(){return o()(y.FormattedMessage,{id:"faqList.moreQuestionsTextHelpCenter",defaultMessage:"Still have more questions? Learn more in our <messagelink>help center</messagelink>.",values:{messagelink:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()(ao.Z,{href:(0,V.UY)("guides.guides")},void 0,t)}}})}getFaqList(){return fc[this.props.type](this.environment)}getAnswerStyle(){return{color:this.props.isSettings?this.theme.mediumTextColor:g.ZP.frontTextMedium,marginBottom:"1.5rem",lineHeight:1.5}}}l()(vc,"questionStyle",{fontWeight:v.Z.fontWeight.semibold,marginBottom:4});const yc=vc;const Sc=function(e){return!!e.device.isMobile||e.WindowSizeStore.state.width<960};var bc=i(66205);class Mc extends p.Z{renderComponent(){const e="yearly"===ec.state.termType?"monthly":"yearly";return o()("div",{style:Mc.getTermToggleStyle(this.theme),onClick:()=>{M.trackFrontTogglePricingTerm(this.environment,{from:"pricing_grid_top",toggle_to:e}),ec.setState({...ec.state,termType:e})}},void 0,o()("div",{style:{marginRight:8}},void 0,o()(y.FormattedMessage,{id:"pricingGrid.pricingTermToggle.payAnnually.label",defaultMessage:"Pay annually"})),o()(es.Z,{on:"monthly"===ec.state.termType}),o()("div",{style:{marginLeft:8}},void 0,o()(y.FormattedMessage,{id:"pricingGrid.pricingTermToggle.payMonthly.label",defaultMessage:"Monthly"})))}static getTermToggleStyle(e){return{cursor:"pointer",fontSize:14,color:e.mediumTextColor,display:"flex",alignItems:"center",marginBottom:8}}}const wc=Mc,Cc=["free","personal","team","business","enterprise"];class kc extends p.Z{willMount(e){const t=T.XX(e.data);t&&e.data&&ec.setState({termType:"year"===t.interval?"yearly":"monthly"})}renderComponent(){const e="on"===re.default.getGroup("show-business-plan"),t=(0,rl.Sl)({showingBusinessPlan:e});return o()("div",{},void 0,o()("table",{style:kc.getTableStyle()},void 0,this.renderHeader(e),o()("tbody",{},void 0,t.map(((e,t)=>this.renderSection(e,t))))))}renderCheck(){return h.Z.thinCheck({display:"inline",height:12,width:12,color:this.theme.regularTextColor})}upgradeLink(e,t){const{planState:i}=this.props;if(i)return o()(ao.Z,{onClick:i.plans[e].onClick,style:{fontSize:12,fontWeight:500,textDecoration:"none",color:this.theme.mediumTextColor,lineHeight:1.2}},void 0,t||o()(y.FormattedMessage,{id:"pricingGrid.planAttribute.button.upgrade",defaultMessage:"Upgrade"}))}renderPlanContent(e){const{label:t,upgradeCta:i,upgradeCTALabel:n}=e;return t&&i?o()(u.Fragment,{},void 0,t,o()("br",{}),this.upgradeLink(i,n)):t||(i?o()(u.Fragment,{},void 0,o()(y.FormattedMessage,{id:"pricingGrid.planAttribute.notInTrial",defaultMessage:"Not in trial"}),o()("br",{}),this.upgradeLink(i,n)):this.renderCheck())}renderPlan(e,t,i){return o()("td",{style:{...kc.getRowStyle(this.theme),...kc.getValueStyle(),...kc.getActiveStyle(this.theme,this.isPlanActive(e)),...this.getBorderStyle(e)}},void 0,i.hasFeature&&o()(Ue.Z,{delayThreshold:0,placement:Ue.Z.Placement.Right,renderTooltip:()=>(0,rl.O_)(t),textWrap:!0,render:e=>m().createElement("div",a()({style:{cursor:"help",lineHeight:1.3,padding:"6px 0"}},e),this.renderPlanContent(i))}))}renderItem(e,t){const i="auto",n=this.props.planState&&this.props.planState.isTeamTrial,s="on"===re.default.getGroup("show-business-plan");return o()("tr",{},"table-row-".concat(t),o()("td",{style:{...kc.getRowStyle(this.theme),...kc.getRowLabelStyle(this.theme),width:i,maxWidth:i,minWidth:i}},void 0,o()(Ue.Z,{delayThreshold:0,placement:Ue.Z.Placement.Right,renderTooltip:()=>(0,rl.O_)(e.tooltip),textWrap:!0,render:t=>m().createElement("span",a()({},t,{style:kc.getTooltipInnerStyle()}),e.label,e.isComingSoon&&this.renderBadge("comingSoon"),e.isBeta&&this.renderBadge("beta"))})),Cc.map((t=>{const i="team"===t&&n?"teamTrial":t;if((s||"business"!==t)&&(!s||"personal"!==t))return this.renderPlan(t,e.tooltip,e.plans[i])})))}renderEmptyTableCell(e,t){return o()("td",{style:{...kc.getSectionStyle(this.theme,t),...kc.getValueStyle(),...kc.getActiveStyle(this.theme,this.isPlanActive(e)),...this.getBorderStyle(e),color:g.ZP.lightTextColor,fontWeight:400}})}renderEmptyTableCells(e){return o()(u.Fragment,{},void 0,Cc.map((t=>this.renderEmptyTableCell(t,e))))}renderSection(e,t){const i="auto";return o()(u.Fragment,{},"table-section-".concat(t),o()("tr",{},void 0,o()("td",{style:{...kc.getSectionStyle(this.theme,t),width:i,maxWidth:i,minWidth:i}},void 0,e.label),this.renderEmptyTableCells(t)),e.items.map(((e,t)=>this.renderItem(e,t))))}renderButton(e,t){const i=t.plans[e],n="notion-pricing-grid-upgrade-".concat(e);let s;switch(i.buttonType){case"current":s=o()(y.FormattedMessage,{id:"pricingGrid.currentPlanButton.label",defaultMessage:"Current"});break;case"upgrade":s=o()(y.FormattedMessage,{id:"pricingGrid.upgradePlanButton.label",defaultMessage:"Upgrade"});break;case"downgrade":s=o()(y.FormattedMessage,{id:"pricingGrid.downgradePlanButton.label",defaultMessage:"Downgrade"});break;case"will-downgrade":s=o()(y.FormattedMessage,{id:"pricingGrid.willDowngradePlanButton.label",defaultMessage:"Future plan"});break;case"resubscribe":s=o()(y.FormattedMessage,{id:"pricingGrid.resubscribePlanButton.label",defaultMessage:"Resubscribe"});break;default:H.t1(i.buttonType)}if("current"===i.buttonType)return this.renderDisabledButtonWithTooltip({tooltip:o()(y.FormattedMessage,{id:"pricingGrid.currentPlan.tooltip",defaultMessage:"This is your current active plan"}),label:o()(y.FormattedMessage,{id:"pricingGrid.currentPlan.largeScreenLabel",defaultMessage:"Current plan"}),buttonClassName:n,wrapTooltip:!1});if(!t.canSwitchPlans){let e;return e=t.isInAppPurchase?o()(y.FormattedMessage,{id:"pricingGrid.switchPlanFromInAppPurchase.tooltip",defaultMessage:"You're currently subscribed through an in-app purchase with Apple. To switch plans, cancel your subscription with Apple first."}):o()(y.FormattedMessage,{id:"pricingGrid.switchPlanAsMember.tooltip",defaultMessage:"You need to be an administrator of this workspace to switch plans."}),this.renderDisabledButtonWithTooltip({tooltip:e,label:s,buttonClassName:n,wrapTooltip:!0})}return("personal"===e||"free"===e)&&t.memberCount>1?this.renderDisabledButtonWithTooltip({tooltip:o()(y.FormattedMessage,{id:"pricingGrid.switchToPersonalPlanButton.tooltip",defaultMessage:"The Personal and Personal Pro Plans are only available for 1-person use. If you'd like to use these plans, please remove the other members in this workspace."}),label:s,buttonClassName:n,wrapTooltip:!0}):"will-downgrade"===i.buttonType?this.renderDisabledButtonWithTooltip({tooltip:o()(y.FormattedMessage,{id:"pricingGrid.willDowngradePlan.tooltip",defaultMessage:"This is the plan after your current plan expires"}),label:o()(y.FormattedMessage,{id:"pricingGrid.willDowngradePlan.largeScreenLabel",defaultMessage:"Future plan"}),buttonClassName:n,wrapTooltip:!1}):"downgrade"===i.buttonType?o()(jt.Z,{isLarge:!0,style:{width:"100%"},onClick:()=>{M.trackPricingGridButtonClick(this.environment,{plan:e,from:"pricing_grid_top",button_text:i.buttonType}),i.onClick()},className:n},void 0,s):o()(Ee.Z,{isLarge:!0,style:{width:"100%"},onClick:()=>{M.trackPricingGridButtonClick(this.environment,{plan:e,from:"pricing_grid_top",button_text:i.buttonType}),i.onClick()},className:n},void 0,s)}renderDisabledButtonWithTooltip(e){const{tooltip:t,label:i,buttonClassName:n,wrapTooltip:s}=e;return o()(Ue.Z,{style:{width:s?320:"auto"},textWrap:s,renderTooltip:()=>t,render:e=>m().createElement(jt.Z,a()({style:{width:"100%",opacity:.5},isLarge:!0,disabled:!0},e,{className:n}),i)})}renderSalesContactLink(){return o()(ao.Z,{onClick:()=>{const{currentUserStore:e}=F.default.state,t=e&&e.getValue();M.trackContactSalesClick(this.environment),bc.Z.setState({open:!0,email:t&&t.email,name:t&&(0,Ce.Nz)(this.props.intl,t)})}},void 0,o()("div",{style:kc.getUpgradeButtonBelowLinkStyle()},void 0,o()(y.FormattedMessage,{id:"pricingGrid.contactSalesLink",defaultMessage:"Contact sales"})))}renderTeamTrialIndicator(){return o()(Ue.Z,{delayThreshold:0,placement:Ue.Z.Placement.Bottom,renderTooltip:()=>o()(y.FormattedMessage,{id:"pricingGrid.inTeamTrial.tooltip",defaultMessage:"Your current Team trial has a 1,000 block limit. Upgrade to go unlimited."}),textWrap:!0,style:{width:280},render:e=>m().createElement("div",a()({style:{...kc.getUpgradeButtonBelowLinkStyle(),fontWeight:500,display:"flex",flexDirection:"row",cursor:"help"}},e),o()("div",{style:{paddingRight:4,paddingTop:2}},void 0,this.renderCheck()),o()("div",{},void 0,o()(y.FormattedMessage,{id:"pricingGrid.inTeamTrial",defaultMessage:"In free trial"})))})}static renderTeamTrialButton(e){if(e.isActive&&"resubscribe"===e.buttonType)return;const t="current"===e.buttonType?o()(y.FormattedMessage,{id:"pricingGrid.cancelPlanLink",defaultMessage:"Cancel plan"}):o()(y.FormattedMessage,{id:"pricingGrid.teamTrialLink",defaultMessage:"Try for free"});return o()(ao.Z,{onClick:e.onClickTeamFree},void 0,o()("div",{style:kc.getUpgradeButtonBelowLinkStyle()},void 0,t))}getPlanName(e){const{intl:t}=this.props;switch(e){case"free":return t.formatMessage({id:"pricingGrid.personalFreePlanColumn.header",defaultMessage:"Personal"});case"personal":return t.formatMessage({id:"pricingGrid.personalProPlanColumn.header",defaultMessage:"Personal Pro"});case"team":return t.formatMessage({id:"pricingGrid.teamPlanColumn.header",defaultMessage:"Team"});case"business":return t.formatMessage({id:"pricingGrid.businessPlanColumn.header",defaultMessage:"Business",description:"Shown in our plans page in settings to describe the business plan type."});case"enterprise":return t.formatMessage({id:"pricingGrid.enterprisePlanColumn.header",defaultMessage:"Enterprise"});default:H.t1(e)}}renderHeaderTitle(e){const t=this.getPlanName(e.plan);return o()("td",{style:{...kc.getHeaderStyle(),...kc.getActiveStyle(this.theme,this.isPlanActive(e.plan)),...this.getBorderStyle(e.plan)}},void 0,o()("div",{style:this.getHeaderTitleStyle()},void 0,t),void 0!==e.price&&o()("div",{style:{display:Sc(this.environment)?"block":"flex"}},void 0,o()("div",{style:kc.getHeaderPriceStyle()},void 0,e.price),void 0!==e.terms&&o()("div",{style:this.getHeaderTermsStyle(this.theme)},void 0,(0,rl.X6)(this.props.intl,e.terms))))}renderHeaderLabels(e){const t=this.isPlanActive("team")||this.isPlanActive("business")||this.isPlanActive("enterprise");return o()("tr",{},void 0,o()("td",{style:{width:"28%"}}),o()("td",{style:{...this.getHeaderLabelStyle(!t,e,!1),...this.getBorderStyle("free"),borderLeft:"1px solid ".concat(this.theme.lightDividerColor)},colSpan:e?1:2},void 0,o()(y.FormattedMessage,{id:"pricingGrid.personalPlans.label",defaultMessage:"For individuals"})),o()("td",{style:{...this.getHeaderLabelStyle(t,e,!0),...this.getBorderStyle("enterprise")},colSpan:e?3:2},void 0,o()(y.FormattedMessage,{id:"pricingGrid.teamPlans.label",defaultMessage:"For teams & businesses"})))}renderHeaderTitles(e){const t=ec.state.termType,i=(0,rl.MZ)(Kt.Z,this.props.intl);return o()("tr",{},void 0,o()("td",{}),this.renderHeaderTitle({plan:"free",price:i.price[t].personal,image:tc.Z.images.pricing.pricingFreeV2Png}),!e&&this.renderHeaderTitle({plan:"personal",price:i.price[t].pro,image:tc.Z.images.pricing.pricingPersonalV2Png,terms:i.terms.pro}),this.renderHeaderTitle({plan:"team",price:i.price[t].team,image:tc.Z.images.pricing.pricingTeamV2Png,terms:i.terms.team}),e&&this.renderHeaderTitle({plan:"business",price:i.price[t].business,image:tc.Z.images.pricing.pricingEnterpriseV2Png,terms:i.terms.business}),this.renderHeaderTitle({plan:"enterprise",price:i.price[t].enterprise,image:tc.Z.images.pricing.pricingEnterpriseV2Png,terms:i.terms.enterprise}))}renderHeaderAction(e,t){const{planState:i}=this.props;if(i&&(t||"business"!==e)&&(!t||"personal"!==e))return o()("td",{style:{...kc.getHeaderStyle(),...kc.getActiveStyle(this.theme,this.isPlanActive(e)),...this.getBorderStyle(e)}},void 0,this.renderButton(e,i),this.renderHeaderSubAction(e))}renderHeaderSubAction(e){if("enterprise"===e)return o()("div",{style:{marginTop:7}},void 0,this.renderSalesContactLink());if("team"===e){const{planState:t}=this.props;if(!t||!t.canSwitchPlans||t.plans.personal.isActive)return;return o()("div",{style:{marginTop:7}},void 0,t.isTeamTrial?this.renderTeamTrialIndicator():kc.renderTeamTrialButton(t.plans[e]))}}renderHeaderActions(e){if(this.props.planState)return o()("tr",{},void 0,o()("td",{style:{width:"28%",verticalAlign:"top",paddingTop:16}},void 0,o()(wc,{})),Cc.map((t=>this.renderHeaderAction(t,e))))}renderHeader(e){return o()("thead",{},void 0,this.renderHeaderLabels(e),this.renderHeaderTitles(e),this.renderHeaderActions(e))}renderBadge(e){return o()("div",{style:{background:this.theme.buttonHoveredBackground,fontSize:10,fontWeight:500,letterSpacing:"0.015em",color:this.theme.mediumTextColor,display:"inline",textTransform:"uppercase",padding:"2px 4px",marginLeft:6,borderRadius:3,whiteSpace:"nowrap",position:"relative",top:-1}},void 0,"comingSoon"===e&&o()(y.FormattedMessage,{id:"pricingGrid.comingSoonBadge",defaultMessage:"Coming soon"}),"beta"===e&&o()(y.FormattedMessage,{id:"pricingGrid.betaBadge",defaultMessage:"Beta"}))}isPlanActive(e){return Boolean(this.props.planState&&this.props.planState.plans[e].isActive)}static getTableStyle(){return{fontSize:14,width:"100%",tableLayout:"fixed",borderCollapse:"initial"}}static getSectionStyle(e,t){const i={borderBottom:"1px solid ".concat(e.regularDividerColor),paddingBottom:7,paddingRight:15,fontWeight:500,verticalAlign:"bottom"};return 0===t?{...i,paddingTop:0}:{...i,paddingTop:20}}static getUpgradeButtonBelowLinkStyle(){return{fontSize:12}}static getRowStyle(e){return{borderBottom:"1px solid ".concat(e.regularDividerColor)}}static getRowLabelStyle(e){return{color:e.mediumTextColor,paddingRight:10,paddingTop:5,paddingBottom:6,verticalAlign:"top"}}static getValueStyle(){return{paddingLeft:10,paddingRight:10,textAlign:"left",overflow:"hidden",verticalAlign:"top"}}static getActiveStyle(e,t){const i=e.cardSidebarBackground;return{background:t?i:g.ZP.transparent}}getBorderStyle(e){return{borderLeft:"1px solid ".concat(this.theme.lightDividerColor),borderRight:["enterprise"].includes(e)?"1px solid ".concat(this.theme.lightDividerColor):void 0}}getHeaderLabelStyle(e,t,i){let n="36%";return t&&(n=i?"54%":"18%"),{paddingLeft:10,paddingRight:10,verticalAlign:"top",width:n,paddingTop:10,fontWeight:700,fontSize:12,paddingBottom:10,borderBottom:e?"2px solid ".concat(this.theme.regularTextColor):"1px solid ".concat(this.theme.lightDividerColor),borderTop:"1px solid ".concat(this.theme.lightDividerColor)}}static getHeaderStyle(){return{paddingLeft:10,paddingRight:10,verticalAlign:"top",width:"18%",paddingTop:10}}getHeaderTitleStyle(){return{fontSize:16,fontWeight:Sc(this.environment)?500:700,lineHeight:1.3,marginBottom:2}}static getHeaderPriceStyle(){return{fontSize:20,marginRight:7}}static getTooltipInnerStyle(){return{cursor:"help",width:"100%",display:"inline-block"}}getHeaderTermsStyle(e){return{fontSize:10,lineHeight:1,color:e.mediumTextColor,width:70,paddingTop:Sc(this.environment)?0:3}}}const Tc=(0,y.injectIntl)(kc);var Ic=i(10644);class Zc extends p.Z{constructor(){super(...arguments),l()(this,"storeTypes",{store:sl,downgradeModalStore:ul}),l()(this,"renderChurnSurveyModal",(()=>{const e=this.stores.store.state,{data:t}=this.props,i=T.XX(t),n=T.CM(this.environment);if(!e.churnSurveyModalOpen||!n||!i)return;return"on"===re.default.getGroup("churn_survey")?o()(hl,{churnType:e.churnType,currentPlan:n,isWorkspaceDeletion:!1,periodEnd:i.periodEnd,customerId:i.customerId,onAccept:this.handleChurnSurveyModalAccept,onClose:this.handleChurnSurveyModalClose}):o()(lc,{churnType:e.churnType,periodEnd:i.periodEnd,onAccept:this.handleChurnSurveyModalAccept,onClose:this.handleChurnSurveyModalClose})})),l()(this,"handleFreeClick",(async()=>{const{data:e}=this.props;if(await new Promise((e=>{C.showDialog({showCancel:!0,keepFocus:!1,message:o()("div",{},void 0,o()("h4",{style:{margin:"8px 0 0"}},void 0,o()(y.FormattedMessage,{id:"subscriptSettings.freePersonal.downgradeTitle",defaultMessage:"Downgrade to the Personal Plan?"})),this.shouldShowTeamWarningDuringDowngrade()&&m().createElement(m().Fragment,null,o()("p",{},void 0,o()(y.FormattedMessage,{id:"subscriptionSettings.freePersonal.downgradeMessageWithTeamsSecondParagraph",defaultMessage:"Pages in the “Teamspaces” section will no longer be in your sidebar, but still be accessible via search and links.",description:"Downgrade message shown in confirmation modal."})),o()("p",{},void 0,o()("b",{},void 0,o()(y.FormattedMessage,{id:"subscriptionSettings.freePersonal.downgradeMessageWithTeamsThirdParagraph",defaultMessage:"We suggest you move them to the “Private” section before downgrading.",description:"Downgrade message shown in confirmation modal."}))))),items:[{label:o()(y.FormattedMessage,{id:"subscriptionSettings.freePersonal.downgradeConfirmationButton",defaultMessage:"Downgrade to Personal Plan"}),color:"red",onAccept:()=>{e(!0)}}],handleCancel:()=>{e(!1)}})}))){if(e&&"subscribed_admin"===e.type){if(!(await new Promise((e=>{const{store:t}=this.stores;t.setState({churnType:"free",churnSurveyModalOpen:!0,onAccept:()=>e(!0),onClose:()=>e(!1)})}))))return}await D.EO({environment:this.environment,spaceStore:this.props.spaceStore,planType:"personal",from:"space_settings-plans_tab"})}})),l()(this,"handlePersonalClick",(async e=>{const{spaceStore:t,data:i}=this.props,n=T.XX(i);if(this.shouldShowTeamWarningDuringDowngrade()){if(!(await new Promise((e=>{C.showDialog({showCancel:!0,keepFocus:!1,message:o()("div",{},void 0,o()("h4",{style:{margin:"8px 0 0"}},void 0,o()(y.FormattedMessage,{id:"subscriptSettings.personalPro.downgradeTitle",defaultMessage:"Downgrade to the Personal Pro Plan?",description:"Downgrade title shown in confirmation modal."})),o()("p",{},void 0,o()(y.FormattedMessage,{id:"subscriptionSettings.personalPro.downgradeMessage",defaultMessage:"Pages in the “Teamspaces” section will no longer be in your sidebar, but still be accessible via search and links.",description:"Downgrade message shown in confirmation modal."})),o()("p",{},void 0,o()("b",{},void 0,o()(y.FormattedMessage,{id:"subscriptionSettings.personalPro.downgradeMessageSuggestion",defaultMessage:"We suggest you move them to the “Private” section before downgrading.",description:"Downgrade message shown in confirmation modal."})))),items:[{label:o()(y.FormattedMessage,{id:"subscriptionSettings.personalPro.downgradeConfirmationButton",defaultMessage:"Downgrade to Personal Pro Plan",description:"Downgrade button shown in confirmation modal."}),color:"red",onAccept:()=>{e(!0)}}],handleCancel:()=>{e(!1)}})}))))return}if(n&&T.lr(i)){const i=bd.HA.personal[n.interval],o=T.CM(this.environment),s=o&&Xd.rC[o]<Xd.rC.personal;if(e&&!s&&void 0===n.canceledAt){const e=await new Promise((e=>{const{store:t}=this.stores;t.setState({churnType:"personal",churnSurveyModalOpen:!0,onAccept:()=>e(!0),onClose:()=>e(!1)})}));if(!e)return;e&&await D.Mg({environment:this.environment,spaceStore:t,plan:i,from:"space_settings-plans_tab"})}else await D.Mg({environment:this.environment,spaceStore:t,plan:i,from:"space_settings-plans_tab"})}else D.I0(this.environment,{subscriptionTier:"personal",from:"pricing_grid"})})),l()(this,"handleEducationPlanClick",(()=>{const{spaceStore:e}=this.props;D.r7({environment:this.environment,spaceStore:e})})),l()(this,"handleTeamClick",(async e=>{const{spaceStore:t,data:i}=this.props,n=T.XX(i),s=n&&void 0===n.canceledAt;let a;n&&s&&"enterprise"!==T.CM(this.environment)&&(a=this.props.intl.formatMessage({id:"spaceSubscriptionPlans.teamPlan.confirmMessage",defaultMessage:"You are about to subscribe to Notion's Team Plan for {price} per member per month.{br}You will be charged a prorated amount, minus any account balance."},{price:T._B({subscriptionTier:"team",billingInterval:"yearly"===ec.state.termType?"year":"month",intl:this.props.intl}),br:o()("br",{})}));const r=T.CM(this.environment),l=r&&Xd.rC[r]<Xd.rC.team,d="unsubscribed_admin"===i.type||"unsubscribed_member"===i.type||n&&n.canceledAt||l;if(a){if(!(await C.confirmUserAction({message:a,acceptLabel:this.props.intl.formatMessage({id:"spaceSubscriptionPlans.teamPlan.confirmButtonLabel",defaultMessage:"{upgrading, select, true {Upgrade to Team Plan} other {Downgrade to Team Plan}}"},{upgrading:d})})))return}if(n&&T.lr(i)){const i=bd.HA.team[n.interval];if(e&&!d){const e=await new Promise((e=>{const{store:t}=this.stores;t.setState({churnType:"team",churnSurveyModalOpen:!0,onAccept:()=>e(!0),onClose:()=>e(!1)})}));if(!e)return;e&&await D.Mg({environment:this.environment,spaceStore:t,plan:i,from:"space_settings-plans_tab"})}else await D.Mg({environment:this.environment,spaceStore:t,plan:i,from:"space_settings-plans_tab"})}else D.I0(this.environment,{subscriptionTier:"team",from:"pricing_grid"})})),l()(this,"handleTeamFreeClick",(async()=>{const{data:e}=this.props;if(e&&"subscribed_admin"===e.type){const e=await new Promise((e=>{const{store:t}=this.stores;t.setState({churnType:"team",churnSurveyModalOpen:!0,onAccept:()=>e(!0),onClose:()=>e(!1)})}));if(M.trackClickTeamCancelPlan(this.environment,{confirmed:e}),!e)return;e&&await D.EO({environment:this.environment,spaceStore:this.props.spaceStore,planType:"team",from:"space_settings-plans_tab"})}else if(e&&("unsubscribed_admin"===e.type||"unsubscribed_member"===e.type)){const e=await new Promise(((e,t)=>{C.showDialog({showCancel:!0,keepFocus:!1,message:o()("div",{},void 0,o()("h4",{style:{margin:"8px 0 0"}},void 0,o()(y.FormattedMessage,{id:"subscriptionSettings.freeTeam.upgradeTitle",defaultMessage:"Try the Team Plan for free"})),o()("p",{style:{margin:"8px 0"}},void 0,o()(y.FormattedMessage,{id:"subscriptionSettings.freeTeam.upgradeMessage",defaultMessage:"You'll get access to most features of a paid Team Plan, with a 1,000 block storage limit. Upgrade to go unlimited anytime."}))),items:[{label:o()(y.FormattedMessage,{id:"subscriptionSettings.startTeamTrialDialog.confirmationbutton",defaultMessage:"Start Team trial"}),color:"blue",onAccept:()=>{e(!0)}}],handleCancel:()=>{e(!1)}})}));if(M.trackClickTeamTryForFree(this.environment,{confirmed:Boolean(e)}),!e)return;e&&await D.EO({environment:this.environment,spaceStore:this.props.spaceStore,planType:"team",from:"space_settings-plans_tab"})}})),l()(this,"handleBusinessClick",(async()=>{const{spaceStore:e,data:t}=this.props,i=T.XX(t),n=i&&void 0===i.canceledAt;if(i&&n){const e=o()(y.FormattedMessage,{id:"subscriptionSettings.upgradeToBusinessDialog.message",defaultMessage:"You are about to subscribe to Notion's Business Plan for {price} per member per month.{br}You will be charged a prorated amount, minus any account balance.",values:{price:T._B({subscriptionTier:"business",billingInterval:"yearly"===ec.state.termType?"year":"month",intl:this.props.intl}),br:o()("br",{})},description:"Shown when a user is going to upgrade to a business plan type."});if(!(await C.confirmUserAction({message:e,acceptLabel:(0,T.gG)(i.plan)?o()(y.FormattedMessage,{id:"subscriptionSettings.downgradeToBusinessDialog.confirmationButton",defaultMessage:"Downgrade to Business Plan",description:"Shown when user is going to downgrade to a business plan type."}):o()(y.FormattedMessage,{id:"subscriptionSettings.upgradeToBusinessDialog.confirmationButton",defaultMessage:"Upgrade to Business Plan",description:"Shown when a user is going to upgrade to a business plan type."})})))return}if(i&&T.lr(t)){const t=bd.HA.business[i.interval];await D.Mg({environment:this.environment,spaceStore:e,plan:t,from:"space_settings-plans_tab"})}else D.I0(this.environment,{subscriptionTier:"business",from:"pricing_grid"})})),l()(this,"handleEnterpriseClick",(async()=>{const{spaceStore:e,data:t}=this.props,i=T.XX(t),n=i&&void 0===i.canceledAt;if(i&&n){const e=o()(y.FormattedMessage,{id:"subscriptionSettings.upgradeToEnterpriseDialog.message",defaultMessage:"You are about to subscribe to Notion's Enterprise Plan for {price} per member per month.{br}You will be charged a prorated amount, minus any account balance.",values:{price:T._B({subscriptionTier:"enterprise",billingInterval:"yearly"===ec.state.termType?"year":"month",intl:this.props.intl}),br:o()("br",{})}});if(!(await C.confirmUserAction({message:e,acceptLabel:o()(y.FormattedMessage,{id:"subscriptionSettings.upgradeToEnterpriseDialog.confirmationbutton",defaultMessage:"Upgrade to Enterprise Plan"})})))return}if(i&&T.lr(t)){const t=bd.HA.enterprise[i.interval];await D.Mg({environment:this.environment,spaceStore:e,plan:t,from:"space_settings-plans_tab"})}else D.I0(this.environment,{subscriptionTier:"enterprise",from:"pricing_grid"})})),l()(this,"handleChurnSurveyModalAccept",(()=>{const{store:e}=this.stores;e.state.churnSurveyModalOpen&&e.state.onAccept(),"on"!==re.default.getGroup("churn_survey")&&e.reset()})),l()(this,"handleChurnSurveyModalClose",(()=>{const{store:e}=this.stores;e.state.churnSurveyModalOpen&&e.state.onClose(),e.reset()}))}willMount(){D.bi(this.environment)}renderComponent(){return cn.Z.state.online?this.renderPlans():o()(Ic.Z,{})}renderPlans(){const{churnSurveyModalOpen:e}=this.stores.store.state,t="on"===re.default.getGroup("churn_survey");return o()("div",{style:Zc.wrapStyle},void 0,o()(Bd.Z,{style:Zc.scrollerStyle,type:Cd.Z.Y},void 0,this.renderSubscriptionInfo(),this.renderPricingGrid(),this.renderPriceDisclaimer(),this.allowEducationUpgrade()&&this.renderStudentUpgrade(),this.renderFAQ(),o()(Zn.Z,{innerStyle:{width:t?300:600,height:t?"auto":"80vh",overflow:"scroll"},open:e,render:this.renderChurnSurveyModal,onDismiss:this.handleChurnSurveyModalClose})))}renderPriceDisclaimer(){const{intl:e}=this.props;return o()("div",{style:Zc.priceDisclaimerStyle},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionPlans.priceDisclaimer",defaultMessage:"Prices shown are for annual billing. When billed month-to-month, the <b>Personal Pro Plan</b> is {personalMonthlyPrice} per month, the <b>Team Plan</b> is {teamMonthlyPrice} per member per month, and the <b>Enterprise Plan</b> is {enterpriseMonthlyPrice} per member per month.",values:{b:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()("b",{},void 0,t)},personalMonthlyPrice:(0,tr.Dx)({amount:Kt.Z.pricing.personal.monthlyPrice,currency:"dollar",intl:e}),teamMonthlyPrice:(0,tr.Dx)({amount:Kt.Z.pricing.team.monthlyPricePerMember,currency:"dollar",intl:e}),enterpriseMonthlyPrice:(0,tr.Dx)({amount:Kt.Z.pricing.enterprise.monthlyPricePerMember,currency:"dollar",intl:e})}}))}renderSubscriptionInfo(){const{spaceStore:e}=this.props,{data:t}=this.props;return"subscribed_admin"===t.type?o()("div",{style:this.subscriptionInfoStyle()},void 0,T.D0(this.environment,e,t)):"unsubscribed_admin"===t.type||"unsubscribed_member"===t.type?o()("div",{style:{...this.subscriptionInfoStyle(),display:"flex",alignItems:"center",justifyContent:"space-between"}},void 0,o()("div",{},void 0,T.D0(this.environment,e,t))):void 0}renderPricingGrid(){const e=this.getPlanState();return o()(Tc,{planState:e,data:this.props.data})}renderStudentUpgrade(){return o()("div",{style:Zc.subsectionStyle},void 0,o()("div",{style:Zc.subsectionTitleStyle},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionPlans.studentsAndEducatorsSection.title",defaultMessage:"Students & educators"})),o()("div",{style:{color:this.theme.mediumTextColor,marginBottom:15}},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionPlans.studentsAndEducatorsSection.text",defaultMessage:"<p>Personal Pro Plans are free for students and educators! Simply sign up with your school email address and you'll immediately gain access to those features.</p><p>If you're already on a Personal Pro Plan, change the email associated with your account to your school email address to get it for free.</p>",values:{p:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()("div",{style:{marginBottom:4}},void 0,t)}}})),o()(Ee.Z,{isLarge:!0,onClick:this.handleEducationPlanClick},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionPlans.studentsAndEducatorsSection.getEducationPlanButton.label",defaultMessage:"Get free Education plan"})))}renderFAQ(){return o()("div",{style:Zc.subsectionStyle},void 0,o()("div",{style:Zc.subsectionTitleStyle},void 0,o()(y.FormattedMessage,{id:"spaceSubscriptionPlans.faqSection.title",defaultMessage:"FAQ"})),o()(yc,{cta:"intercom",type:"general",isSettings:!0}))}getMemberCount(){return T.su(this.props.data)}canSwitchPlans(){const e=T.wY(this.props.data);return this.props.spaceStore.canAdmin()&&!e}calculateButtonState(e){const{data:t}=this.props,i=T.DH(t);return"personal_free"===e?{free:"current",personal:"upgrade",team:"upgrade",business:"upgrade",enterprise:"upgrade"}:"personal"===e||"student"===e?{free:i?"current":"downgrade",personal:i?"resubscribe":"current",team:"upgrade",business:"upgrade",enterprise:"upgrade"}:"team_free"===e||"free"===e?{free:"downgrade",personal:"upgrade",team:"upgrade",business:"upgrade",enterprise:"upgrade"}:"team"===e?{free:"downgrade",personal:"downgrade",team:i?"resubscribe":"current",business:"upgrade",enterprise:"upgrade"}:"business"===e?{free:"downgrade",personal:"downgrade",team:"downgrade",business:i?"resubscribe":"current",enterprise:"upgrade"}:"enterprise"===e?{free:"downgrade",personal:"downgrade",team:"downgrade",business:"downgrade",enterprise:i?"resubscribe":"current"}:void(0,H.t1)(e)}isButtonStateActive(e){return["current","resubscribe"].includes(e)}getPlanState(){const e=T.CM(this.environment);if(!e)return;const t="team_free"===e||"free"===e,i=T.wY(this.props.data),n=this.calculateButtonState(e),o="on"===re.default.getGroup("churn_survey");return{plans:{free:{buttonType:n.free,isActive:this.isButtonStateActive(n.free),onClick:this.handleFreeClick},personal:{buttonType:n.personal,isActive:this.isButtonStateActive(n.personal),onClick:()=>this.handlePersonalClick(o)},team:{buttonType:n.team,isActive:this.isButtonStateActive(n.team)||t,onClick:()=>this.handleTeamClick(o),onClickTeamFree:this.handleTeamFreeClick},business:{buttonType:n.business,isActive:this.isButtonStateActive(n.business),onClick:this.handleBusinessClick},enterprise:{buttonType:n.enterprise,isActive:this.isButtonStateActive(n.enterprise),onClick:this.handleEnterpriseClick}},isTeamTrial:t,isInAppPurchase:i,canSwitchPlans:this.canSwitchPlans(),memberCount:this.getMemberCount()}}allowEducationUpgrade(){const{data:e}=this.props,t=this.getPlanState();return t&&t.canSwitchPlans&&!T.wl(e)&&1===t.memberCount&&(t.plans.free.isActive||t.plans.personal.isActive)}shouldShowTeamWarningDuringDowngrade(){const{spaceStore:e}=this.props,t=null==e?void 0:e.getPlanType();return!!t&&((0,z.bq)()&&(0,Jd.u2)(t))}subscriptionInfoStyle(){return{textAlign:"left",marginBottom:24,fontSize:14,borderBottom:"1px solid ".concat(this.theme.regularDividerColor),paddingBottom:16}}}l()(Zc,"wrapStyle",{display:"flex",flexDirection:"column",height:"100%"}),l()(Zc,"scrollerStyle",{transform:"translateZ(0px)",flexGrow:1,padding:30}),l()(Zc,"subscriptionInfoCtaButtonStyle",{marginLeft:16,paddingLeft:10}),l()(Zc,"priceDisclaimerStyle",{fontSize:14,marginTop:20,marginBottom:40}),l()(Zc,"subsectionStyle",{fontSize:14,marginTop:40}),l()(Zc,"subsectionTitleStyle",{fontSize:20,fontWeight:v.Z.fontWeight.bold,marginBottom:12});const Pc=(0,y.injectIntl)(Zc);var _c=i(93963),xc=i(42982),Fc=i(38363);const Ac="teamColumn",Bc="ownersColumn",Ec="membersColumn",Rc="AccessLevelColumn",Dc="lastUpdatedColumn",Lc="contextMenuColumn",Oc=[Ac,Ec,Rc,Dc],Nc="filterAccessAny",Uc="filterAccessOnlyOpen",Wc="filterAccessOnlyClosed",Vc="filterAccessOnlyPrivate",zc="filterOwnerAny",qc="filterOwnerShowOrphaned",Hc="filterOwnerById";class Gc extends I.Z{getInitialState(){return{searchQuery:"",sortColumn:Dc,sortAscending:!1,showOnlyArchivedTeams:!1,filterByOwner:{type:zc},filterAccess:Nc}}}const Kc=new Gc;var jc=i(51923);class Yc extends I.Z{getInitialState(){return{tokenQuery:"",showAutoCompletePopup:!1,defaultTeams:{}}}addedAndCurrentTeams(){return Object.values(this.state.defaultTeams).filter((e=>{let{state:t}=e;return"current-default"===t||"add-default"===t}))}addedTeams(){return Object.values(this.state.defaultTeams).filter((e=>{let{state:t}=e;return"add-default"===t}))}removedTeams(){return Object.values(this.state.defaultTeams).filter((e=>{let{state:t}=e;return"remove-default"===t}))}}const Qc=new Yc;function Xc(e){var t;let{team:i}=e;return null===(t=Qc.state.defaultTeams[i.id])||void 0===t?void 0:t.state}function Jc(e){let{team:t,persistedDefaultTeams:i}=e;if(i.includes(t))$c({store:t,state:"current-default"});else{const e={...Qc.state.defaultTeams};delete e[t.id],Qc.setState({...Qc.state,defaultTeams:e})}}function $c(e){const t=Qc.state;Qc.setState({...t,defaultTeams:{...t.defaultTeams,[e.store.id]:e}})}var eu=i(75024),tu=i(30676),iu=i(47082);function nu(e){let{allTeams:t,loaded:i}=e;const n=(0,be.Fy)(),s=(0,y.useIntl)(),r=(0,be.O7)(),[l,d]=(0,u.useState)(!1),[p,g,h]=(0,Me.oR)(Qc),[{currentSpaceStore:f}]=(0,Me.oR)(F.default),v=!p.tokenQuery,{addedTeams:S,removedTeams:b,addedAndCurrentTeams:M}=(0,Me.VK)((()=>({addedAndCurrentTeams:h.addedAndCurrentTeams(),addedTeams:h.addedTeams(),removedTeams:h.removedTeams()})),[h]),w=(0,Me.VK)((()=>t.reduce(((e,t)=>(e[t.id]=t.getName(),e)),{})),[t]),C=(0,Me.VK)((()=>t.filter((e=>e.isDefault()))),[t]);(0,u.useEffect)((()=>function(e){let{persistedDefaultTeams:t}=e;const i=t.reduce(((e,t)=>(e[t.id]={state:"current-default",store:t},e)),{}),n=Qc.state;Qc.setState({...n,defaultTeams:i})}({persistedDefaultTeams:C})),[C,g]);const k=S.length>0||b.length>0,T=e=>function(e){let{team:t,persistedDefaultTeams:i}=e;"add-default"===Xc({team:t})?Jc({team:t,persistedDefaultTeams:i}):$c({store:t,state:"remove-default"})}({team:e,persistedDefaultTeams:C}),I=e=>{!function(e){let{team:t,persistedDefaultTeams:i}=e;"remove-default"===Xc({team:t})?Jc({team:t,persistedDefaultTeams:i}):$c({store:t,state:"add-default"})}({team:e,persistedDefaultTeams:C}),g((e=>({...e,showAutoCompletePopup:!1,tokenQuery:""})))},Z=new Set(b.map((e=>e.store.id))),P=r.currentUser.id,_=(0,Me.VK)((()=>P?t.filter((e=>{const t=e.getMembers(),i=e.getSettingsStore().getValue();return!!i&&((0,Jd.pd)({membership:t},P)&&"open"===(0,Jd.B5)(i))})):[]),[t,P]),x=function(e){let{query:t,addedAndCurrentTeams:i,eligibleDefaultTeams:n,teamIdsToNames:o}=e;const s=new Set;for(const a of i)s.add(a.store.id);return(0,Cn.ZP)(t,n,(e=>{var t;return null!==(t=o[e.id])&&void 0!==t?t:""}))}({query:p.tokenQuery,addedAndCurrentTeams:M,teamIdsToNames:w,eligibleDefaultTeams:_}),A=[];x.length>0&&!v&&A.push({key:"default-teams-list",render:e=>m().createElement(Ne.Z,a()({},e,{title:o()(y.FormattedMessage,{id:"defaultTeamsInput.defaultTeamList.title",description:"Title for the input menu to search for default teamspaces to add to the workspace",defaultMessage:"Teamspaces"}),loading:!1})),items:x.map((e=>({key:e.id,render:t=>m().createElement(tu.F,a()({},t,{teamStore:e})),action:()=>I(e)})))});const B=p.showAutoCompletePopup&&A.length>0,E=(0,ei.y)((e=>({defaultTeamsHeader:{fontSize:14,marginBottom:2},inputAndButtonContainer:{paddingTop:12,display:"flex"},inputContainer:{flexGrow:1},tokenInputMenu:{borderRadius:B?au:su,margin:0},menuList:{maxHeight:300,border:"1px solid ".concat(e.regularDividerColor),borderTop:0,borderRadius:ru},updateButton:{marginLeft:10,height:35}})),[B]);return m().createElement(m().Fragment,null,o()("div",{style:E.defaultTeamsHeader},void 0,o()(y.FormattedMessage,{id:"teamsWorkspaceSettings.defaultTeams.title",defaultMessage:"Default teamspaces"})),o()(oi.Z,{isSmall:!0,isMultiline:!0},void 0,o()(y.FormattedMessage,{id:"teamsWorkspaceSettings.defaultTeams.caption",defaultMessage:"Choose teamspaces that all new and current workspace members will automatically join"})),o()("div",{style:E.inputAndButtonContainer},void 0,o()("div",{style:E.inputContainer},void 0,o()(Oe.ZP,{popupType:Oe.ZP.PopupType.Popup,placementToOrigin:Oe.ZP.Placement.Bottom,sameWidthAsOrigin:!0,open:B,borderRadius:ru,onDismiss:()=>g((e=>({...e,showAutoCompletePopup:!1}))),origin:o()(iu.Z,{disabled:!i||l,style:E.tokenInputMenu,focusInitial:n.isMobile,focusAfterAnimation:!0,format:iu.Z.Format.Share,inputDivStyle:{alignItems:"center"},value:p.tokenQuery,onChange:e=>g((t=>({...t,tokenQuery:e.target.value,showAutoCompletePopup:!0}))),type:"default-teams",tokens:Object.values(p.defaultTeams).filter((e=>!Z.has(e.store.id))).map((e=>o()(ou,{teamStore:e.store,onClickRemove:T}))),placeholder:s.formatMessage({id:"teamsWorkspaceSettings.defaultTeams.inputPlaceholder",defaultMessage:"Select a default teamspace..."}),onRemoveLastToken:()=>{const e=M,t=c().last(e);t&&T(t.store)},onEmptySubmit:c().identity,showBorder:!0}),render:()=>o()(De.Z,{menuType:Fe.o.Popup,tokenInputHeader:!0,disableHeaderBorder:!0},void 0,o()("div",{style:E.menuList},void 0,o()(Le.Z,{type:Le.i.Vertical,initialFocus:0,sections:A})))})),o()(Ee.Z,{style:E.updateButton,disabled:!k||l,isLarge:!0,onClick:async()=>{if(f){d(!0);try{await async function(e){let{addedTeams:t,removedTeams:i,environment:n,spaceStore:o}=e;if(!o.isDefined())return!1;const s=o.getPermissionItems();return await(0,Fc.lH)({addedStores:t.map((e=>{let{store:t}=e;return t})),removedStores:i.map((e=>{let{store:t}=e;return t})),environment:n,spaceValue:{permissions:s},createNewTeamFlowId:void 0,from:"workspace_settings"})}({environment:r,addedTeams:S,removedTeams:b,spaceStore:f})}finally{d(!1)}}}},void 0,o()(y.FormattedMessage,{id:"teamsWorkspaceSettings.updateButton.label",defaultMessage:"Update"}))))}function ou(e){const t=(0,be.Fy)(),{teamStore:i,onClickRemove:n}=e,{name:s,icon:a}=(0,Me.VK)((()=>({name:i.getName(),icon:i.getIcon()})),[i]);return o()($s.Z,{showRemoveButton:!0,isSingle:!1,format:t.isMobile?Ks.l.Large:Ks.l.Medium,style:{marginLeft:6},onClickRemove:()=>n(i),value:o()("div",{style:{display:"flex"}},void 0,o()(mn.Z,{disabled:!0,icon:a,isEmptyPage:!1,size:14,style:{marginRight:4}}),s)})}const su=3,au=(0,eu.wK)({topLeft:su,topRight:su,bottomLeft:0,bottomRight:0}),ru=(0,eu.wK)({topLeft:0,topRight:0,bottomLeft:su,bottomRight:su});var lu=i(17224),du=i(14871);function cu(e){let{selectItems:t,currentSelectedItem:i,onChange:n,icon:s}=e;return o()(du.Z,{items:t,getKey:e=>e.key,selectedItem:i,onSelect:n,renderItem:e=>m().createElement(Re.Z,a()({title:e.value.name},e,{checkState:i.key===e.value.key})),renderOrigin:e=>{var t;return m().createElement(Ye.u,a()({},e,{title:null!==(t=i.originName)&&void 0!==t?t:i.name,on:!i.showFilterAsOffWhenSelected,icon:s}))}})}const uu={[Nc]:{key:Nc,name:o()(y.FormattedMessage,{id:"manageTeamsAccessFilter.accessFilter.filterAllTeams",defaultMessage:"Any",description:"Select option text to clear filter for access level on the teamspaces table."}),originName:o()(y.FormattedMessage,{id:"manageTeamsAccessFilter.accessSelectPlaceolder",defaultMessage:"Access",description:"Placeholder option for the filter by access dropdown menu in the manage teamspaces settings"}),showFilterAsOffWhenSelected:!0},[Uc]:{key:Uc,name:o()(y.FormattedMessage,{id:"manageTeamsAccessFilter.accessFilter.filterOpenTeams",defaultMessage:"Open",description:"Select option text to filter for open teamspaces only in the manage teamspaces table in workspace settings."})},[Wc]:{key:Wc,name:o()(y.FormattedMessage,{id:"manageTeamsAccessFilter.accessFilter.filterClosedTeams",defaultMessage:"Closed",description:"Select option text to filter for closed teamspaces only in the manage teamspaces table in workspace settings."})},[Vc]:{key:Vc,name:o()(y.FormattedMessage,{id:"manageTeamsAccessFilter.accessFilter.filterPrivateTeams",defaultMessage:"Private",description:"Select option text to filter for private teamspaces only in the manage teamspaces table in workspace settings."})}},mu=c().compact([uu.filterAccessAny,uu.filterAccessOnlyOpen,uu.filterAccessOnlyClosed,uu.filterAccessOnlyPrivate]);function pu(e){let{manageTeamsStore:t}=e;const i=(0,be.O7)(),[n,s]=(0,Me.oR)(t),a=(0,ei.y)((e=>({keyIcon:{width:18,height:18,fill:e.mediumIconColor},blueFill:{fill:g.ZP.blue}})),[]),r=(0,u.useCallback)((e=>{s({...n,filterAccess:e.key}),(0,lu.GZ)(i,{filter:"access",value:e.key})}),[n,s,i]),l=uu[n.filterAccess];return o()(cu,{selectItems:mu,currentSelectedItem:l,onChange:r,icon:h.Z.key({...a.keyIcon,...n.filterAccess!==Nc&&a.blueFill})})}const gu="showArchived",hu="hideArchived",fu={[hu]:{key:hu,name:o()(y.FormattedMessage,{id:"manageTeamsArchivedFilter.archivedFilter.hideArchivedTeams",defaultMessage:"Active",description:"Select option text to hide archived teamspaces in the manage teamspaces table."}),originName:o()(y.FormattedMessage,{id:"manageTeamsArchivedFilter.archivedSelectPlaceolder",defaultMessage:"Archived",description:"Placeholder option for the filter by archived dropdown menu in the manage teamspaces settings"}),showFilterAsOffWhenSelected:!0},[gu]:{key:gu,name:o()(y.FormattedMessage,{id:"manageTeamsArchivedFilter.archivedFilter.showArchivedTeams",defaultMessage:"Archived",description:"Select option text to show only archived teamspaces in the manage teamspaces table."})}};function vu(e){let{manageTeamsStore:t}=e;const i=(0,be.O7)(),[n,s]=(0,Me.oR)(t),a=(0,ei.y)((e=>({archiveIcon:{width:16,height:16,marginRight:5,fill:e.mediumIconColor},blueFill:{fill:g.ZP.blue}})),[]),r=[fu.hideArchived,fu.showArchived],l=(0,u.useCallback)((e=>{s({...n,showOnlyArchivedTeams:e.key===gu}),(0,lu.GZ)(i,{filter:"archived",value:e.key})}),[n,s,i]),d=fu[n.showOnlyArchivedTeams?gu:hu];return o()(cu,{selectItems:r,currentSelectedItem:d,onChange:l,icon:h.Z.archiveFilled({...a.archiveIcon,...n.showOnlyArchivedTeams&&a.blueFill})})}i(99244);const yu="ShowTeamsWithNoOwnersId";function Su(e){let{teamStores:t,manageTeamsStore:i}=e;const n=(0,be.O7)(),[s,r]=(0,Me.oR)(i),l=function(e){switch(e.type){case zc:return;case Hc:return e.id;case qc:return yu;default:(0,H.t1)(e)}}(s.filterByOwner),[{currentSpaceStore:d}]=(0,Me.oR)(F.default),p=(0,y.useIntl)(),f=(0,Me.VK)((()=>{const e=t.flatMap((e=>(0,Jd.XO)({membership:e.getMembers()})));return c().uniq(e)}),[t]),v=(0,ei.y)((e=>({icon:{marginRight:2,fill:e.mediumIconColor},blueFill:{fill:g.ZP.blue}})),[]),S=(0,u.useCallback)((e=>{if(d)return Ts({userId:e,currentSpaceStore:d}).getValue()}),[d]),b=(0,u.useCallback)((e=>{const t=e[e.length-1];let i;i=t===l||void 0===t?{type:zc}:t===yu?{type:qc}:{type:Hc,id:t},r({...s,filterByOwner:i}),(0,lu.GZ)(n,{filter:"owner",value:i.type})}),[l,s,r,n]),M=(0,u.useCallback)((async e=>{let{query:t}=e;if(!d)return[];const i=(await ke.pz({query:t,currentSpaceStore:d,userIds:f})).map((e=>e.id));return""===t?[yu,...i]:i}),[d,f]),w=(0,u.useCallback)(((e,t)=>{if(!d)return null;if(e===yu)return m().createElement(Re.Z,a()({},t,{title:o()(y.FormattedMessage,{id:"manageTeamsOwnerFilter.noOwnersFilterOption",description:"Teamspaces owners filter option for the manage teamspaces table to filter the table to only show teamspaces that have no owners.",defaultMessage:"No owners"}),checkState:s.filterByOwner.type===qc,className:"notranslate"}));const i=S(e);return i?m().createElement(Ct.Z,a()({},t,{key:e,user:i,checkState:l===e})):null}),[d,S,l,s.filterByOwner.type]),C=(0,Me.VK)((()=>{if(s.filterByOwner.type!==Hc)return;const e=S(s.filterByOwner.id);return e?(0,Ce.Nz)(p,e):void 0}),[s.filterByOwner,S,p]);let k;return k=s.filterByOwner.type===qc?o()(y.FormattedMessage,{id:"manageTeamsOwnerFilter.filterTitle.onlyOrphanedTeams",description:"Title for the manage teamspaces filter pill when the filter is set to: Teamspaces without owners.",defaultMessage:"Owner: None"}):o()(y.FormattedMessage,C?{id:"manageTeamsOwnerFilter.filterTitle.withSpecifiedOwner",description:"Title for the manage teamspaces owner filter pill when an owner filter is specified.",defaultMessage:"Owner: {teamOwnerName}",values:{teamOwnerName:C}}:{id:"manageTeamsOwnerFilter.filterTitle.unset",description:"Title for the manage teamspaces filter pill.",defaultMessage:"Owner"}),o()(ht.Z,{mode:ht.z.Pill,title:k,disabled:0===t.length,icon:h.Z.person,iconStyles:{...v.icon,...s.filterByOwner.type!==zc&&v.blueFill},items:c().compact([l]),hasItemsSelected:(0,H.$K)(l),onChange:b,labelText:{title:k,tokenInputPlaceholder:p.formatMessage({defaultMessage:"Search teamspace owner...",id:"manageTeamsOwnerFilter.searchOwner.placeholder",description:"The placeholder in the input for search an actor in manage teamspaces owner filter"}),resultSectionTitle:p.formatMessage({defaultMessage:"Select users",id:"manageTeamsOwnerFilter.searchOwner.resultsTitle",description:"The text shown above the list of all selectable actors in manage teamspaces owner filter"}),componentDebugName:"ManageTeamsSearchOwnerFilter"},performRequest:M,renderResultMenuItem:w,renderToken:()=>null,renderFilter:()=>null,renderItemForSummary:()=>null,addItemLabel:null,focused:!1})}function bu(e){let{manageTeamsStore:t,teamStores:i}=e;const[n,s]=(0,Me.oR)(t),a=(0,ei.y)((()=>({container:{display:"flex",alignItems:"center",marginTop:20},searchContainer:{maxWidth:250,marginRight:"auto"},archivedTeamsSwitch:{display:"flex",alignItems:"center",marginLeft:15,marginRight:15},archivedTeamsLabel:{marginLeft:10},dropdownContainer:{display:"flex",alignContent:"stretch",marginLeft:5}})),[]),r=(0,u.useCallback)((e=>{s({...n,searchQuery:e})}),[n,s]);return o()("div",{style:a.container},void 0,o()(Mu,{style:a.searchContainer,onChange:r,value:n.searchQuery}),o()("div",{style:a.dropdownContainer},void 0,o()(vu,{manageTeamsStore:t}),o()(Su,{teamStores:i,manageTeamsStore:t}),o()(pu,{manageTeamsStore:t})))}function Mu(e){let{style:t,value:i,onChange:n}=e;const s=(0,y.useIntl)(),a=(0,ei.y)((e=>({input:{boxShadow:e.inputBoxShadow,borderRadius:100,fontSize:12},searchIcon:{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,fill:e.mediumIconColor}})),[]),r=(0,u.useCallback)((e=>n(e.target.value)),[n]);return o()(lt.Z,{placeholder:s.formatMessage({defaultMessage:"Search teamspaces...",id:"manageTeamsFilterRow.searchFilter.placeholder",description:"Placeholder text for manage teamspaces list search filter."}),style:{...a.input,...t},value:i,onChange:r,left:h.Z.searchThick(a.searchIcon),format:lt.Z.Format.Small,showClearButton:!0})}var wu=i(45080),Cu=i(48690),ku=i(20320),Tu=i(93686),Iu=i(98742),Zu=i(92350),Pu=i(45660),_u=i(86275);function xu(e){let{teamStore:t,accessLevel:i,isTeamOwner:n,onChangeAccessLevel:s}=e;const r=(0,be.O7)(),l=(0,Zu.vR)(t),d=(0,_u.U)({teamStore:t,onChange:s,isCreateTeam:!1,isDefault:l}),c=(0,Pu.e)(),u=(0,Go.Z)(),p=(0,ei.y)((e=>({selectButton:{paddingLeft:8,marginLeft:-8},label:{color:e.regularTextColor,fontSize:v.Z.fontSize.UIRegular.desktop,fontWeight:v.Z.fontWeight.regular},chevron:{width:10,marginLeft:4,fill:e.lightIconColor}})),[]),g=!n,f=d.find((e=>e.key===i));if(!f)throw new Error("Selected access level is not an option found in team access level option: ".concat(i));return o()(du.Z,{items:d,getKey:e=>e.key,selectedItem:f,onSelect:e=>"private"===e.key&&c?(0,Wo.y)(r,{from:"team_security_settings",for:u}):s(e.key),renderItem:e=>o()(Ue.Z,{textWrap:!0,placement:di.u.Bottom,disableTooltip:!e.value.tooltip,renderTooltip:()=>e.value.tooltip,render:t=>m().createElement(Re.Z,a()({title:e.value.title},(0,Iu.Z)(e,t)))}),disabled:g,renderOrigin:e=>m().createElement(Je.Z,a()({style:p.selectButton,disabled:g},e),o()("span",{style:p.label},void 0,f.level),!g&&h.Z.chevronDown(p.chevron))})}var Fu=i(13380);function Au(e){let{teamOwners:t,manageTeamsStore:i}=e;const[n]=(0,Me.oR)(i),[{currentSpaceStore:s}]=(0,Me.oR)(F.default),a=(0,y.useIntl)(),r=(0,Me.VK)((()=>{if(!s)return;let e=t[0];if(n.filterByOwner.type===Hc){const i=n.filterByOwner.id;t.includes(i)&&(e=i)}return e?Ts({userId:e,currentSpaceStore:s}).getValue():void 0}),[s,n.filterByOwner,t]),l=(0,Me.VK)((()=>{if(r)return(0,Ce.Nz)(a,r)}),[r,a]),d=(0,ei.y)((e=>({container:{display:"flex",alignItems:"center",fontSize:v.Z.fontSize.UIRegular.desktop,overflow:"hidden"},userAvatar:{paddingRight:6},nMoreOwnersText:{paddingLeft:3,color:e.mediumTextColor},noOwners:{marginRight:8,color:e.lightTextColor},userName:{flexShrink:1}})),[]);return t.length<1?o()("div",{style:d.noOwners},void 0,o()(y.FormattedMessage,{id:"manageTeamsOwnersCell.noOwners",description:"Label that shows that a teamspace has no owners in the manage teamspaces table.",defaultMessage:"No owners"})):o()("div",{style:d.container},void 0,o()(Hn.Z,{style:d.userAvatar,avatarShouldShowShadow:!0,userValue:r,size:20}),o()(Fu.s,{style:d.userName},void 0,l),t.length>1&&o()("div",{style:d.nMoreOwnersText},void 0,o()(y.FormattedMessage,{id:"manageTeamsOwnersCell.nMoreOwnersLabel",description:"Label that shows in the owners cell in the manage teamspaces table. Ex: if there are 2 owners, James and Joe, the cell will show 'James +1'.",defaultMessage:"+{numAdditionalOwners}",values:{numAdditionalOwners:t.length-1}})))}const Bu=[Ac,Bc,Ec,Rc,Dc,Lc],Eu={[Rc]:{headerTitle:o()(y.FormattedMessage,{id:"manageTeamsTable.columnTitle.access",description:"Title of the access (private or open) column in the manage teamspaces table.",defaultMessage:"Access"}),renderCell:e=>{let{data:t,environment:i}=e;return o()(xu,{teamStore:t.store,accessLevel:t.accessLevel,isTeamOwner:t.isCurrentUserOwnerOfTeam,onChangeAccessLevel:e=>Fc.Ju({environment:i,store:t.store,accessLevel:e,teamName:t.name,from:"manage_teams_table"})})},colWidth:{width:90},hasClickableContents:!0},[Ac]:{headerTitle:o()(y.FormattedMessage,{id:"manageTeamspacesTable.columnTitle.teamspace",description:"Title of the teamspace name column in the manage teamspaces table.",defaultMessage:"Teamspace"}),renderCell:e=>{let{data:t}=e;return o()(Uu,{teamStore:t.store,isArchivedTeam:t.isArchivedTeam,name:t.name})},colWidth:{minWidth:30,widthPercent:35}},[Bc]:{headerTitle:o()(y.FormattedMessage,{id:"manageTeamsTable.columnTitle.owners",description:"Title of the teamspace owners column in the manage teamspaces table.",defaultMessage:"Owners"}),renderCell:e=>{let{data:t,manageTeamsStore:i}=e;return o()(Au,{teamOwners:t.owners,manageTeamsStore:i})},colWidth:{minWidth:60,widthPercent:25}},[Ec]:{headerTitle:o()(y.FormattedMessage,{id:"manageTeamsTable.columnTitle.members",description:"Title of the teamspace members column in the manage teamspace table.",defaultMessage:"Members"}),renderCell:e=>{let{data:t}=e;return o()(Fu.s,{},void 0,o()(y.FormattedMessage,{id:"manageTeamsTable.numMembersCell",description:"Text that shows in the members cell of each teamspace in the manage teamspaces table. The cell says the number of teamspace members.",defaultMessage:"{numTeamMembers, plural, one {# member} other {# members}}",values:{numTeamMembers:t.members.length}}))},colWidth:{minWidth:40,widthPercent:15}},[Dc]:{headerTitle:o()(y.FormattedMessage,{id:"manageTeamsTable.columnTitle.updated",description:"Title of the last updated column in the manage teamspaces table.",defaultMessage:"Updated"}),renderCell:e=>{let{data:t}=e;return o()(Fu.s,{},void 0,(0,Zt.default)(t.lastUpdated).format("MMM D, YYYY"))},colWidth:{minWidth:50,widthPercent:15}},[Lc]:{headerTitle:void 0,renderCell:e=>{let{data:t}=e;return o()(ku.oN,{teamStore:t.store,from:"manage_teams_table"})},colWidth:{width:30},hasClickableContents:!0}};function Ru(e){let{teamStores:t,manageTeamsStore:i}=e;const n=(0,be.O7)(),[{currentSpaceStore:s,currentUserStore:a}]=(0,Me.oR)(F.default),[r,l]=(0,Me.oR)(i),[,d]=(0,Me.oR)(Cu.Z),{showOnlyArchivedTeams:p,filterAccess:g,searchQuery:h,sortAscending:f,sortColumn:v,filterByOwner:y}=r,S=(0,Me.VK)((()=>{const e=null==s?void 0:s.getPermissionGroups();return c().compact(t.map((t=>{var i;const n=t.getMembers(),o=null==a?void 0:a.id;if(!o)return;const s=(0,Jd.XO)({membership:n});return{store:t,name:null!==(i=t.getName())&&void 0!==i?i:"",owners:s,isCurrentUserOwnerOfTeam:s.includes(o),isCurrentUserOnTeam:(0,Jd.MA)(n,e,o),members:(0,Jd.E8)({teamMembers:n,spaceGroups:e}),accessLevel:t.getTeamAccessLevel(),isArchivedTeam:(0,Jd.m4)({archived_by:t.getArchivedBy()}),lastUpdated:t.getLastEditedTime()}})))}),[s,null==a?void 0:a.id,t]),b=(0,Me.VK)((()=>S.filter((e=>p?e.isArchivedTeam:!e.isArchivedTeam)).filter((e=>{if(g===Uc&&"open"!==e.accessLevel)return!1;if(g===Wc&&"closed"!==e.accessLevel)return!1;if(g===Vc&&"private"!==e.accessLevel)return!1;switch(y.type){case qc:return 0===e.owners.length;case Hc:return e.owners.includes(y.id);case zc:return!0;default:(0,H.t1)(y)}}))),[S,p,g,y]),M=(0,Me.VK)((()=>function(e){let{data:t,sortColumn:i,sortAscending:n}=e;const o=[n?"asc":"desc"],s=[n?"desc":"asc"];switch(i){case Ac:return c().orderBy(t,(e=>e.name),s);case Ec:return c().orderBy(t,(e=>e.members.length),o);case Rc:return c().orderBy(t,(e=>fi.bx.indexOf(e.accessLevel)),o);case Dc:return c().orderBy(t,(e=>e.lastUpdated),o);default:(0,H.t1)(i)}}({data:b,sortAscending:f,sortColumn:v})),[f,v,b]),w=(0,Me.VK)((()=>(0,Cn.ZP)(h,M,(e=>e.name))),[h,M]),C=(0,u.useCallback)((e=>{d((t=>({...t,open:!0,tab:Cu.a.Members,selectedTeamId:e})))}),[d]),k=(0,ei.y)((e=>({container:{marginTop:17,tableLayout:"fixed",borderCollapse:"collapse",width:"100%",minWidth:Bu.reduce(((e,t)=>e+qu(Eu[t].colWidth)+Vu),0)},tableHeaderRow:{borderTop:"1px solid ".concat(e.tableDividerColor),borderBottom:"1px solid ".concat(e.tableDividerColor)},noTeamsLabel:{marginTop:15,marginBottom:40,textAlign:"center"}})),[]),T=(0,u.useCallback)((e=>{const t=e===v&&!f;l((i=>({...i,sortAscending:t,sortColumn:e}))),(0,lu.dw)(n,{sortBy:e,sortOrder:f?"ascending":"descending"})}),[l,f,v,n]),I=(0,u.useCallback)((()=>{i.reset()}),[i]);return m().createElement(m().Fragment,null,o()("table",{style:k.container},void 0,o()("tr",{style:k.tableHeaderRow},void 0,Bu.map((e=>o()(Lu,{column:e,onSortableColumnClick:T,sortAscending:f,sortColumn:v},"header_".concat(e))))),o()("tr",{},void 0,Bu.map((e=>o()("td",{},"padding_row_".concat(e))))),w.map((e=>o()(Du,{onShowTeamSettings:C,teamData:e,manageTeamsStore:i},"".concat(e.store.id,"_row"))))),o()(Nu,{style:k.noTeamsLabel,numItemsAfterFilter:w.length,numItemsBeforeFilter:t.length,onResetFilters:I}))}function Du(e){let{teamData:t,manageTeamsStore:i,onShowTeamSettings:n}=e;const[s,a]=(0,u.useState)(!1),r=(0,u.useCallback)((()=>a(!0)),[]),l=(0,u.useCallback)((()=>a(!1)),[]),d=(0,u.useCallback)((e=>{Wu(e,(()=>n(t.store.id)))}),[n,t.store.id]),c=(0,ei.y)((e=>({teamRow:{cursor:"pointer",borderBottom:"1px solid ".concat(e.tableDividerColor)}})),[]);return o()("tr",{onMouseLeave:l,onMouseEnter:r,style:c.teamRow,onClick:d},void 0,Bu.map(((e,n)=>o()(Ou,{isRowHovered:s,columnIndex:n,teamData:t,columnData:Eu[e],manageTeamsStore:i},"".concat(t.store.id,"_").concat(e)))))}function Lu(e){let{column:t,onSortableColumnClick:i,sortColumn:n,sortAscending:s}=e;const a=Eu[t],r=(0,ei.y)((e=>({th:Hu(a),innerDiv:{display:"flex",alignItems:"center",minWidth:qu(a.colWidth),height:32},text:{fontSize:v.Z.fontSize.UISmall.desktop,fontWeight:v.Z.fontWeight.regular,color:e.mediumTextColor},sortButton:{padding:5,margin:-5,overflow:"hidden",maxWidth:"100%"},sortIcon:{fill:e.mediumTextColor,width:12,height:12,marginLeft:4}})),[a]),l=o()(Fu.s,{style:r.text},void 0,a.headerTitle),d=(c=t,Oc.includes(c)?o()(Je.Z,{style:r.sortButton,onClick:()=>i(t)},void 0,l,(()=>{if(t===n)return h.Z.arrowDownSmall({...r.sortIcon,...s&&{transform:"rotate(180deg)"}})})()):l);var c;return o()("th",{style:r.th},void 0,o()("div",{style:r.innerDiv},void 0,d))}function Ou(e){let{teamData:t,columnData:i,columnIndex:n,isRowHovered:s,manageTeamsStore:a}=e;const r=(0,be.O7)(),l=(0,ei.y)((e=>({td:{...Hu(i),...s&&{background:e.buttonHoveredBackground}},innerDiv:{minWidth:qu(i.colWidth),fontSize:v.Z.fontSize.UIRegular.desktop,color:e.regularTextColor,height:48,display:"flex",alignItems:"center"}})),[i,s]),d=Wu,c=Boolean(i.hasClickableContents);return o()("td",{style:l.td},void 0,o()("div",{style:l.innerDiv,onClick:c?d:void 0},void 0,i.renderCell({environment:r,data:t,manageTeamsStore:a})))}function Nu(e){let{style:t,numItemsBeforeFilter:i,numItemsAfterFilter:n,onResetFilters:s}=e;const a=0!==i;if(0!==n)return null;let r;return r=o()(y.FormattedMessage,a?{id:"manageTeamsTable.emptyManageTeamTableDisclaimer.teamsFilteredOut",defaultMessage:"Could not find any teamspaces. <linkbutton>Reset your filters</linkbutton>",description:"Row that shows when the manage teamspaces table is empty because no teamspaces match the applied filters. The 'Reset your filters' link will clear the user's filters.",values:{linkbutton:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()(ao.Z,{onClick:s},void 0,t)}}}:{id:"manageTeamsTable.emptyManageTeamTableDisclaimer.noTeamsExist",defaultMessage:"Could not find any teamspaces.",description:"Row that shows when the manage teamspaces table is empty because no teamspaces have been created yet."}),o()(oi.Z,{isSmall:!0,style:t},void 0,r)}function Uu(e){let{teamStore:t,name:i,isArchivedTeam:n}=e;const s=(0,ei.y)((()=>({teamNameContainer:{display:"flex",alignItems:"center",overflow:"hidden"},teamIcon:{marginRight:8},nameText:{flexShrink:1,minWidth:15},archivedTag:{marginLeft:5}})),[]);return o()("div",{style:s.teamNameContainer},void 0,o()(Tu.p,{style:s.teamIcon,size:22,store:t,disabled:!0}),o()(Fu.s,{style:s.nameText},void 0,i),n&&o()(wt.Z,{desktopStyle:s.archivedTag,mobileStyle:s.archivedTag},void 0,o()(y.FormattedMessage,{id:"manageTeamsTable.archivedTag",description:"Tag pill placed next to team name to mark it as an archived team in the manage teams table",defaultMessage:"Archived"})))}function Wu(e,t){(0,wu.ZP)({event:e,context:wu.Af.ManageTeamsRowClick,callback:t})}const Vu=10,zu={paddingLeft:Vu/2,paddingRight:Vu/2};function qu(e){return"minWidth"in e?e.minWidth:e.width}function Hu(e){let t={};return t="width"in e.colWidth?{width:e.colWidth.width}:{width:"".concat(e.colWidth.widthPercent,"%"),minWidth:e.colWidth.minWidth},{...zu,...t}}function Gu(e){let{isLoading:t,unarchivedTeams:i,archivedTeams:n}=e;const{isMobile:s=!1}=(0,be.Fy)(),[,,a]=(0,Me.oR)(Kc),r=(0,ei.y)((()=>({container:{marginTop:8},header:{display:"flex",justifyContent:"space-between",alignItems:"center"},subheader:{display:"flex",flexDirection:"column"}})),[]),l=(0,Me.VK)((()=>t?[]:[...i,...n]),[t,n,i]),d=(0,u.useCallback)((()=>Fc.lo("workspace_settings")),[]);return o()("div",{style:r.container},void 0,o()(Yt.Z,{large:!s,style:r.header,small:!0},void 0,o()("div",{style:r.subheader},void 0,o()(y.FormattedMessage,{id:"manageTeamsBrowser.title",description:"Title of the section in teamspace settings for the manage teamspaces browser. This section shows a list of all teamspaces in the workspace.",defaultMessage:"Manage teamspaces"}),o()(oi.Z,{isSmall:!0,style:{marginTop:3}},void 0,o()(y.FormattedMessage,{id:"manageTeamsBrowser.subtitle",description:"Descripton of the teamspace settings in manage teamspaces browser",defaultMessage:"Manage all teamspaces you have access here"}))),o()(Ee.Z,{onClick:d,isLarge:!0,className:N.my},void 0,o()(y.FormattedMessage,{id:"manageTeamsBrowser.newTeamButton.text",description:"Button for creating a new teamspace.",defaultMessage:"New teamspace"}))),t?o()(qn.Z,{}):m().createElement(m().Fragment,null,o()(bu,{teamStores:l,manageTeamsStore:a}),o()(Ru,{teamStores:l,manageTeamsStore:a})))}function Ku(e){let{title:t,description:i,disabled:n=!1,selected:s,onChange:a=(()=>{})}=e;return o()("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>!n&&a(!s)},void 0,o()("div",{style:{fontSize:14,marginRight:8,flexGrow:1}},void 0,t,i&&o()(oi.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"80%"}},void 0,i)),o()("div",{style:{marginTop:5}},void 0,o()(es.Z,{on:s,disabled:n})))}function ju(){const e=(0,be.Fy)();return o()(Yt.Z,{large:!e.isMobile||void 0,divider:e.isMobile?void 0:"full"},void 0,o()(y.FormattedMessage,{id:"teamsWorkspaceSettings.title",description:"Title of the Teamspaces settings page inside workspace settings. This is where global settings for the teamspaces feature are set.",defaultMessage:"Teamspace settings"}))}function Yu(){var e;const t=(0,be.O7)(),[{currentSpaceStore:i}]=(0,Me.oR)(F.default),[,,n]=(0,Me.oR)(void 0,le.Z),s=(0,Me.VK)((()=>i&&n.getValueForSpace(i)),[i,n]),a=null!==(e=null==s?void 0:s.disableTeamCreation)&&void 0!==e&&e,r=void 0===s,l=(0,u.useCallback)((()=>{i&&s&&async function(e){let{newSettingValue:t,environment:i,workspaceSecuritySettings:n,spaceStore:s}=e;const a="on"===re.default.getGroup("show_workspace_owner"),r=o()(y.FormattedMessage,"allowTeamCreation"===t?{id:"manageTeamsHelpers.confirmChangeSecuritySetting.allowTeamCreation",defaultMessage:"Are you sure you want allow all members of this workspace to create teams?",description:"Confirmation dialog title asking the user if they want to turn on the 'Limit teamspace creation' workspace setting."}:a?{id:"manageTeamsHelpers.confirmChangeSecuritySetting.workspaceOwners.disableTeamCreation",defaultMessage:"Are you sure you want to limit teamspace creation to only workspace owners?",description:"Confirmation dialog title asking the workspace owner if they want to turn on the 'Limit team creation' workspace setting."}:{id:"manageTeamsHelpers.confirmChangeSecuritySetting.disableTeamCreation",defaultMessage:"Are you sure you want to limit teamspace creation to only admins?",description:"Confirmation dialog title asking the user if they want to turn on the 'Limit team creation' workspace setting."});!!(await C.confirmUserAction({message:r}))&&(0,Ys.n)(i,{securitySettingsState:{...n,disableTeamCreation:"disableTeamCreation"===t},spaceStore:s})}({newSettingValue:a?"allowTeamCreation":"disableTeamCreation",environment:t,spaceStore:i,workspaceSecuritySettings:s})}),[i,a,t,s]),d=(0,ii.u)();return m().createElement(m().Fragment,null,o()(so.Z,{size:34}),o()(Ku,{disabled:r,onChange:l,title:o()(y.FormattedMessage,d?{id:"teamWorkspacesSettings.disableTeamCreation.workspaceOwners.title",description:"Title for a setting that, when on, will only allow workspace owners to create new teamspaces.",defaultMessage:"Limit teamspace creation to only workspace owners"}:{id:"teamWorkspacesSettings.disableTeamCreation.title",description:"Title for a setting that, when on, will only allow workspace admins to create new teamspaces.",defaultMessage:"Limit teamspace creation to only admins"}),description:o()(y.FormattedMessage,d?{id:"teamWorkspacesSettings.disableTeamCreation.workspaceOwnercaption",description:"Description for a setting that, when on, will only allow workspace owners to create new teamspaces.",defaultMessage:"Only allow workspace owners to create teamspaces"}:{id:"teamWorkspacesSettings.disableTeamCreation.caption",description:"Description for a setting that, when on, will only allow workspace admins to create new teams.",defaultMessage:"Only allow workspace admins to create teamspaces"}),selected:a}),o()(so.Z,{size:34}))}function Qu(e){const t=(0,ei.y)((()=>({learnMoreLinkContainer:{paddingTop:6,paddingBottom:20}})),[]),i=(0,be.O7)(),[{currentSpaceStore:n,currentUserStore:s,currentSpaceViewStore:a}]=(0,Me.oR)(F.default),[r]=(0,Kn.r5)((async()=>n&&s?await(0,z.qX)({environment:i,spaceStore:n,includeArchived:!0,currentUserId:s.id}):[]),[i,n,s]),{archivedTeams:l,unarchivedTeams:d}=(0,Me.VK)((()=>{if("resolved"!==r.status)return{archivedTeams:[],unarchivedTeams:[]};const e=[],t=[];return r.value.forEach((i=>{i.isDefined()&&(void 0===i.getArchivedBy()?t.push(i):e.push(i))})),{archivedTeams:e,unarchivedTeams:t}}),[r.status,r.value]),{loaded:u,teams:m}=(0,Me.VK)((()=>{const e={loaded:!1,teams:[]};return"idle"===r.status||"pending"===r.status?e:null!=n&&n.isDefined()&&null!=a&&a.isDefined()&&a?{loaded:!0,teams:c().uniqBy([...d||[],...a.getTeamsStores()],(e=>e.id))}:e}),[r.status,n,a,d]);return o()(yo.Z,{},void 0,o()(ju,{}),o()(jc.Z,{helpCenterLocation:"settingsAndPermissions",analyticsFrom:"teams_learn_more_workspace_settings",containerStyle:t.learnMoreLinkContainer}),o()(nu,{allTeams:m,loaded:u}),o()(Yu,{}),o()(Gu,{isLoading:!u,unarchivedTeams:m,archivedTeams:l}))}var Xu=i(62296);class Ju extends I.Z{getInitialState(){return{emailInputValue:"",showAllInviteCredits:!1}}}const $u=Ju;var em=i(47593);class tm extends p.Z{constructor(){super(...arguments),l()(this,"handleImportActionClick",(()=>{em.Z.setState({open:!0}),M.trackCreditItemActionClick(this.environment,{type:"import_evernote"})})),l()(this,"handleWebActionClick",(()=>{k.navigateToExternalURL({environment:this.environment,url:"/product"}),M.trackCreditItemActionClick(this.environment,{type:"web_login"})})),l()(this,"handleDesktopActionClick",(()=>{k.navigateToExternalURL({environment:this.environment,url:"/desktop"}),M.trackCreditItemActionClick(this.environment,{type:"desktop_login"})})),l()(this,"handleMobileActionClick",(()=>{k.navigateToExternalURL({environment:this.environment,url:"/mobile"}),M.trackCreditItemActionClick(this.environment,{type:"mobile_login"})})),l()(this,"handleBrowserExtensionActionClick",(()=>{k.navigateToExternalURL({environment:this.environment,url:"/web-clipper"}),M.trackCreditItemActionClick(this.environment,{type:"browser_extension"})})),l()(this,"handleMobileShareSheetActionClick",(()=>{k.navigateToExternalURL({environment:this.environment,url:"/mobile"}),M.trackCreditItemActionClick(this.environment,{type:"mobile_share_sheet"})}))}renderComponent(){return o()("div",{style:this.getWrapperStyle()},void 0,o()("div",{style:{flex:0}},void 0,this.renderLeft()),o()("div",{style:this.getCenterStyle()},void 0,o()("div",{},void 0,this.renderTitle()),o()(oi.Z,{isSmall:!0,style:{marginBottom:2}},void 0,this.renderCaption())),o()("div",{style:{flex:0}},void 0,this.renderRight()))}renderTitle(){const{credit:e,intl:t}=this.props;if("invited_user"===e.type){const i=this.getUserStore(e.to_user_id).getValue();return o()(u.Fragment,{},void 0,(0,Ce.Nz)(t,i)," ",!e.activated&&i&&!i.onboarding_completed&&o()("span",{style:{color:this.theme.mediumTextColor}},void 0,o()(y.FormattedMessage,{id:"userCreditSettings.inviteFriendsSection.userHasNotSignedUpNote",defaultMessage:"(has not signed up)",description:"Annotation that appears next to a referred user's name if the user hasn't signed up for Notion yet"})),!e.activated&&i&&i.onboarding_completed&&o()("span",{style:{color:this.theme.mediumTextColor}},void 0,o()(y.FormattedMessage,{id:"userCreditSettings.inviteFriendsSection.userHasAlreadySignedUpNote",defaultMessage:"(has already signed up)",description:"Annotation that appears next to a referred user's name if the user has signed up for Notion already"})))}if("invited_by_user"===e.type){const i=this.getUserStore(e.from_user_id).getValue();return o()(u.Fragment,{},void 0,(0,Ce.Nz)(t,i),o()("span",{style:{color:this.theme.mediumTextColor}},void 0,o()(y.FormattedMessage,{id:"userCreditSettings.inviteFriendsSection.sourceOfReferralNote",defaultMessage:"(invited you)",description:"Annotation that appears next to the name of the user who invited this user to Notion"})))}return"import_evernote"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.evernoteImport.title",defaultMessage:"Import from Evernote"}):"web_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webApp.title",defaultMessage:"Log in on the web"}):"desktop_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.desktopApp.title",defaultMessage:"Log in on the desktop app"}):"mobile_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileApp.title",defaultMessage:"Log in on the mobile app"}):"browser_extension"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webClipper.title",defaultMessage:"Use the Web Clipper"}):"mobile_share_sheet"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileShare.title",defaultMessage:"Use the iOS or Android system share menu"}):void 0}renderCaption(){const{credit:e,intl:t}=this.props;if("invited_user"===e.type){const t=this.getUserStore(e.to_user_id).getValue();return t&&t.email}if("invited_by_user"===e.type){const t=this.getUserStore(e.from_user_id).getValue();return t&&t.email}return"import_evernote"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.evernoteImport.description",defaultMessage:"Import your notes and notebooks"}):"web_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webApp.description",defaultMessage:"Sign in to Notion from any web browser"}):"desktop_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.desktopApp.description",defaultMessage:"Download the desktop app and sign in"}):"mobile_login"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileApp.description",defaultMessage:"Download the mobile app and sign in"}):"browser_extension"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webClipper.description",defaultMessage:"Download the Chrome extension and save a link"}):"mobile_share_sheet"===e.type?t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileShare.description",defaultMessage:"Use the share menu to save a link into Notion"}):void 0}renderLeft(){const{credit:e}=this.props;if("invited_user"===e.type){const t=this.getUserStore(e.to_user_id);return o()(Hn.Z,{userValue:t.getValue(),style:{marginRight:8},size:24,hasTooltip:!0})}if("invited_by_user"===e.type){const t=this.getUserStore(e.from_user_id);return o()(Hn.Z,{userValue:t.getValue(),style:{marginRight:8},size:24,hasTooltip:!0})}return"import_evernote"===e.type?h.Z.evernoteLogo(this.getIconStyle()):"web_login"===e.type?h.Z.logInWeb(this.getIconStyle()):"desktop_login"===e.type?h.Z.deviceDesktop(this.getIconStyle()):"mobile_login"===e.type?h.Z.deviceMobile(this.getIconStyle()):"browser_extension"===e.type?h.Z.googleChrome(this.getIconStyle()):"mobile_share_sheet"===e.type?h.Z.deviceMobileShareSheet(this.getIconStyle()):void 0}renderRight(){const{credit:e,intl:t}=this.props;let i;return"import_evernote"===e.type?i={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.evernoteImport.actionLink",defaultMessage:"Connect"}),onClick:this.handleImportActionClick}:"web_login"===e.type?i={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webApp.actionLink",defaultMessage:"Visit"}),onClick:this.handleWebActionClick}:"desktop_login"===e.type?i={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.desktopApp.actionLink",defaultMessage:"Download"}),onClick:this.handleDesktopActionClick}:"mobile_login"===e.type?i={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileApp.actionLink",defaultMessage:"Download"}),onClick:this.handleMobileActionClick}:"browser_extension"===e.type?i={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.webClipper.actionLink",defaultMessage:"Install"}),onClick:this.handleBrowserExtensionActionClick}:"mobile_share_sheet"===e.type&&(i={text:t.formatMessage({id:"userCreditSettings.otherWaysToEarnCreditSection.mobileShare.actionLink",defaultMessage:"Download"}),onClick:this.handleMobileShareSheetActionClick}),o()("div",{style:{display:"flex",alignItems:"center"}},void 0,i&&!e.activated&&o()(Je.Z,{isBlue:!0,isSmall:!0,onClick:i.onClick},void 0,i.text),o()("div",{style:{minWidth:32,marginLeft:8,marginRight:8,textAlign:"right",fontWeight:v.Z.fontWeight.semibold,...!e.activated&&{color:this.theme.lightTextColor}}},void 0,(0,tr.Dx)({amount:e.amount,currency:"dollar",intl:this.props.intl})),o()("div",{style:this.getTickStyles(e.activated)},void 0,h.Z.check({fill:g.ZP.white,width:12,height:12,opacity:e.activated?1:0})))}getUserStore(e){const{currentSpaceStore:t}=F.default.state;if(!t)throw new Error("No current space.");return Mt.Z.createChildStore(t,{table:Ce.KJ,id:e})}getWrapperStyle(){const e="1px solid ".concat(this.theme.regularDividerColor);return{display:"flex",alignItems:"center",borderTop:this.props.isFirst?e:void 0,borderBottom:e,paddingTop:8,paddingBottom:8}}getCenterStyle(){return{flex:1,fontSize:14,marginLeft:4}}getIconStyle(){return{width:24,height:24,fill:this.theme.mediumIconColor,marginRight:8}}getTickStyles(e){const t=e?void 0:"inset 0 0 0 2px ".concat(this.theme.regularDividerColor);return{display:"flex",alignItems:"center",justifyContent:"center",width:20,height:20,borderRadius:20,background:e?g.ZP.blue:void 0,boxShadow:t}}}const im=(0,y.injectIntl)(tm);class nm extends p.Z{constructor(){super(...arguments),l()(this,"storeTypes",{store:$u}),l()(this,"renderCredit",((e,t)=>o()(im,{credit:e,isFirst:0===t},e.id))),l()(this,"handleInviteCreditsToggleShowMoreClick",(()=>{const{store:e}=this.stores;e.setState({...e.state,showAllInviteCredits:!e.state.showAllInviteCredits})})),l()(this,"handleApplyCreditClick",(()=>{const{data:e}=this.props;ve.Z.setState({open:!0,currentTab:"subscribed_admin"===e.type?"billing":"plans",defaultSubtab:void 0}),M.trackApplyCreditClick(this.environment)}))}willMount(){D.bi(this.environment)}renderComponent(){if(cn.Z.state.online){const{credits:e}=this.props.data;return this.renderSettings(e)}return this.renderOfflineMessage()}renderOfflineMessage(){return o()(yo.Z,{},void 0,o()(oi.Z,{isSmall:!0,style:{textAlign:"center"}},void 0,o()(y.FormattedMessage,{id:"userCreditSettings.offline.message",defaultMessage:"Please go online to manage your account credit."})))}renderOtherCreditWays(e){const t=this.getActionCredits(e);return t.length>0&&o()(u.Fragment,{},void 0,o()(Yt.Z,{large:!0},void 0,o()(y.FormattedMessage,{id:"userCreditSettings.otherWaysToEarnCreditSectionAlt.title",defaultMessage:"Ways to earn credit"})),o()("div",{},void 0,t.map(this.renderCredit)))}renderReferralSection(e){const{store:t}=this.stores,{showAllInviteCredits:i}=t.state,n=this.getInviteCredits(e),s=i?n:n.slice(0,nm.showInviteCreditCount);return n.length>0&&o()(m().Fragment,{},void 0,o()("div",{style:this.getHeaderContainerStyles()},void 0,o()("div",{style:this.getHeaderStyles()},void 0,o()(y.FormattedMessage,{id:"userCreditSettings.inviteFriendsSection.title",defaultMessage:"Invite friends and earn credit"}))),o()("div",{style:this.getInviteCreditStyles()},void 0,s.map((e=>this.renderCredit(e,1))),n.length>nm.showInviteCreditCount&&o()(Is.Z,{style:{marginTop:8},onClick:this.handleInviteCreditsToggleShowMoreClick},void 0,o()(y.FormattedMessage,i?{id:"userCreditSettings.inviteFriendsSection.showLessReferredUsers.link",defaultMessage:"Show {numberOfReferredUsers} less",values:{numberOfReferredUsers:n.length-nm.showInviteCreditCount}}:{id:"userCreditSettings.inviteFriendsSection.showMoreReferredUsers.link",defaultMessage:"Show {numberOfReferredUsers} more",values:{numberOfReferredUsers:n.length-nm.showInviteCreditCount}}))))}renderTotalCreditEarned(e){const{intl:t}=this.props,i=e.reduce(((e,t)=>e+(t.activated?t.amount:0)),0);return i>0&&o()("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-end"}},void 0,o()($o.Z,{title:t.formatMessage({id:"userCreditSettings.helpButton.caption",defaultMessage:"Learn how to earn and apply credits"}),href:(0,V.UY)("guides.referralsAndCredit"),analyticsFrom:"credit_settings"}),o()("div",{style:{display:"flex",alignItems:"center",paddingRight:28,marginTop:16}},void 0,o()("div",{style:{marginLeft:"auto",fontSize:14,color:this.theme.mediumTextColor,paddingRight:6}},void 0,o()(y.FormattedMessage,{id:"userCreditSettings.otherWaysToEarnCreditSection.totalCreditSummaryText",defaultMessage:"Total credit earned"})),o()("div",{style:{minWidth:32,marginLeft:8,fontWeight:v.Z.fontWeight.semibold,textAlign:"right"}},void 0,(0,tr.Dx)({amount:i,currency:"dollar",intl:t}))))}renderSettings(e){return o()(yo.Z,{},void 0,this.renderCreditBalance(),this.renderReferralSection(e),this.renderOtherCreditWays(e),this.renderTotalCreditEarned(e))}renderCreditBalance(){var e=this;const{data:t,intl:i}=this.props,{availableCredit:n,totalCredit:s}=t,a=ye.default.state.data;if(!a)return;const r=T.YK(a),l=Math.floor(n/Kt.Z.pricing.personal.monthlyPrice),d=s>=dc.cw;return o()(u.Fragment,{},void 0,o()(Yt.Z,{large:!0,divider:"full"},void 0,o()(y.FormattedMessage,{id:"userCreditSettings.creditBalanceSection.title",defaultMessage:"Credit balance"})),o()("div",{style:{display:"flex",justifyContent:"space-between",marginBottom:40,fontSize:14}},void 0,o()("div",{},void 0,o()(y.FormattedMessage,{id:"userCreditSettings.creditBalanceSection.creditBalanceMessage",defaultMessage:"Your current credit balance is {creditBalance}.",values:{creditBalance:o()("b",{style:{color:this.theme.regularTextColor}},void 0,(0,tr.Dx)({amount:n,currency:"dollar",intl:i}))}})," ",n>0&&!d&&o()(y.FormattedMessage,{id:"userCreditSettings.creditBalanceSection.freeMonthMessage",description:"Message in sidebar letting user know how many months of free Notion they can get with their credits",defaultMessage:"{numberOfMonths, plural, one {That's equivalent to <b>{numberOfMonths} month</b> of the Personal Pro Plan.} other {That's equivalent to <b>{numberOfMonths} months</b> of the Personal Pro Plan.}}",values:{numberOfMonths:l,b:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return o()("b",{style:{color:e.theme.regularTextColor}},void 0,i)}}}),d&&o()(y.FormattedMessage,{id:"userCreditSettings.creditBalanceSection.maximumCreditBalanceExceeded",defaultMessage:"You've exceeded the maximum amount of credit per account, {maximumCreditBalance}. Any additional credit you earn will not increase your balance.",values:{maximumCreditBalance:(0,tr.Dx)({amount:dc.cw,currency:"dollar",intl:i})}})),n>0&&o()(jt.Z,{isLarge:!0,onClick:this.handleApplyCreditClick},void 0,r?h.Z.settingsBilling(nm.applyCreditButtonIconStyle):h.Z.settingsUpgrade(nm.applyCreditButtonIconStyle),r?i.formatMessage({id:"userCreditSettings.creditBalanceSection.applyCreditButton.label",defaultMessage:"Apply your credit"}):i.formatMessage({id:"userCreditSettings.creditBalanceSection.upgradeForFreeButton.label",defaultMessage:"Upgrade for free"}))))}getActionCredits(e){const{id:t}=this.environment.currentUser,{currentUserSettingsStore:i}=F.default.state;if(!t||!i)return[];const n=[],o=i.getValue();if(o&&dc.qQ(o)){const i={id:"web_login_default",version:0,amount:dc.lk.web_login,activated:!1,created_timestamp:Date.now(),type:"web_login",user_id:t};n.push(e.find((e=>"web_login"===e.type))||i);const o={id:"desktop_login_default",version:0,amount:dc.lk.desktop_login,activated:!1,created_timestamp:Date.now(),type:"desktop_login",user_id:t};n.push(e.find((e=>"desktop_login"===e.type))||o);const s={id:"mobile_login_default",version:0,amount:dc.lk.mobile_login,activated:!1,created_timestamp:Date.now(),type:"mobile_login",user_id:t};n.push(e.find((e=>"mobile_login"===e.type))||s)}const s={id:"import_evernote_default",version:0,amount:dc.lk.import_evernote,activated:!1,created_timestamp:Date.now(),type:"import_evernote",user_id:t};n.push(e.find((e=>"import_evernote"===e.type))||s);const a={id:"browser_extension_default",version:0,amount:dc.lk.browser_extension,activated:!1,created_timestamp:Date.now(),type:"browser_extension",user_id:t};n.push(e.find((e=>"browser_extension"===e.type))||a);const r={id:"mobile_share_sheet_default",version:0,amount:dc.lk.mobile_share_sheet,activated:!1,created_timestamp:Date.now(),type:"mobile_share_sheet",user_id:t};return n.push(e.find((e=>"mobile_share_sheet"===e.type))||r),n}getInviteCredits(e){const t=e.find((e=>"invited_by_user"===e.type)),i=e.filter((e=>"invited_user"===e.type&&!e.activated)),n=e.filter((e=>"invited_user"===e.type&&e.activated));return c().compact([t,...c().sortBy(i,(e=>-e.created_timestamp)),...c().sortBy(n,(e=>-e.created_timestamp))])}getHeaderContainerStyles(){return{borderBottom:"1px solid ".concat(this.theme.regularDividerColor),paddingBottom:4,marginBottom:12}}getHeaderStyles(){return{fontWeight:v.Z.fontWeight.medium,fontSize:18}}getInviteCreditStyles(){return{marginBottom:44}}}l()(nm,"showInviteCreditCount",3),l()(nm,"applyCreditButtonIconStyle",{width:20,height:20,marginRight:6});const om=(0,y.injectIntl)(nm);class sm extends p.Z{constructor(){var e;super(...arguments),e=this,l()(this,"lastSpaceSettingsStoreState",void 0),l()(this,"lastSpaceSettingsModalStoreOpen",!1),l()(this,"storeTypes",{spaceBasicSettingsStore:me,spaceProfileSettingsStore:fe,securitySettingsStore:le.Z,spaceSecuritySamlSettingsStore:P,spaceDomainSettingsStore:ge}),l()(this,"renderContent",(()=>{const e={profile:this.renderProfile,notifications_and_settings:this.renderNotificationsAndSettings,credit:this.renderCredit,language_and_region:this.renderLanguageAndRegion,connected_apps:this.renderConnectedApps,debug_zone:this.renderDebugZone,settings:this.renderSettings,teams:this.renderTeamsSettings,members:this.renderMembers,analytics:this.renderAnalytics,plans:this.renderPlans,billing:this.renderBilling,subscription:this.renderSubscription,security:this.renderSecuritySaml,identity_provisioning:this.renderIdentityProvisioning,integrations:this.renderIntegrations,experiments:this.renderExperiments,audit_log:this.renderAuditLog};return o()(Mo.Z,{capture:!0,allowEsc:!0,render:t=>o()(wo.Z,{capture:!0,ignoreBlockSelection:!0,restoreSelection:!0,focusOffscreenInput:!1,render:()=>m().createElement(Rr,a()({sidebar:this.renderSidebar()},t),e[ve.Z.state.currentTab]())})})})),l()(this,"renderTabDot",(e=>{const{currentSpaceStore:t}=F.default.state;return"members"===e&&this.environment.device.isDesktop&&null!=t&&t.canEditMembership()&&(0,U.p1)(this.environment)&&Se.Z.state.count>0?o()(_c.z,{color:this.theme.redBadgeBackground}):null})),l()(this,"renderProfile",(()=>o()(dd,{isEducationPlan:T.wl(ye.default.state.data),spaceProfileSettingsStore:this.stores.spaceProfileSettingsStore}))),l()(this,"renderNotificationsAndSettings",(()=>o()(Br.Z,{isMobile:!1}))),l()(this,"renderLanguageAndRegion",(()=>o()(Ar,{}))),l()(this,"renderSettings",(()=>o()(Wl,{spaceStore:this.props.spaceStore,spaceBasicSettingsStore:this.stores.spaceBasicSettingsStore}))),l()(this,"renderTeamsSettings",(()=>o()(Qu,{}))),l()(this,"renderMembers",(()=>o()(Vl.Z,{store:this.props.spaceStore,unreadAccessRequests:Se.Z.state.count}))),l()(this,"shouldRenderAnalyticsTab",(()=>{const{device:e}=this.environment;return!e.isMobile&&"enterprise"===this.props.spaceStore.getSubscriptionTier()&&re.default.checkGate("show_workspace_analytics")})),l()(this,"renderAnalytics",(()=>o()(il,{}))),l()(this,"renderPlans",(()=>{const{data:e}=ye.default.state;if(e)return o()(Pc,{spaceStore:this.props.spaceStore,data:e})})),l()(this,"renderBilling",(()=>{const{data:e}=ye.default.state,t=T.XX(e);return e&&"subscribed_admin"===e.type&&t?o()(jd,{spaceStore:this.props.spaceStore,subscriptionData:e,customerData:t}):e&&"unsubscribed_admin"===e.type?o()(Qd,{spaceStore:this.props.spaceStore,data:e}):void 0})),l()(this,"renderExperiments",(()=>o()(yo.Z,{},void 0,o()(Io.Ub,{})))),l()(this,"shouldRenderMembersPrompt",(()=>{var e,t;const{currentSpaceViewStore:i,currentSpaceStore:n,currentUserStore:o}=F.default.state;if(null==o||!o.id)return!1;if(null==n||!n.isDefined())return!1;if("enterprise"!==(null==n?void 0:n.getSubscriptionTier())||!(0,f.wv)({permissions:n.getPermissionItems()},o.id)||!(0,W.U7)())return!1;const s=null==i?void 0:i.getSettings();return"dismissed"!==(null==s||null===(e=s.enterprise_settings_prompt)||void 0===e?void 0:e.status)&&"hidden"!==(null==s||null===(t=s.enterprise_settings_prompt)||void 0===t?void 0:t.status)&&(function(e){var t;const{currentSpaceViewStore:i}=F.default.state;i&&void 0===(null===(t=i.getSettings())||void 0===t?void 0:t.enterprise_settings_prompt)&&A.createAndCommit({userAction:"userSettingsActions.updateOnboardingChecklistSettings",environment:e,perform:e=>{B(i,e,{enterprise_settings_prompt:{status:"showing",num_times_shown:0}})}})}(this.environment),!0)})),l()(this,"shouldRenderDomainClaimPrompt",(()=>{var e,t;const{currentSpaceViewStore:i,currentSpaceStore:n,currentUserStore:o}=F.default.state;if(!re.default.checkGate("domain_claim_view"))return!1;if(null==o||!o.id)return!1;if(null==n||!n.isDefined())return!1;if("enterprise"!==(null==n?void 0:n.getSubscriptionTier())||!(0,f.wv)({permissions:n.getPermissionItems()},o.id))return!1;const s=null==i?void 0:i.getSettings();return"dismissed"!==(null==s||null===(e=s.domain_claim_settings_prompt)||void 0===e?void 0:e.status)&&"hidden"!==(null==s||null===(t=s.domain_claim_settings_prompt)||void 0===t?void 0:t.status)&&(function(e){var t;const{currentSpaceViewStore:i}=F.default.state;i&&void 0===(null===(t=i.getSettings())||void 0===t?void 0:t.domain_claim_settings_prompt)&&A.createAndCommit({userAction:"userSettingsActions.updateOnboardingChecklistSettings",environment:e,perform:e=>{B(i,e,{domain_claim_settings_prompt:{status:"showing",num_times_shown:0}})}})}(this.environment),!0)})),l()(this,"shouldRenderAuditLog",(()=>{const{device:e}=this.environment;return!e.isMobile&&"enterprise"===T.CM(this.environment)&&this.props.spaceStore.canAdmin()&&"on"===re.default.getEligibleGroup({experimentId:"show_audit_log",defaultGroup:"on"})})),l()(this,"renderAuditLog",(()=>{if(!this.shouldRenderAuditLog())return null;const e=this.getAuditLogBannerText();return m().createElement(m().Fragment,null,o()(yo.Z,{bannerText:e},void 0,o()(en,{spaceStore:this.props.spaceStore})))})),l()(this,"getAuditLogBannerText",(()=>{var t,i;const{currentSpaceViewStore:n}=F.default.state;if(!(null==n||null===(t=n.getSettings())||void 0===t||null===(i=t.audit_log_banner)||void 0===i?void 0:i.seen_page_audience)&&"on"===re.default.getGroup("show_private_names_in_audit_log"))return function(e,t){var i;const{currentSpaceViewStore:n}=F.default.state;if(!n)return;const o=null===(i=n.getSettings())||void 0===i?void 0:i.audit_log_banner;o&&o[t]||A.createAndCommit({userAction:"spaceViewActions.setAuditLogBannerToSeen.".concat(t),environment:e,perform:e=>{B(n,e,{audit_log_banner:{...o,[t]:!0}})}})}(this.environment,"seen_page_audience"),o()(y.FormattedMessage,{id:"auditLog.bannerText.pageAudienceNotification",defaultMessage:"You can now view the audience (or visibility level) of the target page for page events moving forward.<a>Learn more →</a>",description:"Banner that shows at top of audit log informing users about the new page audience feature.",values:{arrowRight:h.Z.arrowRight({width:12,height:12,marginLeft:2}),a:function(){for(var t=arguments.length,i=new Array(t),n=0;n<t;n++)i[n]=arguments[n];return o()("a",{style:{cursor:"pointer",textDecoration:"underline",marginLeft:2,color:g.ZP.white},onClick:()=>{(0,k.navigateToExternalURL)({environment:e.environment,url:(0,V.UY)("guides.auditLog.pageEvents")})}},void 0,i)}}})})),l()(this,"renderSubscription",(()=>o()(yo.Z,{},void 0,o()(xc.Z,{})))),l()(this,"renderCredit",(()=>{const{data:e}=ye.default.state;if(e)return o()(om,{data:e})})),l()(this,"renderConnectedApps",(()=>o()(Xu.Z,{location:"settings-page"}))),l()(this,"renderDebugZone",(()=>o()(hd,{store:this.props.spaceStore}))),l()(this,"renderSecuritySaml",(()=>o()(aa,{spaceStore:this.props.spaceStore,securitySettingsStore:this.stores.securitySettingsStore,samlConfigStore:this.stores.spaceSecuritySamlSettingsStore,domainSettingsStore:this.stores.spaceDomainSettingsStore,userStore:this.props.userStore}))),l()(this,"renderIdentityProvisioning",(()=>o()(Va,{spaceStore:this.props.spaceStore,samlConfigStore:this.stores.spaceSecuritySamlSettingsStore,domainSettingsStore:this.stores.spaceDomainSettingsStore,userStore:this.props.userStore}))),l()(this,"renderIntegrations",(()=>o()(bo,{spaceStore:this.props.spaceStore,userStore:this.props.userStore}))),l()(this,"handleModalOpen",(()=>{D.bi(this.environment),this.resetAuditLogSetting(),(0,S.kj)({environment:this.environment,spaceId:this.props.spaceStore.id,canAdmin:this.props.spaceStore.canAdmin()})})),l()(this,"handleModalDismiss",(()=>this.attemptCloseCurrentTab((()=>{ve.Z.setState({...ve.Z.state,open:!1}),ce.reset(),this.stores.spaceDomainSettingsStore.reset(),this.resetAuditLogSetting(),Se.Z.reset()}))))}willMount(e){super.willMount(e);const{spaceStore:t}=this.props,{securitySettingsStore:i}=this.stores,n=i.getValueForSpace(t);n&&i.setState(n)}willMountOrUpdate(e){super.willMountOrUpdate(e);const{open:t}=ve.Z.state,i=ve.Z.state;this.lastSpaceSettingsModalStoreOpen===t&&c().isEqual(this.lastSpaceSettingsStoreState,i)||t&&M.trackOpenSettings(this.environment,{tab:i.currentTab}),this.lastSpaceSettingsModalStoreOpen=t,this.lastSpaceSettingsStoreState=c().clone(i)}renderComponent(){const{open:e}=ve.Z.state;return o()(Zn.Z,{open:e,innerStyle:{width:1150,maxWidth:"calc(100vw - 100px)",height:"calc(100vh - 100px)",overflow:"hidden",borderRadius:5,maxHeight:715},onOpen:this.handleModalOpen,onDismiss:this.handleModalDismiss,render:this.renderContent,className:N.zY})}renderSidebar(){const{spaceStore:e}=this.props,{data:t}=ye.default.state,i=(0,O.S4)(this.environment),n=T.wY(t),s=(0,Io.mS)(),a=pd().length>0,r="on"===re.default.getEligibleGroup({experimentId:"split_identity_provisioning",defaultGroup:"unassigned"}),l="on"===re.default.getEligibleGroup({experimentId:"better_integrations",defaultGroup:"control"})?e.canAdmin():e.canRead();return o()("div",{style:sm.sidebarStyle},void 0,o()("div",{style:sm.sidebarTabsStyle},void 0,o()("div",{},void 0,o()("div",{style:this.getSidebarHeader()},void 0,i&&i.email||o()(y.FormattedMessage,{id:"spaceSettings.sidebar.personalSettingsSection.title",defaultMessage:"Me"})),this.renderTabButton("profile"),this.renderTabButton("notifications_and_settings"),this.renderTabButton("connected_apps"),this.renderTabButton("language_and_region"),t&&t.creditEnabled&&this.renderTabButton("credit"),a&&this.renderTabButton("debug_zone"),o()(so.Z,{size:18,isHidden:!0}),o()("div",{style:this.getSidebarHeader()},void 0,o()(y.FormattedMessage,{id:"spaceSettings.sidebar.workspaceSettingsSection.title",defaultMessage:"Workspace"})),this.renderTabButton("settings"),e.canAdmin()&&(0,z.bq)()&&this.renderTabButton("teams"),e.canRead()&&this.renderTabButton("members"),this.shouldRenderAnalyticsTab()&&this.renderTabButton("analytics"),e.canRead()&&this.renderTabButton("plans"),e.canAdmin()&&t&&("subscribed_admin"===t.type||"unsubscribed_admin"===t.type)&&!n&&this.renderTabButton("billing"),n&&this.renderTabButton("subscription"),e.canAdmin()&&this.renderTabButton("security"),r&&e.canAdmin()&&this.renderTabButton("identity_provisioning"),l&&this.renderTabButton("integrations"),this.shouldRenderAuditLog()&&this.renderTabButton("audit_log"),s&&this.renderTabButton("experiments"),e.canRead()&&o()(tn.Z,{source:"settings"}))),this.shouldRenderDomainClaimPrompt()?o()(ko,{navigateToDomainManagement:()=>{this.attemptCloseCurrentTab((()=>{ve.Z.setState({...ve.Z.state,currentTab:"identity_provisioning",defaultSubtab:void 0}),this.stores.spaceDomainSettingsStore.reset(),M.trackToggleSettingsTab(this.environment,{tab:"identity_provisioning"})}))}}):this.shouldRenderMembersPrompt()&&o()(To,{onMembersTabClick:()=>{this.attemptCloseCurrentTab((()=>{ve.Z.setState({...ve.Z.state,currentTab:"members"}),this.stores.spaceDomainSettingsStore.reset(),M.trackToggleSettingsTab(this.environment,{tab:"members"})}))}}))}renderTabButton(e){const t=ve.Z.state.currentTab===e,i=yd[e](this.environment),n=Sd[e]();return o()(ni.Z,{hovered:t,style:{display:"flex",alignItems:"center",justifyContent:"space-between",padding:"5px 15px"},onClick:i=>{t||this.attemptCloseCurrentTab((()=>{ve.Z.setState({...ve.Z.state,currentTab:e,defaultSubtab:void 0}),this.stores.spaceDomainSettingsStore.reset(),M.trackToggleSettingsTab(this.environment,{tab:e})}))}},void 0,o()("div",{style:{display:"flex",alignItems:"center",...t&&{fontWeight:v.Z.fontWeight.semibold}}},void 0,o()("div",{style:this.getIconWrapStyle()},void 0,i),o()(oi.Z,{},void 0,n)),this.renderTabDot(e))}async attemptCloseCurrentTab(e){const t="on"===re.default.getEligibleGroup({experimentId:"split_identity_provisioning",defaultGroup:"unassigned"}),{spaceStore:i}=this.props,{spaceProfileSettingsStore:n}=this.stores,{currentUserStore:s,currentUserSettingsStore:a}=F.default.state;if(!s||!a)throw new Error("No user or settings store.");const r=o()(y.FormattedMessage,{id:"spaceSettings.closeSettingsDialog.confirmationMessage",defaultMessage:"Your changes have not been saved. Save changes?"}),l=o()(y.FormattedMessage,{id:"spaceSettings.closeSettingsDialog.confirmationButton.label",defaultMessage:"Yes",description:"Label for button that appears below the question, 'Your changes have not been saved. Save changes?' to confirm that the user would like to save their changes."}),d=o()(y.FormattedMessage,{id:"spaceSettings.closeSettingsDialog.cancelationButton.label",defaultMessage:"No",description:"Label for button that appears below the question, 'Your changes have not been saved. Save changes?' to not save changes and return to settings menu."}),{currentTab:u}=ve.Z.state;if("profile"===u){if(!c().isEqual(n.state,n.getValueForUser(s,a))){const{profilePhoto:t,name:i,startDayOfWeek:s}=n.state;return i?C.showDialog({message:r,showCancel:!0,keepFocus:!0,items:[{label:o()(y.FormattedMessage,{id:"spaceSettings.closeSettingsDialog.updateSettingsButton.label",defaultMessage:"Update"}),color:"blue",onAccept:()=>{A.createAndCommit({userAction:"SpaceSettings.attemptCloseCurrentTab",environment:this.environment,perform:e=>{const{currentUserStore:n}=F.default.state;if(n&&b.A({userStore:n,data:{name:i,profilePhoto:t},transaction:e}),a){const t=a.getSettings();(null==t?void 0:t.start_day_of_week)!==s&&(0,L.d2)({userSettingsStore:a,data:{start_day_of_week:s},transaction:e})}}}),e()}}],handleCancel:()=>{e()}}):C.showErrorMessage(o()(y.FormattedMessage,{id:"profileSettings.personalInfoSection.nameMissing.message",defaultMessage:"Please fill in name."})),!0}e()}else if("settings"===u&&i.canEdit()){const{spaceBasicSettingsStore:t}=this.stores;if(!c().isEqual(t.state,t.getValueForSpace(i))){if(await C.confirmUserAction({message:r,acceptLabel:l,cancelLabel:d})){if(!(await x.Y5({environment:this.environment,spaceId:i.id,spaceBasicSettingsStore:t})))return!1;x.OF({environment:this.environment,spaceStore:this.props.spaceStore,spaceBasicSettingsStore:t}),e()}else e();return!0}e()}else if("security"===u&&i.canAdmin()){const{securitySettingsStore:n,spaceSecuritySamlSettingsStore:o,spaceDomainSettingsStore:s}=this.stores,a=!c().isEqual(n.state,n.getValueForSpace(i)),u=await async function(e,t){const i=new P;return await _({environment:e,spaceId:t.id,store:i}),Promise.resolve(i.state)}(this.environment,i),m=(o.state.emailDomains.length>0||"enterprise"===T.CM(this.environment))&&(!o.state.id||o.state.id===i.id),p=m&&!c().isEqual(o.state,u)&&!t,g=await w.getEmailDomainsForSpace(this.environment,{spaceId:i.id}),h=m&&!c().isEqual(s.state,g)&&s.state.spaceCreation&&0!==o.state.emailDomains.length&&!t;if(a||p||h){if(await C.confirmUserAction({message:r,acceptLabel:l,cancelLabel:d})){const{disablePublicAccess:t,disableGuests:r,disableMoveToSpace:l,disableExport:d,disableSpacePageEdits:c,disablePublicAccessRequests:u,disablePersonalBots:m,disableTeamCreation:g,disableMembershipRequests:f}=n.state;if(a&&A.createAndCommit({userAction:"SpaceSettings.attemptCloseCurrentTab",environment:this.environment,perform:e=>{x.Xr({environment:this.environment,disablePublicAccess:t,disableGuests:r,disableMoveToSpace:l,disableExport:d,disableSpacePageEdits:c,disablePublicAccessRequests:u,transaction:e,spaceStore:this.props.spaceStore,disablePersonalBots:m,disableTeamCreation:g,disableMembershipRequests:f})}}),p){const{state:e}=o,t=await w.adminSamlConfigForSpace(this.environment,{spaceId:this.props.spaceStore.id,status:e.status,useMetadataUrl:e.useMetadataUrl,idpMetadataUrl:e.idpMetadataUrl,idpMetadata:e.idpMetadata,createAccount:e.createAccount});"failed"===t.type&&C.showError(t)}if(h&&s.state.spaceCreation){const e=await w.updateWorkspaceCreationForEmailDomains(this.environment,{emailDomains:o.state.emailDomains,workspaceCreationEnum:s.state.spaceCreation,spaceId:i.id});"failed"===e.type&&C.showError(e)}e()}else e();return!0}e()}else"audit_log"===u?(this.resetAuditLogSetting(),e()):e();return!1}resetAuditLogSetting(){ne.reset(),ae.reset()}getSidebarHeader(){return{letterSpacing:"0.03em",textTransform:"uppercase",fontSize:11,lineHeight:1,marginBottom:1,color:this.theme.mediumTextColor,fontWeight:v.Z.fontWeight.medium,padding:"5px 15px",textOverflow:"ellipsis",overflow:"hidden"}}getIconWrapStyle(){return{width:20,height:20,marginRight:8,color:this.theme.regularIconColor,fill:this.theme.regularIconColor}}}l()(sm,"theme",void 0),l()(sm,"sidebarStyle",{display:"flex",flexDirection:"column",height:"100%",justifyContent:"space-between",paddingTop:10}),l()(sm,"sidebarTabsStyle",{overflow:"auto",paddingBottom:12});const am=sm},93039:(e,t,i)=>{i.d(t,{J:()=>I});var n=i(97464),o=i.n(n),s=i(77094),a=i.n(s),r=(i(33948),i(67294)),l=i.n(r),d=i(480),c=i(24405),u=i(31942),m=i(59054),p=i(97880),g=i(5366),h=i(50906),f=i(54642),v=i(80366),y=i(60709),S=i(27242),b=i(52275),M=i(74194),w=i(78140),C=i(58189),k=i(44532),T=i(72495);function I(e){const t=(0,c.y)((e=>({container:(0,v.s)(e),cityZipRow:{display:"flex"},verticalDivider:{display:"flex",borderLeft:"1px solid",borderLeftColor:e.groupedFormBorder},zipRow:{display:"flex",flex:2},stateRow:{display:"flex",flex:3}})),[]),i=(0,g.useIntl)(),n=(0,d.O7)();return a()("div",{},void 0,a()("div",{style:t.container},void 0,a()(P,{placeholder:i.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.fullName",defaultMessage:"Full name"}),address:e.address,updateAddress:e.updateAddress,addressKey:"name",environment:n}),e.shouldShowBusinessName&&a()(P,{placeholder:i.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.businessName",defaultMessage:"Business name (optional)"}),address:e.address,updateAddress:e.updateAddress,addressKey:"businessName",environment:n}),a()(Z,{updateAddress:e.updateAddress,address:e.address}),e.address&&l().createElement(l().Fragment,null,a()(P,{placeholder:i.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.address",defaultMessage:"Address"}),address:e.address,addressKey:"addressLine1",updateAddress:e.updateAddress,environment:n}),a()(P,{placeholder:i.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.city",defaultMessage:"City"}),addressKey:"city",address:e.address,updateAddress:e.updateAddress,environment:n}),a()("div",{style:t.cityZipRow},void 0,a()("div",{style:t.zipRow},void 0,a()(P,{placeholder:i.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.zipCode",defaultMessage:"Zip code"}),address:e.address,addressKey:"zipCode",updateAddress:e.updateAddress,environment:n})),a()("div",{style:t.verticalDivider}),a()("div",{style:t.stateRow},void 0,a()(P,{placeholder:i.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.state",defaultMessage:"State / Province"}),address:e.address,addressKey:"state",updateAddress:e.updateAddress,environment:n}))))))}function Z(e){const t=(0,d.O7)(),[i,n]=(0,r.useState)(!1),s=(0,g.useIntl)(),I=(0,c.y)((()=>({input:{background:"none",boxShadow:"none",padding:8}})),[]),[Z,P]=l().useState(""),[_]=(0,m.r5)((async()=>{const e=await f.getAvailableCountries(t,{});return"success"===e.type?e.data.countries:"failed"===e.type?[]:void(0,p.t1)(e)}),[t]),x=_.value;if(!x)return null;const F=(0,u.ZP)(Z,x,(e=>e.name)).map(((i,s)=>({key:s,render:e=>l().createElement(b.Z,o()({},e,{title:i.name})),action:()=>{i.countryCode!==e.address.country&&e.updateAddress({addressLine1:"",addressLine2:"",zipCode:"",city:"",state:"",country:i.countryCode});const o=S.Z.state;o.open&&S.Z.setState({...o,vatApplicable:Boolean(i.vatApplicable)}),P(i.name),n(!1),(0,h.trackSubscriptionUpgradeModalAddressFormUpdated)(t,{addressType:"country",addressUpdate:i.name})}})));return a()(v.c,{},void 0,a()(k.ZP,{popupType:k.ZP.PopupType.Popup,alignmentToOrigin:k.ZP.Alignment.End,placementToOrigin:k.ZP.Placement.Right,originGap:0,open:i,origin:a()(M.Z,{value:Z,focus:i,placeholder:s.formatMessage({id:"spaceSubscriptionPaymentForm.billingInformation.country",defaultMessage:"Country or region"}),style:I.input,onChange:t=>{P(t.target.value),e.updateAddress({country:void 0})},onFocus:()=>{n(!0)}}),onDismiss:()=>{n(!1)},render:()=>a()(w.Z,{menuType:y.o.Popup,width:"100%"},void 0,a()(C.Z,{type:C.i.Vertical,initialFocus:Z.length>0?0:void 0,sections:[{key:0,showNoResultMessage:!0,render:e=>l().createElement(T.Z,o()({},e,{title:a()(g.FormattedMessage,{id:"spaceSubscriptionBillingInfoForm.countryDropdown.title",defaultMessage:"Select a country or region"})})),items:F}]}))}))}function P(e){const t=(0,c.y)((()=>({input:{background:"none",boxShadow:"none",padding:8}})),[]);return a()(v.c,{},void 0,a()(M.Z,{value:e.address[e.addressKey],style:t.input,placeholder:e.placeholder,onBlur:(i=e.updateAddress,n=e.addressKey,o=e.environment,e=>{(0,h.trackSubscriptionUpgradeModalAddressFormUpdated)(o,{addressType:n,addressUpdate:e.target.value}),i({[n]:e.target.value})})}));var i,n,o}},10644:(e,t,i)=>{i.d(t,{Z:()=>c});var n=i(77094),o=i.n(n),s=(i(67294),i(83355)),a=i(5366),r=i(64369),l=i(27386);class d extends s.Z{renderComponent(){return o()(l.Z,{},void 0,o()(r.Z,{isSmall:!0,style:{textAlign:"center"}},void 0,o()(a.FormattedMessage,{id:"spaceSubscriptionPlans.offlineMessage",defaultMessage:"Please go online to manage your plan."})))}}const c=d},1063:(e,t,i)=>{i.d(t,{X:()=>u});var n=i(77094),o=i.n(n),s=(i(67294),i(480)),a=i(24405),r=i(5366),l=i(50906),d=i(21115),c=i(42402);function u(e){const t=(0,s.O7)(),i=(0,a.y)((()=>({couponLink:{fontSize:12}})),[]);return o()(c.Z,{href:"https://notionup.typeform.com/to/qYXezfBW",external:!0,style:i.couponLink,onClick:()=>{const i=d.CM(t);l.trackCouponTypeformClicked(t,{tier:e.tier,currentTier:i})}},void 0,o()("div",{},void 0,o()(r.FormattedMessage,{id:"startupCouponInlineLink.text",defaultMessage:"Are you a startup?",description:"Shown in our billing/upgrade settings to ask if a user's workspace belongs to a startup."})))}},13787:(e,t,i)=>{i.r(t),i.d(t,{default:()=>I});var n=i(77094),o=i.n(n),s=i(77422),a=i.n(s),r=(i(33948),i(67294)),l=i.n(r),d=i(83355),c=i(8848),u=i(53397),m=i(89101),p=i(82990),g=i(5366),h=i(54642),f=i(28020),v=i(33846),y=i(92083),S=i(9209),b=i(12318),M=i(42922),w=i(74194),C=i(22346),k=i(42402);class T extends d.Z{constructor(){super(...arguments),a()(this,"storeTypes",{promoCodeStore:v.Z,promoError:b.default.of(void 0)}),a()(this,"handleModalDismiss",(()=>{S.Z.setState({open:!1})})),a()(this,"handleChangeEmail",(()=>{this.handleModalDismiss(),y.Z.setState({open:!0,currentTab:"profile",defaultSubtab:void 0})})),a()(this,"handleInputChange",(e=>{this.stores.promoCodeStore.setState({...this.stores.promoCodeStore.state,inputValue:e.target.value.toUpperCase()}),this.stores.promoError.set(void 0)})),a()(this,"handleSubmitPromoCode",(async()=>{const e=this.stores.promoCodeStore.state.inputValue;if(e){const t=await h.getPromoCode(this.environment,{code:e});"failed"!==t.type&&t.data.promo?S.Z.state.open&&(await S.Z.state.handlePromoCode(this.stores.promoCodeStore.state.inputValue),this.handleModalDismiss()):this.stores.promoError.set(this.props.intl.formatMessage({defaultMessage:"Promo code {code} does not exist",id:"studentNotEligibleModal.numberedList.item2.promocode.errorMessage"},{code:e}))}}))}renderComponent(){const{open:e}=S.Z.state;return o()(C.Z,{open:e,innerStyle:T.wrapStyle,preventHideChildrenWhileOpening:!0,render:()=>this.renderModalContents(),onDismiss:this.handleModalDismiss})}renderModalContents(){return o()("div",{style:{fontSize:14}},void 0,o()("div",{},void 0,o()(g.FormattedMessage,{defaultMessage:"<p>Unfortunately you are not eligible for a free Personal Pro plan if you use this email address.</p><p>K-12 students, K-12 educators, and personal email addresses such as Gmail and Outlook are not eligible to receive the <pricinglink>Personal Pro Plan</pricinglink> for free, but anyone is welcome to use the <pricinglink>Personal Plan</pricinglink> for free with unlimited storage.</p>",id:"studentNotEligibleModal.header",values:{br:o()("br",{}),p:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()("p",{style:{marginTop:0,marginBottom:8}},void 0,1===t.length?t[0]:l().Children.toArray(t))},pricinglink:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()(k.Z,{external:!0,href:m.AR.pricing},void 0,t)}}})),this.renderSchoolEmailCodePrompt(),this.renderPromoCode(),this.renderContactUs())}renderSchoolEmailCodePrompt(){const e=(0,f.S4)(this.environment);return o()("div",{style:{display:"flex",marginTop:16}},void 0,o()("div",{style:{width:18,flexShrink:0,color:this.theme.mediumTextColor}},void 0,o()(g.FormattedMessage,{defaultMessage:"1.",id:"studentNotEligibleModal.numberedList.firstItem"})),o()("div",{style:{flexGrow:1}},void 0,o()("div",{style:{color:this.theme.mediumTextColor}},void 0,o()(g.FormattedMessage,{defaultMessage:"Your current email is:",id:"studentNotEligibleModal.numberedList.changeEmailItem.message"})),o()("div",{style:{fontWeight:p.Z.fontWeight.medium,marginTop:0}},void 0,e&&e.email),o()("div",{style:{color:this.theme.mediumTextColor,marginTop:4}},void 0,o()(g.FormattedMessage,{defaultMessage:"Thousands of university, college, and post-secondary school domains are already eligible, not just .edu emails!",id:"studentNotEligibleModal.numberedList.changeEmailItem.message2"})),o()(M.Z,{style:{marginTop:12},onClick:this.handleChangeEmail,isLarge:!0},void 0,o()(g.FormattedMessage,{defaultMessage:"Change email",id:"studentNotEligibleModal.numberedList.changeEmailItem.button.label"}))))}renderPromoCode(){const e=this.stores.promoError.get(),t=this.props.intl.formatMessage({defaultMessage:"Enter code…",id:"studentNotEligibleModal.numberedList.item2.promocodePlaceholder",description:"Placeholder text to enter the promotion code for a student plan."});return o()("div",{style:{display:"flex",marginTop:16}},void 0,o()("div",{style:{width:18,flexShrink:0,color:this.theme.mediumTextColor}},void 0,o()(g.FormattedMessage,{defaultMessage:"2.",id:"studentNotEligibleModal.numberedList.secondItem"})),o()("div",{style:{flexGrow:1}},void 0,o()("div",{style:{color:this.theme.mediumTextColor}},void 0,o()(g.FormattedMessage,{defaultMessage:"Have a student promo code?",id:"studentNotEligibleModal.numberedList.promoCodeItem.message"})),o()("div",{style:{display:"flex",marginTop:12}},void 0,o()(w.Z,{style:{marginRight:8,height:32},value:this.stores.promoCodeStore.state.inputValue,onChange:this.handleInputChange,onSubmit:this.handleSubmitPromoCode,placeholder:t}),o()(M.Z,{onClick:this.handleSubmitPromoCode,disabled:!this.stores.promoCodeStore.state.inputValue,isLarge:!0},void 0,o()(g.FormattedMessage,{defaultMessage:"Submit",id:"studentNotEligibleModal.numberedList.promoCodeItem.submitButton"}))),o()("div",{style:{color:c.ZP.red,fontSize:12,marginTop:4,marginLeft:8,height:20}},void 0,e)))}renderContactUs(){return o()("div",{style:{display:"flex",alignItems:"center",color:this.theme.lightTextColor,borderTop:"1px solid ".concat(this.theme.regularDividerColor),paddingTop:14}},void 0,u.Z.help({width:14,marginTop:1,marginRight:6,fill:this.theme.lightIconColor})," ",o()("div",{},void 0,o()(g.FormattedMessage,{defaultMessage:"Have questions about this? <inlinelink>More info & FAQs</inlinelink>.",id:"studentNotEligibleModal.contactUsSection.message",values:{inlinelink:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()(k.Z,{href:"https://www.notion.so/Notion-for-students-teachers-adc631df15ee4ab9a7a33dd50f4c16fe",external:!0},void 0,t)}}})))}}a()(T,"wrapStyle",{padding:"24px 36px 24px",minWidth:300,maxWidth:400});const I=(0,g.injectIntl)(T)},6202:(e,t,i)=>{i.d(t,{Z:()=>g});var n=i(77094),o=i.n(n),s=i(77422),a=i.n(s),r=(i(67294),i(83355)),l=i(8848),d=i(60709),c=i(42922),u=i(7908),m=i(28992);class p extends r.Z{renderComponent(){return o()(m.Z,{title:this.renderButton()})}renderButton(){const{isMobile:e}=this.environment.device;return e?o()(u.Z,{onClick:this.props.onClick,mobileFeedback:!0,disabled:this.props.disabled,style:p.buttonMobileStyle},void 0,this.props.title):o()(c.Z,{onClick:this.props.onClick,disabled:this.props.disabled,style:{width:"100%",maxWidth:300,display:"flex",margin:"auto"}},void 0,this.props.title)}}a()(p,"contextTypes",{...d.f}),a()(p,"buttonMobileStyle",{width:"100%",color:l.ZP.blue});const g=p},30676:(e,t,i)=>{i.d(t,{F:()=>m});var n=i(97464),o=i.n(n),s=i(77094),a=i.n(s),r=i(67294),l=i.n(r),d=i(28350),c=i(52275),u=i(93686);function m(e){const{teamStore:t}=e,{name:i}=(0,d.VK)((()=>({name:t.getName()})),[t]);return l().createElement(c.Z,o()({},e,{icon:a()(u.p,{size:14,store:t,disabled:!0}),title:i}))}},66721:(e,t,i)=>{i.r(t),i.d(t,{default:()=>se});var n=i(77094),o=i.n(n),s=i(77422),a=i.n(s),r=(i(33948),i(96486)),l=i.n(r),d=i(67294),c=i.n(d),u=i(83355),m=i(17215),p=i(2072),g=i(94044),h=i(5366),f=i(4708),v=i(79817),y=i(60709),S=i(75472),b=i(65598),M=i(38755),w=i(23537),C=i(25464),k=i(27832),T=i(85834),I=i(52878),Z=i(8848),P=i(53397),_=i(97880),x=i(82990),F=i(50906),A=i(42922),B=i(7908),E=i(74420),R=i(31278),D=i(58032),L=i(64369);class O extends u.Z{constructor(){super(...arguments),a()(this,"storeTypes",{contextualInviteStore:T.ZP}),a()(this,"containerStyle",{padding:12,display:"flex",flexDirection:"column",gap:16}),a()(this,"iconStyle",{width:20,height:20,fill:this.theme.lightIconColor})}didMount(){F.trackOpenShareWorkspaceInvite(this.environment,v.Oh(this.environment,this.stores.contextualInviteStore)),this.props.isForSinglePlayer&&this.stores.contextualInviteStore.setState({...this.stores.contextualInviteStore.state,selection:T.uq.page_guest})}renderComponent(){const{contextualInviteStore:e}=this.stores,t=e.getGuestEmails(),i=e.state.selection;if(!t.length&&!this.props.isForSinglePlayer)return null;const{expanded:n}=e.state;return this.props.isForSinglePlayer?o()("div",{},void 0,o()(L.Z,{isSecondaryColor:!0,style:{alignSelf:"flex-start",fontWeight:x.Z.fontWeight.medium,paddingTop:6,paddingBottom:6}},void 0,o()(h.FormattedMessage,{id:"ContextualInvite.send_guest_invite.what_to_share.title",defaultMessage:"What to share",description:"Title for the invitation modal asking what user wants to share with these emails"})),o()("div",{style:{display:"flex",gap:8,flexDirection:"column"}},void 0,n?this.renderExpandedOptions(!0):this.renderInitialOptions(!0))):o()("div",{style:this.containerStyle},void 0,o()("div",{style:{display:"flex",flexDirection:"row",justifyContent:"space-between"}},void 0,o()("div",{},void 0,o()(L.Z,{style:{fontWeight:600}},void 0,o()(h.FormattedMessage,{id:"ContextualInvite.send_guest_invite.title",defaultMessage:"Invite to page or workspace?",description:"Title for the invitation modal asking what user wants to share with these emails"})),this.renderEmailSubtitle(t)),o()(A.Z,{isLarge:!0,onClick:()=>{this.handleInviteClick()}},void 0,i===T.uq.page_guest?o()(h.FormattedMessage,{id:"ContextualInvite.send_guest_page_invite.button",defaultMessage:"Done",description:"Title for the invitation modal confirming that the invitees will be invited"}):o()(h.FormattedMessage,{id:"ContextualInvite.send_guest_invite.button",defaultMessage:"Invite",description:"Title for the invitation modal confirming that the invitees will be invited"}))),o()("div",{style:{display:"flex",gap:8,flexDirection:"column"}},void 0,n?this.renderExpandedOptions():this.renderInitialOptions()))}renderEmailSubtitle(e){return o()(L.Z,{isSmall:!0,isSecondaryColor:!0},void 0,1===e.length?e[0]:o()(D.Z,{placement:D.Z.Placement.Bottom,render:t=>c().createElement("span",t,o()(h.FormattedMessage,{id:"ContextualInvite.send_guest_invite.subtitle",defaultMessage:"{firstEmail}, {numOfEmails} more",values:{firstEmail:e[0],numOfEmails:e.length-1},description:"Subtitle for the invitation modal where it shows an example email which is invited and says how many additional people are invited"})),renderTooltip:()=>c().createElement(c().Fragment,null,e.map((e=>o()("div",{},void 0,e))))}))}renderInitialOptions(e){const{selection:t}=this.stores.contextualInviteStore.state;return"page_guest"===t?this.renderPageGuestButton({state:"collapsed",onClick:()=>this.expand()}):this.renderWorkspaceMemberButton({state:"collapsed",onClick:()=>this.expand(),showNewBadge:e})}renderRequestMemberOptions(){const{selection:e}=this.stores.contextualInviteStore.state,t=[T.uq.request_workspace_member,T.uq.page_guest],i={[T.uq.request_workspace_member]:this.renderRequestWorkspaceMemberButton({state:e===T.uq.request_workspace_member?"selected":"none",onClick:()=>this.selectRequestWorkspaceMemberOption()}),[T.uq.page_guest]:this.renderPageGuestButton({state:e===T.uq.page_guest?"selected":"none",onClick:()=>this.selectPageGuestOption()})};return t.map((e=>({...i[e],key:{option:e}})))}renderInviteMemberOptions(e){const{order:t,selection:i}=this.stores.contextualInviteStore.state,n={[T.uq.workspace_member]:this.renderWorkspaceMemberButton({state:i===T.uq.workspace_member?"selected":"none",onClick:()=>this.selectWorkspaceMemberOption(),showNewBadge:e}),[T.uq.page_guest]:this.renderPageGuestButton({state:i===T.uq.page_guest?"selected":"none",onClick:()=>this.selectPageGuestOption()})},o=[T.uq.page_guest,T.uq.workspace_member];return(this.props.isForSinglePlayer?o:t).map((e=>({...n[e],key:{option:e}})))}renderSpaceIcon(){const{device:e}=this.environment,{spaceStore:t}=this.props,i=(0,M.getSpaceIcon)(this.environment,t),n=this.getSpaceName();return i||n?o()(R.Z,{disabled:!0,icon:i,isEmptyPage:!1,title:n,size:e.isMobile?24:20,style:{color:this.theme.regularTextColor}}):P.Z.folder(this.iconStyle)}getSpaceName(){const{spaceStore:e}=this.props;return(0,M.getSpaceName)(this.environment,e)}renderExpandedOptions(e){const{inviteStage:t}=this.stores.contextualInviteStore.state;return t===T.TG.request_workspace?this.renderRequestMemberOptions():this.renderInviteMemberOptions(e)}renderWorkspaceMemberButton(e){const{state:t,onClick:i,showNewBadge:n}=e;return o()(N,{icon:this.renderSpaceIcon(),title:o()(h.FormattedMessage,{defaultMessage:"Share this workspace",id:"ContextualInvite.share_this_workspace.title",description:"Title for the button to tell the inviter that they are giving access to the current workspace"}),subtitle:o()(h.FormattedMessage,{defaultMessage:"These people will have access to all content shared with workspace members in {workspaceName}. Adds new emails as billable members.",values:{workspaceName:this.getSpaceName()},id:"ContextualInvite.share_this_workspace.subtitle2",description:"Subtitle for the button to tell the inviter that they are giving member access of the workspace to the invitee"}),state:t,onClick:i,showNewBadge:n})}renderRequestWorkspaceMemberButton(e){const{state:t,onClick:i}=e;return o()(N,{icon:this.renderSpaceIcon(),title:o()(h.FormattedMessage,{defaultMessage:"Request invite to workspace",id:"ContextualInvite.request_invite_workspace.title",description:"Title for the button to tell the inviter that they are requesting an invite for invitee to the current workspace."}),subtitle:o()(h.FormattedMessage,{defaultMessage:"Sends a request to admin to invite as a workspace member.",id:"ContextualInvite.request_invite_workspace.subtitle2",description:"Subtitle for button to tell the inviter that they are requesting an invite for invitee to the current workspace."}),state:t,onClick:i})}renderPageGuestButton(e){const{device:t}=this.environment,{state:i,onClick:n}=e,{blockStore:s}=this.props,a=s.hasIcon()?o()(R.Z,{disabled:!0,icon:s.getIcon(),isEmptyPage:!1,size:t.isMobile?24:20,style:{color:this.theme.regularTextColor}}):P.Z.fileAttachment(this.iconStyle);return o()(N,{icon:a,title:o()(h.FormattedMessage,{defaultMessage:"Only share this page",id:"ContextualInvite.share_this_page.title",description:"Title for the button to tell the inviter that they are giving access to the current page"}),subtitle:o()(h.FormattedMessage,{defaultMessage:"These people will only have access to this page. They will not be added to your bill.",id:"ContextualInvite.share_this_page.subtitle2",description:"Subtitle for the button to tell the inviter that they are giving guest access of the workspace to the invitee"}),state:i,onClick:n})}expand(){this.stores.contextualInviteStore.setState({...this.stores.contextualInviteStore.state,expanded:!0})}selectWorkspaceMemberOption(){this.stores.contextualInviteStore.setState({...this.stores.contextualInviteStore.state,selection:T.uq.workspace_member})}selectRequestWorkspaceMemberOption(){this.stores.contextualInviteStore.setState({...this.stores.contextualInviteStore.state,selection:T.uq.request_workspace_member})}selectPageGuestOption(){this.stores.contextualInviteStore.setState({...this.stores.contextualInviteStore.state,selection:T.uq.page_guest})}async handleInviteClick(){const{contextualInviteStore:e}=this.stores,{spaceStore:t,blockStore:i,intl:n}=this.props;switch(e.state.inviteStage){case T.TG.share_page:case T.TG.closed:break;case T.TG.request_workspace:F.trackClickMembershipRequest(this.environment,{...v.Oh(this.environment,e),from:"share_menu"}),await v.fC({environment:this.environment,spaceStore:t,originId:i.id,originType:"share_menu",reasonMessage:void 0,contextualInviteStore:e,intl:n});break;case T.TG.share_workspace:F.trackClickShareWorkspace(this.environment,v.Oh(this.environment,e)),await v.j_({environment:this.environment,spaceStore:t,contextualInviteStore:e,from:"page_contextual_invite",intl:n});break;case T.TG.transition_workspace:break;default:(0,_.t1)(e.state.inviteStage)}}}class N extends u.Z{renderComponent(){const{device:e}=this.environment,{icon:t,title:i,subtitle:n,state:s,onClick:a}=this.props,r="selected"===s;return o()(B.Z,{focused:r,disabled:!1,mobileFeedback:e.isMobile,onClick:a,style:{borderWidth:1,borderStyle:"solid",borderColor:this.theme.regularDividerColor,borderRadius:5,...r&&{backgroundColor:this.theme.cardBackground}}},void 0,o()("div",{style:{display:"flex",justifyContent:"space-between",paddingTop:10,paddingBottom:10,paddingLeft:12,paddingRight:12}},void 0,o()("div",{style:{display:"flex",justifyContent:"center",width:24,height:24,marginTop:5,marginRight:12}},void 0,t),o()("div",{style:{marginRight:"auto"}},void 0,o()("div",{style:{display:"flex",alignItems:"center"}},void 0,o()(L.Z,{},void 0,i),this.props.showNewBadge&&o()(E.Z,{style:{background:Z.FN[this.theme.mode].red["dark"===this.theme.mode?300:50],color:Z.FN[this.theme.mode].red["dark"===this.theme.mode?700:500],fontSize:12,fontWeight:x.Z.fontWeight.regular,textTransform:"none",letterSpacing:0}})),o()(L.Z,{isMultiline:!0,isSmall:!0,isSecondaryColor:!0},void 0,n)),o()("div",{style:{display:"flex",alignItems:"center",justifyContent:"center",marginRight:4}},void 0,"selected"===s&&P.Z.thinCheck({width:16,height:16,fill:this.theme.lightIconColor}),"collapsed"===s&&P.Z.chevronDownThin({width:16,height:16,fill:this.theme.lightIconColor}))))}}const U=(0,h.injectIntl)(O);var W=i(74194),V=i(78140),z=i(91941),q=i(44532),H=i(21523),G=i(36932),K=i(480),j=i(28350),Y=i(24405),Q=i(4615),X=i(75246),J=i(29369),$=i(38363),ee=i(61519),te=i(71397);const ie=function(e){const{contextualInviteStore:t}=e,i=(0,K.O7)(),n=(0,Y.y)((e=>({topContainer:{padding:"14px 12px",display:"flex",flexDirection:"column"},title:{fontWeight:x.Z.fontWeight.semibold,paddingBottom:4},nameAndIconContainer:{display:"flex",alignItems:"center",paddingTop:12},name:{height:34,background:e.inputBackground},icon:{marginRight:8},updateButton:{marginLeft:12},bottomContainer:{display:"flex",justifyContent:"flex-end",padding:12}})),[]),[{currentSpaceStore:s}]=(0,j.oR)(k.default),a=(0,j.VK)((()=>{var e;return null!==(e=null==s?void 0:s.getName())&&void 0!==e?e:""}),[s]),[r,l]=(0,d.useState)(a),u=(0,d.useCallback)((e=>{l(e)}),[]),m=(0,j.VK)((()=>s?(0,M.getSpaceIcon)(i,s):void 0),[i,s]),[p,g]=(0,d.useState)(m),f=(0,d.useCallback)((e=>{const t=null==s?void 0:s.id;e&&t&&g({icon:e,pointer:{table:X.bx,id:t}})}),[null==s?void 0:s.id]),v=(0,d.useCallback)((()=>{t.reset()}),[t]);return c().createElement(c().Fragment,null,o()("div",{style:n.topContainer},void 0,o()(L.Z,{style:n.title},void 0,o()(h.FormattedMessage,{id:"SinglePlayerShareWorkspaceModal.title",defaultMessage:"Add a new teamspace",description:"Title of the create teamspace modal triggered by sharing flow."})),c().createElement(c().Fragment,null,o()(L.Z,{isSmall:!0,isMultiline:!0},void 0,o()(h.FormattedMessage,{id:"SinglePlayerShareWorkspaceModal.subtitle1",defaultMessage:"Give it a name and icon so people in your workspace can find it.",description:"Explanation text displayed below create teamspace modal title."})),o()(L.Z,{isSmall:!0,isMultiline:!0},void 0,o()(h.FormattedMessage,{id:"SinglePlayerShareWorkspaceModal.subtitle2",defaultMessage:"Your other pages will remain private to you.",description:"Explanation text displayed below create teamspace modal title."}))),o()("div",{style:n.nameAndIconContainer},void 0,o()(R.Z,{style:n.icon,isLarge:!0,largeIcon:!0,size:34,bucket:"public",disabled:!1,isEmptyPage:!1,icon:p,title:r||"Teamspace",iconLoggingData:{recordTable:J.e0,source:"team_creation_from_share_menu"},onChange:f}),o()(te.V,{value:r,style:n.name,onBlur:u,onChange:u,disabled:!1,placeholder:"Acme Labs"}))),o()(ee.Z,{size:1}),o()("div",{style:n.bottomContainer},void 0,o()(z.Z,{isLightGray:!0,onClick:v},void 0,o()(h.FormattedMessage,{id:"SinglePlayerShareWorkspaceModal.cancel.button",defaultMessage:"Cancel",description:"Cancel button in the create teamspace modal triggered via sharing flow."})),o()(A.Z,{style:n.updateButton,onClick:async()=>{var e;await(0,$.HD)({environment:i,name:r,icon:null==p?void 0:p.icon,flowId:null!==(e=t.getState().flowId)&&void 0!==e?e:(0,Q.ZP)()})}},void 0,o()(h.FormattedMessage,{id:"SinglePlayerShareWorkspaceModal.sendInvites.button",defaultMessage:"Send invites",description:"Confirmation button for inviting user to workspace and creating teamspace."}))))};class ne extends u.Z{constructor(){super(...arguments),a()(this,"storeTypes",{universalInviteStore:I.Z}),a()(this,"renderEmailInput",this.createComputedStore((()=>"milestone_2"===this.props.mode)))}renderComponent(){const{universalInviteStore:e}=this.stores,{permissionsInviteStore:t,contextualInviteStore:i}=e.state,n=e.stage,{spaceStore:s}=this.props;if(this.environment.device.isMobile||n===T.TG.closed)return null;if(!(0,b.Mm)(this.props.store)&&n===T.TG.transition_workspace)return o()(ie,{contextualInviteStore:i});if(!(0,b.Mm)(this.props.store)&&(n===T.TG.share_workspace||n===T.TG.request_workspace))return o()(U,{blockStore:this.props.store,spaceStore:s,contextualInviteStore:i});if(n===T.TG.share_page){const n={...this.props,renderInShareMenu:!0,spaceStore:s,permissionsInviteStore:t,contextualInviteStore:i,onInviteClick:()=>{(0,w.$)(this.environment)?i.setState({...i.state,inviteStage:T.TG.closed}):v.fr({environment:this.environment,spaceStore:s,contextualInviteStore:i})},onInviteComplete:e=>{v.x5({success:e,intl:this.props.intl,contextualInviteStore:i})},onCancel:async()=>{await(0,S.Aw)({environment:this.environment,permissionsInviteStoreState:t.state,from:"share_menu"})||e.reset()}};return this.renderEmailInput.state?c().createElement(oe,n):c().createElement(G.default,n)}}}class oe extends G.PermissionsInviteBase{constructor(){super(...arguments),a()(this,"inviteTargetLength",this.createComputedStore((()=>this.stores.permissionsInviteStore.state.inviteTargets.length))),a()(this,"blockTitle",this.createComputedStore((()=>{if((0,b.Mm)(this.props.store))return"";const e=this.props.store,t=e.getValue();if(!t)return"";const i=m.T5({table:e.table,value:t,getRecordValue:e.getRecordValue,userTimeZone:p.x7,intl:this.props.intl});return i||m.Q2({table:e.table,value:t,getRecordValue:e.getRecordValue,userTimeZone:p.x7,intl:this.props.intl})}))),a()(this,"handleInviteInputSubmit",(async()=>{const{permissionsInviteStore:e}=this.stores;"invitee"===e.state.inputFocus?e.setState({...e.state,inputFocus:"email-content"}):await super.handleInviteInputSubmit()})),a()(this,"resetFocusOnClickEmpty",(e=>{const{permissionsInviteStore:t}=this.stores;e.currentTarget===e.target&&t.setState({...t.state,inputFocus:"none"})}))}renderComponent(){return this.renderInShareMenu.state?this.renderUniversalInviteInner():super.renderComponent()}renderUniversalInviteInner(){const{permissionsInviteStore:e}=this.stores;return o()("div",{style:this.getContainerStyle(),onClick:this.resetFocusOnClickEmpty},void 0,o()(q.ZP,{popupType:q.kQ.Popup,alignmentToOrigin:C.v.Start,placementToOrigin:C.u.Bottom,open:"invitee"===e.state.inputFocus,originGap:10,disableMouseCapture:!0,forceRemeasureStore:this.inviteTargetLength,origin:super.renderHeader(),onDismiss:()=>{e.setState({...e.state,inputFocus:"email-content"})},render:()=>{const e=super.renderSearchRequest(),t={menuType:y.o.Popup,disableScroller:!1};return o()("div",{},void 0,c().createElement(V.Z,t,e))},style:{width:360}}),this.renderEmailMessageInput(),this.renderSinglePlayerOptions(),this.renderActions())}renderEmailMessageInput(){const{permissionsInviteStore:e}=this.stores,t=this.getEmailMessage(),{inputFocus:i,emailMessage:n}=e.state,s=n.length/g.vr>=.8,a=(0,g.TQ)(n),r=s||a,l=(0,f._6)(this.environment),d="email-content"===i;return o()(W.Z,{textarea:!0,value:n,focus:d,focusInitial:!1,maxlength:g.vr,onFocus:()=>{e.setState({...e.state,inputFocus:"email-content"})},style:{background:d?"none":this.theme.inputBackground,alignItems:"flex-start",paddingLeft:12,paddingRight:12,paddingTop:8,paddingBottom:r?34:12},inputStyle:{minHeight:l?80:100},placeholder:t,onChange:t=>{e.setState({...e.state,emailMessage:t.target.value})},right:r&&this.renderMessageWarning({shouldShowLengthWarning:s,shouldShowLinkWarning:a}),isRightLastElementOfInput:!0,onSubmit:async()=>{await super.handleInviteClick()}})}renderSinglePlayerOptions(){if((0,b.Mm)(this.props.store))return null;const{contextualInviteStore:e,permissionsInviteStore:t}=this.stores,{currentSpaceStore:i}=k.default.state;if(!i)return null;if(!(0,w.$)(this.environment))return null;const{inviteTargets:n}=t.state;return!t.state.isInviteTargetsEmpty&&n.some((e=>S.OA(e)))?o()(U,{blockStore:this.props.store,spaceStore:i,contextualInviteStore:e,isForSinglePlayer:!0}):null}renderActions(){return o()("div",{style:{display:"flex",flexDirection:"row-reverse",justifyContent:"space-between",alignItems:"center",width:"100%"},onClick:this.resetFocusOnClickEmpty},void 0,o()("div",{style:{display:"flex",flexDirection:"row-reverse",justifyContent:"flex-end",gap:8}},void 0,this.renderDesktopInputRightInnerButton({isLarge:!1}),o()(z.Z,{style:{minWidth:g.UF,justifyContent:"center"},isLarge:!1,isLightGray:!0,onClick:()=>{var e,t;null===(e=(t=this.props).onCancel)||void 0===e||e.call(t)}},void 0,o()(h.FormattedMessage,{defaultMessage:"Cancel",id:"ContextualInvite.permissions_invites.button.cancel",description:"Button to cancel"}))),o()(H.Z,{style:{paddingLeft:0,paddingRight:0},disableHover:!0}))}renderMessageWarning(e){const{permissionsInviteStore:t}=this.stores,{shouldShowLengthWarning:i,shouldShowLinkWarning:n}=e;return o()("span",{style:{fontSize:12,color:this.theme.lightTextColor,position:"absolute",bottom:8,left:12}},void 0,i&&o()(h.FormattedMessage,{defaultMessage:"{characters} / {maxCharacters} characters",id:"ContextualInvite.permissions_invites.messageLengthWarning",description:"Message showing how many characters out of the maximum the user has already typed.",values:{characters:t.state.emailMessage.length,maxCharacters:g.vr}}),i&&n&&" · ",n&&o()(h.FormattedMessage,{defaultMessage:"Links will be omitted from your message",id:"ContextualInvite.permissions_invites.removeLinkWarning",description:"Warning message to the user that hyperlinks will be removed from their custom message."}))}getEmailMessage(){const{currentUserStore:e,currentSpaceStore:t}=k.default.state,{permissionsInviteStore:i}=this.stores,{intl:n}=this.props,{inviteTargets:o}=i.state,s=!i.state.isInviteTargetsEmpty&&l().every(o,S.OA);if(!t)return n.formatMessage(g.VX.default);const a=(null==e?void 0:e.getName())||(null==e?void 0:e.getEmail()),r=(0,M.getSpaceName)(this.environment,t);if(!a||!r)return n.formatMessage(g.VX.default);return(0,g.jm)({includeOptional:!1,isGuest:s,emailProps:{userName:a,pageName:this.blockTitle.state,spaceName:r},intl:this.props.intl})}getContainerStyle(){const{WindowSizeStore:e}=this.environment;return{display:"flex",alignItems:"center",minHeight:52,paddingTop:10,paddingBottom:10,paddingLeft:e.getSafePaddingLeftCSS(14),paddingRight:e.getSafePaddingRightCSS(14),flexDirection:"column",gap:10}}}const se=(0,h.injectIntl)(ne)},87968:(e,t,i)=>{i.d(t,{Z:()=>d});var n=i(77094),o=i.n(n),s=(i(67294),i(24405)),a=i(24006),r=i(64369);const l=e=>{let{title:t,subtitle:i,on:n,onChange:l,disabled:d,style:c}=e;const u=(0,s.y)((()=>({container:{display:"flex",alignItems:"center",width:"100%"},title:{fontSize:14,marginRight:8,flexGrow:1}})),[]);return o()("div",{style:{...u.container,...c}},void 0,o()("div",{style:u.title},void 0,t,o()(r.Z,{isSmall:!0,isMultiline:!0,style:{marginTop:2,width:"95%"}},void 0,i)),o()(a.Z,{on:n,disabled:d,onClick:l}))};l.defaultProps={disabled:!1,style:{}};const d=l},25735:(e,t,i)=>{i.d(t,{Y:()=>p});var n=i(77094),o=i.n(n),s=(i(33948),i(67294)),a=i.n(s),r=i(28350),l=i(24405),d=i(5366),c=i(16639),u=i(27832),m=i(29302);function p(e){const t=(0,l.y)((e=>({container:{marginBottom:4},userContainer:{display:"flex",alignContent:"flex-end",minWidth:140,width:"100%",marginTop:4},user:{flexGrow:1},moreMessage:{marginLeft:2,marginTop:4,color:e.mediumInvertedTextColor}})),[]),{group:i,limit:n,noMembersMessage:s}=e,[{currentSpaceStore:p}]=(0,r.oR)(u.default),{countRemainingUsers:g,limitedUserValues:h}=(0,r.VK)((()=>(0,c.rm)({group:i,spaceStore:p,limit:n})),[i,p,n]);return 0===h.length?a().createElement(a().Fragment,null,s):o()("div",{style:t.container},void 0,h.map((e=>o()("div",{style:t.userContainer},e.id,o()(m.Z,{style:t.user,userValue:e,avatarSize:18})))),g>0&&o()("div",{style:t.moreMessage},void 0,o()(d.FormattedMessage,{id:"blockPermissionsSettings.groupPermissionUsers.tooltip",defaultMessage:"{countRemainingUsers} more…",values:{countRemainingUsers:g}})))}},29127:(e,t,i)=>{i.r(t),i.d(t,{default:()=>cn});var n=i(77094),o=i.n(n),s=i(77422),a=i.n(s),r=(i(33948),i(73210),i(67294)),l=i.n(r),d=i(83355),c=i(18466),u=i(4615),m=i(70203),p=i(63143),g=i(50906),h=i(26111),f=i(87531),v=i(74647),y=i(95477),S=i(69988),b=i(22889),M=i(86785),w=i(65598),C=i(80084),k=i(15517),T=i(23537),I=i(27832),Z=i(72087),P=i(32470),_=i(55320),x=i(49085),F=i(62965);class A extends x.Z{getInitialState(){return{localResults:void 0,serverResultsLoading:!1,serverResults:void 0,serverEventProperties:void 0,serverResultsAllLoaded:!1,errorState:E,jumpToResult:void 0}}setState(e){const t={...this.instanceState};if(!(0,F.Z)(this.instanceState,t))return;const i=function(e){const{newState:t,priorState:i}=e,{localResults:n,serverError:o,serverResultsLoading:s}=t,a=Boolean(n),r=s?void 0:o;if(!a&&s)return!i.errorState.isLoading&&i.errorState.showMajorError?i.errorState:{isLoading:s};if(a)return{hasLocalResults:a,serverError:r,isLoading:!1,showMajorError:!1};return r?{hasLocalResults:a,serverError:r,isLoading:!1,showMajorError:!0}:{hasLocalResults:a,serverError:r,isLoading:!1,showMajorError:!1}}({newState:e,priorState:t});super.setState({...e,errorState:i})}}function B(e){const t=Boolean(e.localResults),i=Boolean(e.serverResults)&&!e.serverResultsLoading;return t||i||!1}const E={showMajorError:!1,isLoading:!1,hasLocalResults:!1,serverError:void 0};const R=A;var D=i(30857),L=i(29026),O=i(9019),N=i(97464),U=i.n(N),W=i(96486),V=i.n(W),z=i(480),q=i(28350),H=i(24405),G=i(59054),K=i(29477),j=i(43250),Y=i(60709),Q=i(59488),X=i(88632),J=i(29798),$=i(69454),ee=i(36488),te=i(56940),ie=i(78140),ne=i(40721),oe=i(37770),se=i(97880),ae=i(82990),re=i(5366),le=i(15447),de=i(69327),ce=i(12318),ue=i(58189),me=i(43145),pe=i(72495),ge=i(53772),he=i(75024),fe=i(28992),ve=i(63296);class ye extends d.Z{constructor(){super(...arguments),a()(this,"openSidebar",(()=>L.ZP.setState({...L.ZP.state,isSidebarOpen:!0}))),a()(this,"styles",{footer:()=>{const{device:e}=this.environment;return{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",fontSize:e.isMobile?ae.Z.fontSize.UIRegular.mobile:ae.Z.fontSize.UIRegular.desktop}},footerWrapper:{flexShrink:0},footerText:{color:this.theme.lightTextColor,fontSize:he.yv(this.environment,"UISmall"),...ae.Z.textOverflowStyle},footerDebugButton:{...Se(this.theme),marginRight:6}})}renderComponent(){const e=this.styles;return o()("footer",{style:e.footerWrapper},void 0,o()(pe.Z,{topBorder:!0,style:e.footer(),disableDesktopPadding:!0},void 0,l().createElement(fe.Z,U()({},this.props,{style:e.footerText})),(0,ge.x)(y.Z)&&!L.ZP.state.isSidebarOpen&&o()(ve.Z,{onClick:this.openSidebar,style:e.footerDebugButton},void 0,"Open Debug Sidebar")))}}const Se=e=>({fontSize:12,color:e.lightTextColor,marginLeft:6,paddingRight:4,paddingLeft:4,height:24}),be=ye;var Me=i(53397),we=i(62134);function Ce(){const e=(0,z.O7)(),t=(0,re.useIntl)(),i=(0,H.y)((t=>({upDownIcon:{marginRight:4,marginBottom:-2,display:"inline",width:12,height:12,fill:t.mediumIconColor},enterIcon:{marginRight:4,marginBottom:-2,display:"inline",width:11,height:11,fill:t.mediumIconColor},commandGlyph:{fontSize:.75*he.yv(e,"UIRegular"),paddingRight:1,color:t.lightTextColor},footerText:{fontSize:he.yv(e,"UISmall"),color:t.lightTextColor,...ae.Z.textOverflowStyle},inlineHint:{display:"inline",marginRight:16}})),[e]),n={...he.mK,...i.footerText},{command:s}=we.fg(e);return o()("ul",{style:n},void 0,o()("li",{style:i.inlineHint},void 0,Me.Z.arrowsUpDownThick(i.upDownIcon),t.formatMessage({id:"searchFooter.helpText.selectHint",defaultMessage:"Select"})),o()("li",{style:i.inlineHint},void 0,Me.Z.enter(i.enterIcon),t.formatMessage({id:"searchFooter.helpText.openHint",defaultMessage:"Open"})),o()("li",{style:i.inlineHint},void 0,o()("span",{style:i.commandGlyph},void 0,s),Me.Z.enter(i.enterIcon),e.device.isElectron?t.formatMessage({id:"searchFooter.helpText.openNewWindow",defaultMessage:"Open in a new window"}):t.formatMessage({id:"searchFooter.helpText.openNewTab",defaultMessage:"Open in a new tab"})))}var ke=i(94184),Te=i.n(ke),Ie=i(21202),Ze=i(92338),Pe=i(98742),_e=i(21115),xe=i(16402),Fe=i(77907),Ae=i(54835),Be=i(80270),Ee=i(24039),Re=i(52275),De=i(64133),Le=i(31278),Oe=i(86176),Ne=i(76798),Ue=i(58032);class We extends d.Z{constructor(){super(...arguments),a()(this,"styles",{title:{fontWeight:ae.Z.fontWeight.medium,lineHeight:"20px"},jumpToTitle:{fontWeight:ae.Z.fontWeight.medium,fontSize:15,lineHeight:"20px"},menuItem:{minHeight:36,paddingTop:this.environment.device.isMobile?12:8,paddingBottom:this.environment.device.isMobile?12:8},menuItemWithCaption:{minHeight:36,paddingTop:this.environment.device.isMobile?12:8,paddingBottom:this.environment.device.isMobile?8:4},textWrapper:{marginLeft:10,alignItems:void 0,flex:void 0,width:"100%"},inlineTextWrapper:{alignItems:"baseline"},highlight:{fontWeight:ae.Z.fontWeight.medium},enterIcon:{height:14,width:14},caption:{marginTop:1},debugHit:{fontFamily:"monospace",marginRight:-28,marginLeft:-28},timestamp:{fontSize:ae.Z.fontSize.UISmall.desktop,fontWeight:ae.Z.fontWeight.regular},toolTip:{maxWidth:300},toolTipTitle:{fontWeight:ae.Z.fontWeight.medium,fontSize:ae.Z.fontSize.UISmall.desktop},toolTipText:{fontWeight:ae.Z.fontWeight.medium,fontSize:ae.Z.fontSize.UISmall.desktop,marginLeft:0,paddingRight:20},toolTipValue:{fontSize:ae.Z.fontSize.UISmall.desktop,fontWeight:ae.Z.fontWeight.regular},toolTipMenuItem:{minHeight:20}})}renderComponent(){var e;const{focused:t,isLastInSection:i,isBeforeFocused:n,inline:s,className:a,result:r}=this.props,d=this.styles,c=this.getThemeColors(),u={...null!=r&&null!==(e=r.highlight)&&void 0!==e&&e.text||!this.hasPath()?d.menuItem:d.menuItemWithCaption,...!s&&!i&&!n&&!t&&c.menuItemBorder},m={...d.caption,...c.caption},p={...d.timestamp,...c.timestamp},g={...d.textWrapper,...this.props.inline&&d.inlineTextWrapper},h={title:this.renderTitle(),icon:this.renderIcon(),caption:this.renderCaption(),body:this.renderPreview(),right:this.renderRight(t),rightStyle:t?void 0:p,dontShrinkRight:!0,captionStyle:m,style:u,textWrapperStyle:g,className:Te()("notranslate",a),buttonStyle:{paddingLeft:2},hoveredStyle:{background:this.theme.buttonHoveredBackground}},f=(0,_e.CM)(this.environment);if("personal"===f||"personal_free"===f||"free"===f)return l().createElement(Re.Z,U()({},this.props,h,{disableTransition:!0,ignoreLocalHoverState:!0}));const{hasHoveredForContext:v}=L.ZP.state,y=v?50:600;return o()(Ue.Z,{delayThreshold:y,placement:Ue.Z.Placement.Top,originGap:0,renderTooltip:()=>this.renderTooltip(),style:d.toolTip,render:e=>l().createElement(Re.Z,U()({},this.props,h,{disableTransition:!0,ignoreLocalHoverState:!0},(0,Pe.Z)(e,this.props)))})}renderTooltip(){return L.ZP.update((e=>({...e,hasHoveredForContext:!0}))),o()(Ee.Z,{store:this.props.store})}renderTitle(){const{store:e,result:t,placeholder:i,index:n}=this.props,s=this.styles,a=this.getThemeColors(),r="on"===Ae.default.getGroup("navigational_search_improvements"),l={...(null==t?void 0:t.sources.includes(Ze.vp.Local))&&0===n&&r?s.jumpToTitle:s.title,...this.hasAnyHighlight()&&a.highlightedTitle},d=[];if(t&&t.highlight)if(d.push(...(0,S.fe)(t.highlight.pathText)),this.usesFullPageIndexingHighlight())d.push(...(0,S.fe)(t.highlight.title));else{Be.Z.createChildStore(this.props.store,{table:Ie.iU,id:t.id,spaceId:t.spaceId}).isNavigableBlock()&&d.push(...(0,S.fe)(t.highlight.text))}const c=this.getWordHighlighter({words:d});return o()("div",{style:{display:"flex",flexDirection:"row",...l}},void 0,P.ZP.state.showDebugInfo&&void 0!==n&&"".concat(n+1,". "),o()(Ne.Z,{style:l,store:e,placeholder:i,highlighter:c}))}renderRight(e){return l().createElement(l().Fragment,null,P.ZP.state.showDebugInfo&&this.renderDebugRight(),e?this.renderEnterIcon():this.renderTimestamp())}renderTimestamp(){const{result:e,lastViewed:t}=this.props;if(!e&&t)return(0,xe.IS)(t,{useCompactFormat:!0})}renderDebugRight(){var e;const{result:t,index:i,originalPosition:n}=this.props,o=null==t||null===(e=t.sources)||void 0===e?void 0:e.map((e=>e===Ze.vp.Local?["💻"]:e===Ze.vp.ElasticSearch?["🌐"]:e===Ze.vp.Postgres?["🐘"]:void(0,se.t1)(e))),s=void 0===i||void 0===n?" ":i>n?"⬇️":i<n?"⬆️":void 0;return l().createElement(l().Fragment,null,s,o)}renderIcon(){const{store:e}=this.props;return l().createElement(l().Fragment,null,o()(Le.Z,{disabled:!0,icon:e.getIcon(),isEmptyPage:e.isEmptyPage(),size:20,largeIcon:!0}))}renderCaption(){const{store:e,result:t,inline:i}=this.props;if(!this.hasPath())return;const n=this.getWordHighlighter({words:(0,S.fe)(t&&t.highlight&&t.highlight.pathText),removeDuplicate:!0}),{device:s}=this.environment,a=i||s.isMobile?0:2;return l().createElement(l().Fragment,null,o()(Oe.Z,{store:e,extraLength:a,showFullPathInTooltip:!0,highlighter:n}))}renderPreview(){const{result:e,debugLocal:t,debugHit:i}=this.props;return l().createElement(l().Fragment,null,(()=>{if(!e)return;if(!e.highlight)return;if(Be.Z.createChildStore(this.props.store,{table:Ie.iU,id:e.id,spaceId:e.spaceId}).isNavigableBlock()&&!this.usesFullPageIndexingHighlight())return;if(!e.highlight.text)return;const t=e.highlight.text,i=(0,S.ZP)(t);if(this.usesFullPageIndexingHighlight()){const t=e=>e.filter(S.il).map((e=>e[0].toLowerCase())),n=e=>void 0===e?[]:t((0,S.ZP)(e)),o=new Set([...n(e.highlight.title),...n(e.highlight.pathText)]);if(t(i).every((e=>o.has(e))))return}const n=this.styles,s=this.getThemeColors();return o()(De.Z,{text:t,highlighter:{tokenize:e=>(0,S.Vu)(i),style:{...n.highlight,...s.highlight}}})})(),t&&o()("div",{style:this.styles.debugHit},void 0,o()(Fe.LazyAdminReactJson,{data:{debugLocal:t},defaultCollapsed:!0,jsonTreeRef:this.props.debugLocalRef,customCollapsedRenderers:[qe],showCopyButton:!1,showModalButton:!1})),i&&o()("div",{style:this.styles.debugHit},void 0,o()(Fe.LazyAdminReactJson,{data:{debugHit:i},defaultCollapsed:!0,jsonTreeRef:this.props.debugAreaRef,customCollapsedRenderers:[ze],showCopyButton:!0,showModalButton:!0})))}usesFullPageIndexingHighlight(){const{result:e,clusterInfo:t}=this.props;return e&&!e.sources.includes(Ze.vp.Local)&&(null==t?void 0:t.isFullPageIndexing)}getWordHighlighter(e){const{words:t,removeDuplicate:i}=e;if(0===t.length)return;const n={...this.styles.highlight,...this.getThemeColors().highlight},o=i?new Set:void 0;return{tokenize:e=>(0,S.XT)({text:e,patterns:t,uniqueTokenHighlighterContext:o}),style:n}}renderEnterIcon(){const{device:e}=this.environment,{focused:t}=this.props,i=this.styles,n=this.getThemeColors();if(e.isMobile)return;const o={...i.enterIcon,...n.enterIcon,opacity:t?1:0};return Me.Z.enter(o)}hasPath(){const{hidePath:e,store:t}=this.props;return!e&&(0,Oe.L)(t)}hasAnyHighlight(){const{result:e}=this.props;if(!e)return!1;const{highlight:t}=e;return!!t&&Boolean(t.text||t.pathText)}getThemeColors(){return{highlightedTitle:{color:this.theme.mediumTextColor},menuItemBorder:{boxShadow:"0 1px 0 ".concat(this.theme.lightDividerColor)},highlight:{color:this.theme.regularTextColor},enterIcon:{fill:this.theme.mediumIconColor},caption:{color:this.theme.mediumTextColor},timestamp:{color:this.theme.lightTextColor},toolTipTitle:{color:this.theme.mediumTextColor},toolTipText:{color:this.theme.regularTextColor},toolTipValue:{color:this.theme.lightTextColor}}}}a()(We,"contextTypes",Y.f);const Ve=We;function ze(e){let{data:t}=e;if(!["_score","matched_queries"].every((e=>t[e])))return null;const{_score:i,matched_queries:n}=t;return{element:l().createElement(l().Fragment,null,i,n&&" ".concat(n.join(", "))),expanded:!1}}function qe(e){let{data:t}=e;const i=t;if(!i)return null;const{localSource:n}=i;return{element:l().createElement(l().Fragment,null,"from ".concat(n)),expanded:!1}}class He extends d.Z{constructor(){super(...arguments),a()(this,"storeTypes",{isLoadingRecents:ce.default.of(!1),endOfRecentsReached:ce.default.of(!1)}),a()(this,"renderComponent",(()=>{if(!le.X4.state)return;const{resultListStore:e}=this.props,{device:t}=this.environment,i=this.defaultViewStyles,{currentSpaceStore:n}=I.default.state;if(!n)return;const s=le.X4.state,a={};s.forEach((e=>{let{pageId:t,visitedAt:i}=e;return a[t]=i}));const r=new Map;s.map(((e,i)=>{const n=le._5(e.visitedAt),o="Today"!==n&&"Yesterday"!==n,s={key:"".concat(e.store.id,":").concat(i),action:t=>this.props.onSelect({store:e.store,action:t}),render:i=>l().createElement(Ve,U()({},i,{inline:!t.isMobile,store:e.store,hidePath:!1,lastViewed:o?a[e.store.id]:void 0,buttonStyle:{paddingLeft:1}}))};var d;r.has(n)?null===(d=r.get(n))||void 0===d||d.push(s):r.set(n,[s])}));const d=[];for(const[l,u]of r.entries()){const e=this.getMessageFromBucket(l),t={key:l,items:u,render:t=>o()(pe.Z,{title:e,desktopTitleStyle:i.sectionHeader,disableDesktopPadding:!0,style:i.sectionMenuWithNewFilterBar},void 0,t.children)};d.push(t)}const c=!t.isMobile&&s.length>0;return l().createElement(l().Fragment,null,o()("div",{style:i.wrapper},void 0,o()(ue.Z,{type:ue.i.Vertical,store:e,initialFocus:this.getInitialFocus(),disableKeyboardArrowWrap:!0,sections:d,unfocusOnScroll:!0}),o()(me.Z,{onChange:this.handleScrollOffsetChange})),c&&o()(be,{title:o()(Ce,{})}))})),a()(this,"handleScrollOffsetChange",(e=>{this.getLastPageTimestamp()&&e<=200&&!this.stores.isLoadingRecents.get()&&!this.stores.endOfRecentsReached.get()&&this.loadMoreRecents()})),a()(this,"loadMoreRecents",V().throttle((async()=>{const e=this.getLastPageTimestamp(),{currentSpaceStore:t}=I.default.state,i=this.environment.currentUser.id,n=null==t?void 0:t.id;if(!i||!n||!e)return;this.stores.isLoadingRecents.set(!0);const o=await le.Od(e,{environment:this.environment,userId:i,spaceId:n});this.stores.isLoadingRecents.set(!1),o||this.stores.endOfRecentsReached.set(!0)}),300)),a()(this,"defaultViewStyles",{wrapper:{width:"100%",height:"100%",overflowX:"hidden",overflowY:"auto"},sectionHeader:{fontWeight:ae.Z.fontWeight.semibold,marginBottom:7,marginLeft:2},sectionMenuWithNewFilterBar:{marginTop:0,marginBottom:16}})}getInitialFocus(){if(L.ZP.state.query.text.trim())return;const e=le.X4.state;return e&&e.length>0?1:0}getLastPageTimestamp(){const{currentSpaceStore:e}=I.default.state;if(!e)return;const t=de.Z.getWithoutSubscribing(e.id),i=t[t.length-1];return null==i?void 0:i.visitedAt}getMessageFromBucket(e){switch(e){case"Today":return o()(re.FormattedMessage,{id:"search.recentPagesTimeBuckets.today.text",defaultMessage:"Today",description:"Time buckets for the recent pages default view: Today"});case"Yesterday":return o()(re.FormattedMessage,{id:"search.recentPagesTimeBuckets.yesterday.text",defaultMessage:"Yesterday",description:"Time buckets for the recent pages default view: Yesterday"});case"Past Week":return o()(re.FormattedMessage,{id:"search.recentPagesTimeBuckets.pastWeek.text",defaultMessage:"Past Week",description:"Time buckets for the recent pages default view: Past 30 Days"});case"Past 30 Days":return o()(re.FormattedMessage,{id:"search.recentPagesTimeBuckets.past30Days.text",defaultMessage:"Past 30 Days",description:"Time buckets for the recent pages default view: Past 30 Days"});case"Older":return o()(re.FormattedMessage,{id:"search.recentPagesTimeBuckets.older.text",defaultMessage:"Older",description:"Time buckets for the recent pages default view: Older"})}(0,se.t1)(e)}}const Ge=He;var Ke=i(15157),je=i(34859),Ye=i(61766),Qe=i(79131),Xe=i(18647),Je=i(84619),$e=i(31299),et=i(33929),tt=i(11470),it=i(255),nt=i(85567),ot=i(98707);const st=(0,re.defineMessages)({searchPages:{defaultMessage:"Search pages",id:"searchPageFilter.searchTokenFilter.tokenInput.placeholder"},selectAPage:{defaultMessage:"Select a page",id:"searchPageFilter.searchTokenFilter.resultSection.title"}});class at extends d.Z{constructor(){super(...arguments),a()(this,"renderFilterListItem",((e,t)=>{let{disabled:i,onRemove:n,onClick:s}=t;const a=this.styles,r=this.createBlockStore(e),l=o()(it.Z,{disabled:i,onClick:n});return o()(tt.Z,{disabled:i,focused:!1,store:r,right:l,style:a.menuItem,desktopTitleStyle:a.menuItemTitle,onClick:s})})),a()(this,"renderItemForSummary",(e=>o()(Ne.Z,{store:this.createBlockStore(e),shouldWrap:!0,maxLength:50}))),a()(this,"renderToken",((e,t)=>{const{blockIds:i}=this.props,n=this.tokenStyles,s=1===i.length,a=this.createBlockStore(e),r=o()("div",{style:n.token},void 0,o()(Le.Z,{disabled:!0,icon:a.getIcon(),isEmptyPage:!1,size:20,style:n.icon}),o()(Ne.Z,{store:a}));return o()(nt.Z,{format:this.environment.device.isMobile?Je.l.Large:Je.l.Small,value:r,showRemoveButton:!0,onClickRemove:t.onRemove,isSingle:s,shouldShrink:!0,backgroundColor:"transparent",shouldWrap:!1},e)})),a()(this,"renderResultMenuItem",((e,t)=>{const i=this.createBlockStore(e);return l().createElement(tt.Z,U()({},t,{key:e,store:i}))})),a()(this,"performRequest",(async e=>{let{query:t,current:i}=e;const{currentSpaceStore:n}=I.default.state;if(!n)return[];const o=t?(await $e.nJ({environment:this.environment,query:t,limit:20,spaceId:n.id,requireEditPermissions:!1,excludeTemplates:!1,source:"quick_find_ancestor_filter",boostRecentlyViewedPages:!0})).results:le.X4.state.map((e=>e.pageId)),s=new Set(i);return o.filter((e=>!s.has(e)))})),a()(this,"createBlockStore",(e=>{const{parentStore:t}=this.props;return Be.Z.createChildStore(t,{table:Ie.iU,id:e})})),a()(this,"styles",{menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{fill:"currentColor"}}),a()(this,"tokenStyles",{token:{display:"flex",alignItems:"center"},icon:{marginRight:4}})}renderComponent(){const{mode:e,title:t,blockIds:i,onChange:n,disabled:s,focused:a,onMenuDismiss:r}=this.props;return o()(ot.Z,{mode:e,hasItemsSelected:(null==i?void 0:i.length)>0,title:t,icon:Me.Z.searchInPage,iconStyles:this.styles.recordIcon,items:i,onChange:n,focused:a,renderFilter:this.renderFilterListItem,renderToken:this.renderToken,renderItemForSummary:this.renderItemForSummary,addItemLabel:o()(re.FormattedMessage,{defaultMessage:"Add another page",id:"searchPageFilter.searchTokenFilter.addAPage.button"}),labelText:{title:t,tokenInputPlaceholder:et.default.formatMessage(st.searchPages),componentDebugName:"SearchPageFilter"},performRequest:this.performRequest,renderResultMenuItem:this.renderResultMenuItem,disabled:s,onMenuDismiss:r})}}const rt=at;var lt=i(83890),dt=i(29369),ct=i(20431),ut=i(93044),mt=i(30676);class pt extends d.Z{constructor(){super(...arguments),a()(this,"renderFilterListItem",((e,t)=>{let{disabled:i,onRemove:n,onClick:s}=t;const a=this.styles,r=this.createTeamStore(e),l=o()(it.Z,{disabled:i,onClick:n});return o()(mt.F,{disabled:i,focused:!1,teamStore:r,right:l,style:a.menuItem,desktopTitleStyle:a.menuItemTitle,onClick:s},e)})),a()(this,"renderItemForSummary",(e=>this.createTeamStore(e).getName())),a()(this,"renderAvatarFactory",(e=>{const t=e.getIcon();return e=>o()(Le.Z,{disabled:!0,icon:t,isEmptyPage:!1,size:e})})),a()(this,"renderToken",((e,t)=>{const{teamIds:i}=this.props,n=1===(null==i?void 0:i.length),s=this.createTeamStore(e);if(!s)return;const a=s.getName();return o()(ut.Z,{format:this.environment.device.isMobile?ut.Z.Format.Large:ut.Z.Format.Small,showRemoveButton:!0,isSingle:n,onClickRemove:t.onRemove,renderAvatar:this.renderAvatarFactory(s),backgroundColor:"transparent",title:a},e)})),a()(this,"renderResultMenuItem",((e,t)=>{const i=this.createTeamStore(e);return l().createElement(mt.F,U()({},t,{key:e,teamStore:i}))})),a()(this,"performRequest",(async e=>{var t;let{query:i,current:n}=e;const o=new Set(n),s=I.default.state.currentSpaceViewStore,a=I.default.state.currentSpaceStore,r=null===(t=I.default.state.currentUserStore)||void 0===t?void 0:t.id;if(!s||!a||!r)return[];const l=await(0,T.qX)({environment:this.environment,spaceStore:a,currentUserId:r});return(await $e.zf({query:i,spaceViewStore:s,teamStores:l})).filter((e=>!o.has(e.id))).slice(0,20).map((e=>e.id))})),a()(this,"createTeamStore",(e=>{const{parentStore:t}=this.props;return ct.Z.createChildStore(t,{table:dt.e0,id:e})})),a()(this,"styles",{menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},menuItemTitle:{width:"100%"},labeledMenuItemTitle:{display:"inline-flex",alignItems:"center"},menuItemLabel:{marginRight:12},recordIcon:{marginRight:6,fill:"currentColor"}})}renderComponent(){const{mode:e,title:t,teamIds:i,onChange:n,disabled:s,focused:a,onMenuDismiss:r,intl:l}=this.props;return o()(ot.Z,{mode:e,title:t,icon:Me.Z.openTeamSearch,iconStyles:this.styles.recordIcon,items:i||[],onChange:n,disabled:s,focused:a,renderFilter:this.renderFilterListItem,renderToken:this.renderToken,renderItemForSummary:this.renderItemForSummary,addItemLabel:o()(re.FormattedMessage,{defaultMessage:"Add a teamspace",id:"search.filterMenu.addATeamButton.label",description:"In-line help message in the search filter UI when one teamspace is selected for filtering search results and the user wants to add another teamspace (filter)"}),labelText:{title:t,tokenInputPlaceholder:l.formatMessage({defaultMessage:"Search teamspaces",id:"search.filterMenu.searchTeams.placeholder",description:"Placeholder text for a search box for teamspace names in search filters"}),componentDebugName:"SearchTeamFilter"},performRequest:this.performRequest,renderResultMenuItem:this.renderResultMenuItem,onMenuDismiss:r,hasItemsSelected:Boolean(i&&(null==i?void 0:i.length)>0)})}}const gt=(0,re.injectIntl)(pt);var ht=i(55811),ft=i(86825),vt=i(75689),yt=i(91642);class St extends d.Z{constructor(){super(...arguments),a()(this,"handleToggle",(()=>{const{value:e,onChange:t}=this.props;t(!e)})),a()(this,"styles",{menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},icon:{height:14,width:14,fill:"currentColor"},pillIcon:{height:16,width:16,fill:"currentColor",marginRight:6}})}renderComponent(){const{device:e}=this.environment,{mode:t}=this.props;return e.isMobile?this.renderMobile(t):this.renderDesktop(t)}renderDesktop(e){return o()(yt.Z,{marginAfter:!1},void 0,this.renderSwitcherMenuItem(e))}renderMobile(e){const{title:t,value:i,disabled:n}=this.props;return e===ot.z.Button?this.renderSwitcherMenuItem(e):o()(vt.Z,{disabled:n,onClick:this.handleToggle,label:t,isToggle:!0,isToggleActive:i})}renderSwitcherMenuItem(e){const{title:t,icon:i,value:n,style:s,...a}=this.props,r=this.styles,d=this.getThemeColors(),c={...r.menuItem,...d.menuItem,...s};return e===ot.z.Pill?o()(ht.u,{on:n,hideChevron:!0,title:o()("span",{},void 0,t),onClick:this.handleToggle,icon:i(r.pillIcon)}):l().createElement(ft.Z,U()({title:t,icon:i(r.icon),on:n,onClick:this.handleToggle,style:c},a))}getThemeColors(){return{menuItem:{color:this.theme.mediumTextColor}}}}a()(St,"Mode",ot.z);const bt=St;var Mt=i(17215),wt=i(76725),Ct=i(2072),kt=i(19889),Tt=i(20454);function It(e){const{filterUIName:t,parentStore:i}=e,n=(0,q.VK)((()=>L.ZP.state.query.filters),[]),s=(0,H.y)((e=>({title:{maxWidth:220,...ae.Z.textOverflowStyle}})),[]),a=(0,q.VK)((()=>{switch(t){case"personFilter":return function(e,t){const i=e.createdBy,n=et.default.getIntl(),o=V().compact(i.map((e=>{const i=Tt.Z.createChildStore(t,{table:kt.KJ,id:e});return(0,kt.Nz)(n,i.getValue())})));return(0,wt.Z)(o,xt)}(n,i);case"teamsFilter":return function(e,t){const i=e.inTeams;if(!i)return[];const n=V().compact(i.map((e=>ct.Z.createChildStore(t,{table:dt.e0,id:e}).getName())));return(0,wt.Z)(n,xt)}(n,i);case"pageFilter":return function(e,t){const i=e.ancestors,n=V().compact(i.map((e=>{const i=Be.Z.createChildStore(t,{table:Ie.iU,id:e}),n=i.getValue();return n?Mt.T5({table:i.table,value:n,getRecordValue:i.getRecordValue,userTimeZone:Ct.x7,intl:et.default.getIntl()}):""})));return(0,wt.Z)(n,xt)}(n,i);case"dateFilter":return function(e){const t=et.default.getIntl(),i=Pt(e);if("createdTime"===i)return C._Q(e.createdTime,t);if("lastEditedTime"===i)return C._Q(e.lastEditedTime,t);return""}(n);case"titleToggle":return[]}(0,se.t1)(t)}),[i,t,n]);return o()("div",{style:s.title},void 0,o()(re.FormattedMessage,{defaultMessage:"{filterName}{colon} {filterOperator} {filterValues}",id:"search.filterBarFilter.title",values:{filterName:Zt(t),filterOperator:0===a.length?void 0:_t(t,n),filterValues:a,colon:0===a.length?void 0:":"},description:"Filter bar pill titles, potentially containing a filter value preview."}))}function Zt(e){switch(e){case"personFilter":return o()(re.FormattedMessage,{id:"search.filterMenu.moreFilters.person",defaultMessage:"Created by",description:"Search filter by people who created the page"});case"teamsFilter":return o()(re.FormattedMessage,{id:"search.filterMenu.moreFilters.inTeams",defaultMessage:"Teamspace",description:"Label for button that opens a teamspace picker to add teamspace restricts (filters) to search results"});case"pageFilter":return o()(re.FormattedMessage,{id:"search.filterMenu.moreFilters.inPage",defaultMessage:"In page"});case"dateFilter":return o()(re.FormattedMessage,{id:"search.filterMenu.moreFilters.date",defaultMessage:"Date",description:"Search filter by some date"});case"titleToggle":return o()(re.FormattedMessage,{id:"search.filterMenu.onlyMatchTitlesToggle.label",defaultMessage:"Only search titles",description:"Label for only search titles toggle in search modal"})}(0,se.t1)(e)}function Pt(e){const t=C.VD.createdTime(e.createdTime),i=C.VD.lastEditedTime(e.lastEditedTime);return t?"createdTime":i?"lastEditedTime":void 0}function _t(e,t){switch(e){case"personFilter":case"teamsFilter":case"pageFilter":case"dateFilter":case"titleToggle":return}(0,se.t1)(e)}const xt=e=>", ";var Ft=i(41558),At=i(7908),Bt=i(31945),Et=i(3386),Rt=i(44532),Dt=i(14871),Lt=i(83264);const Ot={today:o()(re.FormattedMessage,{defaultMessage:"Today",id:"searchDateFilter.quickActions.today.label",description:"Filter search query results for documents edited or created today"}),pastWeek:o()(re.FormattedMessage,{defaultMessage:"Last 7 days",id:"searchDateFilter.quickActions.last7Days.label",description:"Filter search query results for documents edited or created in the last 7 days"}),pastMonth:o()(re.FormattedMessage,{defaultMessage:"Last 30 days",id:"searchDateFilter.quickActions.last30Days.label",description:"Filter search query results for documents edited or created in the last 30 days"})};function Nt(e){let{date:t,onClick:i,onDismiss:n}=e;const s=Ct.x7,a=Ct.Lg(s),r=a;let l;const d=Ot[t];"today"===t?l=a:"pastWeek"===t?l=Ct.Oo():"pastMonth"===t?l=Ct.dj():(0,se.t1)(t);return o()(Re.Z,{focused:!1,icon:Me.Z.calendar({height:18,width:18}),title:d,onClick:e=>{i({value:{starting:{type:"date",start_date:l.start_date},ending:{type:"date",start_date:r.start_date}}}),n(e)}})}class Ut extends d.Z{constructor(){super(...arguments),a()(this,"storeTypes",{store:Ft.Z}),a()(this,"renderPillButtonOrigin",(()=>{const{icon:e,title:t}=this.props,{store:i}=this.stores,n=this.styles,{dateFilterType:s}=i.state,a=L.ZP.state.query.filters[s].starting;return o()(ht.u,{on:Boolean(a),icon:e(n.pillIcon),title:o()("span",{},void 0,t),onClick:this.handleOriginActivate})})),a()(this,"renderPopupContents",(()=>{const{title:e}=this.props,{store:t}=this.stores;return l().createElement(l().Fragment,null,o()("div",{style:this.styles.dateFilterHeader},void 0,this.renderOperatorSelect(),o()(At.Z,{style:this.styles.clearButton,onClick:this.handleClear},void 0,o()(re.FormattedMessage,{defaultMessage:"Clear",id:"searchDateFilter.clearButton.label",description:"Button to remove the current date range our search results are being filtered by"}))),o()("div",{style:this.styles.quickDatesWrapper},void 0,o()(Nt,{date:"today",onClick:this.updateTemporary,onDismiss:this.handleMenuClose}),o()(Nt,{date:"pastWeek",onClick:this.updateTemporary,onDismiss:this.handleMenuClose}),o()(Nt,{date:"pastMonth",onClick:this.updateTemporary,onDismiss:this.handleMenuClose})),o()(Lt.Z,{title:e,value:this.getCurrentValue(),onUpdate:this.updateTemporary,store:t,onDismiss:this.handleMenuClose,hideDateInputMenuItems:!0}))})),a()(this,"handleOriginActivate",(()=>{const{disabled:e}=this.props,{store:t}=this.stores;e||t.setState({...t.state,isOpen:!0,focus:"starting"})})),a()(this,"handleMenuClose",(e=>{const{onMenuDismiss:t}=this.props,{store:i}=this.stores,{temporaryDateRange:n,dateFilterType:o}=i.state;C.zD(e)||(this.updateFilter(o,n),i.setState({...i.state,isOpen:!1}),t&&t())})),a()(this,"handleClear",(()=>{const{store:e}=this.stores,{dateFilterType:t}=e.state;this.updateFilter(t,{starting:void 0,ending:void 0}),e.clearTemporaryDateRange()})),a()(this,"handleMenuListKey",(e=>{e.preventDefault&&e.preventDefault()})),a()(this,"updateTemporary",(e=>{const{store:t}=this.stores;if(e.error)return;t.setState({...t.state,temporaryDateRange:{...t.state.temporaryDateRange,...e.value}});const{dateFilterType:i,temporaryDateRange:n}=t.state,{starting:o,ending:s}=n;o&&s&&this.updateFilter(i,{starting:o,ending:s})})),a()(this,"styles",{menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},icon:{height:14,width:14,fill:"currentColor"},pillIcon:{height:16,width:16,fill:"currentColor",marginRight:6},iconActiveDesktop:{height:14,width:14,fill:"currentColor",alignSelf:"flex-start",marginTop:2,marginRight:2},iconActiveDesktopWrapper:{marginTop:0},iconActiveMobile:{height:14,width:14,fill:"currentColor",marginTop:1,marginRight:6},popup:{paddingTop:12,paddingBottom:8},menuItemTitleDesktop:{width:"100%"},summary:{display:"inline-flex"},quickDatesWrapper:{marginTop:12,boxShadow:"0 1px 0 ".concat(this.theme.regularDividerColor),paddingBottom:15,marginBottom:15},clearButton:{color:this.theme.mediumTextColor,fill:this.theme.lightIconColor,fontWeight:500,fontSize:13,paddingLeft:2,paddingRight:2,paddingBottom:2,borderRadius:3,flexShrink:0},dateFilterHeader:{display:"flex",justifyContent:"space-between",alignItems:"center",marginLeft:12,marginRight:12}})}didMount(){this.updateTemporary({value:this.props.value})}renderComponent(){const{device:e}=this.environment,{mode:t}=this.props;return e.isMobile?this.renderMobile(t):this.renderDesktop(t)}renderDesktop(e){const{store:t}=this.stores,i=this.styles;return o()(yt.Z,{},void 0,o()(Et.Z,{capture:t.state.isOpen,onUp:this.handleMenuListKey,onDown:this.handleMenuListKey,onEnter:this.handleMenuListKey},void 0,o()(Rt.ZP,{popupType:this.getPopupType(),open:t.state.isOpen,origin:this.renderPillButtonOrigin(),render:this.renderPopupContents,onDismiss:this.handleMenuClose,placementToOrigin:Rt.ZP.Placement.Bottom,alignmentToOrigin:Rt.ZP.Alignment.Start,keepFocus:!0,style:i.popup})))}updateFilter(e,t){L.ZP.updateFilters({[e]:t})}getHumanReadableDateFilterType(e){return{lastEditedTime:o()(re.FormattedMessage,{id:"search.filterMenu.moreFilters.lastEdited",defaultMessage:"Last edited"}),createdTime:o()(re.FormattedMessage,{id:"search.filterMenu.moreFilters.created",defaultMessage:"Created"})}[e]}updateFilterFromToggle(e){const{value:t}=this.props,{store:i}=this.stores,{dateFilterType:n}=i.state;this.updateFilter(e,t),e!==n&&(this.updateFilter(n,{starting:void 0,ending:void 0}),i.setState({...i.state,dateFilterType:e}))}renderOperatorSelect(){const{device:e}=this.environment,{store:t}=this.stores,{dateFilterType:i}=t.state,n={width:190,items:["createdTime","lastEditedTime"],selectedItem:i,getKey:e=>e,onSelect:e=>this.updateFilterFromToggle(e),renderItem:e=>l().createElement(Re.Z,U()({title:this.getHumanReadableDateFilterType(e.value)},e)),renderOrigin:t=>l().createElement(At.Z,U()({},t,{style:{paddingLeft:2,paddingRight:2,paddingBottom:2,borderRadius:3,flexShrink:0}}),o()("div",{style:{display:"flex",alignItems:"center",...!e.isMobile&&{color:this.theme.mediumTextColor,fill:this.theme.lightIconColor,fontWeight:500,fontSize:13}}},void 0,o()("span",{style:{marginRight:4}},void 0,this.getHumanReadableDateFilterType(i)),this.renderOperatorChevron()))};return l().createElement(Dt.Z,U()({},n,{mobileActionSheet:!0}))}renderOperatorChevron(){const{device:e}=this.environment;return Me.Z.chevronDown({width:10,height:10,...e.isMobile&&{marginTop:2}})}renderMobile(e){const{store:t}=this.stores,i=e===ot.z.Section?this.renderMobileFilterSummary():this.renderMobileButtonOrigin();return o()(Rt.ZP,{popupType:Rt.ZP.PopupType.SlideUp,open:t.state.isOpen,origin:i,render:this.renderPopupContents,onDismiss:this.handleMenuClose,preventScaleTransition:!0})}renderMobileButtonOrigin(){const{icon:e,title:t,disabled:i}=this.props,n=this.styles;return o()(Re.Z,{disabled:i,focused:!1,icon:e(n.icon),title:t,onClick:this.handleOriginActivate})}renderMobileFilterSummary(){const{title:e,value:t,dateFormat:i,disabled:n,intl:s}=this.props,a=this.styles,r=o()("div",{style:a.summary},void 0,Me.Z.calendar(a.iconActiveMobile),C._Q(t,s,i));return o()(vt.Z,{disabled:n,onClick:this.handleOriginActivate,onClickClear:this.handleClear,label:e,title:r})}getCurrentValue(){const{store:e}=this.stores,{dateFilterType:t,temporaryDateRange:i}=e.state;return{...L.ZP.state.query.filters[t],...i}}getPopupType(){const{device:e}=this.environment;return e.isMobile?Bt.Z.PopupType.SlideUp:Bt.Z.PopupType.Popup}}const Wt=(0,re.injectIntl)(Ut),Vt="SearchFilterSettings";function zt(e){const t=(0,q.qz)(void 0,Ye.Z),{parentStore:i,isMobile:n}=e,s=(0,z.O7)(),a=(0,q.VK)((()=>s.currentUser.id),[s]),d=(0,q.VK)((()=>L.ZP),[]),c=(0,q.Kw)(d),u=c.query.filters,m=(0,q.VK)((()=>(0,T.bq)()&&Ae.default.checkGate("enable_search_team_filter")),[]),p=(0,H.y)((e=>({scroller:{display:"flex",alignItems:"center",paddingLeft:5,paddingRight:5,paddingTop:12,paddingBottom:10},barContainer:{display:"flex",alignItems:"center"},scrollerContainer:{position:"relative",flexGrow:0,overflow:"hidden"},draggableList:{display:"flex",flexShrink:0,marginLeft:6}})),[]),g=(0,r.useCallback)((e=>t=>d.updateFilters({[e]:t})),[d]),h=(0,r.useCallback)((()=>{t.setState({...t.state,open:!1})}),[t]),f=(0,r.useCallback)((()=>o()(lt.Z,{mode:ot.z.Pill,focused:!1,title:o()(It,{filterUIName:"personFilter",parentStore:i}),parentStore:i,userIds:u.createdBy,onMenuDismiss:h,onChange:g("createdBy")})),[i,u.createdBy,h,g]),v=(0,r.useCallback)((()=>m&&o()(gt,{mode:ot.z.Pill,focused:!1,title:o()(It,{filterUIName:"teamsFilter",parentStore:i}),parentStore:i,teamIds:u.inTeams,onMenuDismiss:h,onChange:g("inTeams")})),[i,u.inTeams,h,g,m]),y=(0,r.useCallback)((()=>o()(rt,{mode:ot.z.Pill,focused:!1,title:o()(It,{filterUIName:"pageFilter",parentStore:i}),parentStore:i,blockIds:u.ancestors,onMenuDismiss:h,onChange:g("ancestors")})),[i,u.ancestors,h,g]),S=(0,r.useCallback)((()=>o()(Wt,{mode:ot.z.Pill,focused:!1,title:o()(It,{filterUIName:"dateFilter",parentStore:i}),icon:Me.Z.calendar,value:u.lastEditedTime,onMenuDismiss:h})),[u.lastEditedTime,h,i]),b=(0,r.useCallback)((()=>!n&&o()(bt,{mode:ot.z.Pill,focused:!1,title:o()(It,{filterUIName:"titleToggle",parentStore:i}),icon:Me.Z.title,value:u.navigableBlockContentOnly||!1,onChange:g("navigableBlockContentOnly")})),[u.navigableBlockContentOnly,g,n,i]);(0,r.useEffect)((()=>{const e=Ke.Z.get({userId:a,key:Vt});e&&e.filterOrder&&d.updateFilterState(e)}),[a,d]);const M={personFilter:f(),teamsFilter:v(),pageFilter:y(),dateFilter:S(),titleToggle:b()};return o()("div",{style:p.barContainer},void 0,o()("div",{style:p.scrollerContainer},void 0,o()(Xe.Z,{type:je.Z.X,style:p.scroller,showLeftRightOverlay:!1},void 0,l().createElement(l().Fragment,null,o()(Qe.Z,{direction:Qe.K.Horizontal,keys:c.filterState.filterOrder,disableVerticalEdgeScroll:!0,disableHorizontalEdgeScroll:!0,renderKey:e=>M[e],style:p.draggableList,onDrop:e=>function(e){const t={...c.filterState,filterOrder:e};Ke.Z.set({userId:a,key:Vt,value:t}),d.updateFilterState(t)}(e)})))))}var qt=i(12174),Ht=i(65381),Gt=i(91941),Kt=i(93481),jt=(i(15306),i(8848));function Yt(e){const t=(0,z.Fy)();return o()(Bt.Z,{popupType:t.isMobile?Bt.Z.PopupType.SlideUp:Bt.Z.PopupType.Popup,renderOrigin:t=>l().createElement(Xt,U()({events:t},e)),render:t=>l().createElement(Qt,U()({parent:t},e))})}function Qt(e){let{parent:t,experiment:i,searchExperimentOverrides:n,onChange:s}=e;const a=(0,z.Fy)(),r=(0,H.y)((()=>({menuOptionStyle:{color:jt.ZP.mediumTextColor}})),[]);let d;d=a.isMobile?{menuType:Y.o.Modal,title:i.experimentId,right:o()(re.FormattedMessage,{defaultMessage:"Done",id:"appearanceSettings.modal.done"}),onClickRight:t.close}:{menuType:Y.o.Popup,width:250};const c=i.groups.map((e=>({key:e,action:n=>{s({experimentId:i.experimentId,group:e}),t.close()},render:(t,i)=>l().createElement(Re.Z,U()({},t,{title:e,style:r.menuOptionStyle}))})));return l().createElement(ie.Z,d,o()(ue.Z,{type:ue.i.Vertical,initialFocus:void 0,sections:[{key:i.experimentId,render:e=>l().createElement(pe.Z,e),items:c}]}))}function Xt(e){let{experiment:t,events:i,searchExperimentOverrides:n}=e;const s=(0,H.y)((e=>({experimentGroupButtonChevronStyle:{width:10,fill:e.lightIconColor},experimentGroupButtonStyle:{overflowX:"hidden",justifyContent:"left",overflow:"hidden",marginLeft:6,color:e.mediumTextColor},rowContainer:{display:"flex",overflow:"hidden",flexDirection:"row"},groupCell:{overflow:"hidden",marginRight:4}})),[]);return l().createElement(Gt.Z,U()({},i,{isSmall:!0,key:t.experimentId,style:s.experimentGroupButtonStyle}),o()("div",{style:s.rowContainer},void 0,o()("div",{style:s.groupCell},void 0,n[t.experimentId]||t.group),o()("div",{},void 0,Me.Z.chevronDown(s.experimentGroupButtonChevronStyle))))}const Jt=e=>({fontSize:14,lineHeight:1.2,color:e.mediumTextColor,overflow:"hidden",textOverflow:"ellipsis",marginRight:4,display:"flex",alignItems:"center",wordBreak:"break-all",whiteSpace:"nowrap"}),$t=function(e){const{experiment:t}=e,{leftOverrides:i,rightOverrides:n,experimentDiffers:s,experimentAgreesButNondefault:a}=(0,q.VK)((()=>{var e,i;const n=P.v_.state.searchExperimentOverrides,o=P.BJ.state.searchExperimentOverrides,s=(null!==(e=n[t.experimentId])&&void 0!==e?e:t.group)!==(null!==(i=o[t.experimentId])&&void 0!==i?i:t.group);return{leftOverrides:n,rightOverrides:o,experimentDiffers:s,experimentAgreesButNondefault:!s&&void 0!==o[t.experimentId]&&n[t.experimentId]!==t.group}}),[t]),d=(0,H.y)((e=>({rowContainer:{backgroundColor:s?e.equationErrorPlaceholderBackground:a?e.accentColors.yellow[100]:void 0},titleCell:{...Jt(e)}})),[a,s]),c=(0,r.useCallback)((e=>{const{experimentId:t,group:i,store:n}=e;n.setState({...n.state,searchExperimentOverrides:{...n.state.searchExperimentOverrides,[t]:i}})}),[]);return l().createElement(l().Fragment,null,o()("div",{style:{...d.titleCell,...d.rowContainer}},void 0,t.experimentId.replace("search-","")),o()("div",{style:d.rowContainer},void 0,o()(Yt,{experiment:t,searchExperimentOverrides:i,onChange:e=>{c({...e,store:P.v_})}})),o()("div",{style:d.rowContainer},void 0,o()(Yt,{experiment:t,searchExperimentOverrides:n,onChange:e=>{c({...e,store:P.BJ})}})))};let ei;!function(e){e[e.Button=0]="Button",e[e.MenuItem=1]="MenuItem"}(ei||(ei={}));class ti extends d.Z{constructor(){super(...arguments),a()(this,"handleFilterClick",(e=>{const{onMenuDismiss:t}=this.props;this.applyFilter(e),this.openSidebar(),t&&t()})),a()(this,"applyFilter",(e=>{L.ZP.updateFilters(e)})),a()(this,"openSidebar",(()=>{L.ZP.isSidebarOpen()||L.ZP.setState({...L.ZP.state,isSidebarOpen:!0})})),a()(this,"styles",{menuItem:{minHeight:void 0,paddingTop:this.environment.device.isMobile?12:4,paddingBottom:this.environment.device.isMobile?12:4},buttonFilter:{padding:"4px 8px",display:"flex",alignItems:"center",overflow:"hidden"},buttonText:{...ae.Z.textOverflowStyle},icon:{display:"inline-block",height:14,width:14,fill:"currentColor"},buttonIcon:{marginRight:6}})}renderComponent(){const{mode:e}=this.props;return e===ei.Button?this.renderAsButton():e===ei.MenuItem?this.renderAsMenuItem():void(0,se.t1)(e)}renderAsButton(){const{icon:e,title:t,filter:i}=this.props,n=this.styles,s=this.getThemeColors();return o()(At.Z,{style:{...n.buttonFilter,...s.buttonFilter},onClick:()=>this.handleFilterClick(i)},void 0,e&&e({...n.icon,...n.buttonIcon}),o()("span",{style:n.buttonText},void 0,t))}renderAsMenuItem(){const{icon:e,title:t,filter:i,focused:n}=this.props,s=this.styles,a=this.getThemeColors(),r={...s.menuItem,...a.menuItem};return o()(Re.Z,{icon:e&&e(s.icon),focused:n,title:t,onClick:()=>this.handleFilterClick(i),style:r})}getThemeColors(){const{device:e}=this.environment;return{menuItem:{color:e.isDesktop?this.theme.mediumTextColor:void 0,...this.props.isLastInSection&&{boxShadow:void 0}},buttonFilter:{color:this.theme.mediumTextColor}}}}a()(ti,"Mode",ei);class ii extends d.Z{renderComponent(){const e=ii.getCurrentPageFilter();if(e)return l().createElement(ti,U()({icon:Me.Z.searchInPage,title:o()(re.FormattedMessage,{id:"search.filterMenu.quickFilters.inCurrentPage",defaultMessage:"In current page"}),filter:e},this.props))}static isActive(e){const t=ii.getCurrentPageFilter();if(!t)return!1;if(!t.ancestors)return!1;const i=t.ancestors[0];return-1!==e.ancestors.indexOf(i)}}a()(ii,"getCurrentPageFilter",(()=>{const{mainEditorCurrentBlockStore:e}=I.default.state;if(e&&e.id)return{ancestors:[e.id]}}));class ni extends d.Z{renderComponent(){const e=ni.getCurrentUserFilter(this.environment);if(e)return l().createElement(ti,U()({icon:Me.Z.person,title:o()(re.FormattedMessage,{id:"search.filterMenu.quickFilters.createdByMe",defaultMessage:"Created by me"}),filter:e},this.props))}static isActive(e,t){const i=ni.getCurrentUserFilter(e);if(!i)return!1;if(!i.createdBy)return!1;const n=i.createdBy[0];return-1!==t.createdBy.indexOf(n)}}a()(ni,"getCurrentUserFilter",(e=>{const{id:t}=e.currentUser;if(t)return{createdBy:[t]}}));class oi extends d.Z{renderComponent(){const e=oi.getPastWeekFilter();if(e)return l().createElement(ti,U()({icon:Me.Z.calendar,title:o()(re.FormattedMessage,{id:"search.filterMenu.quickFilters.editedLastWeek",defaultMessage:"Edited last week"}),filter:e},this.props))}static isActive(e){const{lastEditedTime:t}=oi.getPastWeekFilter();return V().isEqual(t,e.lastEditedTime)}}a()(oi,"getPastWeekFilter",(()=>({lastEditedTime:{starting:Ct.Oo(Ct.x7),ending:Ct.Lg(Ct.x7)}})));var si=i(1743),ai=i(74194);function ri(){const{leftPattern:e,rightPattern:t}=(0,q.VK)((()=>({leftPattern:P.v_.state.forcedClusterPattern,rightPattern:P.BJ.state.forcedClusterPattern})),[]),{titleCell:i,rightTitleCell:n,leftTitleCell:s}=(0,H.y)((i=>{const n=Jt(i);return{titleCell:n,rightTitleCell:{...n,color:t?n.color:i.lightTextColor,width:"95%"},leftTitleCell:{...n,color:e?n.color:i.lightTextColor,width:"95%"}}}),[e,t]),[a,d]=(0,r.useState)(t),[c,u]=(0,r.useState)(e);(0,r.useEffect)((()=>{void 0===t&&d(void 0),void 0===e&&u(void 0)}),[t,e]);const m=(0,r.useCallback)((()=>{P.BJ.setState({...P.BJ.state,forcedClusterPattern:a})}),[a]),p=(0,r.useCallback)((()=>{P.v_.setState({...P.v_.state,forcedClusterPattern:c})}),[c]),g=(0,r.useCallback)((e=>{d(e.target.value)}),[]),h=(0,r.useCallback)((e=>{u(e.target.value)}),[]);return l().createElement(l().Fragment,null,o()("div",{style:i},void 0,"forcedClusterPattern"),o()(si.Z,{capture:!0,allowMenuList:!1},void 0,o()(ai.Z,{style:s,onBlur:p,value:c,onChange:h,placeholder:"cluster-pattern"}),o()(ai.Z,{style:n,onBlur:m,value:a,onChange:g,placeholder:"cluster-pattern"})))}let li;!function(e){e.Button="Button",e.Section="Section"}(li||(li={}));class di extends d.Z{constructor(){var e;super(...arguments),a()(this,"storeTypes",{buttonPopupStore:Ye.Z,debugMenuOpen:ce.default.of(!1)}),a()(this,"renderAddFilterOrigin",(e=>{const t=this.styles;return l().createElement(Gt.Z,U()({},e,{style:t.addFilterButtonMobile,icon:Me.Z.filterCircled,isBlue:!0}),o()(re.FormattedMessage,{defaultMessage:"Add filter",id:"search.addFilter.button.label"}))})),a()(this,"renderAddFilterMenu",(()=>o()(ie.Z,{menuType:Y.o.ActionSheet},void 0,this.renderSuggestedFilters(),o()(yt.Z,{title:this.renderMoreFiltersTitle()},void 0,this.renderCreatedByFilter(ot.Z.Mode.Button),this.renderCreatedTimeFilter(ot.Z.Mode.Button),this.renderLastEditedTimeFilter(ot.Z.Mode.Button),this.renderAncestorFilter(ot.Z.Mode.Button),this.renderInTeamFilter(ot.Z.Mode.Button))))),a()(this,"searchExperimentsToToggle",this.createComputedStore((()=>Object.entries(qt.g6).map((e=>{let[t,i]=e;return{experimentId:t,experimentVersion:1,group:Ae.default.getGroup(t),groups:["control",...i]}}))))),a()(this,"closeAddFilterMenu",(()=>{const{buttonPopupStore:e}=this.stores;e.setState({...e.state,open:!1})})),a()(this,"callTitleFilterUpdateFns",(e=>{L.ZP.updateFilters({navigableBlockContentOnly:e})})),a()(this,"closeSidebar",(()=>L.ZP.setState({...L.ZP.state,isSidebarOpen:!1}))),a()(this,"styles",{sidebar:{paddingTop:12,paddingBottom:24,overflowY:"auto",overflowX:"hidden",flex:"0 0 ".concat(null!==(e=this.stores.debugMenuOpen)&&void 0!==e&&e.state?440:220,"px"),minHeight:400},sidebarHidden:{display:"none"},addFilterButtonMobile:{fontSize:this.props.isMobile?ae.Z.fontSize.UISmall.mobile:ae.Z.fontSize.UISmall.desktop,fontWeight:ae.Z.fontWeight.medium,marginRight:-8}})}renderComponent(){return this.props.isMobile?this.props.mode===li.Button?this.renderAddButtonMobile():this.props.mode===li.Section?this.renderActiveFiltersMobile():void(0,se.t1)(this.props.mode):this.renderSidebar()}renderActiveFiltersMobile(){const{state:e}=L.ZP,t=C.De(e.query.filters);return o()(pe.Z,{disableMobilePadding:!0,disableMobileBorders:!0},void 0,this.renderTitlesOnlyFilter(ot.z.Section),this.renderDeletedOnlyFilter(ot.z.Section),this.renderActiveFilters(t,ot.Z.Mode.Section))}renderAddButtonMobile(){const{buttonPopupStore:e}=this.stores;return o()(Bt.Z,{popupType:Bt.Z.PopupType.SlideUp,buttonPopupStore:e,renderOrigin:this.renderAddFilterOrigin,render:this.renderAddFilterMenu})}renderActiveFilters(e,t){return o()(l().Fragment,{},void 0,e.createdBy&&this.renderCreatedByFilter(t),e.createdTime&&this.renderCreatedTimeFilter(t),e.lastEditedTime&&this.renderLastEditedTimeFilter(t),e.ancestors&&this.renderAncestorFilter(t),e.inTeams&&this.renderInTeamFilter(t))}renderSuggestedFilters(){const{filters:e}=L.ZP.state.query,t=ni.isActive(this.environment,e),i=oi.isActive(e),n=ii.isActive(e);if(!(t&&i&&n))return o()(yt.Z,{title:o()(re.FormattedMessage,{id:"search.filterMenu.quickFiltersSection.title",defaultMessage:"Quick filters"}),marginAfter:!0},void 0,!t&&o()(ni,{mode:ei.MenuItem,focused:!1,onMenuDismiss:this.closeAddFilterMenu}),!i&&o()(oi,{mode:ei.MenuItem,focused:!1,onMenuDismiss:this.closeAddFilterMenu}),!n&&o()(ii,{mode:ei.MenuItem,focused:!1,onMenuDismiss:this.closeAddFilterMenu,isLastInSection:!0}))}renderSidebar(){var e;const t=this.styles,i=this.getThemeColors(),n={...t.sidebar,...i.sidebar,...!L.ZP.isSidebarOpen()&&t.sidebarHidden,flex:"0 0 ".concat((null===(e=this.stores.debugMenuOpen)||void 0===e?void 0:e.state)||360,"px")};return o()("aside",{style:n},void 0,o()(At.Z,{onClick:this.closeSidebar,style:{display:"flex",alignItems:"center",justifyContent:"center",background:void 0,borderRadius:6,width:16,height:16,position:"absolute",top:10,right:10}},void 0,Me.Z.closeSmall({width:14,fill:this.theme.mediumTextColor})),this.renderDevToolsSection())}renderForcedClusterPatternInput(){return null}renderShowDebugInfoToggle(){return o()(bt,{mode:ot.z.Button,focused:!1,title:"Show debug info",icon:Me.Z.bot,value:P.ZP.state.showDebugInfo,onChange:e=>{P.ZP.setState({...P.ZP.state,showDebugInfo:Boolean(e)})}})}renderShowDebugSearchToggle(){return o()(bt,{mode:ot.z.Button,focused:!1,title:"Explain query",icon:Me.Z.bot,value:"everything"===P.ZP.state.debug,onChange:e=>{P.ZP.setState({...P.ZP.state,debug:e?"everything":void 0})}})}renderDevToolsSection(){if((0,ge.x)(y.Z))return o()(yt.Z,{title:o()(At.Z,{onClick:()=>{this.stores.debugMenuOpen.setState(!this.stores.debugMenuOpen.state)}},void 0,"Dev Tools")},void 0,o()(Ht.Z,{isVisible:!0,animationStyle:{height:"100%"},render:()=>o()("div",{style:{overflow:"scroll"}},void 0,this.renderShowDebugInfoToggle(),this.renderShowDebugSearchToggle(),this.renderForcedClusterPatternInput(),o()(yt.Z,{style:{marginTop:16},title:"Dev Experiments",right:(0,P.gq)({device:this.environment.device})&&o()(Gt.Z,{onClick:()=>{P.v_.reset(),P.BJ.reset()},style:{paddingLeft:0,paddingRight:0,height:"unset"}},void 0,Me.Z.sync({width:12}))},void 0,o()("div",{style:{display:"grid",gridTemplateColumns:"2fr 1fr 1fr",minWidth:"100%",maxWidth:"100%",paddingLeft:14}},void 0,this.searchExperimentsToToggle.state.map((e=>o()($t,{experiment:e},e.experimentId))),o()(ri,{}))))}))}renderTitlesOnlyFilter(e){const{filters:t}=L.ZP.state.query;return o()(bt,{mode:e,focused:!1,title:o()(re.FormattedMessage,{id:"search.filterMenu.onlyMatchTitlesToggle.label",defaultMessage:"Only search titles",description:"Label for only search titles toggle in search modal"}),icon:Me.Z.typesTitle,value:t.navigableBlockContentOnly||!1,onChange:this.callTitleFilterUpdateFns})}renderDeletedOnlyFilter(e){const{filters:t}=L.ZP.state.query;return o()(bt,{mode:e,focused:!1,title:o()(re.FormattedMessage,{id:"search.filterMenu.deletedOnlyToggle.label",defaultMessage:"Deleted only",description:"Label for only match deleted content toggle in search modal"}),icon:Me.Z.trash,value:t.isDeletedOnly||!1,onChange:this.createUpdateFunction("isDeletedOnly")})}renderMoreFiltersTitle(){return o()(re.FormattedMessage,{id:"search.filterMenu.moreFiltersSection.title",defaultMessage:"More filters"})}renderAncestorFilter(e){const{parentStore:t}=this.props,{filters:i}=L.ZP.state.query;return o()(rt,{mode:e,focused:!1,title:o()(re.FormattedMessage,{id:"search.filterMenu.moreFilters.inPage",defaultMessage:"In page"}),parentStore:t,blockIds:i.ancestors,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("ancestors")})}renderCreatedByFilter(e){const{parentStore:t}=this.props,{filters:i}=L.ZP.state.query;return o()(lt.Z,{mode:e,focused:!1,title:o()(re.FormattedMessage,{id:"search.filterMenu.moreFilters.createdBy",defaultMessage:"Created by"}),parentStore:t,userIds:i.createdBy,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("createdBy")})}renderCreatedTimeFilter(e){const{filters:t}=L.ZP.state.query;return o()(Kt.Z,{mode:e,focused:!1,title:o()(re.FormattedMessage,{id:"search.filterMenu.moreFilters.created",defaultMessage:"Created"}),icon:Me.Z.calendar,value:t.createdTime,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("createdTime")})}renderLastEditedTimeFilter(e){const{filters:t}=L.ZP.state.query;return o()(Kt.Z,{mode:e,focused:!1,title:o()(re.FormattedMessage,{id:"search.filterMenu.moreFilters.lastEdited",defaultMessage:"Last edited"}),icon:Me.Z.calendar,value:t.lastEditedTime,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("lastEditedTime")})}renderInTeamFilter(e){if(!(0,T.bq)())return;const{parentStore:t}=this.props,{filters:i}=L.ZP.state.query;return o()(gt,{mode:e,focused:!1,title:o()(re.FormattedMessage,{id:"search.filterMenu.moreFilters.inTeams",defaultMessage:"Teamspace",description:"Label for button that opens a teamspace picker to add teamspace restricts (filters) to search results"}),parentStore:t,teamIds:i.inTeams,onMenuDismiss:this.closeAddFilterMenu,onChange:this.createUpdateFunction("inTeams")})}createUpdateFunction(e){return t=>L.ZP.updateFilters({[e]:t})}getThemeColors(){return{sidebar:{backgroundColor:this.theme.sidebarSecondaryBackground,borderLeft:"1px solid ".concat(this.theme.regularDividerColor)}}}}const ci=di;var ui=i(56255);class mi extends d.Z{constructor(){super(...arguments),a()(this,"openSidebar",(()=>{L.ZP.setState({...L.ZP.state,isSidebarOpen:!0})})),a()(this,"styles",{menuItemMobile:{paddingBottom:0},titleWrapper:{flex:void 0,marginTop:-3,marginBottom:-1},showSidebarButton:()=>{const{device:e}=this.environment;return{padding:"0 4px",fontSize:e.isMobile?ae.Z.fontSize.UISmall.mobile:ae.Z.fontSize.UISmall.desktop,fontWeight:ae.Z.fontWeight.medium,borderRadius:3,height:20,lineHeight:"20px"}}})}renderComponent(){const{device:e}=this.environment,t=this.styles,i={...e.isMobile&&t.menuItemMobile},n=this.shouldAllowFilters()&&this.renderAddFilterButton();return o()(fe.Z,{title:this.renderSortMenu(),right:n,textWrapperStyle:t.titleWrapper,style:i})}renderSortMenu(){const e=L.ZP.state.query.sort;if("string"!=typeof e)return o()(ui.Z,{currentSortBy:e,setSortBy:e=>{L.ZP.setState({...L.ZP.state,query:{...L.ZP.state.query,sort:e}})},sortOptions:this.sortOptions})}renderAddFilterButton(){const{device:e}=this.environment,{parentStore:t}=this.props;if(e.isMobile)return o()(ci,{parentStore:t,isMobile:!0,mode:li.Button})}shouldAllowFilters(){const{isPublicPageSearch:e}=this.props;return!e}get sortOptions(){return[{key:"relevance.",formattedName:o()(re.FormattedMessage,{id:"search.sort.sortOrder.bestMatches",defaultMessage:"Best matches"}),sort:{field:"relevance"}},{key:"lastEdited.desc",formattedName:o()(re.FormattedMessage,{id:"search.sort.sortOrder.lastEdited.newestFirst",defaultMessage:"Last edited: Newest first"}),sort:{field:"lastEdited",direction:"desc"}},{key:"lastEdited.asc",formattedName:o()(re.FormattedMessage,{id:"search.sort.sortOrder.lastEdited.oldestFirst",defaultMessage:"Last edited: Oldest first"}),sort:{field:"lastEdited",direction:"asc"}},{key:"created.desc",formattedName:o()(re.FormattedMessage,{id:"search.sort.sortOrder.created.newestFirst",defaultMessage:"Created: Newest first"}),sort:{field:"created",direction:"desc"}},{key:"created.asc",formattedName:o()(re.FormattedMessage,{id:"search.sort.sortOrder.created.oldestFirst",defaultMessage:"Created: Oldest first"}),sort:{field:"created",direction:"asc"}}]}}const pi=mi;var gi=i(38755);class hi extends x.Z{getInitialState(){return{open:!1}}}const fi=new hi;var vi=i(68785),yi=i(33411);class Si extends d.Z{constructor(){super(...arguments),a()(this,"typingTimer",void 0),a()(this,"renderLeft",(e=>{var t,i;const{showSpinner:n}=this.props,{device:s}=this.environment,a=this.styles,r={...this.getThemeColors().searchIcon,...a.searchIcon()},l=Boolean(L.ZP.state.query.text.trim())&&!s.isMobile&&"on"===Ae.default.getGroup("navigational_search_improvements"),d=null===(t=e.state.jumpToResult)||void 0===t||null===(i=t.store)||void 0===i?void 0:i.getIcon(),c=l?o()(Le.Z,{disabled:!0,icon:d,isEmptyPage:Boolean(d),size:20,style:r}):Me.Z.searchThick(r);return o()(yi.Z,{show:n,showDelay:500,showHold:200,render:e=>e?o()(vi.Z,{style:r}):c})})),a()(this,"handleQueryChange",(e=>{this.handleTyping();const t=String(e.target.value);this.props.onQueryChange(t)})),a()(this,"handleClearButtonClick",(()=>{L.ZP.resetQuery({resetFilters:!0}),L.ZP.update((e=>({...e,isSidebarOpen:!1,source:void 0})))})),a()(this,"handleFocus",(()=>{const{onFocusChange:e}=this.props;e(!0)})),a()(this,"handleBlur",(()=>{const{onFocusChange:e}=this.props;e(!1)})),a()(this,"styles",{inputDesktop:{fontSize:18,height:Si.DESKTOP_INPUT_HEIGHT,paddingLeft:16,paddingRight:16,flexGrow:0,flexShrink:0,zIndex:1},inputMobile:{fontSize:16,border:"none",boxShadow:"none",borderRadius:7,lineHeight:"1.2",padding:"6px 8px"},searchIcon:()=>{const{device:e}=this.environment;return{width:e.isMobile?16:18,height:e.isMobile?16:18,marginRight:e.isMobile?12:10,flexGrow:0,flexShrink:0}},input:{minWidth:0,...ae.Z.textOverflowStyle},clearButton:{marginLeft:8}})}willUnmount(){this.typingTimer&&(clearTimeout(this.typingTimer),this.typingTimer=void 0)}renderComponent(){var e;const{device:t}=this.environment,{isOpen:i,searchResultStore:n}=this.props,s=this.styles,a=this.getThemeColors(),r=!t.isMobile&&"on"===Ae.default.getGroup("navigational_search_improvements"),l=m.Jc(null===(e=n.state.jumpToResult)||void 0===e?void 0:e.store.getTitleValue()),d=L.ZP.state.query.text,c=(null==l?void 0:l.slice(0,d.length).toLocaleLowerCase())===d.toLocaleLowerCase()&&d&&d.length<20,u=c?d+(null==l?void 0:l.substring(d.length)):void 0,p=t.isMobile?ai.Z.Format.ExtraLarge:ai.Z.Format.Transparent,g=t.isMobile?{...s.inputMobile,...a.inputMobile}:{...s.inputDesktop,...a.inputDesktop};return o()(ai.Z,{format:p,placeholder:this.getPlaceholderText(),left:this.renderLeft(n),value:d,suggestedText:r?c?u:"":void 0,focus:t.isMobile?void 0:i&&!fi.state.open,focusInitial:!(0,Q.Y)("supportsNativeHome")&&t.isMobile,focusAfterAnimation:!0,showClearButton:!0,selectAll:!0,onChange:this.handleQueryChange,onClearButtonClick:this.handleClearButtonClick,onFocus:this.handleFocus,onBlur:this.handleBlur,style:g,inputStyle:s.input})}handleTyping(){const{onTypingChange:e}=this.props;this.typingTimer&&window.clearTimeout(this.typingTimer),e(!0),this.typingTimer=window.setTimeout((()=>e(!1)),Si.TYPING_DEBOUNCE_MS)}getPlaceholderText(){const{currentSpaceStore:e,mainEditorCurrentBlockStore:t}=I.default.state,i=e&&(0,gi.getSpaceName)(this.environment,e);if(i)return this.props.intl.formatMessage({id:"searchInputMenuItem.placeholder.namedSpace",defaultMessage:"Search {spaceName}…"},{spaceName:i});if(t){const e=m.Jc(t.getTitleValue()).slice(0,Si.MAX_PLACEHOLDER_TITLE_LENGTH);return this.props.intl.formatMessage({id:"searchInputMenuItem.placeholder.namedPage",defaultMessage:"Search in {pageTitle}…"},{pageTitle:e})}return this.props.intl.formatMessage({id:"searchInputMenuItem.placeholder.unnamedPage",defaultMessage:"Search in page…"})}getThemeColors(){return{inputDesktop:{boxShadow:"0 1px 0 ".concat(this.theme.regularDividerColor)},inputMobile:{background:this.theme.inputBackground},searchIcon:{fill:this.theme.mediumIconColor}}}}a()(Si,"TYPING_DEBOUNCE_MS",300),a()(Si,"DESKTOP_INPUT_HEIGHT",48),a()(Si,"MAX_PLACEHOLDER_TITLE_LENGTH",100);const bi=(0,re.injectIntl)(Si);var Mi=i(472),wi=(i(41817),i(73935)),Ci=i.n(wi),ki=i(11689),Ti=i(43339),Ii=i(43765),Zi=i(39634),Pi=i(16354);class _i extends d.Z{constructor(){super(...arguments),a()(this,"styles",{menuItem:{minHeight:void 0,...this.environment.device.isMobile&&{background:void 0,boxShadow:void 0},paddingTop:32,paddingBottom:32},text:{textAlign:"center"},title:{margin:0,fontWeight:ae.Z.fontWeight.medium,fontSize:he.yv(this.environment,"UIRegular"),lineHeight:he.Dp(this.environment,"UIRegular")},caption:{fontSize:he.yv(this.environment,"UIRegular")}})}renderComponent(){const{style:e,captionStyle:t,...i}=this.props,n={...this.styles.menuItem,...e},o={...this.styles.caption,...t};return l().createElement(fe.Z,U()({},i,{title:this.renderTitle(),caption:this.renderCaption(o),textWrapperStyle:this.styles.text,style:n,captionStyle:o}))}renderTitle(){const{title:e}=this.props;if(!e)return;const t=this.styles,i=this.getThemeColors(),n={...t.title,...i.title};return o()("h4",{role:"alert",style:n},void 0,e)}renderCaption(e){const{caption:t}=this.props;if(!t)return;const i={...e,...this.getThemeColors().caption};return o()("div",{style:i},void 0,t)}getThemeColors(){return{title:{color:this.theme.mediumTextColor},caption:{color:this.theme.lightTextColor}}}}a()(_i,"contextTypes",{...Y.f});const xi=_i;class Fi extends d.Z{constructor(){super(...arguments),a()(this,"handleSendMessageClick",(()=>{Zi.j({environment:this.environment,from:"quick_find"})})),a()(this,"styles",{menuItem:{marginTop:"auto",marginBottom:"auto"},caption:{marginTop:"auto"},reportProblemButton:{display:"inline"},searchDeletedButton:{display:"inline"}})}renderComponent(){return l().createElement(xi,U()({},this.getErrorMessage(),{style:this.styles.menuItem,captionStyle:this.styles.caption,shouldWrapCaption:!0}))}renderNoResults(){return{title:Fi.noResultsTitle,caption:this.renderNoResultsMessage()}}renderNoResultsMessage(){var e=this;const t=L.ZP.state.query.filters,i=C.FN(t);if(!C.VD.isDeletedOnly(t.isDeletedOnly)){const t=this.styles,i=this.getThemeColors(),n={...t.searchDeletedButton,...i.searchDeletedButton};return o()(re.FormattedMessage,{id:"searchErrorMenuItem.errorPrompt.searchDeleted",defaultMessage:"Some results may be in your deleted pages.{br}<searchdeleted>Search deleted pages</searchdeleted>",description:"Message prompted to users when their Search return no results to suggest them search in deleted pages",values:{searchdeleted:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return o()(Pi.Z,{onClick:e.props.handleSearchDeletedOnly,style:n},void 0,i)},br:o()("br",{})}})}return o()(re.FormattedMessage,i?{defaultMessage:"Try different search terms or filters",id:"searchErrorMenuItem.errorPrompt.searchTermsAndFilters"}:{defaultMessage:"Try different search terms",id:"searchErrorMenuItem.errorPrompt.searchTerms"})}renderOffline(){return{title:Fi.noResultsTitle,caption:o()(re.FormattedMessage,{defaultMessage:"Go online for more results.",id:"searchErrorMenuItem.errorPrompt.goOnline"})}}renderRequestFailed(){var e=this;const t=this.styles,i=this.getThemeColors(),n={...t.reportProblemButton,...i.reportProblemButton};return{title:o()(re.FormattedMessage,{id:"searchErrorMenuItem.error.genericErrorMessage",defaultMessage:"Something went wrong"}),caption:o()(re.FormattedMessage,{id:"searchErrorMenuItem.errorPrompt.refreshOrReport",defaultMessage:"Try refreshing or <reportlink>report a problem</reportlink>.",values:{reportlink:function(){for(var t=arguments.length,i=new Array(t),s=0;s<t;s++)i[s]=arguments[s];return o()(Pi.Z,{onClick:e.handleSendMessageClick,style:n},void 0,i)}}})}}getErrorMessage(){const{error:e}=this.props;switch(e.type){case Ze.Ix.NoResults.type:return this.renderNoResults();case Ze.Ix.Offline.type:return this.renderOffline();case Ze.Ix.RequestFailed.type:return this.renderRequestFailed();default:(0,se.t1)(e)}}getThemeColors(){return{reportProblemButton:{color:this.theme.blueColor},searchDeletedButton:{color:this.theme.blueColor}}}}a()(Fi,"contextTypes",{...Y.f}),a()(Fi,"noResultsTitle",o()(re.FormattedMessage,{defaultMessage:"No results",id:"searchErrorMenuItem.error.noResults"}));const Ai=Fi;class Bi extends d.Z{constructor(){super(...arguments),a()(this,"storeTypes",{isInLoadMoreResultsScrollOffset:ce.default.of(!1)}),a()(this,"renderSearchResult",((e,t,i)=>{var n,o,s;const{store:a}=e,r=a.isNavigableBlock()?a:a.getNavigableBlockStore(),d="on"===Ae.default.getGroup("navigational_search_improvements");if(!r)return;const c=l().createRef(),u=l().createRef(),m=Boolean(P.ZP.getDebugLevel()),p=m&&e.sources.includes(Ze.vp.Local)?{score:e.score,frecencyScore:e.frecencyScore,localSource:e.localSource,personalizationBoost:e.personalizationBoost}:void 0,g=m&&e.sources.includes(Ze.vp.ElasticSearch)?null===(n=this.props.debugInfo)||void 0===n||null===(o=n.requests[0])||void 0===o||null===(s=o.rawResponse)||void 0===s?void 0:s.hits.hits.find((e=>e._id===a.id)):void 0,h=this.props.clusterInfo;return{key:"".concat(a.id,":").concat(t),action:t=>{if(c.current){const{event:e}=t;function i(t){const i=Ci().findDOMNode(t.current);return Boolean(i&&"target"in e&&e.target&&(i===e.target||i.contains(e.target)))}if(i(c)||i(u))return}this.props.handleSelectResult({store:a,action:t,selectedResult:e,allSearchResults:i})},render:i=>l().createElement(Ve,U()({},i,{index:t,originalPosition:e.originalPosition,isFirstInSection:0===t,isLastInSection:!!d&&void 0,store:r,hidePath:!1,result:e,className:j.ul,debugLocal:p,debugHit:g,debugAreaRef:c,debugLocalRef:u,clusterInfo:h}))}})),a()(this,"handleScrollOffsetChange",((e,t)=>{const{onMaybeLoadMoreResults:i}=this.props,{isInLoadMoreResultsScrollOffset:n}=this.stores,o=e<=Bi.LOAD_MORE_RESULTS_SCROLL_OFFSET_PX;o&&!n.get()&&i(),n.set(o),t.offsetFromTop&&L.ZP.update((e=>({...e,hasScrolled:!0})))})),a()(this,"resultStyles",{results:{flex:1,display:"flex",flexDirection:"column",overflow:"auto",height:"100%"},messageMenuItem:{...this.environment.device.isMobile&&{background:void 0,boxShadow:void 0}},debugMessageMenuItemTextStyle:{whiteSpace:"pre-wrap",fontFamily:"monospace"}})}renderComponent(){var e,t,i,n,s,a,r,d,c;const{errorState:u,results:m,resultListStore:p,parentStore:g,publicAccessPermission:h}=this.props,f=this.resultStyles,v=V().findLastIndex(m,(e=>e.sources.includes(Ze.vp.Local))),y=m?m.slice(0,v):[],S=m?m.slice(v):[],b=[y.length>0?{key:"localResults",render:e=>l().createElement(pe.Z,U()({},e,{shouldShowBottomDivider:!1,disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0})),items:V().compact(y.map(((e,t)=>this.renderSearchResult(e,t,y))))}:void 0,S.length>0?{key:"serverResults",render:e=>l().createElement(pe.Z,U()({},e,{shouldShowBottomDivider:!1,disableDesktopPadding:!0,disableMobilePadding:!0,disableMobileBorders:!0})),items:V().compact(S.map(((e,t)=>this.renderSearchResult(e,t,S))))}:void 0].filter(se.$K),M=null===(e=this.props.debugInfo)||void 0===e||null===(t=e.requests[0])||void 0===t||null===(i=t.rawResponse)||void 0===i||null===(n=i.profile)||void 0===n||null===(s=n.shards[0])||void 0===s||null===(a=s.searches)||void 0===a||null===(r=a[0])||void 0===r?void 0:r.query[0].children,w=null===(d=this.props.debugInfo)||void 0===d||null===(c=d.requests[0])||void 0===c?void 0:c.detectedLanguages;return l().createElement("section",{style:f.results,ref:this.props.resultsSectionRef},!this.environment.device.isMobile&&o()(pi,{parentStore:g,isPublicPageSearch:Boolean(h)}),M&&this.renderDebugMessage(o()(Fe.LazyAdminReactJson,{data:{parsedQuery:M},customCollapsedRenderers:[Di],showCopyButton:!0,showModalButton:!0})),w&&this.renderDebugMessage(o()(Fe.LazyAdminReactJson,{data:{detectedLanguages:w}})),b&&o()(ue.Z,{type:ue.i.Vertical,initialFocus:0,store:p,disableKeyboardArrowWrap:!0,sections:b}),this.renderError(u)||o()(me.Z,{onChange:this.handleScrollOffsetChange}))}renderError(e){if(!e.isLoading)return e.showMajorError?o()(Ai,{error:e.serverError,handleSearchDeletedOnly:()=>{const e=L.ZP.state.query.text;(0,f.IB)(),ki.Z.setState({...ki.Z.state,open:!0}),Ti.Z.setState({...Ti.Z.state,currentTab:"all_pages",filter:e,limit:Ti.Z.startLimit})}}):e.serverError&&e.serverError!==Ze.Ix.NoResults?this.renderMessage(e.serverError.message):void 0}renderDebugMessage(e){const t=this.resultStyles;return o()(pe.Z,{disableMobilePadding:!0,disableMobileBorders:!0},void 0,o()(fe.Z,{body:e,bodyStyle:t.debugMessageMenuItemTextStyle}))}renderMessage(e){const t=this.resultStyles;return o()(pe.Z,{disableMobilePadding:!0,disableMobileBorders:!0},void 0,o()(Ii.Z,{title:e,style:t.messageMenuItem}))}}a()(Bi,"LOAD_MORE_RESULTS_SCROLL_OFFSET_PX",200);const Ei=Bi;function Ri(e){const t=e.replaceAll(/\(MatchNoDocsQuery\("Matching no documents because no terms present"\)\)\^[0-9\.]/g,"").replaceAll(/MatchNoDocsQuery\("Matching no documents because no terms present"\)/g,"").replaceAll(/ConstantScore\(([^)]+):([^)]+)\)/g,"<i>$1</i>:<b>$2</b>").replace(/function score \(\((.*)\), functions:.*\)/,"$1").replaceAll("( ","(").replaceAll(" )",")").replaceAll("|","| <br/>").replaceAll(/([^( ]+):"([^"]+)"/g,'<i>$1</i>:<b>"$2"</b>').replaceAll(/([^( ]+):([^) ]+)/g,"<i>$1</i>:<b>$2</b>");return o()("span",{dangerouslySetInnerHTML:{__html:t}})}function Di(e){var t;let{data:i,keyPath:n}=e;var o;if(1===n.length)return{element:Ri(null===(o=i[0])||void 0===o?void 0:o.description),expanded:!1};if(!["type","description","time_in_nanos"].every((e=>i[e])))return null;let s=(null==i?void 0:i.description)||"";return null!==(t=s)&&void 0!==t&&t.includes("permissions.teamIds")&&(s="PermissionsQuery"),{element:Ri(s),expanded:!1}}const Li=function(e){const{parentStore:t,publicAccessPermission:i,resultListStore:n,localSearchCache:s,searchResultStore:a,queryResultsSectionRef:l,errorState:d,searchExperimentOverrides:c,forcedClusterPattern:u}=e,[{currentSpaceStore:m}]=(0,q.oR)(I.default),{isOpen:p,openAsPage:g,searchSessionId:h,localResults:f,serverResults:v,clusterInfo:y,query:S,limit:b,debug:M,debugInfo:w,recentPagesForBoosting:k}=(0,q.VK)((()=>{var e,t,i,n;return{query:L.ZP.state.query,limit:L.ZP.state.limit,recentPagesForBoosting:L.ZP.state.recentPagesForBoosting,debug:P.ZP.getDebugLevel(),isOpen:_.default.state.open,openAsPage:_.default.state.openAsPage,searchSessionId:_.default.state.sessionId,localResults:null===(e=a.state.localResults)||void 0===e?void 0:e.results,serverResults:null===(t=a.state.serverResults)||void 0===t?void 0:t.results,clusterInfo:null===(i=a.state.serverResults)||void 0===i?void 0:i.clusterInfo,debugInfo:null===(n=a.state.serverResults)||void 0===n?void 0:n.debugInfo}}),[a]),T=(0,z.O7)(),{isOnline:Z,shouldSearchLocal:x}=(0,q.VK)((()=>{return{isOnline:Boolean(X.Z.state.online),shouldSearchLocal:"on"!==(e="search-no-local-blending",null!==(t=null==c?void 0:c[e])&&void 0!==t?t:Ae.default.getGroup(e))};var e,t}),[c]);(0,G.r5)((async()=>{if(!p&&!g)return;a.update((e=>({...e,serverResultsLoading:!0})));const e={query:S,limit:b,debug:M};D.default.update((e=>({...e,numServerRequests:e.numServerRequests+1})));const n=a.state.serverResults,o=L.ZP.state.source,s=await async function(e){const{parentStore:t,requestInput:i,isOnline:n,environment:o,publicAccessPermission:s,searchSessionId:a,searchSessionFlowNumber:r,source:l,spaceId:d,searchExperimentOverrides:c,forcedClusterPattern:u,recentPagesForBoosting:m}=e,{query:p}=i;if(!p.text.trim()&&!C.FN(p.filters))return;if(!n)return{error:Ze.Ix.Offline};const g=Mi.default.createMetric("rum.server_quick_search_query"),h=await C.MS({environment:o,input:i,spaceId:d,publicAccessPermission:s,searchSessionId:a,searchSessionFlowNumber:r,source:l,searchExperimentOverrides:c,forcedClusterPattern:u,recentPagesForBoosting:m});if(!h)return;if("failed"===h.type)return h.offline?{error:Ze.Ix.Offline}:{error:Ze.Ix.RequestFailed};const f=h.data.trackEventProperties,v={};if(Object.keys(f).forEach((e=>{v["server-".concat(e)]=f[e]})),0===h.data.results.length)return{error:Ze.Ix.NoResults};const y=h.data.results.map(((e,i)=>({...e,originalPosition:i,store:Be.Z.createChildStore(t,{table:Ie.iU,id:e.id})})));return Mi.default.emit(o,g,void 0),{value:{results:y,total:h.data.total,debugInfo:h.data.debug,serverEventProperties:v,clusterInfo:h.data.clusterInfo}}}({parentStore:t,environment:T,requestInput:e,spaceId:null==m?void 0:m.id,searchSessionId:h,searchSessionFlowNumber:D.default.state.numServerRequests,publicAccessPermission:i,isOnline:Z,source:o,searchExperimentOverrides:c,forcedClusterPattern:u,recentPagesForBoosting:k}),r={query:L.ZP.state.query,limit:L.ZP.state.limit,debug:P.ZP.getDebugLevel()};if(!V().isEqual(e,r))return;const l=C.b9(s),d="quick_find_scroll"===o?(0,C.Nu)({existingResults:n,newPageResults:l}):l;if(s&&!s.error){const e=s.value.results;a.update((t=>({...t,serverError:null==s?void 0:s.error,serverResultsLoading:!1,serverResults:d,serverResultsAllLoaded:e.length<b,serverEventProperties:s.value.serverEventProperties,localResults:a.state.clearLocalResultsOnServerResponse?void 0:t.localResults,clearLocalResultsOnServerResponse:!1})))}else a.update((e=>({...e,serverError:null==s?void 0:s.error,serverResultsLoading:!1,serverResults:void 0,serverEventProperties:void 0,localResults:a.state.clearLocalResultsOnServerResponse?void 0:e.localResults,clearLocalResultsOnServerResponse:!1})));return s}),[p,g,a,S,b,M,t,T,null==m?void 0:m.id,h,i,Z,c,u,k],{debounce:$e.vp}),(0,G.r5)((()=>{const e=x?function(e){const{parentStore:t,requestInput:i,isOnline:n,environment:o,publicAccessPermission:s,localSearchCache:a}=e,{query:r}=i;if(!a)return;if(!r.text.trim())return;if(s)return;const l=Mi.default.createMetric("rum.local_quick_search_query"),d=C.tz({input:i,cache:a});if(!d)return;if(0===d.results.length)return{error:Ze.Ix.NoResults};const c=C.YB({sort:r.sort,unsorted:d.results,batchSize:L.Xv,currentUserId:o.currentUser.id}).map(((e,i)=>({...e,originalPosition:i,store:Be.Z.createChildStore(t,{table:Ie.iU,id:e.id})}))),u=n?C.g8(o,c):c,m=n?u.length:d.total;if(0===m)return{error:Ze.Ix.NoResults};const p={value:{total:m,results:u,debugInfo:void 0}};return Mi.default.emit(o,l,void 0),p}({parentStore:t,environment:T,requestInput:{query:S,limit:b},publicAccessPermission:i,isOnline:Z,localSearchCache:s}):void 0;D.default.update((e=>({...e,numLocalRequests:e.numLocalRequests+1})));const n=C.b9(e);return V().isEmpty(null==n?void 0:n.results)&&B(a.state)&&a.state.serverResultsLoading?a.update((e=>({...e,clearLocalResultsOnServerResponse:!0}))):a.update((e=>({...e,clearLocalResultsOnServerResponse:!1,localResults:n}))),Promise.resolve(e)}),[T,Z,b,x,s,t,i,S,a],{debounce:$e.E5});const F=(0,r.useCallback)((()=>{!a.state.serverResultsLoading&&!a.state.serverResultsAllLoaded&&void 0!==a.state.serverResults&&L.ZP.update((e=>({...e,limit:e.limit+L.Xv,isScrolled:!0,source:"quick_find_scroll"})))}),[a]),A=(0,r.useMemo)((()=>C.oO({results:{local:f,server:v}})),[f,v]);return(0,q.VK)((()=>{if(!A||A.length<0)return void a.update((e=>({...e,jumpToResult:void 0})));const e=A[0];e.sources.includes(Ze.vp.Local)?a.update((t=>({...t,jumpToResult:e}))):a.update((e=>({...e,jumpToResult:void 0})))}),[a,A]),o()(Ei,{errorState:d,resultsSectionRef:l,handleSelectResult:e.handleSelectResult,onMaybeLoadMoreResults:F,resultListStore:n,results:A,debugInfo:w,clusterInfo:y,parentStore:t,publicAccessPermission:i})};var Oi=i(22346),Ni=i(1800),Ui=i(54642),Wi=i(47307),Vi=i(53471),zi=i(31194),qi=i(71669),Hi=i(81865),Gi=i(92660);const Ki=(0,re.defineMessages)({additionalInformationPlaceholder:{id:"SearchBadResultsForm.additionalInformation.placeholder",defaultMessage:"Any additional comments or context (e.g. ...)",description:"Text box for any freeform feedback describing why the search results are poor quality"},urlPlaceholder:{id:"SearchBadResultsForm.url.placeholder",defaultMessage:"Link to page you were looking for",description:"Hyperlink to the the search page the user was looking for"}}),ji=e=>{const t=(0,H.F)(),i=(0,q.qz)(void 0,Ye.Z);return o()(Bt.Z,{popupType:Bt.Z.PopupType.Popup,buttonPopupStore:i,renderOrigin:e=>l().createElement(l().Fragment,null,l().createElement(Gt.Z,U()({style:{width:"100%"}},e),o()(Ii.Z,{title:"Select Result"}),Me.Z.chevronDown({width:10,marginLeft:4,fill:t.lightIconColor}))),placementToOrigin:zi.Iw.Bottom,alignmentToOrigin:zi.lU.Start,render:t=>{var i;const n=[{key:"results",render:e=>l().createElement(pe.Z,U()({},e,{topBorder:0!==e.index})),items:(null===(i=e.results)||void 0===i?void 0:i.map((i=>({key:i.id,render:e=>l().createElement(tt.Z,U()({store:i.store,checkState:!1,hidePath:!0},e)),action:()=>{e.onSelect(i),t.close()}}))))||[]}],s={menuType:Y.o.Popup,width:240};return l().createElement(ie.Z,s,o()(ue.Z,{type:ue.i.Vertical,initialFocus:void 0,sections:n}))}})};function Yi(){fi.reset()}const Qi=e=>{let{searchStoreState:t,currentSpaceStore:i,serverResults:n,localResults:s,environment:a}=e;const r=fi.getState(),l=C.AX(n),d=C.AX(s),c={query:t.query,limit:t.limit,debug:"everything"},u=C.bC(a),m=C.gC({input:c,spaceId:null==i?void 0:i.id,publicAccessPermission:u,source:"report_bad_search"});if(!m)return;const p={queryText:t.query.text.trim(),apiRequest:m,serverResults:JSON.stringify(l,null,2),localResults:JSON.stringify(d,null,2),desiredUrl:r.desiredUrl,additionalInformation:r.additionalInformation,screenshotUrl:r.screenshotUrl};(0,Ui.reportBadSearch)(a,p).then((e=>{200!==e.status&&Wi.showErrorMessage(o()("h1",{},void 0,"Failed to submit report"))})),fi.reset()},Xi=function(e){const{serverResults:t,localResults:i,combinedResults:n}=e,s=(0,z.Fy)(),a=(0,H.y)((e=>({textArea:{width:"100%",background:e.popoverBackground,display:"block",marginTop:17,marginBottom:17},urlArea:{width:"100%",height:"50%",background:e.popoverBackground,display:"block",marginTop:17,marginBottom:17},modalWrap:{width:360,padding:24,fontSize:14},modalTitle:{fontSize:16,marginBottom:12,fontWeight:ae.Z.fontWeight.medium},buttonArea:{display:"flex",justifyContent:"flex-end",marginTop:18},outlineButton:{marginRight:12},screenshotWrapper:{display:"flex",flexDirection:"column",justifyContent:"center",alignContent:"center",alignItems:"center"}})),[]),[d]=(0,r.useState)(L.ZP),[{currentSpaceStore:c}]=(0,q.oR)(I.default),[u,m]=(0,q.oR)(fi),[p,g]=(0,r.useState)("at-rest"),h=(0,z.O7)(),{screenshotUrl:f}=u,v=async()=>{try{g("screenshotting");const e=await(async()=>new Promise((async(e,t)=>{const i=document.createElement("canvas");i.width=window.outerWidth;const n=i.getContext("2d"),o=document.createElement("video");if(!n)return;const s=P.ZP.state.showDebugInfo;P.ZP.setStateWithoutPersisting({...P.ZP.state,showDebugInfo:!0});const a=await navigator.mediaDevices.getDisplayMedia();o.srcObject=a,await o.play(),setTimeout((()=>{var r,l;i.width=(null===(r=a.getTracks()[0])||void 0===r?void 0:r.getSettings().width)||1400,i.height=(null===(l=a.getTracks()[0])||void 0===l?void 0:l.getSettings().height)||900,n.drawImage(o,0,0,i.width,i.height),P.ZP.setStateWithoutPersisting({...P.ZP.state,showDebugInfo:s}),i.toBlob((i=>{if(!i)return t("no blob!");const n=new File([i],"fileName.jpg",{type:"image/jpeg"});return a.getTracks().forEach((e=>e.stop())),e(n)}),"image/jpeg")}),500)})))();if(!e)throw new Error("no file");return new Promise((async(t,i)=>{g("uploading"),await(0,Vi.cT)({environment:h,file:e,bucket:"public",preventLimitFreeFileSize:!0,onComplete:e=>(fi.setState({...fi.state,screenshotUrl:e}),t(e)),onError:i}),g("at-rest")}))}catch(e){throw g("at-rest"),e}},S=(0,r.useCallback)((e=>{m({...u,desiredUrl:e?(0,Ni.Z)({pageId:e.store.id,pageValue:e.store.getValue(),baseUrl:y.Z.domainBaseUrl}):void 0})}),[u,m]),b=(0,r.useCallback)((()=>{Qi({searchStoreState:d.state,currentSpaceStore:c,serverResults:t,localResults:i,environment:h})}),[d,c,t,i,h]);return o()(Gi.Z,{onDismiss:Yi,style:"screenshotting"===p?{display:"none"}:{},render:()=>o()(ee.Z,{capture:!0,allowUndo:!0,allowEsc:!0,allowTabUntab:!1,render:e=>l().createElement("div",U()({style:a.modalWrap},e),o()("div",{style:a.modalTitle},void 0,o()(re.FormattedMessage,{id:"SearchBadResultsForm.title",defaultMessage:"Report Bad Search",description:"Title for the poor search quality report form."})),o()(ai.Z,{textarea:!0,style:a.textArea,placeholder:et.default.formatMessage(Ki.additionalInformationPlaceholder),value:u.additionalInformation,onChange:e=>{m({...u,additionalInformation:e.target.value})},focusInitial:!0}),o()(ji,{results:n,onSelect:S}),o()(ai.Z,{textarea:!0,style:a.urlArea,placeholder:et.default.formatMessage(Ki.urlPlaceholder),value:u.desiredUrl,onChange:e=>{m({...u,desiredUrl:e.target.value})}}),!s.isNative&&o()("div",{style:a.screenshotWrapper},void 0,"uploading"===p?o()(vi.Z,{}):o()(ve.Z,{onClick:v},void 0,"Click to Include Screenshot"),f&&"at-rest"===p&&o()(Hi.Z,{url:f,isAuthenticated:!1,stripGoogleIconQuery:!0,width:90,render:(e,t)=>o()("div",{style:{width:90,height:90}},void 0,o()(qi.Z,{src:t,style:{width:90,height:90,objectFit:"fill",borderRadius:3}}))})),o()("div",{style:a.buttonArea},void 0,o()(ve.Z,{isLarge:!0,onClick:Yi,style:a.outlineButton},void 0,o()(re.FormattedMessage,{id:"SearchBadResultsForm.cancelButton.label",defaultMessage:"Cancel",description:"Exit the modal"})),o()(ve.Z,{isRed:!0,isLarge:!0,onClick:b,disabled:"at-rest"!==p,disabledFeedback:!0},void 0,o()(re.FormattedMessage,{id:"SearchBadResultsForm.reportButton.label",defaultMessage:"Submit",description:"Submit the form"}))))}),requireOnline:!0,modalStore:fi})};function Ji(e){const[t,i]=(0,q.oR)(fi),n=(0,H.y)((e=>({button:{...Se(e)}})),[]);return o()(ve.Z,{style:n.button,onClick:()=>{i({...t,open:!0})}},void 0,o()(re.FormattedMessage,{defaultMessage:"Report bad search",id:"search.header.badSearch.button.label",description:"Button that takes user to the poor search result page"}),l().createElement(Xi,e))}class $i extends d.Z{constructor(){super(...arguments),a()(this,"storeTypes",{requestModalOpen:ce.default.of(!1),responseModalOpen:ce.default.of(!1)}),a()(this,"styles",{footer:()=>{const{device:e}=this.environment;return{display:"flex",flexDirection:"row",justifyContent:"space-between",alignItems:"center",fontSize:e.isMobile?ae.Z.fontSize.UIRegular.mobile:ae.Z.fontSize.UIRegular.desktop}},footerText:{fontSize:he.yv(this.environment,"UISmall"),...ae.Z.textOverflowStyle},inlineHint:{display:"inline",marginRight:16},resultCountWrapper:{display:"flex",alignItems:"center",...ae.Z.textOverflowStyle},resultCount:{fontWeight:ae.Z.fontWeight.medium},resultText:{verticalAlign:"middle",marginRight:6},spinner:{display:"inline",width:12,height:12,verticalAlign:"middle"},keyboardShortcut:{marginRight:4,marginBottom:1,fontVariant:"all-small-caps",fontSize:1.1*he.yv(this.environment,"UISmall")},commandGlyph:{fontSize:.75*he.yv(this.environment,"UIRegular")},footerDebugButton:Se(this.theme),debugModalStyle:{maxHeight:"90vh",maxWidth:"90vw",height:"90vh",width:"90vw",overflow:"scroll"},navigationHints:{marginLeft:15}})}renderComponent(){const{localResults:e,serverResults:t,shouldShow:i}=this.props,n="production"!==y.Z.env&&"staging"!==y.Z.env;if(!n&&!i)return;const s=this.styles,a=this.getThemeColors(),r={...s.resultCount,...a.resultCount},{count:d,isLowerBound:c}=this.getResultCount(),u=o()("span",{style:s.resultText},void 0,c?this.props.intl.formatMessage({id:"SearchResultsFooter.helpText.resultCountApproximate",description:"Approximate number of results displayed in footer of search modal.",defaultMessage:"{resultCount, plural, other {<resultwrapper>{resultCount}+</resultwrapper> results}}"},{resultCount:d,resultwrapper:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()("span",{style:r},void 0,t)}}):this.props.intl.formatMessage({id:"SearchResultsFooter.helpText.resultCount",description:"Exact number of results displayed in footer of search modal.",defaultMessage:"{resultCount, plural, one {<resultwrapper>{resultCount}</resultwrapper> result} other {<resultwrapper>{resultCount}</resultwrapper> results}}"},{resultCount:d,resultwrapper:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return o()("span",{style:r},void 0,t)}})),m=o()("div",{style:s.resultCountWrapper},void 0,u,this.renderSpinner(this.props.showSpinner),o()("div",{style:s.navigationHints},void 0,o()(Ce,{})));return o()(be,{title:m,right:l().createElement(l().Fragment,null,n&&o()(Ji,{localResults:null==e?void 0:e.results,serverResults:null==t?void 0:t.results,combinedResults:this.props.combinedResults}),this.renderSearchDebugButtons())})}renderSpinner(e){const t=this.styles;return o()(yi.Z,{show:e,showDelay:500,showHold:200,render:e=>e&&o()(vi.Z,{style:t.spinner})})}renderSearchDebugButtons(){var e,t;if(!P.ZP.state.debug&&!P.ZP.state.showDebugInfo)return;const{rawRequest:i,rawResponse:n}=(null===(e=this.props.serverResults)||void 0===e||null===(t=e.debugInfo)||void 0===t?void 0:t.requests[0])||{};return l().createElement(l().Fragment,null,i&&l().createElement(l().Fragment,null,o()(Oi.Z,{open:this.stores.requestModalOpen.state,innerStyle:this.styles.debugModalStyle,onDismiss:()=>{this.stores.requestModalOpen.setState(!1)},render:()=>o()(Fe.LazyAdminReactJson,{showCopyButton:!0,data:i})}),o()(ve.Z,{style:this.styles.footerDebugButton,onClick:()=>this.stores.requestModalOpen.setState(!0)},void 0,"Open Request")),n&&l().createElement(l().Fragment,null,o()(Oi.Z,{open:this.stores.responseModalOpen.state,innerStyle:this.styles.debugModalStyle,onDismiss:()=>{this.stores.responseModalOpen.setState(!1)},render:()=>o()(Fe.LazyAdminReactJson,{showCopyButton:!0,data:n,defaultCollapsed:!0})}),o()(ve.Z,{style:this.styles.footerDebugButton,onClick:()=>this.stores.responseModalOpen.setState(!0)},void 0,"Open Response")))}getResultCount(){var e,t;const{serverResults:i,localResults:n}=this.props,o=null!==(e=null!==(t=null==i?void 0:i.total)&&void 0!==t?t:null==n?void 0:n.total)&&void 0!==e?e:0,s=Boolean(i&&o>=100);return{count:o,isLowerBound:Boolean(i&&n&&o<L.Xv)||s}}getThemeColors(){return{footerText:{color:this.theme.lightTextColor},resultCount:{color:this.theme.mediumTextColor},keyboardShortcut:{color:this.theme.mediumTextColor}}}}const en=(0,re.injectIntl)($i),tn="80vh";function nn(e){const t=(0,z.Fy)();return o()(te.Z,{capture:!0,ignoreBlockSelection:!0,focusOffscreenInput:!1,restoreSelection:!t.isMobile,render:()=>o()(ee.Z,{capture:!0,allowMenuList:!0,render:t=>l().createElement(on,U()({},e,{ignoreAreaEvents:t}))})})}function on(e){const{parentStore:t,ignoreAreaEvents:i,renderAsPage:n,onClose:s,modalBodyMenuRef:a,searchFilterMenuRef:d,queryResultsSectionRef:c,searchResultStore:u}=e,m=(0,H.y)((e=>({body:{flex:1,overflow:"hidden",display:"flex",flexDirection:"column"},topbar:{height:void 0,marginTop:10,marginLeft:16,marginBottom:10,marginRight:16},topbarRightButtonWrapper:{flex:void 0,paddingLeft:16},topbarButton:{fontWeight:void 0,padding:0,color:e.mediumTextColor},scroller:{display:"flex",flexDirection:"row",flexWrap:"nowrap",justifyContent:"space-between",maxHeight:n?"100vh":tn},clearButton:{color:e.lightTextColor},sxsContainer:{display:"flex",flexDirection:"row",height:"100%",overflow:"hidden",maxWidth:"100%"}})),[n]),[p,g,h]=(0,q.oR)(void 0,J.Z),[f,v]=(0,r.useState)(!1),[y,S]=(0,r.useState)(!1),b=(0,z.O7)(),M=(0,z.Fy)(),[w]=(0,q.oR)(I.default),{isSearchMenuOpen:k,shouldShowSpinner:T,localResults:Z,serverResults:x,shouldShowFilterSidebar:F,publicAccessPermission:A,hasQuery:B,errorState:E,showMajorError:O,hasResults:N,searchExperimentOverridesLeft:W,searchExperimentOverridesRight:K,forcedClusterPatternRight:Q,forcedClusterPatternLeft:ee,shouldShowSxSView:te}=(0,q.VK)((()=>{const e=Boolean(X.Z.state.online),t=C.bC(b),i=u.state.errorState;return{isSearchMenuOpen:_.default.state.open,shouldShowSpinner:e&&Boolean(L.ZP.state.query.text)&&u.state.serverResultsLoading&&!f,localResults:u.state.localResults,serverResults:u.state.serverResults,shouldShowFilterSidebar:ln({device:M,isPublicAccessPermissionForPage:Boolean(t)}),publicAccessPermission:t,isMobile:M.isMobile,hasQuery:Boolean(L.ZP.state.query.text.trim())||C.VA(L.ZP.state.query.filters),errorState:i,showMajorError:!1===i.isLoading&&i.showMajorError,hasResults:Boolean(u.state.localResults||u.state.serverResults),isLoading:i.isLoading,searchExperimentOverridesLeft:P.v_.state.searchExperimentOverrides,searchExperimentOverridesRight:P.BJ.state.searchExperimentOverrides,forcedClusterPatternLeft:P.v_.state.forcedClusterPattern,forcedClusterPatternRight:P.BJ.state.forcedClusterPattern,shouldShowSxSView:(0,P.gq)({device:M})}}),[f,u,M,b]),ne=(0,r.useMemo)((()=>V().debounce((()=>{const{activeElement:e}=document;e instanceof HTMLInputElement&&e.blur()}),500,{leading:!0})),[]),oe=(0,r.useCallback)((()=>{y&&ne()}),[ne,y]),se=(0,r.useCallback)((e=>{""!==e?(D.default.update((e=>({...e,numKeystrokes:e.numKeystrokes+1}))),L.ZP.updateQueryText(e),h.update((e=>({...e,focus:{section:0,indexLocal:0,indexGlobal:0}})))):L.ZP.resetQuery({resetFilters:!1})}),[h]),ae=(0,r.useCallback)((e=>{S(e),e||M.isMobileNative&&$.Z.updateKeyboardPhase(b,$.i.willHide,0)}),[M.isMobileNative,b]),re=(0,r.useMemo)((()=>o()(bi,{isOpen:Boolean(n||k),onTypingChange:v,onFocusChange:ae,showSpinner:T,onQueryChange:se,searchResultStore:u})),[n,k,ae,T,se,u]),le=(0,r.useMemo)((()=>{if(M.isMobile){return{menuType:Y.o.Modal,left:re,shouldRenderLeftDirectly:!0,width:n?"100vw":void 0,...an({isPhone:M.isPhone,renderAsPage:n,style:m.topbarRightButtonWrapper,onClick:s}),header:B&&o()(pi,{parentStore:t,isPublicPageSearch:Boolean(A)}),disableHeaderShadow:!0,topbarStyle:m.topbar,leftRightButtonStyle:m.topbarButton,onScroll:rn(M)?oe:void 0,bodyScrollerClassName:j.GZ,...i}}const e={menuType:Y.o.Popup,maxHeight:n?"100vh":tn,minHeight:50,disableScroller:!0,scrollerStyle:m.scroller,...i};return n&&M.isDesktop&&(e.maxWidth="100%"),e}),[M,m,i,re,n,s,B,t,A,oe]),[{value:de}]=(0,G.r5)((()=>async function(e){let{environment:t,appStoreState:{currentSpaceStore:i,currentSpaceViewStore:n},isPublicAccessPermissionForPage:o}=e;if(o)return;if(!i)return;return C.hb({environment:t,currentSpaceStore:i,currentSpaceViewStore:n})}({environment:b,appStoreState:w,isPublicAccessPermissionForPage:Boolean(A)})),[b,w,A]),ce=(0,r.useMemo)((()=>C.oO({results:{local:null==Z?void 0:Z.results,server:null==x?void 0:x.results}})),[Z,x]),ue={parentStore:t,publicAccessPermission:A,resultListStore:h,localSearchCache:de,searchResultStore:u,queryResultsSectionRef:c,errorState:E,handleSelectResult:e.handleSelectResult,searchExperimentOverrides:W,forcedClusterPattern:ee},[,,me]=(0,q.oR)(void 0,J.Z),[pe,,ge]=(0,q.oR)(void 0,R),he={...ue,resultListStore:me,searchResultStore:ge,searchExperimentOverrides:K,forcedClusterPattern:Q};return l().createElement(ie.Z,U()({},le,{className:j.O,ref:a}),o()(sn,{enableLazyLoading:n},void 0,o()("div",{style:m.body},void 0,!M.isMobile&&re,!M.isMobile&&o()(zt,{parentStore:t,isMobile:M.isMobile}),B?l().createElement(l().Fragment,null,!O&&M.isMobile&&l().createElement(ci,{parentStore:t,isMobile:!0,mode:li.Section,ref:d}),o()("div",{style:m.sxsContainer},void 0,o()("div",{style:{display:"flex",flexDirection:"column",width:te?"50%":"100%"}},void 0,l().createElement(Li,ue),o()(en,{localResults:Z,serverResults:x,combinedResults:ce,showSpinner:T,shouldShow:!O&&N&&!M.isMobile})),te&&o()("div",{style:{display:"flex",flexDirection:"column",width:te?"50%":"100%"}},void 0,l().createElement(Li,he),o()(en,{localResults:pe.localResults,serverResults:pe.serverResults,combinedResults:ce,showSpinner:pe.serverResultsLoading,shouldShow:!M.isMobile})))):o()(Ge,{parentStore:t,onSelect:e.onRecentPageSelect,resultListStore:h})),F&&l().createElement(ci,{parentStore:t,ref:d})))}function sn(e){const{enableLazyLoading:t,children:i}=e,n=(0,z.O7)();return t?o()(oe.Z,{fetch:async()=>{var e;await K.Vs(0),await I.default.waitUntil((()=>void 0!==I.default.state.currentSpaceStore)),null===(e=n.mobileNative)||void 0===e||e.markTransitionReady({type:"search"})},loading:()=>o()(r.Fragment,{}),render:()=>i}):o()(r.Fragment,{},void 0,i)}function an(e){let{isPhone:t,style:i,renderAsPage:n,onClick:s}=e;return t&&(0,Q.Y)("supportsNativeHome")||n?{rightOuterStyle:{display:"none"}}:{right:o()(ne.CancelMenuText,{}),onClickRight:s,rightOuterStyle:i}}function rn(e){return!!e.isMobile&&(!e.isIOS||e.isMobileNative)}function ln(e){let{device:t,isPublicAccessPermissionForPage:i}=e;if(!i&&!t.isMobile)return L.ZP.isSidebarOpen()}class dn extends d.Z{constructor(){super(...arguments),a()(this,"inactiveTimer",void 0),a()(this,"spaceId",void 0),a()(this,"isOpen",!1),a()(this,"queryResultsSectionRef",l().createRef()),a()(this,"searchFilterMenuRef",l().createRef()),a()(this,"modalBodyMenuRef",l().createRef()),a()(this,"storeTypes",{localCacheRequestStore:Z.Z,searchResultStore:R}),a()(this,"renderContent",(()=>o()(nn,{renderAsPage:this.props.renderAsPage,parentStore:this.props.parentStore,onRecentPageSelect:this.onRecentPageSelect,onClose:this.handleComponentClose,searchResultStore:this.stores.searchResultStore,handleSelectResult:this.onQueryResultSelect,searchFilterMenuRef:this.searchFilterMenuRef,modalBodyMenuRef:this.modalBodyMenuRef,queryResultsSectionRef:this.queryResultsSectionRef}))),a()(this,"onRecentPageSelect",(e=>{this.handleSelectResult({...e,context:"recent_pages"})})),a()(this,"onQueryResultSelect",(e=>{this.handleSelectResult({...e,context:"query_results"})})),a()(this,"handleComponentOpenClose",(()=>{this.isOpen!==_.default.state.open&&(this.isOpen=_.default.state.open,_.default.state.open?(clearTimeout(this.inactiveTimer),L.ZP.update((e=>({...e,hasScrolled:!1,hasHoveredForContext:!1})))):this.addRecentSearch())})),a()(this,"getNumResultsAboveFold",(()=>C.MQ({environment:this.environment,searchResultsSection:this.queryResultsSectionRef.current,modalBodyMenu:this.modalBodyMenuRef.current,searchFilterMenu:this.searchFilterMenuRef.current}))),a()(this,"getNumLocalResults",(()=>{var e,t;return null!==(e=null===(t=this.stores.searchResultStore.state.localResults)||void 0===t?void 0:t.results.length)&&void 0!==e?e:0})),a()(this,"handleComponentClose",(()=>{const{device:e}=this.environment,{searchResultStore:t}=this.stores,{selectedQueryResult:i,numKeystrokes:n,numServerRequests:o,numLocalRequests:s,hadMetaClick:a}=D.default.state,{serverEventProperties:r}=t.state,{query:l,hasScrolled:d}=L.ZP.state;if(n>0&&(o>0||s>0)&&!i&&!a&&(_.default.state.openAsPage||_.default.state.open)){const e=Date.now(),t=_.default.state.openedTimeMs,i=_.default.state.sessionId;g.trackAbandonedSearch(this.environment,{...r,timeToAbandonMs:e-t,numKeystrokes:n,numResultsAboveFold:this.getNumResultsAboveFold(),searchSessionId:i,searchSessionFlowNumber:o,hasScrolled:d,numLocalResults:this.getNumLocalResults()})}f.IB(),""===l.text.trim()?L.ZP.reset():C.FN(l.filters)||L.ZP.update((e=>({...e,isSidebarOpen:!1}))),this.inactiveTimer=window.setTimeout(this.resetState,2*p.hM),!this.props.renderAsPage&&e.isMobile&&v.close(),D.default.reset()})),a()(this,"handlePotentialWebSearchAbandon",(e=>{this.props.renderAsPage&&this.handleComponentClose()})),a()(this,"handleSelectResult",(e=>{let{store:t,action:i,context:n,selectedResult:o,allSearchResults:s}=e;const{searchResultStore:a}=this.stores,{serverEventProperties:r}=a.state,{numKeystrokes:l,hadMetaClick:d}=D.default.state;if(!_.default.state.open&&!_.default.state.openAsPage)return;const{event:c}=i,u="metaKey"in c&&c.metaKey||"ctrlKey"in c&&c.ctrlKey;"query_results"===n&&this.stores.searchResultStore.update((e=>({...e,selectedQueryResult:!0})));const m=Date.now(),{openedTimeMs:p,sessionId:f}=_.default.state,{numServerRequests:v}=D.default.state,{query:S}=L.ZP.state;g.trackSelectSearchItem(this.environment,{...r,context:n,queryStringLength:S.text.trim().length,hasFilters:C.FN(S.filters),activeFilters:S.filters,selectedItemIndex:i.index,numKeystrokes:l,isMetaClick:u,isSidebarOpen:L.ZP.isSidebarOpen(),timeToSelectMs:m-p,sources:null==o?void 0:o.sources,hadMetaClick:d,numResultsAboveFold:this.getNumResultsAboveFold(),selectedSearchResultMetadata:this.getSearchResultMetadata(t,null==o?void 0:o.highlight),selectedSearchResultContent:"production"!==y.Z.env?this.getSearchResultContent(t,null==o?void 0:o.highlight):void 0,allSearchResultMetadata:null==s?void 0:s.slice(0,dn.MAX_RESULT_TO_TRACK).map((e=>this.getSearchResultMetadata(e.store,e.highlight))),totalSearchResultCount:null==s?void 0:s.length,searchSessionId:f,searchSessionFlowNumber:v,originalPosition:null==o?void 0:o.originalPosition,numLocalResults:this.getNumLocalResults()});const M=this.jumpToBlock(o);void 0===M?h.navigateToPage(t,u,this.environment):h.navigateToBlock({environment:this.environment,store:t,scrollToBlockId:M,metaClick:u,visitType:b.vu.Search}),u?D.default.update((e=>({...e,hadMetaClick:!0}))):this.handleComponentClose()})),a()(this,"jumpToBlock",(e=>{var t;if(void 0!==(null==e?void 0:e.highlightBlockId)&&void 0===(null===(t=e.highlight)||void 0===t?void 0:t.title))return e.highlightBlockId})),a()(this,"getSearchResultMetadata",((e,t)=>c.Z.withListenerIgnored((()=>{var i;return{blockId:e.id,blockType:e.getType(),lowestNavigableAncestorId:null===(i=e.getNavigableBlockStore())||void 0===i?void 0:i.id,depth:M.qA(e).length,matchesText:Boolean(null==t?void 0:t.text),matchesPathText:Boolean(null==t?void 0:t.pathText),isNavigable:e.isNavigableBlock(),lastEditedTime:e.getLastEditedTime()}})))),a()(this,"getPathText",(e=>{const t=[];return M.uJ(e).forEach((e=>{if(w.NZ(e)){var i;const n=(0,m.Q)(null===(i=e.getNavigableBlockStore())||void 0===i?void 0:i.getTitleValue());n&&t.push(n)}else if((0,T.bq)()&&w.Y(e)){const i=e.getName();i&&t.push(i)}})),t})),a()(this,"handleSpaceChange",(()=>{const e=I.default.state.currentSpaceStore&&I.default.state.currentSpaceStore.id;this.spaceId!==e&&(this.spaceId=e,this.resetState())})),a()(this,"addRecentSearch",(()=>{const{currentSpaceStore:e}=I.default.state;if(!e)return;const{query:t}=L.ZP.state;t.text.trim()&&B(this.stores.searchResultStore.state)&&k._({currentUserId:this.environment.currentUser.id,spaceId:e.id,query:t})})),a()(this,"resetState",(()=>{const{localCacheRequestStore:e,searchResultStore:t}=this.stores;L.ZP.reset(),e.reset(),_.default.reset(),t.reset()}))}willMount(){var e;this.spaceId=null===(e=I.default.state.currentSpaceStore)||void 0===e?void 0:e.id,(0,P.lO)()}willMountOrUpdate(e){if(e.renderAsPage&&!_.default.state.sessionId){const e=(0,u.ZP)();_.default.setState({open:!1,openAsPage:!0,openedTimeMs:Date.now(),sessionId:e}),g.trackOpenSearch(this.environment,{from:"nativeTab-search-direct-link",searchSessionId:e})}}didMount(){this.props.renderAsPage||_.default.addListener(this.handleComponentOpenClose),h.potentialWebSearchAbandonEventEmitter.addListener(this.handlePotentialWebSearchAbandon),I.default.addListener(this.handleSpaceChange)}willUnmount(){this.props.renderAsPage||_.default.removeListener(this.handleComponentOpenClose),h.potentialWebSearchAbandonEventEmitter.removeListener(this.handlePotentialWebSearchAbandon),I.default.removeListener(this.handleSpaceChange),this.inactiveTimer&&(clearTimeout(this.inactiveTimer),this.inactiveTimer=void 0)}renderComponent(){if(this.props.renderAsPage)return this.renderContent();const{device:e,mobileNative:t}=this.environment,i=Boolean(_.default.state.open);return o()(O.Z,{open:i,onDismiss:this.handleComponentClose,modalStyle:this.getModalStyle(),disableAnimation:!e.isMobile||(null==t?void 0:t.supportsNativeHomeOnPhone())||!1,renderContent:this.renderContent})}getPublicAccessPermissionForPage(){return C.bC(this.environment)}getSearchResultContent(e,t){return c.Z.withListenerIgnored((()=>{var i;return{title:(0,m.Q)(null===(i=e.getNavigableBlockStore())||void 0===i?void 0:i.getTitleValue()),pathText:this.getPathText(e),highlight:{text:(0,S.fe)(null==t?void 0:t.text),pathText:(0,S.fe)(null==t?void 0:t.pathText)}}}))}getModalStyle(){const{renderAsPage:e}=this.props,t=(0,P.gq)({device:this.environment.device}),i=ln({device:this.environment.device,isPublicAccessPermissionForPage:Boolean(this.getPublicAccessPermissionForPage())});return{width:"75%",minHeight:dn.MIN_MENU_HEIGHT,maxHeight:e?"100vh":dn.MAX_MENU_HEIGHT,background:this.theme.popoverBackground,maxWidth:t?"90vw":i?900:660}}}a()(dn,"MAX_RESULT_TO_TRACK",50),a()(dn,"MIN_MENU_HEIGHT",50),a()(dn,"MAX_MENU_HEIGHT","80vh");const cn=dn},62889:(e,t,i)=>{i.r(t),i.d(t,{CreateTeamFromPageConfirmModal:()=>v});var n=i(77094),o=i.n(n),s=(i(41817),i(67294),i(480)),a=i(24405),r=i(53397),l=i(5366),d=i(82990),c=i(38363),u=i(72684),m=i(42922),p=i(63296),g=i(92660),h=i(29551),f=i(51923);function v(){const e=(0,s.O7)(),t=(0,l.useIntl)(),i=(0,a.y)((e=>({modal:{maxWidth:350,padding:24},loopIcon:{height:28,width:28,fill:e.darkTextColor},infoIcon:{height:16,width:16,fill:e.lightIconColor,marginRight:4},title:{marginTop:16,marginBottom:12,color:e.regularTextColor,fontWeight:d.Z.fontWeight.semibold,fontSize:18},description:{color:e.darkTextColor,textAlign:"center",fontSize:14,marginBottom:18},confirmButton:{width:"100%",marginBottom:8},cancelButton:{width:"100%",display:"flex",alignItems:"center",justifyContent:"center",marginBottom:14}})),[]);return o()(g.Z,{onDismiss:()=>{u.Z.setState({open:!1})},render:()=>o()("div",{style:i.modal},void 0,o()(h.gq,{flexDirection:"column",justifyContent:"center",alignItems:"center"},void 0,r.Z.loop(i.loopIcon),o()("div",{style:i.title},void 0,o()(l.FormattedMessage,{id:"createTeamFromPage.confirmModal.title",defaultMessage:"Turn into teamspace?",description:"Title in confirmation modal for creating a teamspace from a page."})),o()("div",{style:i.description},void 0,o()(l.FormattedMessage,{id:"createTeamFromPage.confirmModal.description",defaultMessage:"This will move this page into a newly created teamspace along with people who already have access to this page.",description:"Description in confirmation modal for creating a teamspace from a page."})),o()(m.Z,{isLarge:!0,style:i.confirmButton,onClick:()=>{if(u.Z.state.open){const{pageStore:i,flowId:n}=u.Z.state;(0,c.Sq)({environment:e,intl:t,page:i,flowId:n}),u.Z.setState({open:!1})}}},void 0,o()(l.FormattedMessage,{id:"createTeamFromPage.confirmModal.confirmButton",defaultMessage:"Create teamspace",description:"Confirm button in confirmation modal for creating a teamspace from a page."})),o()(p.Z,{isLarge:!0,style:i.cancelButton,onClick:()=>u.Z.setState({open:!1})},void 0,o()(l.FormattedMessage,{id:"createTeamFromPage.confirmModal.cancelButton",defaultMessage:"Cancel",description:"Cancel button in confirmation modal for creating a teamspace from a page."})),o()(f.Z,{message:o()(l.FormattedMessage,{id:"createTeamFromPage.confirmModal.learnMore",defaultMessage:"Learn more about teamspaces",description:"Learn more link in confirmation modal for creating a teamspace from a page."}),analyticsFrom:"teams_learn_more_turn_page_into_team",helpCenterLocation:"bestPractices"}))),requireOnline:!0,modalStore:u.Z})}},72360:(e,t,i)=>{i.r(t),i.d(t,{SidebarCreateTeamModal:()=>de});var n=i(77094),o=i.n(n),s=(i(33948),i(41817),i(96486)),a=i.n(s),r=i(67294),l=i.n(r),d=i(480),c=i(28350),u=i(24405),m=i(53397),p=i(82990),g=i(5366),h=i(50906),f=i(38363),v=i(33929),y=i(78122),S=i(23537),b=i(27832),M=i(20431),w=i(19522),C=i(33052),k=i(42922),T=i(7908),I=i(74194),Z=i(3386),P=i(68785),_=i(22346),x=i(31278),F=i(13490),A=i(97464),B=i.n(A),E=i(60709),R=i(98742),D=i(86275),L=i(25464),O=i(31194),N=i(52275),U=i(31945),W=i(78140),V=i(58189),z=i(74136),q=i(72495),H=i(58032);function G(e){let{currentAccessLevel:t,onChange:i}=e;const{device:n}=(0,d.O7)(),s=(0,u.y)((e=>({chevronDown:{width:12,marginLeft:4,fill:e.lightIconColor},selectedButton:{width:"100%",margin:0,paddingTop:4,paddingBottom:4,border:"1px solid ".concat(e.outlineButtonBorder)},selectedCheckmark:{width:n.isMobile?16:14}})),[n.isMobile]),a=(0,D.U)({isCreateTeam:!0,teamStore:void 0,onChange:i,isDefault:!1});return o()(U.Z,{popupType:n.isMobile?U.Z.PopupType.SlideUp:U.Z.PopupType.Popup,renderOrigin:e=>{const i=a.find((e=>e.key===t));return i?l().createElement(N.Z,B()({},e,{title:i.title,caption:i.caption,icon:i.icon({fill:i.iconColor}),right:m.Z.chevronDown(s.chevronDown),focused:!1,shouldWrapCaption:!0,buttonStyle:s.selectedButton})):null},placementToOrigin:O.Iw.Bottom,alignmentToOrigin:O.lU.Start,sameWidthAsOrigin:!0,render:e=>{const i=[{key:"access levels",render:e=>l().createElement(q.Z,B()({},e,{topBorder:0!==e.index})),items:a.map((i=>{const n=i.key===t;return{key:i.key,render:e=>o()(H.Z,{placement:L.u.Top,disableTooltip:!i.tooltip,renderTooltip:()=>i.tooltip,render:t=>l().createElement(N.Z,B()({},(0,R.Z)(e,t),{title:i.title,caption:i.caption,icon:i.icon({fill:i.iconColor}),right:n?o()("div",{style:s.selectedCheckmark},void 0,m.Z.check()):void 0,disabled:i.disabled,shouldWrapCaption:!0}))}),action:()=>{i.onSelect(),e.close()}}}))}];return o()(W.Z,{menuType:E.o.Popup},void 0,o()(V.Z,{type:V.i.Vertical,initialFocus:void 0,sections:i}))}})}function K(){const e=(0,u.y)((e=>({icon:{width:22,height:22,fill:e.teamAccessLevelIcons.blue},button:{width:"100%",margin:0,paddingTop:4,paddingBottom:4,border:"1px solid ".concat(e.outlineButtonBorder)}})),[]);return o()(N.Z,{disabled:!0,title:o()(D.n,{title:o()(g.FormattedMessage,{id:"openAndDefaultTeamInformation.title",defaultMessage:"Open",description:"Title for open teamspace."}),badge:o()(z.Z,{},void 0,o()(g.FormattedMessage,{id:"openAndDefaultTeamInformation.defaultPill",defaultMessage:"Default",description:"Pill displayed next to the open access level option when a teamspace is a default teamspace."}))}),caption:o()(g.FormattedMessage,{id:"openAndDefaultTeamInformation.caption",defaultMessage:"Anyone can see and join this teamspace",description:"Caption for open teamspace."}),icon:m.Z.openTeam(e.icon),focused:!1,shouldWrapCaption:!0,buttonStyle:e.button})}var j=i(30688),Y=i(51923);const Q={display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",userSelect:"none",WebkitUserSelect:"none",position:"relative",padding:22},X={createTeamContainer:{...Q,width:480},addMembersContainer:{...Q,width:500},inputs:{paddingLeft:12,paddingRight:12,paddingBottom:8,width:"100%"}},J=(0,g.defineMessages)({teamNamePlaceholder:{id:"sidebarCreateTeamModal.teamScreen.namePlaceholder",defaultMessage:"Acme Labs"},teamDescriptionPlaceholder:{id:"sidebarCreateTeamModal.teamScreen.descriptionPlaceholder",defaultMessage:"Details about your teamspace"}});function $(){const[e,t]=(0,c.oR)(w.Z);return l().createElement(l().Fragment,null,o()(F.Z,{hasMarginTop:!0,style:{fontWeight:p.Z.fontWeight.medium,marginTop:18}},void 0,o()(g.FormattedMessage,{id:"sidebarCreateTeamModal.teamScreen.teamDescriptionLabel",defaultMessage:"Description"})),o()(I.Z,{value:e.description,placeholder:v.default.formatMessage(J.teamDescriptionPlaceholder),textarea:!0,onChange:i=>{t({...e,description:i.target.value})}}))}function ee(e){return o()("div",{style:{fontSize:18,fontWeight:p.Z.fontWeight.semibold,marginTop:12,textAlign:"center"}},void 0,(()=>{switch(e.screen){case w.F.Team:return o()(g.FormattedMessage,{id:"sidebarCreateTeamModal.teamTitle.label",defaultMessage:"Create a new teamspace"});case w.F.Members:return o()(g.FormattedMessage,{id:"sidebarCreateTeamModal.membersTitle.label",defaultMessage:"Add people"})}})())}function te(){const e=(0,d.O7)(),[t]=(0,c.oR)(w.Z),i=(0,r.useCallback)(((t,i)=>{f.ED({environment:e,from:i,teamStore:t})}),[e]),{open:n,screen:s}=t;if(n)switch(s){case w.F.Team:return o()(ae,{});case w.F.Members:const e=t.teamId;return e?o()(le,{teamId:e,onCompleted:e=>{i(e,"success")},onCanceled:e=>{i(e,"dismiss_button")}}):null}return null}function ie(){const[e,t]=(0,c.oR)(w.Z);return l().createElement(l().Fragment,null,o()(F.Z,{hasMarginTop:!0,style:{fontWeight:p.Z.fontWeight.medium}},void 0,o()(g.FormattedMessage,{id:"sidebarCreateTeamModal.teamScreen.teamNameLabel",defaultMessage:"Teamspace name"})),o()(I.Z,{value:e.name,placeholder:v.default.formatMessage(J.teamNamePlaceholder),onChange:i=>{t({...e,name:i.target.value})},preventSafariAutofill:!0}))}function ne(e){const t=(0,u.F)();return o()("div",{style:{fontSize:14,color:t.mediumTextColor,width:290,marginTop:3,marginBottom:22,textAlign:"center",lineHeight:1.4}},void 0,(()=>{switch(e.screen){case w.F.Team:return o()(g.FormattedMessage,{id:"sidebarCreateTeamModal.teamDescription.label",defaultMessage:"Teamspaces are where your team organizes pages, permissions, and members"});case w.F.Members:return o()(g.FormattedMessage,{id:"sidebarCreateTeamModal.membersDescription.label",defaultMessage:"Invite people to collaborate"})}})())}function oe(){const[e,t]=(0,c.oR)(w.Z),[i]=(0,c.oR)(b.default),n=(0,S.OX)(),s=(0,d.O7)(),a=(0,u.y)((e=>({box:{justifyContent:"space-between",alignItems:"center",display:"flex",width:"100%",paddingTop:12,paddingBottom:14,paddingRight:14,paddingLeft:14,boxShadow:"0 -1px 0 ".concat(e.regularDividerColor)},button:{marginLeft:8},previous:{fontSize:14,color:e.mediumTextColor,cursor:"pointer"}})),[]),{handleNextClick:r,nextMessage:l,isDisabled:m}={handleNextClick:async()=>{if(!i.currentSpaceStore)return;const o=e.name;if(!(await(0,y.Xg)({environment:s,spaceStore:i.currentSpaceStore,teamName:o})))return;let a;t((e=>({...e,loading:!0}))),a=n?await(0,f.HD)({environment:s,name:o,description:e.description,icon:e.icon,flowId:e.flowId}):await(0,f.Cm)({environment:s,name:o,description:e.description,icon:e.icon,accessLevel:e.accessLevel,flowId:e.flowId,createTeamHome:!0}),t(a?e=>{var t;return{...e,loading:!1,screen:w.F.Members,name:"",description:"",teamId:null===(t=a)||void 0===t?void 0:t.id}}:e=>({...e,loading:!1}))},nextMessage:o()(g.FormattedMessage,{id:"sidebarCreateTeamModal.footer.createTeam",defaultMessage:"Create teamspace"}),isDisabled:""===e.name};return o()("div",{style:a.box},void 0,o()(Y.Z,{helpCenterLocation:"bestPractices",analyticsFrom:"teams_learn_more_sidebar_create_team_modal"}),o()(k.Z,{isLarge:!0,onClick:r,disabled:m,style:a.button},void 0,l))}function se(){const[e,t]=(0,c.oR)(w.Z),i=(0,u.y)((e=>({logo:{fontSize:12,color:e.lightTextColor,marginTop:4},container:{alignItems:"center",display:"flex",flexDirection:"column",justifyContent:"center",width:"100%"}})),[]),[{currentSpaceStore:n}]=(0,c.oR)(b.default);if(!n)return null;const s=e.icon?{icon:e.icon,pointer:{table:"space",id:n.id}}:void 0;return o()("div",{style:i.container},void 0,o()(x.Z,{disabled:!1,bucket:"public",icon:s,isEmptyPage:!1,title:"team-icon-".concat(n.id),size:56,iconLoggingData:{recordTable:"team",source:"team_creation"},onChange:i=>{t({...e,icon:i})}}),o()("div",{style:i.logo},void 0,o()(g.FormattedMessage,{id:"sidebarCreateTeamModal.logo.label",defaultMessage:"Choose icon"})))}function ae(){const[e]=(0,c.oR)(w.Z),{loading:t}=e,i=(0,u.F)(),n=(0,d.O7)();return(0,r.useEffect)((()=>{if(e.open){const{from:t,flowId:i}=e;h.trackCreateTeamStart(n,{from:t,flowId:i})}}),[]),l().createElement(l().Fragment,null,o()("div",{style:X.createTeamContainer},void 0,o()(ee,{screen:w.F.Team}),o()(ne,{screen:w.F.Team}),o()("div",{style:{...X.full,...X.inputs}},void 0,o()(se,{}),o()(ie,{}),o()($,{}),o()(re,{}))),o()(oe,{}),t&&o()("div",{style:{width:"100%",height:"100%",backgroundColor:i.modalUnderlayBackground,position:"absolute",top:0,left:0}},void 0,o()(P.Z,{style:{position:"absolute",top:"50%",left:"50%"}})))}function re(){const[e,t]=(0,c.oR)(w.Z),i=(0,S.OX)();return o()("div",{style:{marginTop:20}},void 0,o()(F.Z,{hasMarginTop:!0,style:{fontWeight:p.Z.fontWeight.medium}},void 0,o()(g.FormattedMessage,{id:"sidebarCreateTeamModal.teamScreen.permissionsLabel",defaultMessage:"Permissions",description:"Header label above the teamspace access level switcher."})),i?o()(K,{}):o()(G,{currentAccessLevel:e.accessLevel,onChange:i=>{t({...e,accessLevel:i})}}))}function le(e){const t=(0,d.O7)(),[,,i]=(0,c.oR)(w.Z),[,,n]=(0,c.oR)(void 0,C.Z);(0,c.VK)((()=>{const{defaultInviteTargets:e,flowId:t}=i.state;n.setState({...n.state,flowId:t}),e&&n.setState({...n.state,isInviteTargetsEmpty:!1,inviteTargets:e})}),[i,n]);const[s]=(0,c.oR)(b.default);if(!s.currentSpaceStore)return null;const a=M.Z.createChildStore(s.currentSpaceStore,{table:"team",id:e.teamId,spaceId:s.currentSpaceStore.id});return o()("div",{style:X.full},void 0,o()("div",{style:X.addMembersContainer},void 0,o()(j.Z,{store:a,permissionsInviteStore:n,isNewlyCreatedTeam:!0,onSubmitSuccessful:()=>{i.reset(),e.onCompleted(a),(0,f.hI)({environment:t,teamStore:a,shouldScroll:!0})},onDismiss:()=>{i.reset(),e.onCanceled(a)}})))}function de(){const e=(0,d.O7)(),[t,,]=(0,c.oR)(w.Z),i=(0,u.y)((e=>({modal:{maxWidth:600,borderRadius:3},closeButton:{position:"absolute",top:14,right:14,zIndex:10,display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"100%",background:e.buttonHoveredBackground,width:20,height:20},closeButtonHover:{background:e.buttonPressedBackground},closeButtonIcon:{width:14,fill:e.mediumTextColor},wrapper:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",userSelect:"none",WebkitUserSelect:"none"},container:{display:"flex",alignItems:"center",justifyContent:"center",flexDirection:"column",userSelect:"none",WebkitUserSelect:"none"}})),[]),n=(0,r.useCallback)((t=>{f.ED({environment:e,from:t})}),[e]),{open:s}=t;return o()(_.Z,{open:s,innerStyle:i.modal,onDismiss:()=>{n("modal")},render:()=>{const{device:t}=e;return o()("div",{style:{height:"100%"}},void 0,!t.isMobile&&o()(T.Z,{onClick:()=>{n("close_button")},style:i.closeButton,hoveredStyle:i.closeButtonHover},void 0,m.Z.closeSmall(i.closeButtonIcon)),o()("div",{style:i.wrapper},void 0,o()(Z.Z,{capture:!0,onBackspace:a().identity,onLeft:a().identity,onRight:a().identity,onSelectAll:a().identity,onRedo:a().identity,onUndo:a().identity,onCut:a().identity,onCopy:a().identity,onPaste:a().identity,onKeypress:a().identity,onDelete:a().identity,onTab:a().identity},void 0,o()(te,{}))))}})}},67110:(e,t,i)=>{i.r(t),i.d(t,{default:()=>G});var n=i(97464),o=i.n(n),s=i(77094),a=i.n(s),r=i(77422),l=i.n(r),d=(i(33948),i(67294)),c=i.n(d),u=i(83355),m=i(8848),p=i(33728),g=i(5366),h=i(21325),f=i(43250),v=i(4708),y=i(60709),S=i(75472),b=i(33665),M=i(33052),w=i(78140),C=i(40721),k=i(72495),T=i(83182),I=i(79813),Z=i(91487),P=i(47082),_=i(96486),x=i.n(_),F=i(480),A=i(24405),B=i(53397),E=i(92350),R=i(31194),D=i(52275),L=i(31945),O=i(58189),N=i(91941);const U=["owner","member"],W=(0,g.defineMessages)({ownerLabel:{id:"teamPermissionsMenu.ownerItem.label",defaultMessage:"Teamspace owner"},ownerCaption:{id:"teamPermissionsMenu.ownerItem.caption",defaultMessage:"Can edit teamspace settings and full access to teamspace pages."},memberLabel:{id:"teamPermissionsMenu.memberItem.label",defaultMessage:"Teamspace member"},memberCaption:{id:"teamPermissionsMenu.memberItem.caption",defaultMessage:"Cannot edit teamspace settings and can access teamspace pages."}}),V={owner:{label:W.ownerLabel,caption:W.ownerCaption},member:{label:W.memberLabel,caption:W.memberCaption}};function z(e){const{disabled:t,selectedRole:i,onChange:n,store:s}=e,{device:r}=(0,F.O7)(),l=(0,A.F)(),d=(0,E.ql)(s);return a()(L.Z,{popupType:r.isMobile?L.Z.PopupType.SlideUp:L.Z.PopupType.Popup,renderOrigin:e=>c().createElement(N.Z,o()({disabled:t,disabledFeedback:!0},e),c().createElement(g.FormattedMessage,V[i].label),B.Z.chevronDown({width:10,marginLeft:4,fill:l.lightIconColor})),placementToOrigin:R.Iw.Bottom,render:e=>{const t=[{key:"roles",render:e=>c().createElement(k.Z,o()({},e,{topBorder:0!==e.index})),items:U.map((t=>{const s=!d&&"owner"===t;return{key:t,render:e=>c().createElement(D.Z,o()({},e,{focused:!1,checkState:x().isEqual(t,i),disabled:s,disabledFeedback:s,title:a()("div",{style:{display:"flex",alignItems:"center"}},void 0,c().createElement(g.FormattedMessage,V[t].label)),caption:a()("span",{style:{color:l.mediumTextColor}},void 0,c().createElement(g.FormattedMessage,V[t].caption)),shouldWrapCaption:!0})),action:()=>{n(t),e.close()}}}))}];let s;return s=r.isMobile?{menuType:y.o.Modal,title:a()(g.FormattedMessage,{id:"teamPermissionsMenu.mobile.title",defaultMessage:"Select teamspace role",description:"Message telling user they can select a teamspace role here."}),right:a()(g.FormattedMessage,{id:"teamPermissionsMenu.mobile.doneButton.label",defaultMessage:"Done",description:"Done button"}),onClickRight:e.close}:{menuType:y.o.Popup,width:264},c().createElement(w.Z,s,a()(O.Z,{type:O.i.Vertical,initialFocus:void 0,sections:t}))}})}const q="member";class H extends u.Z{constructor(){super(...arguments),l()(this,"storeTypes",{permissionsInviteStore:M.Z}),l()(this,"handleModalDismiss",(async()=>{const{permissionsInviteStore:e}=this.stores,{disabled:t}=this.props;return e.setState({...e.state,inviteTargets:[],isInviteTargetsEmpty:!0,modalOpen:!t&&await(0,S.Aw)({environment:this.environment,permissionsInviteStoreState:e.state,from:"team_invite_overlay"})})})),l()(this,"handleInputChange",(e=>{const t=e.target.value,{extractedEmails:i,newInputValue:n}=(0,p.zI)(t),o=i.map((e=>({type:"newUser",value:{email:e}}))).filter((e=>!(0,S.Nd)({target:e,permissionsInviteStore:this.stores.permissionsInviteStore}))),s=[...this.stores.permissionsInviteStore.state.inviteTargets,...o];s.length>0?this.stores.permissionsInviteStore.setState({...this.stores.permissionsInviteStore.state,inviteTargets:s,isInviteTargetsEmpty:!1,tokenQuery:n}):this.stores.permissionsInviteStore.setState({...this.stores.permissionsInviteStore.state,inviteTargets:[],isInviteTargetsEmpty:!0,tokenQuery:n})})),l()(this,"handleClickRemoveToken",(e=>{const{permissionsInviteStore:t}=this.stores;if(t.state.isInviteTargetsEmpty)return;const i=t.state.inviteTargets.filter((t=>t!==e));0===i.length?t.setState({...t.state,inviteTargets:[],inviteRole:q,isInviteTargetsEmpty:!0}):t.setState({...t.state,inviteTargets:i})}))}async willMount(){await h.bi(this.environment)}renderComponent(){const{onEmptySubmit:e}=this.props,{permissionsInviteStore:t}=this.stores,{tokenQuery:i}=t.state,n=t.state.inviteTargets.map((e=>{const i="newUser"===e.type?e.value.email:"".concat(e.type,"-").concat(e.value.id);return a()(Z.Z,{target:e,onClickRemove:this.handleClickRemoveToken,role:t.state.inviteRole,disabled:this.props.disabled,shouldWrap:!0,style:this.getInputTokenVerticalMarginStyle(),backgroundColor:(0,v.Wn)()?(0,S.gQ)(e):void 0},i)})),{device:s}=this.environment,r=this.props.intl.formatMessage({id:"teamPermissionsInvite.searchInput.placeholder",defaultMessage:"Search people or groups",description:"Placeholder text for inviting people or groups to a team"}),l=a()(P.Z,{focus:this.isInputFocusedAndEnabled(),focusInitial:s.isMobile,focusAfterAnimation:!0,format:P.Z.Format.Share,value:i,onChange:this.handleInputChange,type:"email",tokens:n,disabled:this.props.disabled,placeholder:r,onRemoveLastToken:()=>{const e={...this.stores.permissionsInviteStore.state};e.inviteTargets=e.inviteTargets.slice(0,-1),0===e.inviteTargets.length&&(e.isInviteTargetsEmpty=!0,e.inviteRole=q),this.stores.permissionsInviteStore.setState(e)},right:!s.isMobile&&this.renderDesktopInputRightInnerSelect({marginLeft:8,display:"flex",alignItems:"center"}),style:this.getTokenMenuItemStyle(),inputAndTokenWrapRightStyle:{alignItems:"center"},inputStyle:this.getInputTokenVerticalMarginStyle(),inputDivStyle:{marginBottom:0},dontShowBorderBottom:s.isAndroid,onEmptySubmit:e}),d=this.isInputFocusedAndEnabled()&&i.length>0;let u;return u=s.isMobile?{menuType:y.o.Modal,title:a()(g.FormattedMessage,{id:"inviteUserModal.invitePersonMenu.title",defaultMessage:"Invite a person"}),right:a()("div",{style:{color:m.ZP.blue}},void 0,a()(g.FormattedMessage,{id:"inviteUserModal.mobile.inviteButton.label",defaultMessage:"Invite"})),left:a()(C.CancelMenuText,{}),onClickLeft:this.handleModalDismiss,header:l}:{menuType:y.o.Popup,width:"100%",header:l,tokenInputHeader:!1,disableScroller:!0,scrollerStyle:{zIndex:1}},a()("div",{style:{borderRadius:3,boxShadow:this.isInputFocusedAndEnabled()?this.theme.outlineBlueInputBoxShadow:this.theme.inputBoxShadow},onFocus:()=>{t.setState({...t.state,isFocused:!0})},onBlur:()=>{t.setState({...t.state,isFocused:!1})}},void 0,c().createElement(w.Z,o()({},u,{className:f.FJ}),s.isMobile&&a()(k.Z,{title:a()(g.FormattedMessage,{id:"inviteUserModal.permissionLevel.title",defaultMessage:"Permission level"})},void 0,this.renderDesktopInputRightInnerSelect()),a()("div",{style:{position:"absolute",width:"100%",zIndex:1,backgroundColor:this.theme.popoverBackground,borderRadius:3,boxShadow:this.theme.inputBoxShadow}},void 0,d&&a()(I.Z,{permissionsInviteStore:t,store:this.props.store,defaultRoleForSpaceBot:"editor",shouldShowBots:!1,shouldShowGroups:!0,sectionRenderLimit:10,membersOnly:!1,hideUserTypeToken:(0,v.Wn)()})),s.isMobile&&this.renderHelpButton()))}renderHelpButton(){return a()(k.Z,{topBorder:!0,disableDesktopPadding:!0},void 0,a()(T.Z,{title:a()(g.FormattedMessage,{id:"inviteUserModal.helpButton.caption",defaultMessage:"Learn how to invite people and set permissions"}),href:(0,b.UY)("guides.invitePerson"),analyticsFrom:"invite_person"}))}renderDesktopInputRightInnerSelect(e){const{permissionsInviteStore:t}=this.stores,i=a()(z,{disabled:this.props.disabled,store:this.props.store,selectedRole:t.state.inviteRole,onChange:e=>t.setState({...t.state,inviteRole:e})});return e?a()("div",{style:e},void 0,i):i}isInputFocusedAndEnabled(){return Boolean(this.stores.permissionsInviteStore.state.isFocused)&&!this.props.disabled}getTokenMenuItemStyle(){const e=8-H.inputTokenVerticalMargin;return{alignItems:"unset",borderRadius:3,paddingTop:e,paddingBottom:e,paddingLeft:8,paddingRight:e}}getInputTokenVerticalMarginStyle(){return{marginTop:H.inputTokenVerticalMargin,marginBottom:H.inputTokenVerticalMargin}}}l()(H,"avatarSize",24),l()(H,"inviteButtonWidth",70),l()(H,"inputTokenVerticalMargin",3);const G=(0,g.injectIntl)(H)},30688:(e,t,i)=>{i.d(t,{Z:()=>W});var n=i(97464),o=i.n(n),s=i(77094),a=i.n(s),r=(i(33948),i(67294)),l=i.n(r),d=i(480),c=i(28350),u=i(27006),m=i(64684),p=i(82990),g=i(5366),h=i(95209),f=i(64964),v=i(38363),y=i(43250),S=i(4708),b=i(75472),M=i(21115),w=i(23537),C=i(77907),k=i(27832),T=i(78291),I=i(42922),Z=i(61519),P=i(68785),_=i(63296),x=i(87968),F=i(58032),A=i(64369),B=i(51923),E=i(93686),R=i(13380);const D={button:{height:32},buttonContainer:{width:"100%",paddingTop:22,display:"flex",justifyContent:"end"},multiButtonContainer:{width:"100%",paddingTop:12,display:"flex",justifyContent:"space-between"},autoAddToggleContainer:{width:"100%",marginTop:22},switcherRow:{marginTop:22},container:{display:"flex",alignItems:(0,S.Wn)()?"left":"center",justifyContent:(0,S.Wn)()?"left":"center",flexDirection:"column",userSelect:"none",WebkitUserSelect:"none",width:"100%"},titleAndIcon:{paddingBottom:18,alignItems:"center",display:"flex"},addMembersTo:{minWidth:"25%"},icon:{paddingRight:3,paddingLeft:3},teamName:{paddingRight:10,fontWeight:p.Z.fontWeight.medium,...p.Z.textOverflowStyle,maxWidth:250},full:{width:"100%"},submitTooltip:{minWidth:250},subtitle:{paddingTop:16}},L=e=>{const{store:t,permissionsInviteStore:i,isAddAllMembersToggled:n,membersOnly:o,onEmptySubmit:s}=e,r=(0,w.S1)();return a()(C.LazyTeamPermissionsInvite,{store:t,permissionsInviteStore:i,disabled:!r&&n,membersOnly:o,onEmptySubmit:s})};function O(e){let{isLoading:t,isNewlyCreatedTeam:i,isDefaultTeamChanged:n,onDismiss:s,onSubmit:r,workspaceMembersToInvite:d,includesGroups:c,inviteRole:u}=e,m=a()(g.FormattedMessage,{id:"teamPermissionsInviteOverlay.inviteModal.done",defaultMessage:"Done"});const p=d>0,h=p||n,f="owner"===u;return i?p?m=a()(g.FormattedMessage,"owner"===u?{id:"teamPermissionsInviteOverlay.inviteModal.inviteNOwners",defaultMessage:"{numMembers, plural, one {Invite {numMembers} owner} other {Invite {numMembers} owners}}",description:"Button prompt for inviting teamspace owners.",values:{numMembers:d}}:{id:"teamPermissionsInviteOverlay.inviteModal.inviteNMembers",defaultMessage:"{numMembers, plural, one {Invite {numMembers} member} other {Invite {numMembers} members}}",description:"Button prompt for inviting teamspace members.",values:{numMembers:d}}):h||(m=a()(g.FormattedMessage,{id:"teamPermissionsInviteOverlay.inviteModal.skipForNow",defaultMessage:"Skip for now",description:"Button prompt to skip adding teamspace members."})):p&&(m=a()(g.FormattedMessage,"owner"===u?{id:"teamPermissionsInviteOverlay.inviteModal.addNOwners",defaultMessage:"{numMembers, plural, one {Add {numMembers} owner} other {Add {numMembers} owners}}",description:"Button prompt for adding teamspace owners.",values:{numMembers:d}}:{id:"teamPermissionsInviteOverlay.inviteModal.addNMembers",defaultMessage:"{numMembers, plural, one {Add {numMembers} member} other {Add {numMembers} members}}",description:"Button prompt for adding teamspace members.",values:{numMembers:d}})),h?a()(F.Z,{textWrap:!0,style:D.submitTooltip,disableTooltip:!(c&&f),renderTooltip:()=>a()(g.FormattedMessage,{id:"teamPermissionsInviteOverlay.inviteModal.addNMembers.groupsAsOwnersTooltip",defaultMessage:"Cannot add groups as teamspace owners. Remove any groups to continue.",description:"Explains to user it cannot proceed to add permission groups as teamspace owners."}),render:e=>l().createElement(I.Z,o()({style:D.button,onClick:r,disabled:t||c&&f},e),m)}):a()(_.Z,{style:D.button,onClick:s,disabled:t},void 0,m)}function N(e){let{isLoading:t,isNewlyCreatedTeam:i,isDefaultTeamChanged:n,onDismiss:s,onSubmit:r,inviteTargets:d,includesGroups:c,inviteRole:u,membershipRequestsDisabled:m}=e;const p=d.length>0,h=p||n,f="owner"===u,v=d.filter((e=>(0,b.OA)(e))).length;return t?a()(I.Z,{style:{...D.button,minWidth:80},disabled:!0},void 0,a()(P.Z,{isWhite:!0})):i&&!h?a()(_.Z,{style:D.button,onClick:s,disabled:t},void 0,a()(g.FormattedMessage,{id:"teamPermissionsInviteOverlay.inviteModal.skipForNow",defaultMessage:"Skip for now",description:"Button prompt to skip adding teamspace members."})):a()(F.Z,{textWrap:!0,style:D.submitTooltip,disableTooltip:!(c&&f),renderTooltip:()=>a()(g.FormattedMessage,{id:"teamPermissionsInviteOverlay.inviteModal.addNMembers.groupsAsOwnersTooltip",defaultMessage:"Cannot add groups as teamspace owners. Remove any groups to continue.",description:"Explains to user it cannot proceed to add permission groups as teamspace owners."}),render:e=>l().createElement(I.Z,o()({style:D.button,onClick:r,disabled:!p||t||c&&f||v>0&&m},e),a()(g.FormattedMessage,{id:"teamPermissionsInviteOverlayV2.inviteButton.label",defaultMessage:"Invite",description:"Button prompt to add members or owners to teamspace."}))})}function U(e){let{inviteTargets:t,workspaceName:i,canEditSpaceMembership:n,membershipRequestsDisabled:o}=e;if(void 0===n)return null;if(!t||0===t.length)return null;const s=t.map((e=>{if("group"!==e.type&&(0,b.OA)(e))return e.value.email})).filter((e=>e));if(!s||0===s.length)return null;const r=function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return a()("b",{},void 0,t)},l=null!=i?i:"this workspace";return a()(A.Z,{isSecondaryColor:!0,isMultiline:!0,isSmall:!0},void 0,n?1===s.length?a()(g.FormattedMessage,{id:"TeamPermissionsInviteOverlayV2.addSpaceMembershipSingular.subtitle",defaultMessage:"<b>{guestEmail}</b> will be added to {workspaceName} as a billed workspace member.",description:"Subtitle explaning that a subset of members will be added to the workspace.",values:{guestEmail:s[0],workspaceName:l,b:r}}):a()(g.FormattedMessage,{id:"TeamPermissionsInviteOverlayV2.addSpaceMembershipPlural.subtitle",defaultMessage:"<b>{numberOfOtherEmails, plural, one {{firstGuest} and {secondGuest}} other {{firstGuest} and {numberOfOtherEmails} more}}</b> will be added to {workspaceName} as billed workspace members.",description:"Subtitle explaning that a subset of members will be added to the workspace.",values:{firstGuest:s[0],secondGuest:s[1],numberOfOtherEmails:s.length-1,workspaceName:l,b:r}}):o?a()(g.FormattedMessage,{id:"TeamPermissionsInviteOverlayV2.requestSpaceMembershipDisabled.subtitle",defaultMessage:"You can't add workspace guests to a teamspace. Ask your admin to add them as workspace members first.",description:"Subtitle explaning that guests can't be added to a teamspace."}):1===s.length?a()(g.FormattedMessage,{id:"TeamPermissionsInviteOverlayV2.requestSpaceMembershipSingular.subtitle",defaultMessage:"Request will be sent to your admin to add <b>{guestEmail}</b> as a member to {workspaceName}.",description:"Subtitle explaning that a subset of members will be added to the workspace.",values:{guestEmail:s[0],workspaceName:l,b:r}}):a()(g.FormattedMessage,{id:"TeamPermissionsInviteOverlayV2.requestSpaceMembershipPlural.subtitle",defaultMessage:"Request will be sent to your admin to add <b>{numberOfOtherEmails, plural, one {{firstGuest} and {secondGuest}} other {{firstGuest} and {numberOfOtherEmails} more}}</b> as members to {workspaceName}.",description:"Subtitle explaning that a subset of members will be added to the workspace.",values:{firstGuest:s[0],secondGuest:s[1],numberOfOtherEmails:s.length-1,workspaceName:l,b:r}}))}const W=function(e){let{store:t,permissionsInviteStore:i,isNewlyCreatedTeam:n,onSubmitSuccessful:o,onDismiss:s}=e;const l=(0,d.O7)(),{membersOnly:p,teamName:w,isDefaultTeam:C,workspaceName:I,canEditSpaceMembership:P,membershipRequestsDisabled:_}=(0,c.VK)((()=>{const{currentSpaceStore:e}=k.default.state;return{membersOnly:Boolean(t.getDisableGuests()||(null==e?void 0:e.getDisableGuests())),teamName:t.getName(),isDefaultTeam:t.isDefault(),workspaceName:null==e?void 0:e.getName(),canEditSpaceMembership:null==e?void 0:e.canEditMembership(),membershipRequestsDisabled:null==e?void 0:e.getDisableMembershipRequests()}}),[t]);(0,r.useEffect)((()=>()=>{n&&(0,v.hI)({environment:l,teamStore:t,shouldScroll:!0})}),[n,t,l]);const[F,A]=(0,r.useState)(!1),[W,V]=(0,r.useState)(C),z=(0,c.VK)((()=>{var e,i;if(n)return!1;const o=null===(e=k.default.state.currentSpaceStore)||void 0===e?void 0:e.getRole(),s=!!o&&(0,u.zz)(o),a=t.getValue(),r=t.getTeamAccessLevel(),l=null===(i=k.default.state.currentUserStore)||void 0===i?void 0:i.id,d=Boolean(a&&l&&(0,m.pd)(a,l));return s&&"open"===r&&d}),[t,n]),q=(0,c.VK)((()=>{const{data:e}=T.default.state;return e?M.su(e):0}),[]),H=(0,c.VK)((()=>i.state.inviteTargets),[i]),G=(0,c.VK)((()=>W?q:i.state.inviteTargets.length),[W,i,q]),K=(0,c.VK)((()=>i.state.inviteRole),[i]),j=(0,c.VK)((()=>{if(i.state.isInviteTargetsEmpty)return!1;return Boolean(i.state.inviteTargets.find((e=>"group"===e.type)))}),[i]),Y=(0,c.VK)((()=>i.state.flowId),[i]),Q=C!==W,X=async()=>{if(A(!0),Q){const e=k.default.state.currentSpaceStore;e&&await v.MH({teamStore:t,spaceStore:e,environment:l,isDefault:W,createNewTeamFlowId:Y,from:"team_permission_overlay"})}else if(G>0){const e=i.state.inviteTargets,n=await h.zK({environment:l,store:t,permissionsInviteStore:i,inviteOrigin:"team_invite_overlay"});if($&&void 0!==P)if(n){const i=(0,b.t0)({inviteTargets:e,recordStore:t,canEditSpaceMembership:P});if(!i)return;setTimeout((()=>{f.oV({label:i})}))}else setTimeout((()=>{f.oV({label:a()(g.FormattedMessage,{id:"TeamPermissionsInviteOverlay.inviteMembersFailure.message",defaultMessage:"Failed to send invites",description:"Message shown if new members could not be added to teamspace."})})}))}h.Mr({permissionsInviteStore:i}),A(!1),null==o||o()},J=()=>{h.Mr({permissionsInviteStore:i}),null==s||s()},$=(0,c.VK)((()=>(0,S.Wn)()),[]);return a()("div",{className:y.D$,style:{...D.full}},void 0,$?a()("div",{style:D.container},void 0,a()("div",{style:D.titleAndIcon},void 0,a()("div",{style:D.addMembersTo},void 0,a()(g.FormattedMessage,{id:"TeamPermissionsInviteOverlayV2.membersTitle.label",defaultMessage:"Invite people to",description:"A prefix for adding members to a certain teamspace (followed by the teamspace's name)."})),a()("div",{style:D.icon},void 0,a()(E.p,{disabled:!0,store:t,size:20})),a()(R.s,{style:D.teamName},void 0,w)),a()("div",{style:D.full},void 0,a()(L,{store:t,permissionsInviteStore:i,isAddAllMembersToggled:W,membersOnly:!0,onEmptySubmit:X}),a()("div",{style:D.subtitle},void 0,a()(U,{inviteTargets:H,workspaceName:I,canEditSpaceMembership:P,membershipRequestsDisabled:_}))),a()("div",{style:D.multiButtonContainer},void 0,a()(B.Z,{message:a()(g.FormattedMessage,{id:"TeamPermissionsInviteOverlayV2.learnMore.text",defaultMessage:"Learn more about teamspaces",description:"Learn more link in modal for adding members to a teamspace."}),analyticsFrom:"teams_learn_more_add_members",helpCenterLocation:"bestPractices"}),a()(N,{isLoading:F,onSubmit:X,onDismiss:J,isNewlyCreatedTeam:n,isDefaultTeamChanged:Q,inviteTargets:H,includesGroups:j,inviteRole:K,membershipRequestsDisabled:_}))):a()("div",{style:D.container},void 0,a()("div",{style:D.titleAndIcon},void 0,a()("div",{style:D.addMembersTo},void 0,a()(g.FormattedMessage,{id:"TeamPermissionsInviteOverlay.membersTitle.label",defaultMessage:"Add members to",description:"A prefix for adding members to a certain teamspace (followed by the teamspace's name)."})),a()("div",{style:D.icon},void 0,a()(E.p,{disabled:!0,store:t,size:20})),a()(R.s,{style:D.teamName},void 0,w)),a()("div",{style:D.full},void 0,a()(L,{store:t,permissionsInviteStore:i,isAddAllMembersToggled:W,membersOnly:p,onEmptySubmit:X})),z&&a()("div",{style:D.autoAddToggleContainer},void 0,a()(Z.Z,{size:"100%"}),a()(x.Z,{style:D.switcherRow,title:a()(g.FormattedMessage,{id:"teamSettings.defaultTeam.title",defaultMessage:"Make default teamspace",description:"Shown as a title for a toggle in teamspace settings that indicates whether the teamspace should be synced with the entire workspace."}),subtitle:a()(g.FormattedMessage,{id:"teamSettings.defaultTeam.subtitle",defaultMessage:"Automatically add all workspace members to this teamspace",description:"Shown as a sub-title for a toggle in teamspace settings that indicates whether the teamspace should be synced with the entire workspace."}),on:W,onChange:()=>{V(!W)},disabled:F})),a()("div",{style:D.buttonContainer},void 0,a()(O,{isLoading:F,onSubmit:X,onDismiss:J,isNewlyCreatedTeam:n,isDefaultTeamChanged:Q,workspaceMembersToInvite:G,includesGroups:j,inviteRole:K}))))}},86100:(e,t,i)=>{i.r(t),i.d(t,{default:()=>l});var n=i(77094),o=i.n(n),s=(i(33948),i(67294),i(28350)),a=i(9019),r=i(30688);const l=function(e){const[t,,i]=(0,s.oR)(e.permissionsInviteStore),n=()=>{i.reset()};return o()(a.Z,{modalStyle:{alignSelf:"center",overflow:"visible",top:0,width:500},open:t.modalOpen,onDismiss:n,renderContent:()=>o()("div",{style:{display:"flex",flexDirection:"column",alignItems:"end",padding:22}},void 0,o()(r.Z,{store:e.store,permissionsInviteStore:i,isNewlyCreatedTeam:!1,onSubmitSuccessful:n,onDismiss:n})),origin:e.origin})}},51923:(e,t,i)=>{i.d(t,{Z:()=>u});var n=i(77094),o=i.n(n),s=(i(67294),i(5366)),a=i(97880),r=i(33665),l=i(74523);function d(e){switch(e){case"bestPractices":return(0,r.UY)("guides.teamspacesLearnMore");case"workspaceOwnerGuide":return(0,r.UY)("guides.teamspacesWorkspaceOwner");case"settingsAndPermissions":return(0,r.UY)("guides.teamspacesSettingsAndPermissions");default:return(0,a.t1)(e)}}function c(e){return e||o()(s.FormattedMessage,{defaultMessage:"Learn about teamspaces",description:"Link that takes a user to a guide with more information about the teamspaces feature.",id:"teamsLearnMoreLink"})}function u(e){let{onClick:t,message:i,helpCenterLocation:n,analyticsFrom:s,containerStyle:a}=e;return o()("div",{style:a},void 0,o()(l.Z,{title:c(i),analyticsFrom:s,href:d(n),onClick:t}))}},62512:(e,t,i)=>{i.d(t,{n:()=>g});var n=i(77094),o=i.n(n),s=i(67294),a=i.n(s),r=i(28350),l=i(24405),d=i(19889),c=i(5366),u=i(31278),m=i(25383);const p=i(23596).Z.iconSize;function g(e){let{ownerStores:t,teamStore:i}=e;const n=(0,l.y)((e=>({container:{position:"relative",width:p,height:p},offsetIcon:{position:"absolute",bottom:0,right:2},teamBadge:{position:"absolute",bottom:-5,right:-3,background:e.modalBackground,padding:.75,borderRadius:"0.25em"}})),[]),{teamName:s,teamIcon:d}=(0,r.VK)((()=>({teamName:i.getName(),teamIcon:i.getIcon()})),[i]),c=e=>o()(u.Z,{disabled:!0,title:s,icon:d,isEmptyPage:!1,size:e});return 0===t.length?c(p):o()("div",{style:n.container},void 0,t.length>=2?a().createElement(a().Fragment,null,o()(h,{isSmall:!0,store:t[0]}),o()(h,{isSmall:!0,store:t[1],style:n.offsetIcon})):o()(h,{store:t[0]}),o()("div",{style:n.teamBadge},void 0,c(16)))}function h(e){let{store:t,isSmall:i=!1,style:n={}}=e;const s=(0,c.useIntl)(),a=i?22:p,g=(0,l.y)((e=>({icon:{width:a,height:a,borderRadius:a,boxShadow:e.avatarBoxShadow,...n}})),[a,n]),{userValue:h,userName:f}=(0,r.VK)((()=>{const e=null==t?void 0:t.getValue();return{userValue:e,userName:(0,d.Nz)(s,e)}}),[s,t]),v=h?o()(m.Z,{avatarShouldShowShadow:!0,userValue:h,size:a}):o()(u.Z,{bucket:"public",disabled:!0,isEmptyPage:!1,title:f,size:a,icon:void 0});return o()("div",{style:g.icon},void 0,v)}},71397:(e,t,i)=>{i.d(t,{E:()=>A,V:()=>B});var n=i(97464),o=i.n(n),s=i(77094),a=i.n(s),r=(i(33948),i(41817),i(73210),i(67294)),l=i.n(r),d=i(480),c=i(28350),u=i(24405),m=i(5366),p=i(64964),g=i(38363),h=i(80456),f=i(78122),v=i(92350),y=i(35901),S=i(27832),b=i(42922),M=i(61519),w=i(36488),C=i(74194),k=i(63296),T=i(58032),I=i(64369),Z=i(13490),P=i(51923),_=i(93686),x=i(49469),F=i(6638);function A(e){var t;let{teamStore:i}=e;const n=(0,d.O7)(),[{currentSpaceStore:o}]=(0,c.oR)(S.default),s=(0,v.TE)(i),[l,y]=(0,r.useState)(void 0),[M,w]=(0,r.useState)(void 0),C=s?22:34,k=(0,u.y)((()=>({container:{maxWidth:400,marginLeft:4},settingsLabel:{marginTop:s?12:8},descriptionLabel:{marginTop:12},nameAndIconWrap:{display:"flex",alignItems:"center",marginBottom:s?18:0},icon:{marginRight:8},name:{height:C},updateButton:{marginTop:14},learnMoreLinkContainer:{marginTop:20}})),[s,C]),T=(0,c.VK)((()=>i.getValue()),[i]);if(!T)return null;const F=T.name,A=null!==(t=T.description)&&void 0!==t?t:"",R=A.length>0,D=null==l?void 0:l.trim(),L=null==M?void 0:M.trim(),O=""===D||(void 0===M||L===A.trim())&&(void 0===l||D===F.trim());return a()("div",{style:k.container},void 0,a()(x.z,{title:a()(m.FormattedMessage,{id:"TeamSettingsGeneral.generalSettings.title",defaultMessage:"Teamspace details",description:"Basic details for teamspace."})}),a()(Z.Z,{style:k.settingsLabel},void 0,a()(m.FormattedMessage,{id:"TeamSettingsGeneral.generalSettings.iconAndName.title",defaultMessage:"Icon and name",description:"Icon and name for teamspace."})),a()("div",{style:k.nameAndIconWrap},void 0,a()(_.p,{disabled:s,store:i,style:k.icon,size:C,onChange:e=>{(0,h.createAndCommit)({userAction:"TeamSettingsGeneral.updateIcon",environment:n,perform:t=>{(0,g.fs)({store:i,update:{icon:e},transaction:t})}})}}),s?a()(I.Z,{},void 0,F):a()(B,{value:null!=l?l:F,style:k.name,onBlur:e=>{y(e)},onChange:e=>{y(e)},disabled:s,placeholder:"Acme Labs"})),a()(Z.Z,{style:k.descriptionLabel},void 0,a()(m.FormattedMessage,{id:"TeamSettingsGeneral.generalSettings.description.title",defaultMessage:"Description",description:"Description for teamspace."})),s?a()(I.Z,{isMultiline:!0,isSecondaryColor:!R},void 0,R?A:a()(m.FormattedMessage,{id:"TeamSettingsGeneral.generalSettings.noDescription",defaultMessage:"No description",description:"Shown in teamspace settings for teamspace members when there is no teamspace description."})):a()(B,{value:void 0===M?A:M,onBlur:e=>{w(e)},onChange:e=>{w(e)},disabled:s,textarea:!0,placeholder:"Details about your teamspace"}),!s&&a()(b.Z,{style:k.updateButton,disabled:O,isLarge:!0,onClick:async()=>{if(!O){if(D&&D!==F.trim()){if(!(await(0,f.Xg)({environment:n,spaceStore:o,teamName:D})))return}(0,h.createAndCommit)({userAction:"TeamSettingsGeneral.updateNameAndDescription",environment:n,perform:e=>{(0,g.fs)({store:i,update:{name:null!=D?D:F,description:null!=L?L:A},transaction:e})}}),p.oV({label:a()(m.FormattedMessage,{id:"TeamSettingsGeneral.settingsChanged",defaultMessage:"Updated teamspace details",description:"Tells the user that the changes they made to the team settings were successfully made."})})}}},void 0,a()(m.FormattedMessage,{id:"teamsWorkspaceSettings.updateButton.label",defaultMessage:"Update"})),a()(E,{teamStore:i}),a()(P.Z,{helpCenterLocation:"bestPractices",analyticsFrom:"teams_learn_more_team_settings_general",containerStyle:k.learnMoreLinkContainer}))}function B(e){const{value:t,style:i,onBlur:n,onChange:s,placeholder:d,disabled:c}=e,[u,m]=(0,r.useState)(!1),p=(0,r.useRef)(null);return a()(w.Z,{capture:u,render:a=>l().createElement(C.Z,o()({textarea:e.textarea,autosize:e.autosize,ref:p,onFocus:e=>{m(!0)},onBlur:e=>{m(!1),n(e.target.value)},onChange:e=>{m(!1),s&&s(e.target.value)},onSubmit:e=>{e.target.blur()},placeholder:d,disabled:c,value:t,style:i},a))})}function E(e){let{teamStore:t}=e;const i=(0,u.y)((()=>({divider:{marginTop:20,marginBottom:20},dangerZoneLabel:{marginBottom:8},archiveMessageLabel:{marginTop:8}})),[]),n=(0,d.O7)(),o=(0,c.VK)((()=>t.getValue()),[t]),s=(0,v.ql)(t),r=(0,y.y)(t.id);if(!o)return null;if(!s)return null;const p=o.name,h=Boolean(o.archived_by);return l().createElement(l().Fragment,null,a()(M.Z,{size:1,style:i.divider}),a()(x.z,{title:a()(m.FormattedMessage,{id:"sidebarTeamModalSettingsScreen.dangerZone.title",defaultMessage:"Danger zone"}),style:i.dangerZoneLabel}),h?l().createElement(l().Fragment,null,a()(k.Z,{isLarge:!0,onClick:()=>(e=>{let{teamStore:t,teamName:i}=e;return(0,g.YH)({environment:n,teamStore:t,teamName:i,from:"sidebar_team_modal"})})({teamName:p,teamStore:t})},void 0,a()(m.FormattedMessage,{id:"sidebarTeamModalSettingsScreen.dangerZone.restoreTeamButton",defaultMessage:"Restore teamspace"})),a()(I.Z,{isSmall:!0,isMultiline:!0,style:i.archiveMessageLabel},void 0,a()(m.FormattedMessage,{id:"sidebarTeamModalSettingsScreen.dangerZone.restoreTeamCaption",defaultMessage:"Restoring this teamspace will add it to the sidebar for all teamspace members that were previously added."}))):l().createElement(l().Fragment,null,a()(T.Z,{disableTooltip:!r,renderTooltip:()=>a()(m.FormattedMessage,{id:"sidebarTeamModalSettingsScreen.dangerZone.cannotArchive",defaultMessage:"Cannot archive this teamspace because it is the only default teamspace in this workspace.",description:"Tells the user that they're unable to archive this teamspace due to stated reason."}),render:e=>a()(F.P,{disabled:r,teamStoreInstance:t,tooltipEvents:e})}),a()(I.Z,{isSmall:!0,isMultiline:!0,style:i.archiveMessageLabel},void 0,a()(m.FormattedMessage,{id:"sidebarTeamModalSettingsScreen.dangerZone.archiveTeamCaption",defaultMessage:"Archiving this teamspace will remove access and hide it in the sidebar for all teamspace members."}))))}},49469:(e,t,i)=>{i.d(t,{z:()=>r});var n=i(77094),o=i.n(n),s=(i(67294),i(24405)),a=i(82990);function r(e){let{title:t,subtitle:i,style:n}=e;const r=(0,s.y)((e=>({base:{width:"100%"},title:{fontWeight:a.Z.fontWeight.medium,color:e.regularTextColor,fontSize:14},subtitle:{fontWeight:a.Z.fontWeight.regular,color:e.mediumTextColor,fontSize:12}})),[]);return o()("div",{style:{...r.base,...n}},void 0,o()("div",{style:r.title},void 0,t),i&&o()("div",{style:r.subtitle},void 0,i))}},6638:(e,t,i)=>{i.d(t,{c:()=>C,P:()=>k});var n=i(97464),o=i.n(n),s=i(77094),a=i.n(s),r=i(67294),l=i.n(r),d=i(480),c=i(28350),u=i(24405),m=i(5366),p=i(38363),g=i(92350),h=i(45660),f=i(14404),v=i(27832),y=i(63296),S=i(91718),b=i(51913),M=i(51923),w=i(49469);function C(e){let{teamStore:t}=e;const{currentSpaceStore:i}=(0,c.Kw)(v.default),n=(0,d.O7)(),o=(0,h.D)(),s=(0,f.Z)(),r=n.currentUser.id,y=(0,u.y)((e=>({header:{marginBottom:4}})),[]),C=(0,c.VK)((()=>{var e,n,o;return{disable_public_access:{spaceIsDisabled:null!==(e=null==i?void 0:i.getDisablePublicAccess())&&void 0!==e&&e,teamIsDisabled:t.getDisablePublicAccess()},disable_export:{spaceIsDisabled:null!==(n=null==i?void 0:i.getDisableExport())&&void 0!==n&&n,teamIsDisabled:t.getDisableExport()},disable_guests:{spaceIsDisabled:null!==(o=null==i?void 0:i.getDisableGuests())&&void 0!==o&&o,teamIsDisabled:t.getDisableGuests()},disable_team_page_edits:{spaceIsDisabled:void 0,teamIsDisabled:t.getDisableTeamPageEdits()}}}),[i,t]),k=(0,g.ql)(t),I=(0,c.VK)((()=>{var e;return null!==(e=null==i?void 0:i.canAdmin())&&void 0!==e&&e}),[i]);if(!i)return null;if(!r)return null;const Z=e=>o&&!C[e].teamIsDisabled,P=e=>{if(Z(e))return!1;if(!k)return!1;return!(e=>C[e].spaceIsDisabled&&C[e].teamIsDisabled)(e)||I},_=e=>Z(e)&&I,x=e=>{const{teamIsDisabled:i,spaceIsDisabled:o}=C[e],s=!i;(0,p.d)({environment:n,store:t,settingName:e,newTeamSettingValue:T(s),spaceSettingValue:void 0===o?void 0:T(o)})},F=e=>{if((e=>C[e].spaceIsDisabled)(e))return(e=>C[e].teamIsDisabled)(e)?a()(m.FormattedMessage,{id:"teamSettingsSecurity.basedOnWorkspaceSettings",description:"Text explaining that a setting is inherited from the workspace settings.",defaultMessage:"Based on <underline>workspace settings</underline>",values:{underline:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return a()("span",{style:{textDecoration:"underline"}},void 0,t)}}}):a()(m.FormattedMessage,{id:"teamSettingsSecurity.overridesWorkspaceSettings",description:"Text explaining that a setting overrides the workspace settings.",defaultMessage:"Overriding <underline>workspace setting</underline>",values:{underline:function(){for(var e=arguments.length,t=new Array(e),i=0;i<e;i++)t[i]=arguments[i];return a()("span",{style:{textDecoration:"underline"}},void 0,t)}}})},A=a()(S.Z,{subscriptionTier:s,analyticsName:"team_security_settings",desktopStyle:{display:"inline-block",marginLeft:8,marginTop:-3}}),B=a()(m.FormattedMessage,"business"===s?{id:"teamSettingsSecurity.setting.businessGateToggleTooltip",defaultMessage:"Upgrade to Business Plan to change security settings",description:"Shown when a user requires upgrade to change security setting."}:{id:"teamSettingsSecurity.setting.enterpriseGateToggleTooltip",defaultMessage:"Upgrade to Enterprise Plan to change security settings",description:"Shown when a user requires upgrade to change security setting."});return l().createElement(l().Fragment,null,a()(w.z,{style:y.header,title:a()(m.FormattedMessage,{id:"TeamSettingsSecurity.title",defaultMessage:"Security",description:"Teamspace security menu."})}),a()(b.SettingToggle,{on:C.disable_public_access.teamIsDisabled,disabled:!P("disable_public_access"),onChange:()=>x("disable_public_access"),shouldTriggerUpsell:_("disable_public_access"),secondCaption:F("disable_public_access"),title:l().createElement(l().Fragment,null,a()(m.FormattedMessage,{id:"teamSettingsSecurity.setting.shareTitle",defaultMessage:"Disable public page sharing",description:"Disable public page sharing for the teamspace"}),Z("disable_public_access")&&A),caption:a()(m.FormattedMessage,{id:"teamSettingsSecurity.setting.shareCaption",defaultMessage:"Disable the Share to web option in the Share menu for all pages in this teamspace.",description:"Disable the Share to web option in the Share menu for all pages in this teamspace."}),tooltip:Z("disable_public_access")&&B}),a()(b.SettingToggle,{on:C.disable_guests.teamIsDisabled,disabled:!P("disable_guests"),onChange:()=>x("disable_guests"),shouldTriggerUpsell:_("disable_guests"),secondCaption:F("disable_guests"),title:l().createElement(l().Fragment,null,a()(m.FormattedMessage,{id:"teamSettingsSecurity.setting.guestTitle",defaultMessage:"Disable guests",description:"Disable guests for this teamspace"}),Z("disable_guests")&&A),caption:a()(m.FormattedMessage,{id:"teamSettingsSecurity.setting.guestCaption",defaultMessage:"Prevent anyone from inviting people outside of the workspace to pages.",description:"Prevent anyone from inviting people outside of the workspace to pages for this teamspace."}),tooltip:Z("disable_guests")&&B}),a()(b.SettingToggle,{on:C.disable_export.teamIsDisabled,disabled:!P("disable_export"),onChange:()=>x("disable_export"),shouldTriggerUpsell:_("disable_export"),secondCaption:F("disable_export"),title:l().createElement(l().Fragment,null,a()(m.FormattedMessage,{id:"teamSettingsSecurity.setting.exportTitle",defaultMessage:"Disable export",description:"Disable export for this team"}),Z("disable_export")&&A),caption:a()(m.FormattedMessage,{id:"teamSettingsSecurity.setting.exportCaption",defaultMessage:"Prevent anyone from exporting as Markdown, CSV, or PDF.",description:"Prevent anyone from exporting as Markdown, CSV, or PDF for this team."}),tooltip:Z("disable_export")&&B}),a()(M.Z,{helpCenterLocation:"settingsAndPermissions",analyticsFrom:"teams_learn_more_team_settings_security",message:a()(m.FormattedMessage,{id:"teamSettingsSecurity.learnMore",defaultMessage:"Learn about teamspace security",description:"Link text that shows in the security tab of the teamspaces settings modal. When the user clicks the link, they are taken to a reference with more information about teamspaces security and permissions."})}))}function k(e){const t=(0,d.O7)(),i=(0,u.y)((e=>({disabled:{background:e.whiteButtonBackground,color:e.mediumTextColor}})),[]);return l().createElement(y.Z,o()({style:e.disabled?i.disabled:void 0,isLarge:!0,isRed:!e.disabled,disabled:e.disabled,onClick:()=>e.disabled?void 0:async function(e){let{teamStore:t,environment:i}=e;await(0,p.aQ)({environment:i,teamStore:t,from:"sidebar_team_modal"})}({environment:t,teamStore:e.teamStoreInstance})},e.tooltipEvents),a()(m.FormattedMessage,{id:"teamSettingsSecurity.dangerZone.archiveTeamButton",defaultMessage:"Archive teamspace",description:"Archive teamspace"}))}function T(e){return e?"disable":"allow"}},57361:(e,t,i)=>{i.r(t),i.d(t,{default:()=>Me});var n=i(77094),o=i.n(n),s=(i(33948),i(67294)),a=i.n(s),r=i(480),l=i(28350),d=i(24405),c=i(6287),u=i(50906),m=i(54642),p=i(90922),g=i(85997),h=i(26111),f=i(62854),v=i(80456),y=i(39865),S=i(28020),b=i(34174),M=i(39883),w=i(54258),C=i(27832),k=i(72500),T=i(37394),I=i(22346),Z=i(97464),P=i.n(Z),_=(i(41817),i(96486)),x=i.n(_),F=i(41892),A=i(53397),B=i(21202),E=i(97880),R=i(5366),D=i(84210),L=i(60709),O=i(92350),N=i(82136),U=i(80270),W=i(42922),V=i(52275),z=i(31945),q=i(62896),H=i(73063),G=i(78140),K=i(58189),j=i(63296),Y=i(44532),Q=i(72495),X=i(64369),J=i(25383),$=i(95642),ee=i(14254),te=i(93686);function ie(e){const{teamStore:t,preset:i,typedDatabases:n,onAddToTeam:s,...c}=e,u=(0,r.O7)(),m=(0,d.F)(),p=(0,l.VK)((()=>t.getUserIdsInTeam().length),[t]),g=(0,l.VK)((()=>{if(!i)return!1;const e=(0,M.w5)("collection",i);for(const i of e)if("collection"===i.type){var t,o;if((null!==(t=null===(o=n[i.uri])||void 0===o?void 0:o.length)&&void 0!==t?t:0)>0){return n[i.uri][0].getParentBlockStore()}}}),[i,n]),f=g?()=>{g&&(T.Z.reset(),h.navigate({environment:u,url:(0,D.Z)({store:g})}))}:e.onAddToTeam,v=o()(H.Z,g?{isBlue:!0,style:{borderRadius:"100px"},icon:A.Z.arrowRight,onClick:f,caption:o()(R.FormattedMessage,{defaultMessage:"View",description:"Go to the existing databases",id:"TemplateDetail.TeamItem.goButton"}),captionStyle:{textTransform:"none",color:m.blueColor},hovered:!0}:{isBlue:!0,style:{borderRadius:"100px"},icon:A.Z.plusThick,onClick:f,caption:o()(R.FormattedMessage,{defaultMessage:"Add",description:"Add a new instance of the databases to the team",id:"TemplateDetail.TeamItem.addButton"}),captionStyle:{textTransform:"none",color:m.accentColors.blue[400]},hovered:!0});return a().createElement(V.Z,P()({},c,{style:{width:256,paddingTop:6,paddingBottom:6},icon:o()(te.p,{store:t,size:20}),desktopIconStyle:{alignSelf:"flex-start",marginTop:3},right:c.focused?v:void 0,title:o()("div",{style:{display:"flex",flexDirection:"column"}},void 0,o()(ee.o,{teamStore:t}),o()("div",{style:{fontSize:12,color:m.lightTextColor}},void 0,o()(R.FormattedMessage,{defaultMessage:"{numberOfMembers, plural, one {{numberOfMembers} member} other {{numberOfMembers} members}}",values:{numberOfMembers:p},description:"Number of members on a team",id:"TemplateDetail.TeamItem.teamMemberCount"}))),onClick:f}))}function ne(e){var t;const i=(0,r.O7)(),n=(0,d.F)(),s=(0,d.y)((e=>({container:{width:"100%",height:"100%",overflow:"auto",flex:1,display:"flex",flexDirection:"column",alignItems:"stretch",background:e.contentBackground,color:e.regularTextColor},contentContainer:{paddingTop:16,paddingLeft:36,paddingRight:36},heroImg:{height:"100%",width:"100%"}})),[]),[c,m]=(0,l.oR)(T.Z),p=(0,l.VK)((()=>C.default.state.currentUserStore),[]),g=(0,l.VK)((()=>{var e;if(c.open&&"preset"===(null===(e=c.selectedTemplate)||void 0===e?void 0:e.type)){const e=c.selectedTemplate.uri,t=(0,M.SP)(e),i=null==t?void 0:t.presets.find((t=>t.uri===e));if(t&&i)return{currentApp:t,currentPreset:i}}}),[c]),h=(0,l.VK)((()=>{if(!g||!c.open)return;const{currentApp:e,currentPreset:t}=g,i=null==g?void 0:g.currentPreset.allToggleFeatures.filter((e=>!(null!=g&&g.currentPreset.requiredFeatures.some((t=>t.feature===e))))),s=x().join(x().compact(i.slice(0,c.showAllFeatures?i.length:6).map((e=>{var t;return null==g||null===(t=g.currentApp.allFeatures.find((t=>t.uri===e)))||void 0===t?void 0:t.name}))),", ");return a().createElement(a().Fragment,null,o()(X.Z,{isSmall:!0,style:{marginTop:20,marginBottom:4}},void 0,o()(R.FormattedMessage,{id:"templateDetail.customizableFeatures.label",defaultMessage:"Features",description:"Label shown in template library listing template features"})),o()("div",{style:{fontSize:14}},void 0,o()("span",{},void 0,s),!c.showAllFeatures&&i.length>6&&a().createElement(a().Fragment,null,o()("span",{},void 0,", "),o()("span",{style:{color:n.lightTextColor,cursor:"pointer"},onClick:()=>m({...c,showAllFeatures:!0})},void 0,"".concat(i.length-6," more...")))),e.presets.length>1&&a().createElement(a().Fragment,null,o()(X.Z,{isSmall:!0,style:{marginTop:20,marginBottom:4}},void 0,o()(R.FormattedMessage,{id:"templateDetail.relatedTemplates.label",defaultMessage:"Related templates"})),o()("div",{style:{display:"flex",flexDirection:"row",flexFlow:"wrap",gap:6}},void 0,e.presets.map((e=>{if(e.uri!==t.uri)return o()(j.Z,{style:{borderRadius:5},onClick:()=>{m({...c,selectedTemplate:{type:"preset",uri:e.uri},showAllFeatures:!1})}},void 0,o()("img",{src:e.icon,style:{width:16,height:16,marginLeft:-2}}),o()("span",{style:{marginLeft:6,fontSize:14}},void 0,e.name))})))))}),[g,m,c,n.lightTextColor]),f=(0,l.VK)((()=>{if(!c.open)return;const{selectedTemplate:e}=c;if(e){if("preset"===e.type){var t;if(!g)return;const{currentPreset:e}=g,n=null===(t=e.previews)||void 0===t?void 0:t.find((e=>"previewRootId"in e)),a=n&&new U.Z(i,{table:B.iU,id:n.previewRootId,spaceId:n.spaceId}),r=a?o()($.Z,{store:a,loadingContainerStore:void 0,context:N.S.InAppTemplatePreview,paddingLeft:0,paddingRight:0,paddingBottom:0,pageCoverHeight:0,titleFontSize:0,disabled:!0},a.id):o()("img",{style:s.heroImg,src:F.Z.images.appPackages.projectPreview1Png});return[e.name,e.description,o()("img",{src:e.icon,style:{width:30,height:30}}),r]}if("pageTemplate"===e.type){var n;const{template:t}=e,s=new U.Z(i,{table:B.iU,id:t.previewRootId,spaceId:t.spaceId}),a=o()($.Z,{store:s,loadingContainerStore:void 0,context:N.S.InAppTemplatePreview,paddingLeft:0,paddingRight:0,paddingBottom:0,pageCoverHeight:$.Z.defaultPageCoverHeight(i),disabled:!0});return[t.name,t.description,o()("span",{style:{fontSize:20}},void 0,o()(q.Z,{},void 0,null!==(n=t.emoji)&&void 0!==n?n:"")),a]}(0,E.t1)(e)}}),[c,g,i,s]),v=(0,O.E7)(),y=(0,l.VK)((()=>v.filter((e=>e.canAddOrRemoveTopLevelPages()))),[v]),S=a().useCallback((t=>{c.open&&(c.selectedTemplate&&e.onGetTemplateClick(c.selectedTemplate,t),m({open:!1}))}),[e,m,c]);if(!c.open)return null;if(!f)return null;const[b,w,k,I]=f,Z=c.open&&"preset"===(null===(t=c.selectedTemplate)||void 0===t?void 0:t.type),_=o()(z.Z,{renderOrigin:e=>a().createElement(W.Z,P()({},e,{style:{width:182,height:35}}),o()(R.FormattedMessage,{id:"templateDetail.getTemplateButton.label",defaultMessage:"Get template"})),onClick:()=>{(0,u.trackGetTemplateClick)(i,{template_name:b})},render:t=>{let s;s=i.device.isMobile?{menuType:L.o.ActionSheet}:{menuType:L.o.Popup,width:"100%"};const r=y.map((t=>({key:t.id,action:()=>{},render:i=>{var n;return a().createElement(ie,P()({teamStore:t,typedDatabases:null!==(n=e.typedDatabases[t.id])&&void 0!==n?n:{},preset:null==g?void 0:g.currentPreset,onAddToTeam:()=>S(t)},i))}})));return a().createElement(G.Z,s,o()(K.Z,{style:{paddingTop:6,paddingBottom:6},type:K.i.Vertical,initialFocus:void 0,sections:x().compact([r.length>0?{key:"teams",render:e=>a().createElement(Q.Z,P()({},e,{disableDesktopPadding:!0,style:{paddingBottom:4},title:"Add to a teamspace"})),items:r}:void 0,{key:"private",render:e=>a().createElement(Q.Z,P()({},e,{topBorder:r.length>0,disableDesktopPadding:!0,style:{paddingTop:4}})),items:[{key:"private",action:()=>{},render:e=>a().createElement(V.Z,P()({},e,{style:{width:256},icon:o()("div",{style:{position:"relative"}},void 0,o()(J.Z,{hasTooltip:!1,userValue:null==p?void 0:p.getValue()}),A.Z.lockedFilled({position:"absolute",bottom:-2,right:-2,zIndex:1,width:10,height:10,fill:n.accentColors.red[500]})),title:"Add to Private",onClick:()=>S()}))}]}])}))},originGap:4,popupType:i.device.isMobile?Y.kQ.SlideUp:Y.kQ.Popup});return a().createElement(a().Fragment,null,o()("div",{style:s.container},void 0,o()("div",{style:{height:Z?"45%":"68%",overflowX:"hidden",overflowY:"auto",maskImage:"linear-gradient(black 80%, transparent 100%)",WebkitMaskImage:"linear-gradient(black 80%, transparent 100%)"}},void 0,o()("div",{style:{width:1122,height:"100%",transform:"scale(0.55)",transformOrigin:"left top"}},void 0,o()("div",{style:{position:"relative"}},void 0,o()("div",{style:{marginTop:-20,opacity:1,zIndex:999,pointerEvents:"none"}},void 0,I),o()("div",{style:{backgroundColor:"transparent",position:"absolute",left:0,top:0,right:0,bottom:0,zIndex:1e3}})))),o()("div",{style:s.contentContainer},void 0,o()("div",{style:{display:"flex",flexDirection:"row",width:"100%",marginTop:20,marginBottom:20,justifyContent:"space-between"}},void 0,o()("div",{style:{display:"flex",flexDirection:"column"}},void 0,o()("div",{style:{display:"flex",flexDirection:"row",alignItems:"flex-start",marginBottom:20}},void 0,k,o()("div",{style:{display:"flex",flexDirection:"column",marginLeft:10}},void 0,o()("span",{style:{fontSize:20,fontWeight:700,lineHeight:1.2,marginTop:3}},void 0,b))),o()("div",{style:{fontSize:14}},void 0,w),h),o()("div",{style:{paddingLeft:30}},void 0,_,o()(X.Z,{isSmall:!0,style:{marginTop:20,marginBottom:4}},void 0,o()(R.FormattedMessage,{id:"templateDetail.madeBy.label",defaultMessage:"Made by"})),o()("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},void 0,o()("img",{src:F.Z.images.notionLogoPng,style:{width:15,height:16}}),o()("span",{style:{fontSize:14,fontWeight:500,marginLeft:5,marginRight:5}},void 0,"Notion")))))))}i(99244);var oe=i(89101),se=i(68989),ae=i(33929),re=i(31194),le=i(74194),de=i(3386),ce=i(7908);function ue(e){const{icon:t,title:i,on:n,wrapStyle:s,innerStyle:a,hideChevron:l}=e,c=(0,d.F)(),u=(0,r.O7)(),m=(0,d.y)((e=>({button:{fontSize:14,display:"inline-flex",alignItems:"center",justifyContent:"center",whiteSpace:"nowrap",borderRadius:32,height:u.device.isMobile?28:24,lineHeight:u.device.isMobile?"28px":"24px",padding:"0 8px",border:"1px solid ".concat(e.outlineButtonBorder),color:e.mediumTextColor,...n&&{color:e.blueColor,border:"1px solid ".concat(e.filterPillBorder),background:e.filterPillBackground},...a}})),[u.device.isMobile,a,n]);return o()("div",{style:{borderRadius:14,marginRight:6,display:"inline-flex",...s}},void 0,o()(ce.Z,{style:m.button,hoveredStyle:n?{background:c.outlineBlueButtonHoveredBackground}:void 0,pressedStyle:n?{background:c.outlineBlueButtonPressedBackground}:void 0,onMouseEnter:e.onMouseEnter,onMouseLeave:e.onMouseLeave,onClick:e.onClick,onDoubleClick:e.onDoubleClick},void 0,t,i,!l&&A.Z.chevronDown({width:10,marginLeft:4,marginTop:1,fill:n?c.blueColor:c.lightIconColor})))}const me=(0,R.defineMessages)({allPersona:{id:"templateGallery.sidebar.persona.all",defaultMessage:"All",description:"All"},designPersona:{id:"templateGallery.sidebar.persona.design",defaultMessage:"Design"},engPersona:{id:"templateGallery.sidebar.persona.eng",defaultMessage:"Engineering"},pmPersona:{id:"templateGallery.sidebar.persona.pm",defaultMessage:"Product Management"},marketingPersona:{id:"templateGallery.sidebar.persona.marketing",defaultMessage:"Marketing"},salesPersona:{id:"templateGallery.sidebar.persona.sales",defaultMessage:"Sales"},financePersona:{id:"templateGallery.sidebar.persona.finance",defaultMessage:"Finance"},supportPersona:{id:"templateGallery.sidebar.persona.support",defaultMessage:"Support"},hrPersona:{id:"templateGallery.sidebar.persona.hr",defaultMessage:"Human Resources"}}),pe=[se.Yt.roadmap,se.Yt.engineeringToDo,se.Yt.designTasks,se.Yt.hrMeetingNotes,se.Yt.pmMeetingNotes,se.Yt.teamMeetingNotes,se.Yt.salesMeetingNotes,se.Yt.designMeetingNotes,se.Yt.supportMeetingNotes,se.Yt.marketingMeetingNotes,se.Yt.engineeringMeetingNotes,se.Yt.pmDocs,se.Yt.teamDocs,se.Yt.engineeringDocs,se.Yt.supportProcessDocs,se.Yt.companyGoals,se.Yt.teamDirectory],ge=[se.Yt.companyHome,se.Yt.oneOnOneNotes,se.Yt.engineeringWiki,se.Yt.engineeringTechSpec,se.Yt.productWiki,se.Yt.productSpec,se.Yt.productTeamUpdate,se.Yt.visionAndStrategy,se.Yt.presentation,se.Yt.investorUpdate,se.Yt.designSprint,se.Yt.designSystem,se.Yt.designPortfolio,se.Yt.userResearch,se.Yt.experimentResults,se.Yt.dataDeepDive,se.Yt.brandAssets,se.Yt.teamWiki,se.Yt.brainstorm,se.Yt.projectRetrospective,se.Yt.productLaunchBrief,se.Yt.contentCalendar,se.Yt.blogEditorialCalendar,se.Yt.socialMediaCalendar,se.Yt.campaignBrief,se.Yt.moodBoard,se.Yt.mediaList,se.Yt.newHireOnboarding,se.Yt.employeeBenefits,se.Yt.interviewGuide,se.Yt.recruitingTracker,se.Yt.resume,se.Yt.jobBoard,se.Yt.applicantTracker,se.Yt.peopleDirectory,se.Yt.productFAQs,se.Yt.helpCenter,se.Yt.salesWiki,se.Yt.salesCRM,se.Yt.salesAssets,se.Yt.competitiveAnalysis],he={design:me.designPersona,eng:me.engPersona,pm:me.pmPersona,marketing:me.marketingPersona,sales:me.salesPersona,support:me.supportPersona,hr:me.hrPersona},fe={design:["notion://projects/projects_preset"],eng:["notion://projects/agile_preset",w.fS("engineeringWiki","preset")],pm:["notion://projects/agile_preset",w.fS("productWiki","preset")],marketing:["notion://projects/projects_preset"],sales:["notion://projects/projects_preset",w.fS("salesWiki","preset")],finance:["notion://projects/projects_preset",w.fS("companyHome","preset")],support:["notion://projects/projects_preset",w.fS("companyHome","preset")],hr:["notion://projects/projects_preset",w.fS("companyHome","preset")]},ve={design:[...se.Fe("designer",ae.default.getIntl()).items,...[se.Yt.designPortfolio,se.Yt.designSprint,se.Yt.brainstorm].map((e=>se.G_(e,ae.default.getIntl())))],eng:[...se.Fe("programmer",ae.default.getIntl()).items,...[se.Yt.experimentResults,se.Yt.engineeringTechSpec,se.Yt.brainstorm,se.Yt.dataDeepDive,se.Yt.projectRetrospective].map((e=>se.G_(e,ae.default.getIntl())))],pm:[...se.Fe("product_manager",ae.default.getIntl()).items,...[se.Yt.investorUpdate,se.Yt.visionAndStrategy,se.Yt.teamWiki,se.Yt.presentation,se.Yt.experimentResults,se.Yt.productSpec,se.Yt.brainstorm,se.Yt.dataDeepDive,se.Yt.projectRetrospective,se.Yt.oneOnOneNotes,se.Yt.productLaunchBrief].map((e=>se.G_(e,ae.default.getIntl())))],marketing:[...se.Fe("marketing",ae.default.getIntl()).items,...[se.Yt.presentation,se.Yt.brainstorm,se.Yt.blogEditorialCalendar,se.Yt.socialMediaCalendar,se.Yt.campaignBrief].map((e=>se.G_(e,ae.default.getIntl())))],sales:se.Fe("sales",ae.default.getIntl()).items,support:se.Fe("customer_support",ae.default.getIntl()).items,hr:[...se.Fe("hr_recruiting",ae.default.getIntl()).items,...[se.Yt.peopleDirectory,se.Yt.employeeBenefits,se.Yt.recruitingTracker,se.Yt.interviewGuide].map((e=>se.G_(e,ae.default.getIntl())))]};function ye(){const[e,t]=(0,l.oR)(T.Z),[i,n]=(0,s.useState)(""),[c,m]=(0,s.useState)(),p=(0,R.useIntl)(),g=(0,d.F)(),h=(0,r.O7)(),f=(0,d.y)((e=>({sidebar:{height:"100%",width:275,background:e.sidebarBackground,alignContent:"center",display:"flex",flexDirection:"column",alignItems:"stretch",boxShadow:e.sidebarBoxShadow},header:{padding:"12px 12px 0 12px"},searchIcon:{width:14,height:14,marginRight:6,flexGrow:0,flexShrink:0,fill:e.mediumIconColor},searchBar:{height:32,borderRadius:5,fontSize:14,marginTop:0,marginBottom:8,padding:"16px 10px"},filterBar:{marginBottom:6,display:"flex",flexDirection:"row",width:273,flexWrap:"wrap",gap:6}})),[]),v=()=>o()(z.Z,{popupType:z.Z.PopupType.Popup,renderOrigin:e=>a().createElement(ue,P()({on:!0,icon:A.Z.person({width:14,marginRight:6,fill:g.blueColor}),title:o()("span",{},void 0,a().createElement(R.FormattedMessage,c?he[c]:me.allPersona))},e)),placementToOrigin:re.Iw.Bottom,render:e=>(e=>{const t=[{key:"personas",render:e=>a().createElement(Q.Z,P()({},e,{topBorder:0!==e.index})),items:[void 0,...(0,E.Yd)(he)].map((t=>({key:null!=t?t:"all",render:e=>a().createElement(V.Z,P()({},e,{focused:!1,checkState:x().isEqual(t,c),title:o()("div",{style:{display:"flex",alignItems:"center"}},void 0,a().createElement(R.FormattedMessage,t?he[t]:me.allPersona)),shouldWrapCaption:!0})),action:()=>{m(t),e.close(),(0,u.trackTemplateModalPersonaSelection)(h,{persona:null!=t?t:"all"})}})))}],i={menuType:L.o.Popup,width:260};return a().createElement(G.Z,i,o()(K.Z,{type:K.i.Vertical,initialFocus:void 0,sections:t}))})(e)}),y=(0,l.VK)((()=>{if(!e.open)return;const t=(0,b.pp)().filter((e=>"notion://wiki_app"!==e.uri)).flatMap((e=>e.presets));if(""!==i)return t.filter((e=>e.name.toLowerCase().includes(i.toLowerCase())));const n=t.filter((e=>{var t;return!c||!(null===(t=fe[c])||void 0===t||!t.includes(e.uri))}));return n.length>0?n:(0,b.pp)().map((e=>e.presets[0]))}),[i,c,e]);a().useEffect((()=>{var i;if(!e.open)return;const n=null==y||null===(i=y[0])||void 0===i?void 0:i.uri;n&&!e.selectedTemplate&&t({...e,selectedTemplate:{type:"preset",uri:n},showAllFeatures:!1})}),[y,e,t]);const S=(""===i&&c?ve[c]:Object.values(ve).flat()).filter((e=>e.name.toLowerCase().includes(i.toLowerCase()))),M=ge.map((e=>e.sources["en-US"].previewRootId)),w=x().chain(S).uniqBy((e=>e.previewRootId)).filter((e=>void 0===pe.find((t=>t.sources["en-US"].previewRootId===e.previewRootId)))).sortBy((e=>M.indexOf(e.previewRootId))).value();return o()("div",{style:f.sidebar},void 0,o()("div",{style:f.header},void 0,o()(de.Z,{capture:!0,onBackspace:x().identity,onLeft:x().identity,onRight:x().identity,onSelectAll:x().identity,onRedo:x().identity,onUndo:x().identity,onCut:x().identity,onCopy:x().identity,onPaste:x().identity,onKeypress:x().identity,onDelete:x().identity,onTab:x().identity},void 0,o()(le.Z,{placeholder:p.formatMessage({id:"templateGallery.sidebar.searchbar.placeholder",defaultMessage:"Search templates"}),left:A.Z.searchThick(f.searchIcon),showClearButton:!0,format:le.Z.Format.Small,value:i,style:f.searchBar,onChange:e=>n(e.target.value)})),o()("div",{style:f.filterBar},void 0,v())),o()(Se,{pageTemplates:w,presets:y||[]}))}function Se(e){const{presets:t,pageTemplates:i}=e,n=(0,d.F)(),s=(0,r.O7)(),a=(0,d.y)((e=>({button:{height:44,padding:"8px 0",borderRadius:4,marginBottom:4,transition:"all 0.2s ease",color:e.mediumTextColor,alignItems:"flex-start"},unSelectedItem:{color:e.mediumTextColor},selectedItem:{background:"dark"===e.mode?e.popoverHoveredBackground:e.buttonHoveredBackground,fontWeight:500,color:e.regularTextColor},hoveredItem:{borderRadius:4,background:e.buttonHoveredBackground},presetIcon:{width:16,height:16},presetTitle:{fontSize:14,color:e.regularTextColor},presetDescription:{fontSize:12}})),[]);return o()("div",{style:{flexGrow:1,width:"100%",overflowY:"auto"}},void 0,o()(Q.Z,{style:{marginTop:6},desktopTitleStyle:{paddingLeft:8}},void 0,t.map((e=>o()(be,{icon:e.icon,name:e.name,template:{type:"preset",uri:e.uri}}))),i.map((e=>o()(be,{icon:e.icon,emoji:e.emoji,name:e.name,template:{type:"pageTemplate",template:e}}))),o()(V.Z,{desktopIconStyle:{alignSelf:"unset"},focused:!1,buttonStyle:{...a.button},title:o()("div",{style:{display:"flex",flexDirection:"row",alignItems:"center"}},void 0,A.Z.typesRelation({width:12,height:12,marginLeft:6,marginRight:12,marginBottom:0,fill:n.mediumIconColor}),o()(R.FormattedMessage,{defaultMessage:"More from the Community",id:"templateGallerySidebar.goToMarketingTemplateGalleryButton.label"})),onClick:()=>{(0,u.trackBrowseMoreTemplatesLink)(s),(0,h.navigateToExternalURL)({environment:s,url:oe._j.templates})}})))}function be(e){var t,i,n;const[s,a]=(0,l.oR)(T.Z),c=(0,r.O7)(),m=(0,d.y)((e=>({button:{height:44,padding:"8px 0",borderRadius:5,marginBottom:4,transition:"background 0.2s ease",color:e.mediumTextColor,alignItems:"flex-start",fontWeight:500,marginLeft:12,marginRight:12,width:"calc(100% - 24px)"},unSelectedItemText:{color:e.mediumTextColor},selectedItemText:{color:e.regularTextColor},selectedItem:{background:"dark"===e.mode?e.popoverHoveredBackground:e.sidebarItemSelectedBackground,fontWeight:500},hoveredItem:{background:e.buttonHoveredBackground},presetIcon:{width:16,height:16},presetTitle:{fontSize:14},presetDescription:{fontSize:12}})),[]),p=(0,l.VK)((()=>{if(!s.open)return!1;const{selectedTemplate:t}=s;return x().isEqual(t,e.template)}),[e.template,s]);if(!s.open)return null;const g=null!==(t=e.icon)&&void 0!==t&&t.startsWith("/")?o()("img",{src:e.icon,style:m.presetIcon}):o()(q.Z,{},void 0,null!==(i=null!==(n=e.emoji)&&void 0!==n?n:e.icon)&&void 0!==i?i:"");return o()(V.Z,{desktopIconStyle:{alignSelf:"unset"},buttonStyle:{...m.button,...p?m.selectedItem:void 0},textWrapperStyle:{...p?m.selectedItemText:m.unSelectedItemText},focused:!1,icon:g,title:o()("span",{style:m.presetTitle},void 0,e.name),shouldWrapCaption:!0,hoveredStyle:m.hoveredItem,onClick:()=>{a({...s,selectedTemplate:e.template,showAllFeatures:!1}),(0,u.trackTemplateModalItemClick)(c,{template_name:"preset"===e.template.type?e.template.uri:e.template.template.name})}})}function Me(){const e=(0,r.Fy)(),t=(0,r.O7)(),i=(0,d.y)((t=>({modal:{width:e.isMobile?"auto":890,height:e.isMobile?"auto":606,borderRadius:8}})),[e.isMobile]),[n]=(0,l.oR)(T.Z),Z=function(e){const t=(0,r.O7)(),[{currentSpaceStore:i}]=(0,l.oR)(C.default),[n,o]=a().useState({});return(0,s.useEffect)((()=>{!async function(){if(!e)return;if(!i)return;const n=await m.getTypedDatabases(t,{spaceId:i.id});if("success"===n.type){const e={};for(const o of n.data.result){var s;const{teamId:n,appUri:a,collectionId:r}=o,l=null!=n?n:"private",d=l in e?e[l]:e[l]={};(null!==(s=d[a])&&void 0!==s?s:d[a]=[]).push(new k.Z(t,{table:c.v,id:r,spaceId:i.id}))}o(e)}}()}),[t,i,e]),n}(n.open),P=async(e,i)=>{const{currentSpaceStore:o,currentSpaceViewStore:s}=C.default.state;if(!n.open)return;const a=(0,S.np)(),r=!n.createNewPage&&a&&a.isEmptyPage()?a:void 0;if("preset"!==e.type||e.uri.startsWith("notion://wiki")){const o="preset"===e.type?(0,w.CQ)(e.uri):e.template;if(!o)return;const{currentSpaceStore:s,currentSpaceViewStore:a}=C.default.state;if(!s||!a)return;let l;l=i?await(0,f.N)({environment:t,spaceStore:s,spaceViewStore:a,teamStore:i,template:o,from:"template_gallery"}):await g.rC({environment:t,item:o,isPrivate:n.isPrivate,spaceStore:s,spaceViewStore:a,useMinimalTemplates:!1,initializeStore:r}),l&&(0,h.navigateToBlock)({environment:t,store:l})}else{var l;const n=e.uri,a=null===(l=(0,M.SP)(n))||void 0===l?void 0:l.uri;if(!a||!o||!s)return;const{performResult:d}=(0,v.createAndCommit)({environment:t,perform:e=>{const s=(0,b.pp)().find((e=>e.uri===a)),r=null==s?void 0:s.presets.find((e=>e.uri===n));if(r){const s=(0,M.KC)(r);return p.ZM({environment:t,appParentStore:null!=i?i:o,appUri:a,preset:n,features:s,transaction:e})}return[]},userAction:"templateGallery.getTemplate"});d&&d.length>0&&((0,h.navigateToBlock)({environment:t,store:d[0]}),r&&(0,y.Tq)({environment:t,blocks:[r]}))}(0,u.trackTemplateModalAccept)(t,{template_name:"preset"===e.type?e.uri:e.template.name})},{open:_}=n;return o()(I.Z,{open:_,innerStyle:i.modal,onDismiss:()=>T.Z.reset(),render:()=>n.open?o()("div",{style:{height:"100%",display:"flex",flexDirection:"row",borderRadius:8,overflow:"hidden"}},void 0,o()(ye,{}),o()(ne,{onGetTemplateClick:P,typedDatabases:Z})):null})}},80366:(e,t,i)=>{i.d(t,{s:()=>a,c:()=>r});var n=i(77094),o=i.n(n),s=(i(67294),i(24405));function a(e){return{backgroundColor:e.groupedFormBackground,borderWidth:1,borderStyle:"solid",borderColor:e.groupedFormBorder,borderRadius:3,borderBottomWidth:0}}function r(e){const t=(0,s.y)((t=>({group:{display:"flex",borderBottomColor:t.groupedFormBorder,borderBottomWidth:1,borderBottomStyle:"solid",alignItems:"center",flex:1,...e.style}})),[e.style]);return o()("div",{style:t.group},void 0,e.children)}},33689:(e,t,i)=>{i.d(t,{J:()=>r});var n=i(32918),o=i(97880);var s=i(78291),a=i(21115);function r(e){let{environment:t}=e;const i=(0,a.CM)(t),{data:r}=s.default.state,l=(0,a.XX)(r);return function(e){let{subscriptionTier:t,subscriptionCreatedAtTime:i}=e;return"business"===t||"enterprise"===t||("team"===t||"team_free"===t)&&(0,o.$K)(i)&&i<n.Xn}({subscriptionTier:i,subscriptionCreatedAtTime:null==l?void 0:l.created})}},45660:(e,t,i)=>{i.d(t,{e:()=>l,D:()=>d});var n=i(480),o=i(28350),s=i(33689),a=i(21115),r=i(27832);function l(){const{currentSpaceStore:e}=(0,o.Kw)(r.default),t=(0,n.O7)();return(0,o.VK)((()=>{const i=null==e?void 0:e.getSubscriptionTier(),n=(0,a.CM)(t);return!("enterprise"===i||"business"===i||"enterprise"===n||"business"===n)}),[e,t])}function d(){const e=(0,n.O7)(),t=l();return(0,o.VK)((()=>t&&!(0,s.J)({environment:e})),[t,e])}},86275:(e,t,i)=>{i.d(t,{n:()=>S,U:()=>y});var n=i(77094),o=i.n(n),s=(i(67294),i(480)),a=i(28350),r=i(24405),l=i(53397),d=i(5366),c=i(64684),u=i(93678),m=i(74136);const p=function(e){let{tier:t}=e;const i=()=>o()(d.FormattedMessage,"business"===t?{id:"upgradeToBusinessBadge",description:"Shows Business Plan is required to access feature",defaultMessage:"Business"}:{id:"upgradeToEnterpriseBadge",description:"Shows Enterprise plan is required to access feature",defaultMessage:"Enterprise"});return o()(m.Z,{},void 0,o()(i,{}))};var g=i(27832);var h=i(14404),f=i(45660),v=i(35901);function y(e){let{isCreateTeam:t,teamStore:i,isDefault:n,onChange:y}=e;const b=(0,s.O7)(),M=function(){const{currentSpaceStore:e}=(0,a.Kw)(g.default);return(0,a.VK)((()=>{var t;return null!==(t=null==e?void 0:e.canAdmin())&&void 0!==t&&t}),[e])}(),w=(0,v.y)(null==i?void 0:i.id),C=(0,f.e)(),k=(0,h.Z)(),{isClosedOrPrivateTeamDisabled:T,closedOrPrivateDisabledTooltip:I}=(0,a.VK)((()=>{var e;return null!==(e=null==i?void 0:i.isDefault())&&void 0!==e&&e?M?w?{isClosedOrPrivateTeamDisabled:!0,closedOrPrivateDisabledTooltip:o()(d.FormattedMessage,{id:"TeamAccessLevelSwitcher.closeOrPrivateTeamspace.disabledTooltipOnlyDefaultTeam",defaultMessage:"Add another default teamspace to change teamspace permissions.",description:"Tooltip text shown when hovering over close or private teamspace button and it is disabled because this is the only default teamspace left."})}:{isClosedOrPrivateTeamDisabled:!1,closedOrPrivateDisabledTooltip:void 0}:{isClosedOrPrivateTeamDisabled:!0,closedOrPrivateDisabledTooltip:o()(d.FormattedMessage,{id:"TeamAccessLevelSwitcher.closeOrPrivateTeamspace.disabledTooltipNonAdmin",defaultMessage:"You can't change this setting because this is a default teamspace. Contact your workspace admin for help.",description:"Tooltip text shown when hovering over close or private teamspace button and it is disabled because user is not a workspace admin."})}:{isClosedOrPrivateTeamDisabled:!1,closedOrPrivateDisabledTooltip:void 0}}),[i,M,w]),Z=(0,a.VK)((()=>{var e;const t=null==i?void 0:i.getSettingsStore().getValue();return!!t&&(null!==(e="private"===(0,c.B5)(t))&&void 0!==e&&e)}),[i]),P=(0,r.F)(),_=(0,r.y)((()=>({iconStyle:{width:22,height:22},lockIcon:{width:16,height:16},lockIconContainer:{width:22,height:22,display:"flex",justifyContent:"center",alignItems:"center"}})),[]),x=o()(d.FormattedMessage,"business"===k?{id:"TeamAccessLevelSwitcher.privateTeamspaceUpsellBusiness.tooltip",defaultMessage:"Upgrade to Business Plan to enable Private teamspaces",description:"Tooltip asks user to upgrade to Business Plan to be able to set team as private"}:{id:"TeamAccessLevelSwitcher.privateTeamspaceUpsellEnterprise.tooltip",defaultMessage:"Upgrade to Enterprise Plan to enable Private teamspaces",description:"Tooltip asks user to upgrade to Enterprise Plan to be able to set teamspace as private"}),F=o()(d.FormattedMessage,{id:"TeamAccessLevelSwitcher.openTeamspace.title",defaultMessage:"Open",description:"Toggle title for open teamspace."}),A=o()(d.FormattedMessage,{id:"TeamAccessLevelSwitcher.closedTeamSpace.title",defaultMessage:"Closed",description:"Toggle title for closed teamspace."}),B=o()(d.FormattedMessage,{id:"TeamAccessLevelSwitcher.privateTeamSpace.title",defaultMessage:"Private",description:"Toggle title for private teamspace."});return[{key:"open",icon:e=>l.Z.openTeam({...e,..._.iconStyle}),iconColor:P.teamAccessLevelIcons.blue,level:F,title:n?o()(S,{title:F,badge:o()(m.Z,{},void 0,o()(d.FormattedMessage,{id:"TeamAccessLevelSwitcher.openTeamspace.defaultPill",defaultMessage:"Default",description:"Pill displayed next to the open access level option when a teamspace is a default teamspace."}))}):F,caption:o()(d.FormattedMessage,t?{id:"CreateTeamspaceMenu.openTeamspace.caption",defaultMessage:"Anyone can see and join this teamspace",description:"Toggle caption for open teamspace."}:{id:"TeamAccessLevelSwitcher.openTeamspace.caption",defaultMessage:"Anyone can see and join",description:"Toggle caption for open teamspace."}),disabled:!1,onSelect:()=>y("open"),tooltip:n&&o()(d.FormattedMessage,{id:"TeamAccessLevelSwitcher.openTeamspace.defaultTooltip",defaultMessage:"All workspace members are members of this teamspace",description:"Tooltip displayed when hovering above the open access level option when a teamspace is a default teamspace."})},{key:"closed",icon:e=>o()("div",{style:_.lockIconContainer},void 0,l.Z.unlockedFilled({...e,..._.lockIcon})),iconColor:P.teamAccessLevelIcons.orange,level:A,title:A,caption:o()(d.FormattedMessage,t?{id:"CreateTeamspaceMenu.closedTeamspace.caption",defaultMessage:"Anyone can see this teamspace but not join",description:"Toggle caption for closed teamspace."}:{id:"TeamAccessLevelSwitcher.closedTeamspace.caption",defaultMessage:"Anyone can see but not join",description:"Toggle caption for closed teamspace."}),disabled:T,tooltip:I,onSelect:()=>y("closed")},{key:"private",icon:e=>o()("div",{style:_.lockIconContainer},void 0,l.Z.lockedFilled({...e,..._.lockIcon})),iconColor:P.teamAccessLevelIcons.red,level:B,title:C?o()(S,{title:B,badge:o()(p,{tier:k})}):B,caption:o()(d.FormattedMessage,t?{id:"CreateTeamspaceMenu.privateTeamspace.caption",defaultMessage:"Only members can see that this teamspace exists",description:"Toggle caption for private teamspace."}:{id:"TeamAccessLevelSwitcher.privateTeamspace.caption",defaultMessage:"Only members can see",description:"Toggle caption for private teamspace."}),disabled:!C&&T||C&&!M,tooltip:C?x:I,onSelect:()=>{if(C&&!Z)return(0,u.y)(b,{from:"team_security_settings",for:k,dontOpenPlansOnCancel:!0});y("private")}}]}function S(e){let{title:t,badge:i}=e;const n=(0,r.y)((()=>({container:{display:"flex",flexWrap:"wrap",alignItems:"center"},badge:{marginLeft:5}})),[]);return o()("div",{style:n.container},void 0,t,o()("div",{style:n.badge},void 0,i))}},14404:(e,t,i)=>{i.d(t,{Z:()=>o});var n=i(92994);const o=function(){return"on"===(0,n.a)("show-business-plan")?"business":"enterprise"}},19234:(e,t,i)=>{i.d(t,{gq:()=>n});i(96486);function n(e){return e.country&&(t=e.country,!["US","CA"].includes(t))?"skip":e.addressLine1&&e.zipCode||e.addressLine1&&e.city&&e.state||e.zipCode?"should_resolve":"insufficient_data";var t}}}]);